{% extends "base.html" %}

{% block title %}Indexing library…{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/indexing.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="indexing-container bg-light-subtle rounded-4 shadow">
        <img src="{{ url_for('static', filename='logo.svg') }}"
             alt="Spinning mixtape"
             width="120"
             height="120"
             class="cassette-spinner">

        <h1 class="mb-3">Your music library is being indexed…</h1>
        <p class="lead text-muted mb-4">
            We are scanning your collection and reading metadata from all tracks. This only happens the first time or after major changes.
        </p>

        <div id="progress-container">
            <!-- Initial fallback content (shown before JS loads) -->
            <div class="progress" style="height: 2.2rem;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
            </div>
            <p class="mt-4">Loading indexing status…</p>
        </div>

        <div id="stats" class="stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="current">0</div>
                <div>Processed</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total">0</div>
                <div>Total</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="speed">—</div>
                <div>Speed</div>
            </div>
        </div>

        <div id="eta" class="eta fw-semibold text-success" style="display: none;"></div>

        <p class="tip mt-4">
            <small>
                <i class="bi bi-info-circle"></i>
                Tip: Grab a coffee or tea – we’ll be done soon! ☕
            </small>
        </p>

        <div class="mt-4">
            <small class="text-muted" id="update-info">Updating automatically…</small>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    {{ super() }}

    <script>
        window.INDEXING_STATUS_URL = {{ url_for('indexing_status_json')|tojson }};
        window.LANDING_URL = {{ url_for('landing')|tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/indexing/index.js') }}"></script>
{% endblock %}