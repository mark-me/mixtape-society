/* --- 0. Adaptive Background Gradient --- */
body {
    /* Background gradient will be set via JS */
    background-attachment: fixed;
    background-size: cover;
    background-position: center;
    position: relative;
    transition: background 0.6s ease-in-out;
    /* Ensure we have a base color to gradient over */
    background-color: var(--bs-body-bg);
}

/* Ensure content remains readable over gradient */
.container {
    position: relative;
    z-index: 1;
}

/* --- 1. Global & Body Overrides --- */
/* Don't override background properties set above */
body {
    color: var(--bs-body-color);
}

/* Player panel background fixes */
#main-player {
    background: var(--bs-body-bg);
}

#main-player::-webkit-media-controls-panel {
    background-color: var(--bs-body-bg);
}

/* === AUDIO PLAYER ADAPTIVE THEMING === */

/* Force native controls to respect theme */
audio {
    color-scheme: light dark;
    width: 100%;
    /* Use accent-color as primary method - most reliable */
    accent-color: var(--color-track);
}

/* Additional aggressive styling for Webkit */
#main-player {
    accent-color: var(--color-track);
    filter: saturate(1.2);
}

/* Dark mode specific adjustments */
[data-bs-theme="dark"] #main-player {
    filter: saturate(1.3) brightness(1.1);
}

/* Light mode specific adjustments */
[data-bs-theme="light"] #main-player {
    filter: saturate(1.1);
}

/* Webkit browsers (Chrome, Safari, Edge) */
audio::-webkit-media-controls-enclosure {
    background-color: var(--bs-body-bg);
    border-radius: 8px;
    filter: none;
}

audio::-webkit-media-controls-panel {
    background-color: var(--bs-body-bg);
}

/* Timeline (progress bar background) */
audio::-webkit-media-controls-timeline {
    background-color: var(--bs-secondary-bg);
    border-radius: 4px;
    margin: 0 8px;
    height: 6px;
}

/* Force track color onto all slider elements */
audio::-webkit-slider-runnable-track {
    background-color: var(--bs-secondary-bg);
}

audio::-webkit-slider-thumb {
    background-color: var(--color-track);
}

/* Current time and remaining time displays */
audio::-webkit-media-controls-current-time-display,
audio::-webkit-media-controls-time-remaining-display {
    color: var(--bs-body-color);
    font-size: 12px;
}

/* Volume slider */
audio::-webkit-media-controls-volume-slider {
    background-color: var(--bs-secondary-bg);
    border-radius: 4px;
}

/* Firefox */
audio::-moz-range-track {
    background-color: var(--bs-secondary-bg);
    border-radius: 4px;
    height: 6px;
}

audio::-moz-range-thumb {
    background-color: var(--color-track);
    border: none;
    border-radius: 50%;
    width: 12px;
    height: 12px;
}

audio::-moz-range-progress {
    background-color: var(--color-track);
    border-radius: 4px;
    height: 6px;
}

/* Additional specificity for main player */
#main-player::-webkit-slider-thumb {
    background: var(--color-track) !important;
    -webkit-appearance: none;
    appearance: none;
}

#main-player::-moz-range-thumb {
    background: var(--color-track) !important;
}

/* Bottom player specific styling */
#bottom-player-container audio {
    filter: none;
    accent-color: var(--color-track);
}

/* Bottom player background – translucent blur with theme support */
#bottom-player-container .bg-dark {
    background-color: rgba(var(--bs-body-bg-rgb), 0.95) !important;
    backdrop-filter: blur(10px);
    /* Override the text-white class for theme support */
    color: var(--bs-body-color) !important;
}

/* Fix heading color to be theme-aware */
h4.text-white {
    color: var(--bs-heading-color) !important;
}

/* --- 2. Bottom Player Text & Button Styling --- */

/* Make bottom player buttons theme-aware instead of btn-outline-light */
#bottom-player-container .btn-outline-light {
    border-color: var(--bs-border-color) !important;
    color: var(--bs-body-color) !important;
    background-color: transparent !important;
}

#bottom-player-container .btn-outline-light:hover {
    background-color: var(--bs-tertiary-bg) !important;
    border-color: var(--bs-border-color) !important;
    color: var(--bs-body-color) !important;
}

/* Bottom player text - make it theme-aware */
#bottom-now-title {
    color: var(--bs-body-color) !important;
}

#bottom-now-artist-album {
    color: var(--bs-secondary-color) !important;
    opacity: 1 !important; /* Remove opacity, use the color directly */
}

/* --- 2. Bottom Player Text Truncation & Layout --- */
#bottom-now-title,
#bottom-now-artist-album {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Limit the width of the track info section so it doesn't push controls off-screen */
.me-4.flex-shrink-0 {
    min-width: 0;
    /* Allows flex item to shrink below content size */
    max-width: 50vw;
    /* On very small screens, limit to ~half viewport */
    flex: 1 1 150px;
    /* Flexible growth/shrink, with a reasonable base */
}

#bottom-player-container .d-flex {
    min-width: 0;
    /* Prevents flex container overflow issues */
}

/* Mobile font size adjustments for bottom player */
@media (max-width: 576px) {
    #bottom-now-title {
        font-size: 0.9rem;
    }

    #bottom-now-artist-album {
        font-size: 0.75rem;
    }
}

/* --- 3. Track List – Layout & Numbering --- */

.track-item {
    padding: 1rem 1.5rem !important;
}

/* Text truncation */
.track-item .min-width-0 {
    min-width: 0;
}

/* Title */
.track-item .fw-bold {
    font-size: 1.15rem;
    line-height: 1.35;
}

/* Artist/album line */
.track-item .opacity-85 {
    opacity: 0.85;
    font-size: 0.95rem;
}

/* Play button hover (turns primary color) */
.track-item .play-this-track:hover {
    background-color: var(--bs-primary) !important;
    color: white !important;
    transform: scale(1.08);
}

/* Mobile tweaks */
@media (max-width: 576px) {

    /* 1️⃣ Bootstrap .container and .container‑fluid have 15 px side padding.
        We strip that padding on phones so the inner columns can reach the
        very edge of the viewport. */
    .container,
    .container-fluid {
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
    }

    /* 2️⃣ The row that holds the two columns (.row.g‑5) adds a horizontal
        gap (the "g‑5" gutter). We already removed the gap in the previous
        snippet, but we also need to force the row itself to be full‑width. */
    .row.g-5 {
        margin-left: 0 !important;
        margin-right: 0 !important;
        width: 100% !important;
    }

    /* 3️⃣ Force the column that contains the track list to occupy the
        full width of its parent (the row). This also removes the default
        15 px column padding that Bootstrap applies. */
    .col-lg-8,
    .col-lg-4 {                     /* also affects the left‑hand column
                                      so the whole page aligns */
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        flex: 0 0 100% !important;   /* 100 % of the row */
        max-width: 100% !important;
    }

    /* 4️⃣ The list that actually renders the tracks – make it flush. */
    .list-group {
        width: 100%;
        margin-left: 0;
        margin-right: 0;
    }

    /* 5️⃣ Individual track rows – already full‑width, but we tighten the
        side padding a little more (feel free to adjust the .5rem value). */
    .track-item {
        width: 100%;
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
        box-sizing: border-box;
    }

    /* 6️⃣ Small tweak: shrink the play button so the text gets even more
        room on very narrow screens. */
    .track-item .play-this-track {
        width: 44px;
        height: 44px;
        margin-right: 0.4rem;
    }

    /* 7️⃣ Ensure the text block can truncate correctly. */
    .track-item .flex-grow-1 {
        min-width: 0;
    }
}

/* --- 4. Track States (Hover & Active) --- */
.track-item:hover {
    background-color: var(--bs-secondary-bg) !important;
}

/* Active (now playing) track - better color */
.track-item.active-track {
    background: var(--color-track-bg-subtle) !important;
    color: var(--color-track-text-emphasis) !important;
}

.track-item.active-track .opacity-75 {
    opacity: 0.9 !important;
    color: var(--bs-secondary-color) !important;
}

/* --- Track cover + overlay play button --- */
.track-cover,
.track-cover-placeholder {
    width: 64px;
    height: 64px;
    object-fit: cover;
    border-radius: 0.5rem;
    display: block;
    flex-shrink: 0;
}

.track-cover-placeholder {
    background: var(--bs-tertiary-bg);
    border: 2px dashed var(--bs-border-color);
}

/* Container for the overlay button */
.track-cover-wrapper {
    position: relative;
    display: inline-block;
}

/* The actual play/pause button */
.play-overlay-btn {
    position: absolute;
    inset: 0;
    margin: auto;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.45);
    color: white;
    border: none;
    font-size: 1.6rem;
    display: flex;
    align-items: center;
    justify-content: center;

    /* Start hidden/faint */
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.22s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(3px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Hover (desktop) */
@media (hover: hover) and (pointer: fine) {
    .track-item:hover .play-overlay-btn {
        opacity: 1;
        transform: scale(1);
        background: rgba(0, 0, 0, 0.65);
    }
}

/* Touch devices (mobile/tablet) */
@media (pointer: coarse) {
    .play-overlay-btn {
        opacity: 0.7;  /* Always faintly visible */
        background: rgba(0, 0, 0, 0.35);
    }
    .play-overlay-btn:active {
        transform: scale(0.94);
        background: rgba(0, 0, 0, 0.75);
    }
}

/* Playing state */
.track-item.playing .play-overlay-btn {
    opacity: 1 !important;
    background: rgba(30, 215, 96, 0.9) !important;  /* Spotify green */
    transform: scale(1) !important;
    animation: pulseOnce 0.6s ease-out;
}

/* Subtle heartbeat pulse */
@keyframes pulseOnce {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.18); }
    100% { transform: scale(1); }
}

/* Track item playing highlight */
.track-item.playing {
    background-color: var(--color-track-bg-subtle) !important;
    border-color: var(--color-track) !important;
}

/* --- 5. Big Play Button – Theme Adaptive Outline --- */
.theme-outline-btn {
    border-color: var(--color-track) !important;
    color: var(--bs-primary) !important;
    background-color: transparent !important;
}

.theme-outline-btn:hover {
    background-color: var(--bs-primary) !important;
    color: white !important;
}

/* Light mode specific */
html[data-bs-theme="light"] .theme-outline-btn {
    border-color: #212529;
    color: #212529;
}

html[data-bs-theme="light"] .theme-outline-btn:hover {
    background-color: #212529;
    color: white;
}

/* Dark mode specific */
html[data-bs-theme="dark"] .theme-outline-btn {
    border-color: #f8f9fa;
    color: #f8f9fa;
}

html[data-bs-theme="dark"] .theme-outline-btn:hover {
    background-color: #f8f9fa;
    color: #212529;
}

.subtle-play-btn {
    border-color: var(--bs-border-color);
}

/* --- 6. Liner Notes Typography --- */
#rendered-liner-notes {
    line-height: 1.7;
    font-size: 1rem;
}
#rendered-liner-notes h1 { font-size: 1.8rem; margin: 1.5em 0 0.8em; }
#rendered-liner-notes h2 { font-size: 1.5rem; margin-top: 1.5em; }
#rendered-liner-notes h3 { font-size: 1.3rem; }
#rendered-liner-notes p { margin-bottom: 1em; }
#rendered-liner-notes ul,
#rendered-liner-notes ol { padding-left: 1.5em; margin-bottom: 1em; }
#rendered-liner-notes strong { font-weight: 600; }

/* --- 7. UI Animations --- */
.transition-chevron {
    transition: transform 0.25s ease;
}

.transition-chevron.rotated {
    transform: rotate(180deg);
}

/* --- 8. Mobile-Specific Adjustments --- */
@media (max-width: 768px) {
    #linerNotesCollapse .card-body {
        padding: 1rem;
    }
}

@media (max-width: 576px) {
    /* Reduce spacing above Tape Talk section on mobile */
    .mt-5 {
        margin-top: 2rem !important;
    }

    /* Reduce spacing around the button area on mobile */
    .text-center.my-5 {
        margin-top: 1.5rem !important;
        margin-bottom: 1.5rem !important;
    }

    /* Keep buttons on same row, hide text, show only icons */
    .btn-group {
        flex-direction: row;
        gap: 0.5rem;
        justify-content: center;
    }

    .btn-group .btn {
        width: auto;
        margin-left: 0 !important;
        padding: 0.75rem 1.25rem;
    }

    /* Hide button text on mobile */
    #big-play-btn .btn-text,
    #big-share-btn .btn-text {
        display: none;
    }

    /* Make icons slightly larger since there's no text */
    #big-play-btn i {
        font-size: 1.8rem !important;
        margin: 0 !important;
        top: 0 !important;
    }

    #big-share-btn i {
        font-size: 1.6rem !important;
        margin: 0 !important;
    }

    #big-share-btn {
        margin-left: 0 !important;
    }
}

/* --- 9. Audio player --- */
/* --------------------------------------------------------------
   Bottom player – make the track‑info area use all available space
   -------------------------------------------------------------- */

/* 1️⃣ Remove the 140 px cap and let the info grow */
#bottom-player-container .me-2 {
    max-width: none !important;           /* override the inline max‑width */
}

/* 2️⃣ Let the info block flex‑grow so it takes the remaining width */
#bottom-player-container #bottom-now-title,
#bottom-player-container #bottom-now-artist-album {
    /* These already have .text-truncate, keep it */
    width: 100%;                          /* ensure they fill the container */
}

/* 3️⃣ Make the wrapper that holds the close‑button + info a flex item
    that can grow, but keep the close button at its natural size. */
#bottom-player-container .d-flex.align-items-center.mb-2.mb-md-0 {
    flex: 1 1 auto;                      /* allow it to expand */
    min-width: 0;                         /* enable truncation */
}

/* 4️⃣ Reduce the horizontal margin on the native <audio> element
    so it doesn't steal space from the info block. */
#bottom-player-container audio#w-main-player,
#bottom-player-container audio#main-player {
    margin-left: 0.5rem !important;
    margin-right: 0.5rem !important;
}

/* 5️⃣ On phones the three groups (info, controls, audio) can wrap.
    Force them onto a single line when there's enough width, but
    allow wrapping only when the viewport is < 480 px. */
@media (max-width: 480px) {
    #bottom-player-container .d-flex.align-items-center.flex-wrap {
        flex-wrap: wrap;                 /* let them stack on very small screens */
    }

    /* Give each group a little bottom margin when stacked */
    #bottom-player-container .d-flex.align-items-center.mb-2.mb-md-0,
    #bottom-player-container .mb-2.mb-md-0,
    #bottom-player-container audio#main-player {
        margin-bottom: 0.4rem;
    }
}

/* 6️⃣ Optional – make the close button a bit smaller on phones
    so the info gets a few extra pixels. */
@media (max-width: 576px) {
    #bottom-player-container #close-bottom-player {
        padding: 0.25rem 0.4rem;
        font-size: 0.9rem;
    }
}

/* --- 10. Quality Selector Dropdown - Theme Aware --- */
.quality-selector {
    position: relative;
    display: inline-block;
}

.quality-menu {
    display: none;
    position: absolute;
    bottom: 100%;
    right: 0;
    margin-bottom: 0.5rem;
    background-color: var(--bs-body-bg);
    border: 1px solid var(--bs-border-color);
    border-radius: 0.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    min-width: 180px;
    z-index: 1050;
}

/* Enhanced shadow for dark mode */
html[data-bs-theme="dark"] .quality-menu {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

.quality-menu.show {
    display: block;
}

.quality-option {
    padding: 0.75rem 1rem;
    cursor: pointer;
    color: var(--bs-body-color);
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background-color 0.2s;
}

.quality-option:first-child {
    border-radius: 0.5rem 0.5rem 0 0;
}

.quality-option:last-child {
    border-radius: 0 0 0.5rem 0.5rem;
}

.quality-option:hover {
    background-color: var(--bs-tertiary-bg);
}

.quality-option.active {
    background-color: var(--bs-primary);
    color: white;
}

.quality-option.active .quality-badge {
    color: rgba(255, 255, 255, 0.8);
}

.quality-option .bi-check2 {
    font-size: 1.2rem;
    color: currentColor;
}

.quality-badge {
    font-size: 0.75rem;
    color: var(--bs-secondary-color);
    margin-left: 0.5rem;
}
