var __index = {"config":{"lang":["en"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"Mixtape Society","text":""},{"location":"index.html#welcome-to-mixtape-society","title":"Welcome to Mixtape Society","text":"<p>Mixtape Society is a private, self\u2011hosted web app to create and share beautiful, ad-free music \u2014 the way mixtapes were exchanged on paper, but with today's digital convenience.</p>"},{"location":"index.html#-why-mixtape-society","title":"\ud83c\udfaf Why Mixtape Society?","text":"<ul> <li>\u2705 No ads, no tracking, no accounts \u2013 pure privacy.</li> <li>\ud83d\udd17 Public share links and QR codes \u2013 anyone can listen without an account.</li> <li>\ud83d\udcfc Cassette\u2011style experience \u2013 nostalgic UI with modern tech.</li> <li>\ud83d\udce1 Universal streaming \u2013 Chromecast, AirPlay, and Android Auto support.</li> </ul> <p>Quick start</p> <p>\ud83d\udc49 Read the full Getting Started guide</p>"},{"location":"index.html#-the-looks","title":"\ud83d\ude0e The looks","text":""},{"location":"index.html#mixtape-editor-user-journey","title":"Mixtape editor user journey","text":"<ul> <li> <p> Login page</p> </li> <li> <p> Manage your mixtape library that's stored locally on your device. Browse, search, share and organize your mixtape collection with ease.</p> </li> <li> <p> Manage your music collection by reviewing statistics and monitoring filesystem changes.</p> </li> <li> <p> Create or edit mixtapes with a live search feature that highlights your tracks as you type</p> </li> <li> <p> Add custom cover art to your mixtapes for a unique look.</p> </li> <li> <p> Add liner notes to your mixtapes for a personal touch.</p> </li> <li> <p> Generate a shareable link or use a QR code for your mixtapes with ease.</p> </li> <li> <p>     Use a QR image to include in physical gift.</p> </li> </ul>"},{"location":"index.html#mixtape-receiver-user-journey","title":"Mixtape receiver user journey","text":"<ul> <li> <p> Receive your mixtape with a public link</p> </li> <li> <p> Listen to your mixtape with a sleek, cassette-inspired player that supports full seeking for FLAC, MP3, M4A, and more.</p> </li> <li> <p> Audio Cassette mode for a nostalgic cassette-inspired player.</p> </li> <li> <p>     Enjoy your mobile nostalgic walkman immersive experience.</p> </li> </ul>"},{"location":"index.html#-key-features","title":"\u2728 Key Features","text":""},{"location":"index.html#-for-mixtape-creators","title":"\ud83c\udfb6\ud83e\uddd1\u200d\ud83c\udfa8 For Mixtape Creators","text":"<ul> <li>Private music library \u2013 Host your own collection (FLAC, MP3, M4A, AAC, OGG, WAV)</li> <li>Custom cover art \u2013 Upload unique artwork for each mixtape</li> <li>Liner notes \u2013 Add personal messages with Markdown formatting</li> <li>Smart caching \u2013 Pre-transcode for faster mobile streaming</li> <li>Instant public links \u2013 Share via URL, QR code or print-ready codes with cover art</li> <li>No accounts needed \u2013 Recipients stream directly in browser</li> <li>Permanent or temporary \u2013 Links persist until you delete them</li> </ul>"},{"location":"index.html#-for-mixtape-receivers","title":"\ud83c\udf81 For Mixtape Receivers","text":"<ul> <li>No login required \u2013 Just click and play</li> <li>Full media controls \u2013 Play, pause, seek, skip</li> <li>Lock screen integration \u2013 Control from phone notifications</li> <li>Background playback \u2013 Keep playing with screen off</li> <li>Personalized PWA \u2013 Each mixtape installs like an app with its own icon and name</li> <li>Cast anywhere \u2013 Stream in your car or throughout your house</li> </ul>"},{"location":"index.html#-stream-everywhere","title":"\ud83d\udce1 Stream Everywhere","text":"<p>Recipients can stream shared mixtapes to any device using Chromecast, AirPlay, or Android Auto:</p> <p>Chromecast (Android/Chrome):</p> <ul> <li>Simple one-tap casting \u2013 Cast button appears automatically</li> <li>Full queue support \u2013 Entire mixtape loads to Chromecast</li> <li>Unified controls \u2013 Control playback from phone, computer, or lock screen</li> <li>Quality streaming \u2013 Respects network conditions and quality settings</li> <li>Track metadata \u2013 Cover art, title, and artist display on TV</li> <li>Seamless experience \u2013 Continues playing when phone screen turns off</li> </ul> <p>AirPlay (Apple Devices):</p> <ul> <li>Native iOS integration \u2013 Built into Safari, no setup required</li> <li>One-tap streaming \u2013 AirPlay icon in audio controls</li> <li>System-wide controls \u2013 Lock screen, Control Center, CarPlay</li> <li>Lossless audio \u2013 High-quality streaming to AirPlay devices</li> <li>Multi-room \u2013 Stream to multiple AirPlay 2 speakers simultaneously</li> <li>Apple Watch \u2013 Control from your wrist</li> </ul> <p>Android Auto (In-Car):</p> <ul> <li>Dashboard integration \u2013 Control from car touchscreen</li> <li>Voice commands \u2013 \"OK Google, pause\", \"next song\"</li> <li>Steering wheel controls \u2013 Use physical car buttons</li> <li>Safe driving mode \u2013 Simplified, distraction-free interface</li> <li>Full metadata \u2013 Album art and track info on display</li> <li>Automatic connection \u2013 Works when phone connects to car</li> </ul> <p>Perfect for:</p> <ul> <li>\ud83c\udf89 Parties \u2013 Share the DJ duties via QR code</li> <li>\ud83c\udfe0 Home audio \u2013 Stream to whole-home speaker systems</li> <li>\ud83d\ude97 Road trips \u2013 Perfect mixtapes for long drives</li> <li>\ud83c\udf81 Gifts \u2013 Create physical cards with QR codes that stream anywhere</li> <li>\ud83c\udfb5 Ambient listening \u2013 Set the mood without managing your phone</li> </ul>"},{"location":"index.html#-get-involved","title":"\ud83d\udc65 Get Involved","text":"<p>Interested in where this is headed?</p> <ul> <li>\ud83d\udca1 Browse ideas being explored</li> <li>\ud83c\udfaf See what's planned next</li> <li>\ud83d\udcdd Read what's been shipped</li> <li>\ud83d\udcac Share thoughts on GitHub Discussions</li> <li>\ud83d\udc1b Report issues or open an issue</li> </ul> <p>Pull requests welcome. Still early days, but contributions appreciated.</p> <p>Personal use only</p> <p>This software is a tool for personal, non-commercial use with legally owned music files. No copyrighted music or artwork is included. You are solely responsible for the media you host and share.</p>"},{"location":"development/configuration.html","title":"Configuration","text":""},{"location":"development/configuration.html#configuration","title":"Configuration","text":"<p>This document explains every configuration option used by the Mixtape\u202fSociety application, how the values are sourced (environment variables, .env file, or defaults), the directory layout that results, and the Docker\u2011specific considerations. The description directly to the implementation in <code>src/config/config.py</code>.</p>"},{"location":"development/configuration.html#-how-configuration-is-loaded","title":"\ud83d\udce5 How Configuration Is Loaded","text":"<pre><code># src/config/config.py\nfrom pathlib import Path\nimport os\nfrom dotenv import load_dotenv\n\n# Load .env only when we are *not* in production.\nif os.getenv(\"APP_ENV\", \"development\") != \"production\":\n    project_root = Path(__file__).parent.parent.parent   # src/config \u2192 project root\n    load_dotenv(project_root / \".env\")\n</code></pre> <ul> <li>In development (or when <code>APP_ENV</code> is anything other than <code>production</code>) the file tries to read a <code>.env</code> file located at the project root.</li> <li>In production the <code>.env</code> file is ignored \u2013 all configuration must be supplied via real environment variables.</li> </ul> <p>After the optional <code>.env</code> load, the module defines a <code>BASE_DIR</code> (<code>src/</code>) and a hierarchy of configuration classes.</p>"},{"location":"development/configuration.html#-core-paths--their-defaults","title":"\ud83d\udee4\ufe0f Core Paths &amp; Their Defaults","text":"Setting Default (when no env var) Meaning <code>MUSIC_ROOT</code> <code>/music</code> Absolute path to the read-only music library that the collection scanner watches. <code>DATA_ROOT</code> <code>../collection-data</code> (relative to the project root) Root folder writable by the app. All generated data lives underneath this directory. <code>DB_PATH</code> <code>&lt;DATA_ROOT&gt;/collection.db</code> SQLite database file that stores the indexed music metadata. <code>MIXTAPE_DIR</code> <code>&lt;DATA_ROOT&gt;/mixtapes</code> Folder that holds each mixtape\u2019s JSON file (<code>&lt;slug&gt;.json</code>). <code>COVER_DIR</code> <code>&lt;MIXTAPE_DIR&gt;/covers</code> Sub-folder for mixtape cover images (<code>&lt;slug&gt;.jpg</code>). <code>AUDIO_CACHE_DIR</code> <code>&lt;DATA_ROOT&gt;/cache/audio</code> Directory where transcoded audio files are cached for streaming. <p>Important</p> <p><code>DB_PATH</code>, <code>MIXTAPE_DIR</code>, <code>COVER_DIR</code>, and <code>AUDIO_CACHE_DIR</code> are derived from <code>DATA_ROOT</code>. You must not set them directly \u2013 change <code>DATA_ROOT</code> instead.</p>"},{"location":"development/configuration.html#-environment-variables-full-list","title":"\ud83c\udf31 Environment Variables (full list)","text":"Variable Where it is read Default (if not set) Description <code>APP_ENV</code> <code>config.py</code> (top) <code>development</code> Determines which configuration class (<code>DevelopmentConfig</code>, <code>TestConfig</code>, <code>ProductionConfig</code>) is used. Accepted values: <code>development</code>, <code>test</code>, <code>production</code>. <code>MUSIC_ROOT</code> <code>BaseConfig.MUSIC_ROOT</code> <code>/music</code> Absolute path to the music collection. Must be readable by the process. <code>DATA_ROOT</code> <code>BaseConfig.DATA_ROOT</code> <code>../collection-data</code> (project-root relative) Writable directory for all app-generated files. <code>PASSWORD</code> <code>BaseConfig.PASSWORD</code> (and overridden in subclasses) <code>dev-password</code> (dev) / <code>test-password</code> (test) / must be set (prod) Login password for the web UI. <code>AUDIO_CACHE_ENABLED</code> <code>BaseConfig.AUDIO_CACHE_ENABLED</code> <code>True</code> Toggle the whole audio-caching subsystem on/off. <code>AUDIO_CACHE_DEFAULT_QUALITY</code> <code>BaseConfig.AUDIO_CACHE_DEFAULT_QUALITY</code> <code>medium</code> Default quality for cached audio files (<code>low</code>, <code>medium</code>, <code>high</code>). <code>AUDIO_CACHE_MAX_WORKERS</code> <code>BaseConfig.AUDIO_CACHE_MAX_WORKERS</code> <code>4</code> Number of worker threads used for background transcoding. <code>AUDIO_CACHE_PRECACHE_ON_UPLOAD</code> <code>BaseConfig.AUDIO_CACHE_PRECACHE_ON_UPLOAD</code> <code>True</code> When a mixtape is saved, automatically start caching its tracks. <code>AUDIO_CACHE_PRECACHE_QUALITIES</code> <code>BaseConfig.AUDIO_CACHE_PRECACHE_QUALITIES</code> <code>[\"medium\"]</code> List of qualities to precache (e.g., <code>[\"low\",\"medium\",\"high\"]</code>). <code>DEBUG</code> Set by subclass (<code>DevelopmentConfig.DEBUG = True</code>) <code>False</code> (prod) Enables Flask\u2019s debugger and auto-reload. <code>PYTHONPATH</code> / <code>PYTHON_VERSION</code> Not read by the app, but documented for developers. \u2013 Pinning to Python\u202f3.11+ via <code>.python-version</code> (used by <code>uv</code>). <p>All variables can be supplied via:</p> <ul> <li>A <code>.env</code> file in the project root (development only).</li> <li>Docker environment variables (<code>-e VAR=value</code> or <code>environment:</code> block in <code>docker-compose.yml</code>).</li> <li>Direct export in the shell (<code>export VAR=value</code>).</li> </ul>"},{"location":"development/configuration.html#-derived-paths-never-set-directly","title":"\ud83d\udd17 Derived Paths (never set directly)","text":"<pre><code>class BaseConfig:\n    DB_PATH = DATA_ROOT / \"collection.db\"\n    MIXTAPE_DIR = DATA_ROOT / \"mixtapes\"\n    COVER_DIR = MIXTAPE_DIR / \"covers\"\n    AUDIO_CACHE_DIR = DATA_ROOT / \"cache\" / \"audio\"\n</code></pre> <p>Because these are computed once when the class is defined, they automatically follow any change to <code>DATA_ROOT</code>. Changing <code>DB_PATH</code> or <code>MIXTAPE_DIR</code> manually would have no effect and could cause path mismatches.</p>"},{"location":"development/configuration.html#-directory-creation-ensure_dirs","title":"\ud83d\udcc1 Directory Creation (<code>ensure_dirs</code>)","text":"<pre><code>@classmethod\ndef ensure_dirs(cls):\n    cls.DATA_ROOT.mkdir(parents=True, exist_ok=True)\n    cls.MIXTAPE_DIR.mkdir(parents=True, exist_ok=True)\n    cls.COVER_DIR.mkdir(parents=True, exist_ok=True)\n    cls.AUDIO_CACHE_DIR.mkdir(parents=True, exist_ok=True)\n</code></pre> <p>Called early in <code>app.py</code> (<code>config.ensure_dirs()</code>).</p> <p>It guarantees that all writable directories exist before any component tries to write files. If a directory already exists, <code>exist_ok=True</code> prevents an error.</p>"},{"location":"development/configuration.html#-configuration-classes","title":"\ud83c\udff7\ufe0f Configuration Classes","text":"Class Inherits from Overrides / Special behaviour <code>BaseConfig</code> \u2013 Defines all defaults and <code>ensure_dirs</code>. <code>DevelopmentConfig</code> <code>BaseConfig</code> <code>DEBUG = True</code>; <code>PASSWORD</code> defaults to <code>\"dev-password\"</code> (or env var). <code>TestConfig</code> <code>BaseConfig</code> Uses a temporary <code>DATA_ROOT</code> (<code>/tmp/mixtape-test-data</code>) and a dummy <code>MUSIC_ROOT</code> (<code>/tmp/test-music</code>). Ideal for CI pipelines. <code>ProductionConfig</code> <code>BaseConfig</code> <code>DEBUG = False</code>; requires <code>PASSWORD</code> to be set via env var (no fallback). All other values are taken from the environment or defaults. <p><code>app.py</code> selects the class with:</p> <pre><code>env = os.getenv(\"APP_ENV\", \"development\")\nif env == \"production\":\n    config_cls = ProductionConfig\nelif env == \"test\":\n    config_cls = TestConfig\nelse:\n    config_cls = DevelopmentConfig\n</code></pre>"},{"location":"development/configuration.html#-docker-integration","title":"\ud83d\udc33 Docker Integration","text":"<p>For more information look at the Docker Deployment documentation.</p>"},{"location":"development/configuration.html#-typical-scenarios-what-youll-see-on-disk","title":"\ud83d\uddbc\ufe0f Typical Scenarios (what you\u2019ll see on disk)","text":"Scenario APP_ENV MUSIC_ROOT DATA_ROOT Resulting layout (host side) Local dev, no <code>.env</code> development /home/mark/Music (hard-coded default) ../collection-data (next to the repo) <code>collection-data/collection.db</code>, <code>collection-data/mixtapes/\u2026</code>, <code>collection-data/cache/audio/\u2026</code> Local dev + <code>.env</code> development Whatever you set in <code>.env</code> Whatever you set in <code>.env</code> Same as above, but paths reflect the values you placed in <code>.env</code>. Docker prod production /music (mounted read-only) /app/collection-data (mounted read-write) Inside the container the same layout as above; on the host you\u2019ll see the folder you bound to <code>/app/collection-data</code>. Automated tests test /tmp/test-music (created by the test harness) /tmp/mixtape-test-data Temporary directories that are cleaned up after the test suite finishes."},{"location":"development/configuration.html#-bestpractice-recommendations","title":"\ud83d\udca1 Best\u2011Practice Recommendations","text":"<ol> <li>Never commit a <code>.env</code> containing secrets. Keep passwords out of source control.</li> <li>In production, set <code>APP_PASSWORD</code> (or any other secret) via the orchestration platform (Docker\u2011Compose <code>env_file</code>, Kubernetes secret, etc.). The app will refuse to start without it.</li> <li>Mount <code>DATA_ROOT</code> on persistent storage (a volume, bind\u2011mount, or cloud\u2011disk) so that the SQLite DB and cached audio survive container restarts.</li> <li>Keep <code>MUSIC_ROOT</code> read\u2011only \u2013 the scanner only needs to read files; mounting it as ro prevents accidental modifications from the container.</li> <li>Adjust audio\u2011caching workers (<code>AUDIO_CACHE_MAX_WORKERS</code>) according to the host CPU count; the default of 4 works well on most 4\u2011core machines.</li> <li>If you change <code>DATA_ROOT</code> after the app has started, you must delete the old DB and mixtape folder (or run a migration script) because the paths are baked into the SQLite DB.</li> <li>Run the test suite with <code>APP_ENV=test</code> (or simply <code>pytest</code> which forces <code>TestConfig</code>). This isolates filesystem side\u2011effects to <code>/tmp</code>.</li> </ol>"},{"location":"development/configuration.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/configuration.html#src.config.config","title":"<code>config</code>","text":"<p>Classes:</p> Name Description <code>BaseConfig</code> <p>Base configuration shared by all application environments.</p> <code>DevelopmentConfig</code> <p>Development configuration used when running the app locally.</p> <code>TestConfig</code> <p>Test configuration tailored for running the application's automated tests.</p> <code>ProductionConfig</code> <p>Production configuration for running the app in deployed environments.</p>"},{"location":"development/configuration.html#src.config.config.BaseConfig","title":"<code>BaseConfig</code>","text":"<p>Base configuration shared by all application environments.</p> <p>This configuration defines paths, credentials, and caching settings that control how the app accesses music, stores data, and manages audio cache.</p> <p>Methods:</p> Name Description <code>ensure_dirs</code> <p>Create all required data and cache directories if they do not exist.</p>"},{"location":"development/configuration.html#src.config.config.BaseConfig.ensure_dirs","title":"<code>ensure_dirs()</code>  <code>classmethod</code>","text":"<p>Create all required data and cache directories if they do not exist.</p> <p>This method prepares the filesystem so the application can safely store databases, mixtapes, covers, and cached audio files.</p> Source code in <code>src/config/config.py</code> <pre><code>@classmethod\ndef ensure_dirs(cls):\n    \"\"\"Create all required data and cache directories if they do not exist.\n\n    This method prepares the filesystem so the application can safely store\n    databases, mixtapes, covers, and cached audio files.\n    \"\"\"\n    cls.DATA_ROOT.mkdir(parents=True, exist_ok=True)\n    cls.MIXTAPE_DIR.mkdir(parents=True, exist_ok=True)\n    cls.COVER_DIR.mkdir(parents=True, exist_ok=True)\n    cls.AUDIO_CACHE_DIR.mkdir(parents=True, exist_ok=True)\n</code></pre>"},{"location":"development/configuration.html#src.config.config.DevelopmentConfig","title":"<code>DevelopmentConfig</code>","text":"<p>               Bases: <code>BaseConfig</code></p> <p>Development configuration used when running the app locally.</p> <p>This configuration enables debugging and uses local defaults suitable for iterative development.</p>"},{"location":"development/configuration.html#src.config.config.TestConfig","title":"<code>TestConfig</code>","text":"<p>               Bases: <code>BaseConfig</code></p> <p>Test configuration tailored for running the application's automated tests.</p> <p>This configuration isolates test data and music paths to avoid affecting development or production environments.</p>"},{"location":"development/configuration.html#src.config.config.ProductionConfig","title":"<code>ProductionConfig</code>","text":"<p>               Bases: <code>BaseConfig</code></p> <p>Production configuration for running the app in deployed environments.</p> <p>This configuration relies solely on environment variables and disables development-focused settings like debugging.</p>"},{"location":"development/deployment.html","title":"Deployment","text":""},{"location":"development/deployment.html#local-development-with-docker","title":"Local Development with Docker","text":"<p>This guide covers Docker usage for local development and testing. For production deployment, see the Production Docker Guide.</p>"},{"location":"development/deployment.html#-development-workflow-overview","title":"\ud83d\udd01 Development Workflow Overview","text":"<p>Mixtape Society supports three development approaches:</p> <ol> <li>Native Python with uv (recommended for active development)</li> <li>Fastest iteration cycle with hot-reload</li> <li>Direct file system access</li> <li> <p>Run: <code>uv run app.py</code></p> </li> <li> <p>Local Docker build (for testing containerization)</p> </li> <li>Tests the production-like environment</li> <li>Validates Dockerfile changes</li> <li> <p>Useful before pushing to CI/CD</p> </li> <li> <p>Docker Compose (for full stack testing)</p> </li> <li>Tests volume mounts and networking</li> <li>Validates environment variable handling</li> <li>Simulates production deployment locally</li> </ol>"},{"location":"development/deployment.html#-configuration-and-environments","title":"\u2699\ufe0f Configuration and Environments","text":"<p>The application uses three configuration classes defined in <code>config.py</code>:</p>"},{"location":"development/deployment.html#configuration-classes","title":"Configuration Classes","text":"<pre><code># APP_ENV environment variable determines which config is loaded\nCONFIG_MAP = {\n    \"development\": DevelopmentConfig,  # Default for local dev\n    \"test\": TestConfig,                # Used by test suite\n    \"production\": ProductionConfig,    # Used in Docker containers\n}\n</code></pre>"},{"location":"development/deployment.html#environment-specific-behavior","title":"Environment-Specific Behavior","text":"Environment APP_ENV value .env file loaded? Default PASSWORD DEBUG mode Development <code>development</code> (default) \u2705 Yes (from project root) <code>dev-password</code> \u2705 Enabled Test <code>test</code> \u274c No <code>test-password</code> \u274c Disabled Production <code>production</code> \u274c No Must be set via env var \u274c Disabled"},{"location":"development/deployment.html#key-configuration-paths","title":"Key Configuration Paths","text":"<p>All paths are derived from two base locations:</p> <pre><code># Set via environment variables or defaults\nMUSIC_ROOT = Path(os.getenv(\"MUSIC_ROOT\", \"/music\"))\nDATA_ROOT = Path(os.getenv(\"DATA_ROOT\", \"../collection-data\"))\n\n# Automatically derived (never set these directly)\nDB_PATH = DATA_ROOT / \"collection.db\"\nMIXTAPE_DIR = DATA_ROOT / \"mixtapes\"\nCOVER_DIR = MIXTAPE_DIR / \"covers\"\nAUDIO_CACHE_DIR = DATA_ROOT / \"cache\" / \"audio\"\n</code></pre>"},{"location":"development/deployment.html#local-development-setup","title":"Local Development Setup","text":"<p>Create a <code>.env</code> file in the project root:</p> <pre><code># .env (used only in development mode)\nMUSIC_ROOT=/home/youruser/Music\nDATA_ROOT=/home/youruser/mixtape-data  # Optional, defaults to ../collection-data\nPASSWORD=my-dev-password               # Optional, defaults to dev-password\nLOG_LEVEL=DEBUG                        # Optional, defaults to INFO\n</code></pre> <p>Note: The <code>.env</code> file is only loaded in development mode (when <code>APP_ENV != \"production\"</code>). In Docker containers, all configuration must come from environment variables or docker-compose.</p>"},{"location":"development/deployment.html#-building-the-docker-image","title":"\ud83d\udee0\ufe0f Building the Docker Image","text":""},{"location":"development/deployment.html#standard-build","title":"Standard Build","text":"<p>Build the production image locally to test Dockerfile changes:</p> <pre><code># Build from project root\ndocker build -f docker/Dockerfile -t mixtape-society:dev .\n\n# Or use the compose file's build configuration\ndocker compose -f docker/docker-compose.yml build\n</code></pre>"},{"location":"development/deployment.html#build-arguments","title":"Build Arguments","text":"<p>The Dockerfile supports custom user/group IDs:</p> <pre><code>docker build \\\n  --build-arg USER_ID=1000 \\\n  --build-arg GROUP_ID=1000 \\\n  -f docker/Dockerfile \\\n  -t mixtape-society:dev .\n</code></pre>"},{"location":"development/deployment.html#multi-stage-build-overview","title":"Multi-stage Build Overview","text":"<p>The Dockerfile uses a multi-stage build process:</p> <ol> <li>Base stage: Installs system dependencies (ffmpeg, image libraries)</li> <li>Builder stage: Installs uv and Python dependencies</li> <li>Runtime stage: Copies app code and creates non-root user</li> <li>Final stage: Sets up entrypoint and exposes port 5000</li> </ol>"},{"location":"development/deployment.html#-running-with-docker-compose","title":"\ud83d\ude80 Running with Docker Compose","text":""},{"location":"development/deployment.html#development-compose-file","title":"Development Compose File","text":"<p>Create <code>docker/docker-compose.dev.yml</code>:</p> <pre><code>services:\n  mixtape:\n    build:\n      context: ..\n      dockerfile: docker/Dockerfile\n    container_name: mixtape-society-dev\n    restart: unless-stopped\n    ports:\n      - \"5000:5000\"\n    volumes:\n      # Mount your local music library (read-only)\n      - /path/to/your/music:/music:ro\n      # Mount data directory for persistence\n      - mixtape_dev_data:/app/collection-data\n      # Optional: mount source for live editing (requires manual restart)\n      # - ../src:/app/src:ro\n    environment:\n      - APP_ENV=production          # Use production config in container\n      - PASSWORD=dev-test-password\n      - MUSIC_ROOT=/music           # Container path, not host path\n      - LOG_LEVEL=DEBUG\n      - TZ=Europe/Amsterdam\n\nvolumes:\n  mixtape_dev_data:\n</code></pre>"},{"location":"development/deployment.html#start-the-development-container","title":"Start the Development Container","text":"<pre><code>cd docker\ndocker compose -f docker-compose.dev.yml up -d\n\n# View logs\ndocker compose -f docker-compose.dev.yml logs -f\n\n# Stop and remove\ndocker compose -f docker-compose.dev.yml down\n</code></pre>"},{"location":"development/deployment.html#environment-variables-reference","title":"Environment Variables Reference","text":"Variable Required Default Description <code>APP_ENV</code> No <code>development</code> Config class to use (<code>development</code>, <code>test</code>, <code>production</code>) <code>MUSIC_ROOT</code> Yes <code>/music</code> Path to music library inside container <code>DATA_ROOT</code> No <code>/app/collection-data</code> Path to persistent data inside container <code>PASSWORD</code> Yes (in production) <code>dev-password</code> (dev only) Login password for web UI <code>LOG_LEVEL</code> No <code>INFO</code> Logging verbosity (<code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>) <code>TZ</code> No <code>UTC</code> Timezone for timestamps <code>PUID</code> / <code>PGID</code> No <code>1000</code> User/group ID for file permissions"},{"location":"development/deployment.html#-testing-configuration-changes","title":"\ud83e\uddea Testing Configuration Changes","text":""},{"location":"development/deployment.html#verify-configuration-loading","title":"Verify Configuration Loading","text":"<p>Run the container and check which config is active:</p> <pre><code>docker compose -f docker-compose.dev.yml exec mixtape python -c \"\nfrom config import get_configuration\nconfig = get_configuration()\nprint(f'Config class: {config.__class__.__name__}')\nprint(f'MUSIC_ROOT: {config.MUSIC_ROOT}')\nprint(f'DATA_ROOT: {config.DATA_ROOT}')\nprint(f'DEBUG: {config.DEBUG}')\n\"\n</code></pre>"},{"location":"development/deployment.html#test-environment-switching","title":"Test Environment Switching","text":"<pre><code># Test development config\nAPP_ENV=development uv run python -c \"from config import DevelopmentConfig; print(DevelopmentConfig.DEBUG)\"\n\n# Test production config\nAPP_ENV=production uv run python -c \"from config import ProductionConfig; print(ProductionConfig.DEBUG)\"\n</code></pre>"},{"location":"development/deployment.html#-common-development-tasks","title":"\ud83d\udccb Common Development Tasks","text":""},{"location":"development/deployment.html#rebuild-after-code-changes","title":"Rebuild After Code Changes","text":"<p>Docker doesn't support hot-reload by default:</p> <pre><code># Rebuild and restart\ndocker compose -f docker-compose.dev.yml up -d --build\n\n# Or manually\ndocker compose -f docker-compose.dev.yml down\ndocker compose -f docker-compose.dev.yml build\ndocker compose -f docker-compose.dev.yml up -d\n</code></pre> <p>Tip: For active development, use <code>uv run app.py</code> instead for instant hot-reload.</p>"},{"location":"development/deployment.html#access-container-shell","title":"Access Container Shell","text":"<pre><code>docker compose -f docker-compose.dev.yml exec mixtape bash\n\n# Or with docker directly\ndocker exec -it mixtape-society-dev bash\n</code></pre>"},{"location":"development/deployment.html#inspect-volume-contents","title":"Inspect Volume Contents","text":"<pre><code># Find the volume location\ndocker volume inspect mixtape_dev_data\n\n# Access files (requires root on host)\nsudo ls -la /var/lib/docker/volumes/mixtape_dev_data/_data/\n</code></pre>"},{"location":"development/deployment.html#reset-development-data","title":"Reset Development Data","text":"<pre><code># Remove the volume (deletes DB, mixtapes, cache)\ndocker compose -f docker-compose.dev.yml down -v\n\n# Start fresh\ndocker compose -f docker-compose.dev.yml up -d\n</code></pre>"},{"location":"development/deployment.html#-cicd-integration","title":"\ud83d\udd04 CI/CD Integration","text":""},{"location":"development/deployment.html#github-actions-build","title":"GitHub Actions Build","text":"<p>The production images are automatically built on:</p> <ul> <li>Push to <code>main</code> branch \u2192 <code>latest</code> tag</li> <li>New release tags \u2192 version-specific tags (e.g., <code>v1.4.2</code>)</li> </ul> <p>Images are published to GitHub Container Registry:</p> <pre><code>ghcr.io/mark-me/mixtape-society:latest\nghcr.io/mark-me/mixtape-society:v1.4.2\n</code></pre>"},{"location":"development/deployment.html#local-testing-before-push","title":"Local Testing Before Push","text":"<p>Test the exact production build locally:</p> <pre><code># Build with production settings\ndocker build -f docker/Dockerfile -t mixtape-society:test-prod .\n\n# Run with production config\ndocker run --rm \\\n  -e APP_ENV=production \\\n  -e PASSWORD=test123 \\\n  -v /path/to/music:/music:ro \\\n  -v test_data:/app/collection-data \\\n  -p 5000:5000 \\\n  mixtape-society:test-prod\n</code></pre>"},{"location":"development/deployment.html#-troubleshooting","title":"\ud83e\ude7a Troubleshooting","text":""},{"location":"development/deployment.html#config-not-loading-as-expected","title":"Config Not Loading as Expected","text":"<pre><code># Check which .env files exist\nls -la .env\n\n# Verify APP_ENV is set correctly\ndocker compose -f docker-compose.dev.yml exec mixtape env | grep APP_ENV\n\n# Check if .env is being loaded (should be \"no\" in containers)\ndocker compose -f docker-compose.dev.yml exec mixtape python -c \"\nimport os\nprint('APP_ENV:', os.getenv('APP_ENV', 'not set'))\nprint('.env loaded:', os.getenv('APP_ENV', 'development') != 'production')\n\"\n</code></pre>"},{"location":"development/deployment.html#permission-issues","title":"Permission Issues","text":"<pre><code># Check container user\ndocker compose -f docker-compose.dev.yml exec mixtape id\n\n# Fix volume permissions (if using bind mount)\nsudo chown -R 1000:1000 /path/to/data\n</code></pre>"},{"location":"development/deployment.html#database-not-persisting","title":"Database Not Persisting","text":"<pre><code># Verify volume is mounted\ndocker compose -f docker-compose.dev.yml exec mixtape ls -la /app/collection-data/\n\n# Check if volume exists\ndocker volume ls | grep mixtape\n</code></pre>"},{"location":"development/deployment.html#-performance-considerations","title":"\ud83d\udcc8 Performance Considerations","text":""},{"location":"development/deployment.html#when-to-use-docker-vs-native","title":"When to Use Docker vs. Native","text":"Scenario Recommended Approach Reason Active code iteration Native (<code>uv run app.py</code>) Hot-reload, faster startup Testing Dockerfile changes Local Docker build Validates containerization Testing volume mounts Docker Compose Simulates production setup Integration testing Docker Compose Tests full stack Final validation before release Docker Compose Production-like environment"},{"location":"development/deployment.html#optimizing-build-times","title":"Optimizing Build Times","text":"<pre><code># Use BuildKit for faster builds\nDOCKER_BUILDKIT=1 docker build -f docker/Dockerfile -t mixtape-society:dev .\n\n# Use compose BuildKit\nCOMPOSE_DOCKER_CLI_BUILD=1 DOCKER_BUILDKIT=1 docker compose build\n\n# Cache the builder stage\ndocker build --target builder -t mixtape-society:builder -f docker/Dockerfile .\n</code></pre>"},{"location":"development/deployment.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Production Deployment: Full Docker production setup with reverse proxy configuration</li> <li>Configuration Module: Detailed explanation of <code>config.py</code> and environment handling</li> <li>Project Architecture: Overview of the application structure</li> </ul>"},{"location":"development/intro.html","title":"Project Overview","text":""},{"location":"development/intro.html#development-guide","title":"Development Guide","text":"<p>Welcome to the Mixtape Society development guide. This section explains how the project is organized, how to set up a local development environment, how to run tests, and where to find the architectural documentation.</p>"},{"location":"development/intro.html#-project-structure","title":"\ud83d\udcc2 Project Structure","text":"<ul> <li>\ud83d\udcc1 mixtape\u2011society/<ul> <li>\ud83d\udc77\u200d\u2640\ufe0f .github/<ul> <li>\u2699\ufe0f workflows/<ul> <li><code>docker-image.yml</code> \u2013 Build Docker images on GHCR</li> <li><code>docs.yml</code> \u2013 Publish GitHub Pages</li> </ul> </li> </ul> </li> <li>\ud83d\udc33 docker/ \u2013 Dockerfiles &amp; Compose configs</li> <li>\ud83d\udcda docs/ \u2013 MkDocs source (this folder)</li> <li>\ud83d\udcc2 src/<ul> <li><code>app.py</code> \u2013 Flask entry point</li> <li>\ud83d\udcc2 <code>audio_cache/</code> \u2013 Audio transcoding &amp; caching</li> <li><code>auth.py</code> \u2013 Authentication utilities</li> <li>\ud83d\udcc2 <code>common/</code> \u2013 Infrastructure\u2011free abstractions</li> <li>\ud83d\udcc2 <code>config/</code> \u2013 Environment\u2011variable handling</li> <li>\ud83d\udcc2 <code>logtools/</code> \u2013 Structured logging helpers</li> <li>\ud83d\udcc2 <code>mixtape_manager/</code> \u2013 Mixtape persistence layer</li> <li>\ud83d\udcc2 <code>musiclib/</code> \u2013 Music indexing (TinyTag + SQLite)</li> <li>\ud83d\udcc2 <code>routes/</code> \u2013 Flask blueprints (browser, editor, \u2026)</li> <li>\ud83d\udcc2 <code>static/</code><ul> <li>\ud83d\udcc2 <code>css/</code> \u2013 Stylesheets for Jinja2 templates</li> <li>\ud83d\udcc2 <code>js/</code> \u2013 Front\u2011end scripts</li> </ul> </li> <li>\ud83d\udcc2 <code>templates/</code> \u2013 Jinja2 views</li> <li>\ud83d\udcc2 <code>utilities/</code> \u2013 Miscellaneous helper functions</li> </ul> </li> <li>\ud83d\udcc4 <code>.gitignore</code> \u2013 Ignored files for Git</li> <li>\ud83d\udcc4 <code>LICENSE</code> \u2013 Project license</li> <li>\ud83d\udcc4 <code>mkdocs.yml</code> \u2013 MkDocs site configuration</li> <li>\ud83d\udcc4 <code>pyproject.toml</code> \u2013 Poetry\u2011style project metadata</li> <li>\ud83d\udcc4 <code>.python-version</code> \u2013 Python version pinning (3.13+)</li> <li>\ud83d\udcc4 <code>README.md</code> \u2013 Repository overview</li> <li>\ud83d\udcc4 <code>uv.lock</code> \u2013 uv\u2011managed lockfile</li> </ul> </li> </ul> <p>Tip</p> <p>The <code>src/</code> package is deliberately framework\u2011agnostic; core modules (<code>musiclib</code>, <code>mixtape_manager</code>, <code>audio_cache</code>) contain no Flask imports, making them easy to unit\u2011test.</p>"},{"location":"development/intro.html#-prerequisites","title":"\ud83d\udee0\ufe0f Prerequisites","text":"Tool Minimum Version Install Command Python 3.13+ (pinned in <code>.python-version</code>) Use your system package manager or <code>pyenv</code> uv (modern Python package manager) Latest <code>curl -LsSf &lt;https://astral.sh/uv/install.sh&gt; | sh</code> Docker (optional, for containerised dev) Engine\u202f\u2265\u202f20.10 Follow Docker\u2019s official install guide <p>Why <code>uv</code>? It resolves and installs dependencies without a <code>requirements.txt</code>, speeds up virtual\u2011environment creation, and produces a deterministic <code>uv.lock</code>.</p>"},{"location":"development/intro.html#-local-development-workflow-uv","title":"\ud83d\ude80 Local Development Workflow (uv)","text":"<pre><code># 1\ufe0f\u20e3 Install runtime dependencies\nuv sync\n\n# 2\ufe0f\u20e3 Install development\u2011only dependencies (testing, linting, docs)\nuv sync --extra dev\n\n# 3\ufe0f\u20e3 Run the Flask development server\nuv run python -m app\n\n# 4\ufe0f\u20e3 Add a new runtime dependency (updates pyproject.toml &amp; uv.lock)\nuv add &lt;package-name&gt;\n</code></pre> <p>All commands are executed from the repository root.</p> <p>The development server automatically reloads when you edit files (Flask\u2019s built\u2011in reloader is enabled because <code>APP_ENV=development</code>).</p>"},{"location":"development/intro.html#-dockerbased-development","title":"\ud83d\udc33 Docker\u2011Based Development","text":"<p>The repository ships with a Docker Compose configuration for rapid iteration:</p> <pre><code># Build the development image\ndocker compose -f docker/docker-compose.yml build\n\n# Start the stack (Flask + optional reverse\u2011proxy)\ndocker compose -f docker/docker-compose.yml up -d\n</code></pre> <p>The compose file mounts the source code into the container, so you can edit files locally and see changes instantly (no hot\u2011reload inside the container, but the Flask dev server picks up changes).</p>"},{"location":"development/intro.html#useful-shortcuts","title":"Useful shortcuts","text":"Command What it does <code>docker compose logs -f mixtape</code> Tail the Flask logs. <code>docker compose exec mixtape bash</code> Drop into the container shell. <code>docker compose down -v</code> Tear down and delete the persisted volume (useful for a clean start)."},{"location":"development/intro.html#-architectural-documentation","title":"\ud83c\udfdb\ufe0f Architectural Documentation","text":"<p>This section dives into the inner workings of Mixtape Society. Each page focuses on a specific subsystem, explains its responsibilities, and shows how it interacts with the rest of the project.</p>"},{"location":"development/intro.html#core-modules","title":"Core Modules","text":"Module What it does Music Library (<code>musiclib</code>) Handles scanning, indexing, and full\u2011text search of the audio collection (TinyTag + SQLite\u202fFTS5). Mixtape Manager Persists mixtape JSON files, manages cover images, and provides CRUD operations. Audio Caching Transcodes FLAC files to MP3/OGG on\u2011demand, stores them in a cache, and streams via HTTP range requests. Progressive Web App (PWA) Enables offline playback for public shared mixtapes via service workers, smart caching, and installable app features. Configuration Centralised environment\u2011variable handling, directory layout, and defaults. Utilities Helper functions (logging, image processing, misc tools)."},{"location":"development/intro.html#flask-application-entry-point","title":"Flask Application (Entry Point)","text":"<p>The <code>app.py</code> file wires everything together:</p> <ul> <li>Initializes the Flask app, CORS, and rate limiting.</li> <li>Sets up core services (<code>MusicCollectionUI</code>, <code>MixtapeManager</code>, <code>AudioCache</code>).</li> <li>Registers blueprints for auth, browser, play, editor, and OG\u2011cover routes.</li> <li>Provides global error handling (e.g., <code>DatabaseCorruptionError</code>).</li> </ul> <p>\ud83d\udcc4 Read the full walkthrough</p>"},{"location":"development/intro.html#blueprint--route-overview","title":"Blueprint / Route Overview","text":"Blueprint URL Prefix Primary Concern Authentication <code>/auth</code> Login / logout, session handling. Browser <code>/mixtapes</code> List, play, delete, and serve static mixtape files. Play <code>/play</code> Audio streaming endpoint (<code>/play/&lt;slug&gt;</code>), range requests, and public player page. Editor <code>/editor</code> Mixtape creation / editing UI, JSON save, cover generation, and background caching trigger. OG\u2011Cover <code>/og</code> Dynamic Open\u2011Graph images for social sharing. <p>Each blueprint has its own Markdown file that details the routes, request flow, and any special middleware:</p> <ul> <li>Browser UI &amp; mixtape management</li> <li>Editor UI, save logic, and progress modal.</li> <li>Streaming, MIME detection, and range handling.</li> <li>Session\u2011based login flow.</li> <li>OG image generation.</li> </ul>"},{"location":"development/intro.html#-data-flow-summary","title":"\ud83d\udd00 Data Flow Summary","text":"<pre><code>flowchart TD\n    subgraph Client\n        UI[\"Web UI\"]\n    end\n\n    subgraph Server\n        A[\"Flask app (app.py)\"]\n        B[MusicCollectionUI]\n        C[MixtapeManager]\n        D[AudioCache]\n        E[Routes]\n    end\n\n    UI --&gt;|HTTP request| A\n    A --&gt;|calls| B\n    A --&gt;|calls| C\n    A --&gt;|calls| D\n    A --&gt;|dispatches to| E\n\n    B --&gt;|reads/writes| SQLite[(SQLite DB)]\n    C --&gt;|reads/writes| JSON[(Mixtape JSON files)]\n    D --&gt;|stores| Cache[(Cached audio files)]\n\n    style Client stroke:#333,stroke-width:1px\n    style Server stroke:#333,stroke-width:1px</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>The diagram illustrates how a request travels from the browser through the Flask entry point, into the core services, and finally reaches the persistent storage.</p>"},{"location":"development/intro.html#-contributing-guidelines","title":"\ud83d\udee1\ufe0f Contributing Guidelines","text":"<ol> <li>Fork the repository and create a feature branch (<code>git checkout -b feature/awesome-feature</code>).</li> <li>Install dev dependencies (<code>uv sync --extra dev</code>).</li> <li>Lint &amp; format (<code>uv run ruff check . &amp;&amp; uv run ruff format .</code>).</li> <li>Commit with a clear, conventional\u2011commit\u2011style message.</li> <li>Open a Pull Request targeting <code>master</code>. Include:<ul> <li>A concise description of the change.</li> <li>Screenshots or diagrams if UI is affected.</li> <li>A reference to any related issue (Closes #123).</li> </ul> </li> </ol> <p>Tip</p> <p>Code Style \u2013 Follow the existing codebase: type hints everywhere, use <code>logtools.get_logger</code> for logging, and keep Flask\u2011specific code inside the <code>routes/</code> package.</p>"},{"location":"development/intro.html#-where-to-go-next","title":"\ud83e\udded Where to Go Next?","text":"<ul> <li>Deep dive into a module \u2013 Click any link in the tables above.</li> <li>Explore the code \u2013 All source files live under <code>src/</code> (e.g., <code>src/musiclib/reader.py</code>).</li> <li>Contribute \u2013 Follow the guidelines in this page and submit a PR.</li> </ul> <p>Happy hacking! \ud83c\udfa7\ud83d\ude80</p>"},{"location":"development/audio-playback/media-integration.html","title":"Media Session Integration","text":""},{"location":"development/audio-playback/media-integration.html#media-playback-integration","title":"Media Playback Integration","text":"<p>This page provides an overview of how the playback routes support different media playback technologies (local playback, Chromecast, Android Auto, AirPlay) and how they coordinate with each other.</p>"},{"location":"development/audio-playback/media-integration.html#-overview","title":"\ud83c\udfaf Overview","text":"<p>Mixtape Society supports multiple playback methods to enable flexible listening experiences across different devices and contexts. The playback routes serve as the common backend for all these technologies.</p>"},{"location":"development/audio-playback/media-integration.html#-playback-technologies","title":"\ud83d\udcca Playback Technologies","text":""},{"location":"development/audio-playback/media-integration.html#technology-comparison","title":"Technology Comparison","text":"Technology Type Use Case Server Requirements Complexity Local Playback Standard HTML5 Desktop, mobile browsers Audio streaming Low Chromecast Network casting TVs, speakers CORS + Range requests High Android Auto Enhanced local In-car dashboard Cover optimization Medium AirPlay Native iOS Apple devices Standard streaming Low"},{"location":"development/audio-playback/media-integration.html#when-each-is-used","title":"When Each is Used","text":"<pre><code>graph TD\n    User[User Starts Playback]\n    CheckMode{Check Playback Mode}\n    Casting{Casting Active?}\n    AndroidAuto{Android Auto?}\n\n    User --&gt; CheckMode\n    CheckMode --&gt; Casting\n    Casting --&gt;|Yes| Chromecast[Use Chromecast SDK]\n    Casting --&gt;|No| AndroidAuto\n    AndroidAuto --&gt;|Yes| AASession[Enhanced Media Session]\n    AndroidAuto --&gt;|No| Standard[Standard Media Session]\n\n    Chromecast --&gt; CastDevice[Chromecast Device]\n    AASession --&gt; CarDashboard[Car Dashboard]\n    Standard --&gt; Browser[Browser Controls]\n\n    style Chromecast fill:#4a6fa5,color:#fff\n    style AASession fill:#c65d5d,color:#fff\n    style Standard fill:#4a8c5f,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/media-integration.html#-local-playback","title":"\ud83d\udd0a Local Playback","text":""},{"location":"development/audio-playback/media-integration.html#overview","title":"Overview","text":"<p>Standard HTML5 audio playback in the browser.</p> <p>How it works:</p> <ol> <li>Browser requests audio file: <code>GET /play/path?quality=medium</code></li> <li>Server validates and serves file (200 or 206)</li> <li>HTML5 <code>&lt;audio&gt;</code> element plays file</li> <li>Media Session API provides lock screen controls</li> </ol> <p>Server requirements:</p> <ul> <li>\u2705 Audio streaming (Audio Streaming)</li> <li>\u2705 Quality parameter (Quality &amp; Caching)</li> <li>\u2705 Range requests optional (Range Requests)</li> </ul> <p>Frontend:</p> <ul> <li><code>playerControls.js</code> - Playback orchestration</li> <li><code>playerUtils.js</code> - Media Session setup</li> </ul>"},{"location":"development/audio-playback/media-integration.html#advantages","title":"Advantages","text":"<ul> <li>\u2705 No setup required</li> <li>\u2705 Works on all modern browsers</li> <li>\u2705 Simple implementation</li> <li>\u2705 No network complexity</li> </ul>"},{"location":"development/audio-playback/media-integration.html#limitations","title":"Limitations","text":"<ul> <li>\u274c Single device only</li> <li>\u274c Basic UI controls</li> <li>\u274c Limited metadata display</li> </ul>"},{"location":"development/audio-playback/media-integration.html#-chromecast","title":"\ud83d\udce1 Chromecast","text":""},{"location":"development/audio-playback/media-integration.html#overview_1","title":"Overview","text":"<p>Network-based casting to TVs and speakers. Browser acts as remote control while audio streams directly from server to Chromecast device.</p> <p>Architecture:</p> <pre><code>graph LR\n    Browser[Browser]\n    CastSDK[Cast SDK]\n    Server[Flask Server]\n    Chromecast[Chromecast Device]\n\n    Browser --&gt;|Control commands| CastSDK\n    CastSDK --&gt;|Media queue| Chromecast\n    Chromecast --&gt;|Audio requests| Server\n    Server --&gt;|Audio stream| Chromecast\n\n    style CastSDK fill:#4a6fa5,color:#fff\n    style Chromecast fill:#c65d5d,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>How it works:</p> <ol> <li>User clicks cast button</li> <li>Browser sends queue to Chromecast via Cast SDK</li> <li>Chromecast requests each track from server</li> <li>Server streams audio with CORS headers</li> <li>Browser controls playback via Cast SDK</li> </ol> <p>Server requirements:</p> <ul> <li>\u2705 CORS headers: <code>Access-Control-Allow-Origin: *</code></li> <li>\u2705 Range request support (required for seeking)</li> <li>\u2705 Quality parameter support</li> <li>\u2705 Proper MIME types</li> </ul> <p>Critical headers:</p> <pre><code>response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\nresponse.headers[\"Access-Control-Expose-Headers\"] = \\\n    \"Content-Type, Accept-Encoding, Range\"\nresponse.headers[\"Accept-Ranges\"] = \"bytes\"\n</code></pre> <p>See: Chromecast Integration</p>"},{"location":"development/audio-playback/media-integration.html#advantages_1","title":"Advantages","text":"<ul> <li>\u2705 Cast to multiple devices</li> <li>\u2705 High-quality audio</li> <li>\u2705 Works across home network</li> <li>\u2705 Unified controls (lock screen, browser, TV remote)</li> </ul>"},{"location":"development/audio-playback/media-integration.html#limitations_1","title":"Limitations","text":"<ul> <li>\u274c Requires Cast-enabled device</li> <li>\u274c Same WiFi network required</li> <li>\u274c More complex setup</li> <li>\u274c iOS has limited support</li> </ul>"},{"location":"development/audio-playback/media-integration.html#-android-auto","title":"\ud83d\ude97 Android Auto","text":""},{"location":"development/audio-playback/media-integration.html#overview_2","title":"Overview","text":"<p>Enhanced local playback with in-car dashboard integration. Audio plays on phone while controls and metadata display on car dashboard.</p> <p>Architecture:</p> <pre><code>graph LR\n    Phone[Phone Browser]\n    MediaSession[Media Session API]\n    Car[Car Dashboard]\n    Audio[Audio Element]\n\n    Phone --&gt;|Enhanced metadata| MediaSession\n    MediaSession --&gt;|Display &amp; controls| Car\n    Audio --&gt;|Plays on phone| Audio\n    Car --&gt;|User actions| MediaSession\n    MediaSession --&gt;|Events| Phone\n\n    style MediaSession fill:#4a6fa5,color:#fff\n    style Car fill:#c65d5d,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>How it works:</p> <ol> <li>Android Auto detected when phone connects to car</li> <li>Enhanced Media Session setup with position state</li> <li>Requests multiple cover art sizes (96x96 to 512x512)</li> <li>Dashboard displays track info and controls</li> <li>Steering wheel buttons/voice commands control playback</li> </ol> <p>Server requirements:</p> <ul> <li>\u2705 Cover art size optimization (5 sizes: 96, 128, 192, 256, 512)</li> <li>\u2705 Standard audio streaming</li> <li>\u274c No CORS headers needed (local playback)</li> <li>\u274c No range requests needed (standard seeking)</li> </ul> <p>Key difference from Chromecast:</p> Aspect Chromecast Android Auto Network WiFi casting Local playback Server Load Direct stream to device Stream to phone CORS Required Not required Range Requests Required Optional Artwork 1 size 5 sizes Complexity High (SDK + server) Medium (Media Session only) <p>See: Android Auto Integration</p>"},{"location":"development/audio-playback/media-integration.html#advantages_2","title":"Advantages","text":"<ul> <li>\u2705 Automatic connection (no user action)</li> <li>\u2705 Safe driving interface</li> <li>\u2705 Voice command support</li> <li>\u2705 Steering wheel controls</li> <li>\u2705 Dashboard display</li> </ul>"},{"location":"development/audio-playback/media-integration.html#limitations_2","title":"Limitations","text":"<ul> <li>\u274c Android Auto car/device required</li> <li>\u274c Only works in car</li> <li>\u274c Single user (driver)</li> </ul>"},{"location":"development/audio-playback/media-integration.html#-airplay","title":"\ud83c\udf4e AirPlay","text":""},{"location":"development/audio-playback/media-integration.html#overview_3","title":"Overview","text":"<p>Native iOS casting to AirPlay-enabled devices.</p> <p>How it works:</p> <ol> <li>Safari detects AirPlay-enabled devices</li> <li>User taps AirPlay icon in audio controls</li> <li>iOS handles streaming to AirPlay device</li> <li>Standard playback routes serve audio</li> </ol> <p>Server requirements:</p> <ul> <li>\u2705 Standard audio streaming</li> <li>\u2705 Quality parameter</li> <li>\u274c No special CORS requirements (handled by iOS)</li> <li>\u274c No range request requirements</li> </ul>"},{"location":"development/audio-playback/media-integration.html#advantages_3","title":"Advantages","text":"<ul> <li>\u2705 Native iOS integration</li> <li>\u2705 Works with HomePod, Apple TV, AirPlay speakers</li> <li>\u2705 Multi-room audio (AirPlay 2)</li> <li>\u2705 Simple implementation (iOS handles everything)</li> </ul>"},{"location":"development/audio-playback/media-integration.html#limitations_3","title":"Limitations","text":"<ul> <li>\u274c iOS/macOS only</li> <li>\u274c AirPlay-enabled device required</li> <li>\u274c Same network required</li> </ul>"},{"location":"development/audio-playback/media-integration.html#-mode-coordination","title":"\ud83d\udd04 Mode Coordination","text":""},{"location":"development/audio-playback/media-integration.html#player-controls-routing","title":"Player Controls Routing","text":"<p>The <code>playerControls.js</code> module coordinates between playback modes:</p> <pre><code>function playTrack(index) {\n    // 1. Check if currently casting\n    if (globalCastingState) {\n        console.log('\ud83c\udfad Routing to Chromecast');\n        castJumpToTrack(index);\n        return;\n    }\n\n    console.log('\ud83d\udd0a Playing locally');\n\n    // 2. Local playback\n    const track = trackItems[index];\n    player.src = `/play/${track.dataset.path}?quality=medium`;\n    player.play();\n\n    // 3. Setup Media Session based on platform\n    const metadata = extractMetadataFromDOM(track);\n\n    if (isAndroidAutoConnected()) {\n        // Enhanced Media Session for Android Auto\n        setupAndroidAutoMediaSession(metadata, playerControls, player);\n    } else {\n        // Standard Media Session (iOS, Desktop)\n        setupLocalMediaSession(metadata, playerControls);\n    }\n}\n</code></pre> <p>Priority order:</p> <ol> <li>Chromecast (highest priority)</li> <li>If casting is active, all commands route to Cast SDK</li> <li> <p>Local player is silenced</p> </li> <li> <p>Android Auto (medium priority)</p> </li> <li>If detected and not casting</li> <li> <p>Enhanced Media Session with position state</p> </li> <li> <p>Standard Playback (fallback)</p> </li> <li>Default for iOS, Desktop</li> <li>Basic Media Session</li> </ol>"},{"location":"development/audio-playback/media-integration.html#mode-switching","title":"Mode Switching","text":"<p>Chromecast Start:</p> <pre><code>function onCastSessionStart() {\n    silenceLocalPlayer();      // Pause and mute local &lt;audio&gt;\n    clearMediaSession();       // Remove local handlers\n    updateMediaSessionForCast(); // Set Cast handlers\n    globalCastingState = true;\n}\n</code></pre> <p>Chromecast Stop:</p> <pre><code>function onCastSessionEnd() {\n    enableLocalPlayer();       // Restore local &lt;audio&gt;\n    globalCastingState = false;\n\n    // Restore appropriate Media Session\n    if (isAndroidAutoConnected()) {\n        setupAndroidAutoMediaSession(...);\n    } else {\n        setupLocalMediaSession(...);\n    }\n}\n</code></pre>"},{"location":"development/audio-playback/media-integration.html#-quality-parameter-usage","title":"\ud83c\udf9b\ufe0f Quality Parameter Usage","text":"<p>All playback modes respect the quality parameter:</p>"},{"location":"development/audio-playback/media-integration.html#by-mode","title":"By Mode","text":"Mode Quality Usage Reason Chromecast Always uses quality param Network bandwidth optimization Android Auto Uses quality param Car data connection limits Desktop Uses quality param User preference Mobile (WiFi) Uses quality param Battery and bandwidth Mobile (Cellular) Defaults to <code>low</code> Data usage minimization"},{"location":"development/audio-playback/media-integration.html#url-construction","title":"URL Construction","text":"<p>Frontend (playerControls.js):</p> <pre><code>const currentQuality = localStorage.getItem('audioQuality') || 'medium';\nconst url = `/play/${track.path}?quality=${currentQuality}`;\n</code></pre> <p>Chromecast (chromecast.js):</p> <pre><code>const mediaInfo = new chrome.cast.media.MediaInfo(\n    `${baseUrl}/play/${track.file_path}?quality=medium`,\n    'audio/mpeg'\n);\n</code></pre> <p>See: Quality &amp; Caching</p>"},{"location":"development/audio-playback/media-integration.html#-server-requirements-summary","title":"\ud83d\udee0\ufe0f Server Requirements Summary","text":""},{"location":"development/audio-playback/media-integration.html#required-for-all-modes","title":"Required for All Modes","text":"<pre><code>@play.route(\"/play/&lt;path:file_path&gt;\")\ndef stream_audio(file_path):\n    # \u2705 Path validation\n    full_path = _resolve_and_validate_path(file_path)\n\n    # \u2705 MIME type detection\n    mime_type = _guess_mime_type(full_path)\n\n    # \u2705 Quality-aware caching\n    quality = request.args.get(\"quality\", \"medium\")\n    serve_path = _get_serving_path(full_path, quality)\n\n    # \u2705 Serve file\n    return send_file(serve_path, mimetype=mime_type)\n</code></pre>"},{"location":"development/audio-playback/media-integration.html#additional-for-chromecast","title":"Additional for Chromecast","text":"<pre><code>    # \u2705 CORS headers\n    response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\n    response.headers[\"Access-Control-Expose-Headers\"] = \\\n        \"Content-Type, Accept-Encoding, Range\"\n\n    # \u2705 Range request handling\n    if request.headers.get(\"Range\"):\n        return _handle_range_request(serve_path, mime_type)\n</code></pre>"},{"location":"development/audio-playback/media-integration.html#additional-for-android-auto","title":"Additional for Android Auto","text":"<pre><code># \u2705 Cover art optimization (separate route)\n@play.route(\"/covers/&lt;slug&gt;_&lt;size&gt;.jpg\")\ndef serve_sized_cover(slug, size):\n    # Returns optimized cover at requested size\n    # Sizes: 96x96, 128x128, 192x192, 256x256, 512x512\n    pass\n</code></pre>"},{"location":"development/audio-playback/media-integration.html#-use-case-recommendations","title":"\ud83d\udcca Use Case Recommendations","text":""},{"location":"development/audio-playback/media-integration.html#scenario-based-recommendations","title":"Scenario-Based Recommendations","text":"Scenario Recommended Method Why Living room TV Chromecast Large screen, shared listening Car dashboard Android Auto Automatic, safe driving UI Personal listening Standard Simple, no setup Multi-room audio Chromecast Cast to multiple devices Offline/low bandwidth Standard (cached) No network needed Party/gathering Chromecast Share control via QR code Work/background Standard Desktop browser iOS user with HomePod AirPlay Native iOS integration"},{"location":"development/audio-playback/media-integration.html#-detailed-documentation","title":"\ud83d\udd17 Detailed Documentation","text":"<p>For complete implementation details, see:</p>"},{"location":"development/audio-playback/media-integration.html#casting-technologies","title":"Casting Technologies","text":"<ul> <li>Chromecast Integration - Complete Cast SDK guide</li> <li>SDK setup and initialization</li> <li>Queue management</li> <li>Media Session synchronization</li> <li>CORS and range request requirements</li> <li>Platform-specific guidance</li> <li> <p>Troubleshooting</p> </li> <li> <p>Android Auto Overview - Enhanced Media Session guide</p> </li> <li>Architecture and detection</li> <li>Enhanced Media Session setup</li> <li>Artwork optimization (5 sizes)</li> <li>Position state management</li> <li>Testing procedures</li> </ul>"},{"location":"development/audio-playback/media-integration.html#frontend-integration","title":"Frontend Integration","text":"<ul> <li>Player Controls - Playback orchestration</li> <li>Mode coordination logic</li> <li>Casting state management</li> <li>Quality selector</li> <li> <p>Event handling</p> </li> <li> <p>Player Utilities - Shared utilities</p> </li> <li>Device detection</li> <li>Media Session management</li> <li>Player state control</li> <li>Metadata extraction</li> </ul>"},{"location":"development/audio-playback/media-integration.html#backend-services","title":"Backend Services","text":"<ul> <li>Audio Streaming - Core streaming implementation</li> <li>Range Requests - Partial content support</li> <li>Quality &amp; Caching - Quality management</li> <li>Cover Art System - Image optimization</li> </ul>"},{"location":"development/audio-playback/media-integration.html#-for-developers","title":"\ud83c\udf93 For Developers","text":""},{"location":"development/audio-playback/media-integration.html#adding-a-new-playback-mode","title":"Adding a New Playback Mode","text":"<p>Steps:</p> <ol> <li>Detect the new mode</li> </ol> <pre><code>// In playerUtils.js\nexport function detectNewMode() {\n    // Detection logic\n    return { isNewMode: true, ... };\n}\n</code></pre> <ol> <li>Add mode check in playerControls</li> </ol> <pre><code>if (globalCastingState) {\n    // Chromecast\n} else if (isAndroidAutoConnected()) {\n    // Android Auto\n} else if (isNewMode()) {\n    // New mode\n} else {\n    // Standard\n}\n</code></pre> <ol> <li>Implement mode-specific setup</li> </ol> <pre><code>// In newMode.js\nexport function setupNewMode(metadata, controls) {\n    // Mode-specific initialization\n}\n</code></pre> <ol> <li>Update server if needed</li> </ol> <pre><code># Add any required headers or endpoints\n</code></pre>"},{"location":"development/audio-playback/media-integration.html#debugging-playback-issues","title":"Debugging Playback Issues","text":"<p>Check in this order:</p> <ol> <li>Mode detection</li> </ol> <pre><code>console.log('Casting:', globalCastingState);\nconsole.log('Android Auto:', isAndroidAutoConnected());\n</code></pre> <ol> <li>Network requests</li> <li>Open DevTools \u2192 Network tab</li> <li>Look for 200/206 responses</li> <li> <p>Check CORS headers</p> </li> <li> <p>Server logs</p> </li> </ol> <pre><code>tail -f logs/app.log | grep \"Streaming\"\n</code></pre> <ol> <li>Media Session</li> </ol> <pre><code>// Check if active\nconsole.log('Media Session:', navigator.mediaSession.metadata);\n</code></pre> <p>This overview connects all playback technologies. For implementation details, see the linked documentation.</p>"},{"location":"development/audio-playback/overview.html","title":"System Overview","text":""},{"location":"development/audio-playback/overview.html#playback-routes-overview","title":"Playback Routes Overview","text":"<p>The playback system is the core of Mixtape Society's audio streaming infrastructure. It handles audio file delivery, quality management, range requests for seeking, and integrates with various playback technologies (Chromecast, Android Auto, AirPlay).</p>"},{"location":"development/audio-playback/overview.html#-purpose","title":"\ud83c\udfaf Purpose","text":"<p>The <code>play</code> Flask blueprint provides:</p> <ul> <li>Audio streaming with quality selection and caching</li> <li>HTTP range support for seeking and Chromecast</li> <li>Public mixtape pages for sharing</li> <li>Cover image serving with size optimization</li> <li>Cache management endpoints for administrators</li> <li>QR code generation for easy sharing</li> </ul> <p>All routes live under the Flask Blueprint named <code>play</code>.</p>"},{"location":"development/audio-playback/overview.html#-routes-reference","title":"\ud83d\uddfa\ufe0f Routes Reference","text":"<pre><code>play = Blueprint(\"play\", __name__)   # registered in the main Flask app\n</code></pre> HTTP Method URL Pattern Handler Description Documentation <code>GET</code> <code>/play/&lt;path:file_path&gt;</code> <code>stream_audio(file_path)</code> Streams audio file with quality &amp; range support Audio Streaming <code>GET</code> <code>/share/&lt;slug&gt;</code> <code>public_play(slug)</code> Renders public mixtape player page Audio Streaming <code>GET</code> <code>/covers/&lt;filename&gt;</code> <code>serve_cover(filename)</code> Serves cover images Covers Route <code>GET</code> <code>/qr/&lt;slug&gt;.png</code> <code>qr.generate_qr(slug)</code> Simple QR code PNG QR Codes <code>GET</code> <code>/qr/&lt;slug&gt;/download</code> <code>qr.download_qr(slug)</code> Enhanced QR with cover art QR Codes <code>GET</code> <code>/admin/cache/stats</code> <code>cache_stats()</code> Returns cache statistics JSON Quality &amp; Caching <code>POST</code> <code>/admin/cache/clear</code> <code>clear_cache()</code> Clears audio cache Quality &amp; Caching"},{"location":"development/audio-playback/overview.html#-high-level-request-flow","title":"\ud83d\udd04 High-Level Request Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant FlaskApp\n    participant stream_audio()\n    participant _resolve_and_validate_path()\n    participant _guess_mime_type()\n    participant _get_serving_path()\n    participant AudioCache\n    participant _handle_range_request()\n    participant send_file\n\n    Client-&gt;&gt;FlaskApp: GET /play/&lt;file_path&gt;?quality=medium [&amp; Range]\n    FlaskApp-&gt;&gt;stream_audio(): Call with file_path + query\n    stream_audio()-&gt;&gt;_resolve_and_validate_path(): Validate &amp; resolve\n    _resolve_and_validate_path()--&gt;&gt;stream_audio(): full_path (or abort 403/404)\n    stream_audio()-&gt;&gt;_guess_mime_type(): Guess MIME\n    _guess_mime_type()--&gt;&gt;stream_audio(): mime_type\n    stream_audio()-&gt;&gt;_get_serving_path(): Choose original or cached file (quality)\n    _get_serving_path()-&gt;&gt;AudioCache: cache.is_cached / cache.get_cache_path\n    AudioCache--&gt;&gt;_get_serving_path(): serve_path\n    alt Range header present\n        stream_audio()-&gt;&gt;_handle_range_request(): Serve partial bytes\n        _handle_range_request()--&gt;&gt;stream_audio(): 206 Partial Content response\n        stream_audio--&gt;&gt;FlaskApp: Return 206\n    else No Range header\n        stream_audio-&gt;&gt;send_file: Send full file\n        send_file--&gt;&gt;stream_audio(): 200 OK response\n        stream_audio--&gt;&gt;FlaskApp: Return 200\n    end\n    FlaskApp--&gt;&gt;Client: Stream audio bytes</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/overview.html#-detailed-documentation","title":"\ud83d\udcda Detailed Documentation","text":""},{"location":"development/audio-playback/overview.html#core-streaming","title":"Core Streaming","text":"<p>Audio Streaming - Complete audio streaming implementation</p> <ul> <li>Path validation and security</li> <li>MIME type detection</li> <li>File serving logic</li> <li>Public mixtape pages</li> <li>Response headers and CORS</li> <li>Error handling</li> <li>Logging</li> </ul>"},{"location":"development/audio-playback/overview.html#advanced-features","title":"Advanced Features","text":"<p>Range Requests - HTTP range support for seeking</p> <ul> <li>Range header parsing</li> <li>Partial content responses (206)</li> <li>Chromecast requirements</li> <li>Error handling (416)</li> </ul> <p>Quality &amp; Caching - Quality selection and caching system</p> <ul> <li>Quality levels (high, medium, low, original)</li> <li>Cache lookup and serving</li> <li>Admin cache management endpoints</li> <li>Performance optimization</li> </ul> <p>Media Integration - Playback technology overview</p> <ul> <li>Local playback</li> <li>Chromecast casting</li> <li>Android Auto integration</li> <li>Mode comparison and coordination</li> </ul>"},{"location":"development/audio-playback/overview.html#-quick-reference","title":"\ud83d\ude80 Quick Reference","text":""},{"location":"development/audio-playback/overview.html#common-tasks","title":"Common Tasks","text":"task example request Stream audio file <code>GET /play/artist/album/track.mp3?quality=medium</code> Stream with seeking <code>GET /play/artist/album/track.mp3 Range: bytes=1000-2000</code> Get cache stats <code>GET /admin/cache/stats</code> Clear audio cache <code>POST /admin/cache/clear</code>"},{"location":"development/audio-playback/overview.html#response-codes","title":"Response Codes","text":"Code Meaning When 200 OK Full file served successfully 206 Partial Content Range request served successfully 403 Forbidden Path outside MUSIC_ROOT (security) 404 Not Found File doesn't exist 416 Range Not Satisfiable Invalid range request 500 Internal Server Error Unexpected error"},{"location":"development/audio-playback/overview.html#key-headers","title":"Key Headers","text":"<p>Request:</p> <ul> <li><code>Range: bytes=start-end</code> - Request partial content</li> </ul> <p>Response:</p> <ul> <li><code>Accept-Ranges: bytes</code> - Server supports range requests</li> <li><code>Access-Control-Allow-Origin: *</code> - CORS for Chromecast</li> <li><code>Cache-Control: public, max-age=3600</code> - Enable caching</li> <li><code>Content-Range: bytes start-end/total</code> - Partial content info (206 only)</li> </ul>"},{"location":"development/audio-playback/overview.html#-architecture-components","title":"\ud83c\udfd7\ufe0f Architecture Components","text":""},{"location":"development/audio-playback/overview.html#flask-blueprint-routesplaypy","title":"Flask Blueprint (<code>routes/play.py</code>)","text":"<p>Core implementation of all playback routes.</p> <p>Key responsibilities:</p> <ul> <li>Route registration and request handling</li> <li>Path validation and security</li> <li>MIME type detection</li> <li>Quality and cache management</li> <li>Range request processing</li> <li>Response construction</li> </ul> <p>Dependencies:</p> <ul> <li><code>AudioCache</code> - Audio caching and transcoding</li> <li><code>MixtapeManager</code> - Mixtape metadata and file management</li> <li><code>Logger</code> - Structured logging</li> </ul>"},{"location":"development/audio-playback/overview.html#audio-cache-audio_cache","title":"Audio Cache (<code>audio_cache/</code>)","text":"<p>Handles audio transcoding and caching.</p> <p>Features:</p> <ul> <li>Quality-based transcoding (FLAC \u2192 MP3)</li> <li>Cache hit/miss tracking</li> <li>Automatic cache management</li> <li>Size and age-based cleanup</li> </ul> <p>See: Audio Caching Documentation</p>"},{"location":"development/audio-playback/overview.html#player-integration","title":"Player Integration","text":"<p>Frontend JavaScript that consumes these routes.</p> <p>Modules:</p> <ul> <li><code>playerControls.js</code> - Playback orchestration</li> <li><code>chromecast.js</code> - Cast SDK integration</li> <li><code>androidAuto.js</code> - Enhanced Media Session</li> <li><code>sleepTimer.js</code> - Automatic playback shutdown</li> </ul>"},{"location":"development/audio-playback/overview.html#-related-documentation","title":"\ud83d\udd17 Related Documentation","text":""},{"location":"development/audio-playback/overview.html#backend-services","title":"Backend Services","text":"<ul> <li>Audio Caching - Transcoding and cache management</li> <li>Mixtape Manager - Mixtape CRUD operations</li> <li>Cover Art System - Image optimization</li> <li>QR Code Generation - QR code routes</li> </ul>"},{"location":"development/audio-playback/overview.html#frontend-integration","title":"Frontend Integration","text":"<ul> <li>Player Controls - Playback orchestration</li> <li>Sleep Timer - Automatic playback shutdown</li> <li>Player Utilities - Uniforming platform experiences</li> <li>Chromecast Integration - Cast SDK setup</li> <li>Android Auto - Enhanced Media Session</li> </ul>"},{"location":"development/audio-playback/overview.html#configuration","title":"Configuration","text":"<ul> <li>Configuration - MUSIC_ROOT, DATA_ROOT, cache settings</li> </ul>"},{"location":"development/audio-playback/overview.html#-for-developers","title":"\ud83c\udf93 For Developers","text":""},{"location":"development/audio-playback/overview.html#understanding-the-system","title":"Understanding the System","text":"<p>New to the codebase? Read in this order:</p> <ol> <li>This overview (you are here)</li> <li>Audio Streaming - Understand basic streaming</li> <li>Quality &amp; Caching - Learn cache system</li> <li>Range Requests - Understand seeking</li> <li>Media Integration - See how it all fits together</li> </ol>"},{"location":"development/audio-playback/overview.html#common-development-tasks","title":"Common Development Tasks","text":"<p>Adding a new quality level:</p> <ul> <li>Update <code>QUALITY_LEVELS</code> in frontend</li> <li>Update cache directory structure</li> <li>See: Quality &amp; Caching</li> </ul> <p>Debugging streaming issues:</p> <ul> <li>Check logs for path validation errors</li> <li>Verify CORS headers for Chromecast</li> <li>Test range requests with curl</li> <li>See: Audio Streaming</li> </ul> <p>Performance optimization:</p> <ul> <li>Monitor cache hit rates</li> <li>Adjust cache cleanup schedule</li> <li>Pre-populate cache for popular tracks</li> <li>See: Quality &amp; Caching</li> </ul>"},{"location":"development/audio-playback/overview.html#testing","title":"Testing","text":"<p>Manual testing:</p> <pre><code># Test basic streaming\ncurl -I http://localhost:5000/play/artist/album/track.mp3\n\n# Test range request\ncurl -I -H \"Range: bytes=0-1023\" http://localhost:5000/play/artist/album/track.mp3\n\n# Test quality parameter\ncurl -I http://localhost:5000/play/artist/album/track.flac?quality=medium\n\n# Get cache stats\ncurl http://localhost:5000/admin/cache/stats\n</code></pre>"},{"location":"development/audio-playback/overview.html#-system-flow-diagram","title":"\ud83d\udcca System Flow Diagram","text":""},{"location":"development/audio-playback/overview.html#complete-request-flow","title":"Complete Request Flow","text":"<pre><code>graph TB\n    Client[Client Request]\n\n    Route{Route Pattern}\n\n    Stream[stream_audio]\n    Player[public_play]\n    Cover[serve_cover]\n    CacheStats[cache_stats]\n    CacheClear[clear_cache]\n\n    Validate[Path Validation]\n    MIME[MIME Detection]\n    Quality[Quality Selection]\n    Cache[Cache Lookup]\n    RangeCheck{Range Header?}\n    Range[Range Request Handler]\n    Full[Full File Sender]\n\n    Response200[200 OK]\n    Response206[206 Partial]\n    Response403[403 Forbidden]\n    Response404[404 Not Found]\n    Response416[416 Range Error]\n\n    Client --&gt; Route\n\n    Route --&gt;|/play/*| Stream\n    Route --&gt;|/share/*| Player\n    Route --&gt;|/covers/*| Cover\n    Route --&gt;|/admin/cache/stats| CacheStats\n    Route --&gt;|/admin/cache/clear| CacheClear\n\n    Stream --&gt; Validate\n    Validate --&gt;|Valid| MIME\n    Validate --&gt;|Invalid| Response403\n    Validate --&gt;|Not Found| Response404\n\n    MIME --&gt; Quality\n    Quality --&gt; Cache\n    Cache --&gt; RangeCheck\n\n    RangeCheck --&gt;|Yes| Range\n    RangeCheck --&gt;|No| Full\n\n    Range --&gt;|Valid| Response206\n    Range --&gt;|Invalid| Response416\n    Full --&gt; Response200\n\n    style Stream fill:#4a6fa5,color:#fff\n    style Response200 fill:#4a8c5f,color:#fff\n    style Response206 fill:#4a8c5f,color:#fff\n    style Response403 fill:#c65d5d,color:#fff\n    style Response404 fill:#c65d5d,color:#fff\n    style Response416 fill:#c65d5d,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>This overview provides a high-level understanding of the playback system. For implementation details, see the detailed documentation pages linked above.</p>"},{"location":"development/audio-playback/backend/audio-streaming.html","title":"Audio Streaming","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#audio-streaming","title":"Audio Streaming","text":"<p>This page documents the core audio streaming implementation in Mixtape Society, including path validation, MIME type detection, file serving, and the public mixtape player page.</p>"},{"location":"development/audio-playback/backend/audio-streaming.html#-overview","title":"\ud83c\udfaf Overview","text":"<p>The <code>stream_audio()</code> function is the central handler for audio file requests. It orchestrates path validation, MIME type detection, quality selection, and response construction.</p> <p>Key responsibilities:</p> <ul> <li>Validate file paths (prevent directory traversal attacks)</li> <li>Detect correct MIME type for audio files</li> <li>Select appropriate file version (original or cached)</li> <li>Construct proper HTTP responses with security headers</li> <li>Handle errors gracefully with appropriate status codes</li> </ul>"},{"location":"development/audio-playback/backend/audio-streaming.html#-path-validation","title":"\ud83d\udd12 Path Validation","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#_resolve_and_validate_path","title":"_resolve_and_validate_path()","text":"<p>Purpose: Ensure requested path is safe and exists</p> <p>Signature:</p> <pre><code>def _resolve_and_validate_path(file_path: str) -&gt; Path\n</code></pre> <p>Implementation:</p> <pre><code>def _resolve_and_validate_path(file_path: str) -&gt; Path:\n    \"\"\"\n    Validate and resolve audio file path\n\n    Security: Prevents directory traversal attacks\n    Returns: Absolute path if valid\n    Raises: 403 if outside MUSIC_ROOT, 404 if not found\n    \"\"\"\n    music_root = Path(current_app.config[\"MUSIC_ROOT\"]).resolve()\n    full_path = (music_root / file_path).resolve()\n\n    # Security check: Ensure path is within MUSIC_ROOT\n    if not str(full_path).startswith(str(music_root)):\n        logger.warning(f\"Path traversal attempt: {file_path}\")\n        abort(403)\n\n    # Existence check\n    if not full_path.exists():\n        logger.warning(f\"File not found: {full_path}\")\n        abort(404)\n\n    return full_path\n</code></pre> <p>Security features:</p> <ol> <li>Path resolution: Resolves symlinks and <code>..</code> references</li> <li>Boundary check: Ensures result stays within <code>MUSIC_ROOT</code></li> <li>Existence validation: Confirms file exists before serving</li> </ol> <p>Attack prevention:</p> <pre><code># These malicious paths are blocked:\n../../../etc/passwd              # \u2192 403 (outside MUSIC_ROOT)\n../../app/config.py              # \u2192 403 (outside MUSIC_ROOT)\nartist/../../../sensitive.file   # \u2192 403 (resolves outside boundary)\nnonexistent.mp3                  # \u2192 404 (doesn't exist)\n</code></pre> <p>Logging:</p> <ul> <li>WARNING: Path traversal attempts and missing files</li> <li>Includes attempted path for security auditing</li> </ul>"},{"location":"development/audio-playback/backend/audio-streaming.html#-mime-type-detection","title":"\ud83c\udfb5 MIME Type Detection","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#_guess_mime_type","title":"_guess_mime_type()","text":"<p>Purpose: Determine correct Content-Type header for audio file</p> <p>Signature:</p> <pre><code>def _guess_mime_type(full_path: Path) -&gt; str\n</code></pre> <p>Implementation:</p> <pre><code>def _guess_mime_type(full_path: Path) -&gt; str:\n    \"\"\"\n    Guess MIME type from file extension\n\n    Uses Python's mimetypes module with fallback map\n    for less common audio formats\n    \"\"\"\n    mime_type, _ = mimetypes.guess_type(str(full_path))\n\n    # Fallback for audio formats not in standard mimetypes\n    if not mime_type:\n        extension = full_path.suffix.lower()\n        fallback_map = {\n            '.flac': 'audio/flac',\n            '.m4a': 'audio/mp4',\n            '.aac': 'audio/aac',\n            '.ogg': 'audio/ogg',\n            '.mp3': 'audio/mpeg',\n            '.wav': 'audio/wav',\n            '.opus': 'audio/opus',\n        }\n        mime_type = fallback_map.get(extension, 'application/octet-stream')\n\n    return mime_type\n</code></pre> <p>Supported formats:</p> Extension MIME Type Detection <code>.mp3</code> <code>audio/mpeg</code> Standard mimetypes <code>.flac</code> <code>audio/flac</code> Fallback map <code>.m4a</code> <code>audio/mp4</code> Fallback map <code>.aac</code> <code>audio/aac</code> Fallback map <code>.ogg</code> <code>audio/ogg</code> Fallback map <code>.wav</code> <code>audio/wav</code> Standard mimetypes <code>.opus</code> <code>audio/opus</code> Fallback map <p>Why fallback map?</p> <p>Python's standard <code>mimetypes</code> module doesn't recognize some audio formats (FLAC, M4A) by default. The fallback ensures correct MIME types for all supported formats.</p> <p>Default fallback:</p> <p>Unknown extensions return <code>application/octet-stream</code> which browsers typically download rather than play.</p>"},{"location":"development/audio-playback/backend/audio-streaming.html#-streaming-logic","title":"\ud83c\udf9b\ufe0f Streaming Logic","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#stream_audio","title":"stream_audio()","text":"<p>Purpose: Main route handler for audio streaming</p> <p>Route:</p> <pre><code>@play.route(\"/play/&lt;path:file_path&gt;\")\ndef stream_audio(file_path: str) -&gt; Response\n</code></pre> <p>Flow diagram:</p> <pre><code>flowchart TD\n    Start[Request: /play/path?quality=X]\n    Validate[_resolve_and_validate_path]\n    MIME[_guess_mime_type]\n    Serving[_get_serving_path]\n    RangeCheck{Range header?}\n    Range[_handle_range_request]\n    Full[send_file]\n    Headers[Add response headers]\n    Return200[Return 200]\n    Return206[Return 206]\n\n    Start --&gt; Validate\n    Validate --&gt; MIME\n    MIME --&gt; Serving\n    Serving --&gt; RangeCheck\n    RangeCheck --&gt;|Yes| Range\n    RangeCheck --&gt;|No| Full\n    Range --&gt; Return206\n    Full --&gt; Headers\n    Headers --&gt; Return200\n\n    style Start fill:#4a6fa5,color:#fff\n    style Return200 fill:#4a8c5f,color:#fff\n    style Return206 fill:#4a8c5f,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>Implementation:</p> <pre><code>@play.route(\"/play/&lt;path:file_path&gt;\")\ndef stream_audio(file_path: str) -&gt; Response:\n    \"\"\"\n    Stream audio file with quality selection and range support\n    \"\"\"\n    # 1. Validate path\n    full_path = _resolve_and_validate_path(file_path)\n\n    # 2. Detect MIME type\n    mime_type = _guess_mime_type(full_path)\n\n    # 3. Get quality parameter\n    quality = request.args.get(\"quality\", \"original\")\n\n    # 4. Select file to serve (original or cached)\n    serve_path = _get_serving_path(\n        full_path,\n        quality,\n        current_app.audio_cache,\n        logger\n    )\n\n    # 5. Log streaming info\n    logger.info(\n        f\"Streaming: {file_path} | \"\n        f\"Quality: {quality} | \"\n        f\"Serving: {serve_path.name}\"\n    )\n\n    # 6. Handle range requests (for seeking)\n    if request.headers.get(\"Range\"):\n        return _handle_range_request(\n            serve_path,\n            mime_type,\n            request.headers.get(\"Range\"),\n            serve_path.stat().st_size\n        )\n\n    # 7. Serve full file\n    response = send_file(\n        serve_path,\n        mimetype=mime_type,\n        as_attachment=False,\n        conditional=True\n    )\n\n    # 8. Add required headers\n    response.headers[\"Accept-Ranges\"] = \"bytes\"\n    response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\n    response.headers[\"Access-Control-Expose-Headers\"] = \\\n        \"Content-Type, Accept-Encoding, Range\"\n    response.headers[\"Cache-Control\"] = \"public, max-age=3600\"\n\n    return response\n</code></pre> <p>Quality parameter:</p> <ul> <li><code>original</code> - Serve original file (default)</li> <li><code>high</code> - Serve 256kbps MP3 (if cached)</li> <li><code>medium</code> - Serve 192kbps MP3 (if cached)</li> <li><code>low</code> - Serve 128kbps MP3 (if cached)</li> </ul> <p>See Quality &amp; Caching for details.</p>"},{"location":"development/audio-playback/backend/audio-streaming.html#-response-headers","title":"\ud83d\udccb Response Headers","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#required-headers","title":"Required Headers","text":"Header Value Purpose <code>Content-Type</code> <code>audio/mpeg</code>, <code>audio/flac</code>, etc. Tells browser how to play file <code>Accept-Ranges</code> <code>bytes</code> Advertises range request support <code>Access-Control-Allow-Origin</code> <code>*</code> Enables Chromecast (CORS) <code>Access-Control-Expose-Headers</code> <code>Content-Type, Accept-Encoding, Range</code> Allows Chromecast to read range info <code>Cache-Control</code> <code>public, max-age=3600</code> Caches response for 1 hour"},{"location":"development/audio-playback/backend/audio-streaming.html#why-cors-headers","title":"Why CORS Headers?","text":"<p>Problem: Chromecast devices make cross-origin requests to your server</p> <p>Solution: Allow all origins with wildcard CORS headers</p> <pre><code>response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\nresponse.headers[\"Access-Control-Expose-Headers\"] = \\\n    \"Content-Type, Accept-Encoding, Range\"\n</code></pre> <p>Security consideration:</p> <p>This is safe because:</p> <ul> <li>Audio files are intentionally public (shared mixtapes)</li> <li>No authentication credentials in responses</li> <li>Read-only operation (no state changes)</li> </ul> <p>See Chromecast Integration for details.</p>"},{"location":"development/audio-playback/backend/audio-streaming.html#why-accept-ranges","title":"Why Accept-Ranges?","text":"<p>Purpose: Tells clients seeking is supported</p> <p>Value: <code>bytes</code> indicates byte-range requests are accepted</p> <p>Used by:</p> <ul> <li>HTML5 <code>&lt;audio&gt;</code> element for seek bar</li> <li>Chromecast for seeking</li> <li>Video players for timeline scrubbing</li> </ul>"},{"location":"development/audio-playback/backend/audio-streaming.html#-public-mixtape-page","title":"\ud83c\udfad Public Mixtape Page","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#public_play","title":"public_play()","text":"<p>Purpose: Render public player page for shared mixtapes</p> <p>Route:</p> <pre><code>@play.route(\"/share/&lt;slug&gt;\")\ndef public_play(slug: str) -&gt; Response\n</code></pre> <p>Implementation:</p> <pre><code>@play.route(\"/share/&lt;slug&gt;\")\ndef public_play(slug: str) -&gt; Response:\n    \"\"\"\n    Render public player page for a shared mixtape\n\n    Returns 404 if mixtape doesn't exist\n    \"\"\"\n    mixtape_manager = current_app.mixtape_manager\n\n    # Load mixtape metadata\n    mixtape = mixtape_manager.get(slug)\n\n    if not mixtape:\n        logger.warning(f\"Mixtape not found: {slug}\")\n        abort(404)\n\n    # Render player template\n    return render_template(\n        'play_mixtape.html',\n        mixtape=mixtape,\n        slug=slug\n    )\n</code></pre> <p>Template data:</p> <pre><code>{\n    'mixtape': {\n        'title': 'My Mixtape',\n        'description': 'A collection of...',\n        'tracks': [\n            {\n                'title': 'Song Title',\n                'artist': 'Artist Name',\n                'album': 'Album Name',\n                'file_path': 'artist/album/song.mp3',\n                'duration': 245\n            },\n            # ... more tracks\n        ],\n        'cover': 'slug.jpg',\n        'liner_notes': 'Markdown formatted notes'\n    },\n    'slug': 'mixtape-slug'\n}\n</code></pre> <p>Frontend integration:</p> <p>The template includes JavaScript that:</p> <ul> <li>Initializes player controls</li> <li>Sets up Chromecast integration</li> <li>Configures Android Auto Media Session</li> <li>Handles adaptive theming from cover art</li> </ul> <p>See: Player Controls</p>"},{"location":"development/audio-playback/backend/audio-streaming.html#-error-handling","title":"\u26a0\ufe0f Error Handling","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#http-status-codes","title":"HTTP Status Codes","text":"Code Situation Response 200 Successful full file stream Complete audio file 206 Successful partial stream Byte range of file 403 Path outside MUSIC_ROOT <code>abort(403)</code> 404 File not found <code>abort(404)</code> 404 Mixtape slug not found <code>abort(404)</code> 416 Invalid range request Range Not Satisfiable 500 Unexpected error Internal Server Error"},{"location":"development/audio-playback/backend/audio-streaming.html#error-flow","title":"Error Flow","text":"<pre><code>flowchart TD\n    Request[Incoming Request]\n\n    PathCheck{Path valid?}\n    ExistsCheck{File exists?}\n    RangeCheck{Range valid?}\n\n    Error403[403 Forbidden]\n    Error404[404 Not Found]\n    Error416[416 Range Error]\n    Error500[500 Server Error]\n\n    Success[Successful Response]\n\n    Request --&gt; PathCheck\n    PathCheck --&gt;|Outside MUSIC_ROOT| Error403\n    PathCheck --&gt;|Inside| ExistsCheck\n    ExistsCheck --&gt;|No| Error404\n    ExistsCheck --&gt;|Yes| RangeCheck\n    RangeCheck --&gt;|Invalid| Error416\n    RangeCheck --&gt;|Valid or None| Success\n\n    style Error403 fill:#c65d5d,color:#fff\n    style Error404 fill:#c65d5d,color:#fff\n    style Error416 fill:#c65d5d,color:#fff\n    style Error500 fill:#c65d5d,color:#fff\n    style Success fill:#4a8c5f,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/backend/audio-streaming.html#error-examples","title":"Error Examples","text":"<p>403 Forbidden:</p> <pre><code># Request\nGET /play/../../etc/passwd\n\n# Response\nHTTP/1.1 403 Forbidden\n\n# Log\nWARNING: Path traversal attempt: ../../etc/passwd\n</code></pre> <p>404 Not Found:</p> <pre><code># Request\nGET /play/artist/album/nonexistent.mp3\n\n# Response\nHTTP/1.1 404 Not Found\n\n# Log\nWARNING: File not found: /music/artist/album/nonexistent.mp3\n</code></pre> <p>416 Range Not Satisfiable:</p> <pre><code># Request\nGET /play/artist/album/song.mp3\nRange: bytes=9999999-\n\n# Response (if file is 1000 bytes)\nHTTP/1.1 416 Range Not Satisfiable\nContent-Range: bytes */1000\n\n# Log\nWARNING: Invalid range request: bytes=9999999-\n</code></pre>"},{"location":"development/audio-playback/backend/audio-streaming.html#-logging","title":"\ud83d\udcca Logging","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#log-levels","title":"Log Levels","text":"<p>INFO: Normal operations</p> <pre><code>INFO: Streaming: artist/album/song.mp3 | Quality: medium | Serving: song.mp3\nINFO: Cache hit: artist/album/song.flac \u2192 medium quality\n</code></pre> <p>WARNING: Recoverable issues</p> <pre><code>WARNING: Path traversal attempt: ../../etc/passwd\nWARNING: File not found: artist/album/missing.mp3\nWARNING: Cache miss: artist/album/song.flac (medium) - serving original\n</code></pre> <p>ERROR: Unexpected failures</p> <pre><code>ERROR: Failed to read file: artist/album/song.mp3\nERROR: Exception in stream_audio: [exception details]\n</code></pre>"},{"location":"development/audio-playback/backend/audio-streaming.html#log-format","title":"Log Format","text":"<p>All logs include:</p> <ul> <li>Timestamp: ISO 8601 format</li> <li>Level: INFO, WARNING, ERROR</li> <li>Context: Function name, file path, action</li> <li>Details: Quality parameter, cache status, error messages</li> </ul> <p>Example:</p> <pre><code>2025-01-16 18:30:15 INFO [routes.play.stream_audio] Streaming: jazz/miles-davis/so-what.flac | Quality: medium | Serving: so-what.mp3\n2025-01-16 18:30:15 INFO [audio_cache] Cache hit: jazz/miles-davis/so-what.flac \u2192 medium quality\n</code></pre>"},{"location":"development/audio-playback/backend/audio-streaming.html#-helper-functions-reference","title":"\ud83d\udd27 Helper Functions Reference","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#function-summary","title":"Function Summary","text":"Function Parameters Returns Purpose <code>_resolve_and_validate_path</code> <code>file_path: str</code> <code>Path</code> Validate and resolve file path <code>_guess_mime_type</code> <code>full_path: Path</code> <code>str</code> Detect MIME type from extension <code>_get_serving_path</code> <code>original_path: Path</code><code>quality: str</code><code>cache: AudioCache</code><code>logger: Logger</code> <code>Path</code> Select original or cached file <code>stream_audio</code> <code>file_path: str</code> <code>Response</code> Main streaming route handler <code>public_play</code> <code>slug: str</code> <code>Response</code> Render public player page <p>For <code>_get_serving_path</code> details, see Quality &amp; Caching.</p>"},{"location":"development/audio-playback/backend/audio-streaming.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/audio-playback/backend/audio-streaming.html#manual-testing","title":"Manual Testing","text":"<p>Test basic streaming:</p> <pre><code>curl -I http://localhost:5000/play/artist/album/track.mp3\n</code></pre> <p>Expected response:</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: audio/mpeg\nAccept-Ranges: bytes\nAccess-Control-Allow-Origin: *\nCache-Control: public, max-age=3600\n</code></pre> <p>Test with quality parameter:</p> <pre><code>curl -I http://localhost:5000/play/artist/album/track.flac?quality=medium\n</code></pre> <p>Test public player:</p> <pre><code>curl http://localhost:5000/share/my-mixtape\n# Should return HTML\n</code></pre> <p>Test error handling:</p> <pre><code># Path traversal (should get 403)\ncurl -I http://localhost:5000/play/../../etc/passwd\n\n# Nonexistent file (should get 404)\ncurl -I http://localhost:5000/play/artist/album/missing.mp3\n</code></pre>"},{"location":"development/audio-playback/backend/audio-streaming.html#integration-testing","title":"Integration Testing","text":"<p>See Range Requests for testing seeking functionality.</p>"},{"location":"development/audio-playback/backend/audio-streaming.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Range Requests - HTTP range support for seeking</li> <li>Quality &amp; Caching - Quality selection and cache logic</li> <li>Media Integration - How playback modes use these routes</li> <li>Chromecast Integration - CORS requirements</li> <li>Audio Caching - Cache implementation details</li> </ul> <p>Implementation: <code>src/routes/play.py</code></p>"},{"location":"development/audio-playback/backend/quality-caching.html","title":"Quality & Caching","text":""},{"location":"development/audio-playback/backend/quality-caching.html#quality--caching","title":"Quality &amp; Caching","text":"<p>The quality and caching system allows clients to request different audio quality levels while the server manages transcoded file caching for optimal performance.</p>"},{"location":"development/audio-playback/backend/quality-caching.html#-purpose","title":"\ud83c\udfaf Purpose","text":"<p>Quality selection enables:</p> <ul> <li>Bandwidth optimization for mobile/cellular connections</li> <li>User preference for quality vs. data usage</li> <li>Faster streaming on slower connections</li> <li>Battery savings on mobile devices</li> </ul> <p>Caching system provides:</p> <ul> <li>Pre-transcoded files for instant delivery</li> <li>Reduced server CPU load (no real-time transcoding)</li> <li>Faster response times</li> <li>Lower latency for quality switching</li> </ul>"},{"location":"development/audio-playback/backend/quality-caching.html#-quality-levels","title":"\ud83d\udcca Quality Levels","text":""},{"location":"development/audio-playback/backend/quality-caching.html#available-qualities","title":"Available Qualities","text":"Quality Bitrate Format Use Case <code>original</code> Varies Original format (FLAC, MP3, etc.) WiFi, audiophiles, local playback <code>high</code> 256 kbps MP3 High-quality wireless, good connections <code>medium</code> 192 kbps MP3 Default, balanced quality/bandwidth <code>low</code> 128 kbps MP3 Cellular, bandwidth-constrained"},{"location":"development/audio-playback/backend/quality-caching.html#quality-parameter","title":"Quality Parameter","text":"<p>URL format:</p> <pre><code>GET /play/&lt;file_path&gt;?quality=&lt;level&gt;\n</code></pre> <p>Examples:</p> <pre><code>/play/jazz/miles-davis/so-what.flac                    # original (no param)\n/play/jazz/miles-davis/so-what.flac?quality=original   # original (explicit)\n/play/jazz/miles-davis/so-what.flac?quality=high       # 256k MP3\n/play/jazz/miles-davis/so-what.flac?quality=medium     # 192k MP3\n/play/jazz/miles-davis/so-what.flac?quality=low        # 128k MP3\n</code></pre> <p>Default: <code>original</code> (when parameter omitted)</p>"},{"location":"development/audio-playback/backend/quality-caching.html#frontend-integration","title":"Frontend Integration","text":"<p>JavaScript:</p> <pre><code>const QUALITY_LEVELS = {\n    high: { label: 'High (256k)', bandwidth: 'high' },\n    medium: { label: 'Medium (192k)', bandwidth: 'medium' },\n    low: { label: 'Low (128k)', bandwidth: 'low' },\n    original: { label: 'Original', bandwidth: 'highest' }\n};\n\n// Get from localStorage\nlet currentQuality = localStorage.getItem('audioQuality') || 'medium';\n\n// Build URL\nconst url = `/play/${track.path}?quality=${currentQuality}`;\n</code></pre> <p>See: Player Controls</p>"},{"location":"development/audio-playback/backend/quality-caching.html#-implementation","title":"\ud83d\udd27 Implementation","text":""},{"location":"development/audio-playback/backend/quality-caching.html#_get_serving_path","title":"_get_serving_path()","text":"<p>Purpose: Select which file to serve (original or cached)</p> <p>Signature:</p> <pre><code>def _get_serving_path(\n    original_path: Path,\n    quality: str,\n    cache: AudioCache,\n    logger: Logger\n) -&gt; Path\n</code></pre> <p>Flow diagram:</p> <pre><code>flowchart TD\n    Start[_get_serving_path called]\n    CheckQuality{quality == 'original'?}\n    NeedTranscode{File needs transcoding?}\n    CheckCache{Cached version exists?}\n    ReturnOriginal[Return original path]\n    ReturnCached[Return cached path]\n    LogHit[Log cache hit]\n    LogMiss[Log cache miss]\n\n    Start --&gt; CheckQuality\n    CheckQuality --&gt;|Yes| ReturnOriginal\n    CheckQuality --&gt;|No| NeedTranscode\n    NeedTranscode --&gt;|No| ReturnOriginal\n    NeedTranscode --&gt;|Yes| CheckCache\n    CheckCache --&gt;|Yes| LogHit\n    CheckCache --&gt;|No| LogMiss\n    LogHit --&gt; ReturnCached\n    LogMiss --&gt; ReturnOriginal\n\n    style ReturnCached fill:#4a8c5f,color:#fff\n    style LogHit fill:#4a8c5f,color:#fff\n    style LogMiss fill:#c65d5d,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>Implementation:</p> <pre><code>def _get_serving_path(\n    original_path: Path,\n    quality: str,\n    cache: AudioCache,\n    logger: Logger\n) -&gt; Path:\n    \"\"\"\n    Select file to serve: original or cached transcoded version\n\n    Logic:\n    1. If quality='original' \u2192 return original\n    2. If file doesn't need transcoding (already MP3) \u2192 return original\n    3. If cached version exists \u2192 return cached path\n    4. Otherwise \u2192 return original (cache miss)\n    \"\"\"\n    # Original quality requested\n    if quality == \"original\":\n        logger.debug(f\"Serving original: {original_path.name}\")\n        return original_path\n\n    # Check if file needs transcoding\n    if not cache.should_transcode(original_path):\n        logger.debug(\n            f\"File already compatible: {original_path.name} \"\n            f\"(no transcode needed)\"\n        )\n        return original_path\n\n    # Check if cached version exists\n    if cache.is_cached(original_path, quality):\n        cached_path = cache.get_cache_path(original_path, quality)\n        logger.info(\n            f\"Cache hit: {original_path.name} \u2192 {quality} quality\"\n        )\n        return cached_path\n\n    # Cache miss - serve original\n    logger.warning(\n        f\"Cache miss: {original_path.name} ({quality}) - \"\n        f\"serving original\"\n    )\n    return original_path\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#transcoding-decision","title":"Transcoding Decision","text":"<p>Files that need transcoding:</p> <ul> <li>FLAC \u2192 MP3</li> <li>WAV \u2192 MP3</li> <li>OGG \u2192 MP3</li> <li>M4A \u2192 MP3</li> </ul> <p>Files that don't need transcoding:</p> <ul> <li>MP3 \u2192 MP3 (already compressed)</li> <li>AAC \u2192 AAC (already compressed, different use case)</li> </ul> <p>Implementation:</p> <pre><code># In AudioCache class\ndef should_transcode(self, file_path: Path) -&gt; bool:\n    \"\"\"Check if file should be transcoded\"\"\"\n    extension = file_path.suffix.lower()\n    return extension in {'.flac', '.wav', '.ogg', '.m4a'}\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#-cache-structure","title":"\ud83d\udcbe Cache Structure","text":""},{"location":"development/audio-playback/backend/quality-caching.html#directory-layout","title":"Directory Layout","text":"<pre><code>cache/audio/\n\u2514\u2500\u2500 &lt;relative_path&gt;/\n    \u251c\u2500\u2500 &lt;filename&gt;_high.mp3      # 256k version\n    \u251c\u2500\u2500 &lt;filename&gt;_medium.mp3    # 192k version\n    \u2514\u2500\u2500 &lt;filename&gt;_low.mp3       # 128k version\n</code></pre> <p>Example:</p> <pre><code>Original: /music/jazz/miles-davis/so-what.flac\n\nCache:\ncache/audio/jazz/miles-davis/\n\u251c\u2500\u2500 so-what_high.mp3      # 256kbps MP3\n\u251c\u2500\u2500 so-what_medium.mp3    # 192kbps MP3\n\u2514\u2500\u2500 so-what_low.mp3       # 128kbps MP3\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#cache-path-generation","title":"Cache Path Generation","text":"<p>Method:</p> <pre><code>cache_path = cache.get_cache_path(original_path, quality)\n</code></pre> <p>Implementation:</p> <pre><code>def get_cache_path(self, original_path: Path, quality: str) -&gt; Path:\n    \"\"\"\n    Generate cache file path for transcoded version\n\n    Example:\n        /music/jazz/album/song.flac + 'medium'\n        \u2192 /cache/audio/jazz/album/song_medium.mp3\n    \"\"\"\n    # Get relative path from MUSIC_ROOT\n    relative = original_path.relative_to(MUSIC_ROOT)\n\n    # Build cache path\n    cache_dir = CACHE_DIR / relative.parent\n    cache_file = f\"{relative.stem}_{quality}.mp3\"\n\n    return cache_dir / cache_file\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#-cache-population","title":"\ud83d\udd04 Cache Population","text":""},{"location":"development/audio-playback/backend/quality-caching.html#pre-caching-strategy","title":"Pre-caching Strategy","text":"<p>Background job: Periodically transcode popular/recent tracks</p> <pre><code># Example background job\ndef precache_mixtapes():\n    \"\"\"Pre-populate cache for all mixtapes\"\"\"\n    mixtapes = mixtape_manager.get_all()\n\n    for mixtape in mixtapes:\n        for track in mixtape['tracks']:\n            for quality in ['high', 'medium', 'low']:\n                original = Path(MUSIC_ROOT) / track['file_path']\n\n                # Check if needs caching\n                if cache.should_transcode(original):\n                    if not cache.is_cached(original, quality):\n                        # Transcode in background\n                        cache.transcode(original, quality)\n</code></pre> <p>Triggers:</p> <ul> <li>New mixtape created</li> <li>Track added to mixtape</li> <li>Scheduled background task (nightly)</li> </ul> <p>See: Audio Caching for transcoding implementation</p>"},{"location":"development/audio-playback/backend/quality-caching.html#on-demand-transcoding","title":"On-Demand Transcoding","text":"<p>Current status: Commented out (prepared for future use)</p> <pre><code># Future: On-demand transcoding\n# if not cache.is_cached(original_path, quality):\n#     cache.transcode(original_path, quality)\n#     cached_path = cache.get_cache_path(original_path, quality)\n</code></pre> <p>Why disabled:</p> <ul> <li>Real-time transcoding adds latency</li> <li>CPU-intensive operation</li> <li>Better to pre-cache popular tracks</li> </ul> <p>When to enable:</p> <ul> <li>Low storage constraints</li> <li>Powerful server hardware</li> <li>Infrequent cache misses acceptable</li> </ul>"},{"location":"development/audio-playback/backend/quality-caching.html#-cache-management","title":"\ud83d\udcc8 Cache Management","text":""},{"location":"development/audio-playback/backend/quality-caching.html#admin-endpoints","title":"Admin Endpoints","text":""},{"location":"development/audio-playback/backend/quality-caching.html#get-admincachestats","title":"GET /admin/cache/stats","text":"<p>Purpose: Get cache statistics</p> <p>Response:</p> <pre><code>{\n    \"cache_size_bytes\": 1234567890,\n    \"cache_size_mb\": 1177.38,\n    \"cached_files\": 1523,\n    \"cache_dir\": \"/app/cache/audio\"\n}\n</code></pre> <p>Implementation:</p> <pre><code>@play.route(\"/admin/cache/stats\")\ndef cache_stats():\n    \"\"\"Return cache statistics\"\"\"\n    cache = current_app.audio_cache\n\n    size_bytes = cache.get_cache_size()\n    size_mb = round(size_bytes / (1024 * 1024), 2)\n    file_count = cache.count_cached_files()\n\n    return jsonify({\n        \"cache_size_bytes\": size_bytes,\n        \"cache_size_mb\": size_mb,\n        \"cached_files\": file_count,\n        \"cache_dir\": str(cache.cache_dir)\n    })\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#post-admincacheclear","title":"POST /admin/cache/clear","text":"<p>Purpose: Clear cached files</p> <p>Query parameters:</p> <ul> <li><code>older_than_days</code> (optional) - Only delete files older than N days</li> </ul> <p>Request:</p> <pre><code>POST /admin/cache/clear\n</code></pre> <p>Request with filter:</p> <pre><code>POST /admin/cache/clear?older_than_days=30\n</code></pre> <p>Response:</p> <pre><code>{\n    \"deleted_files\": 234,\n    \"message\": \"Cleared 234 cached files older than 30 days\"\n}\n</code></pre> <p>Implementation:</p> <pre><code>@play.route(\"/admin/cache/clear\", methods=[\"POST\"])\ndef clear_cache():\n    \"\"\"Clear audio cache\"\"\"\n    cache = current_app.audio_cache\n    older_than_days = request.args.get(\"older_than_days\", type=int)\n\n    deleted_count = cache.clear_cache(older_than_days=older_than_days)\n\n    if older_than_days:\n        message = f\"Cleared {deleted_count} cached files older than {older_than_days} days\"\n    else:\n        message = f\"Cleared all {deleted_count} cached files\"\n\n    logger.info(message)\n\n    return jsonify({\n        \"deleted_files\": deleted_count,\n        \"message\": message\n    })\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#-performance-optimization","title":"\ud83d\udcca Performance Optimization","text":""},{"location":"development/audio-playback/backend/quality-caching.html#cache-hit-rate","title":"Cache Hit Rate","text":"<p>Metric: Percentage of requests served from cache</p> <pre><code>Cache Hit Rate = (Cache Hits / Total Requests) \u00d7 100%\n</code></pre> <p>Monitoring:</p> <pre><code># Log cache performance\nlogger.info(f\"Cache hit: {file_path} \u2192 {quality}\")    # Hit\nlogger.warning(f\"Cache miss: {file_path} ({quality})\")  # Miss\n</code></pre> <p>Analyze logs:</p> <pre><code># Count cache hits vs misses\ngrep \"Cache hit\" logs/app.log | wc -l    # Hits\ngrep \"Cache miss\" logs/app.log | wc -l   # Misses\n</code></pre> <p>Target hit rate: 80%+ for optimal performance</p>"},{"location":"development/audio-playback/backend/quality-caching.html#cache-warming","title":"Cache Warming","text":"<p>Strategy: Pre-cache frequently accessed tracks</p> <pre><code>def warm_cache():\n    \"\"\"Pre-cache popular tracks\"\"\"\n    # Get recently played tracks\n    popular_tracks = get_popular_tracks(limit=100)\n\n    for track in popular_tracks:\n        for quality in ['medium', 'high']:\n            if cache.should_transcode(track.path):\n                if not cache.is_cached(track.path, quality):\n                    cache.transcode(track.path, quality)\n</code></pre> <p>When to run:</p> <ul> <li>Server startup</li> <li>Low-traffic periods (2-4 AM)</li> <li>After adding new mixtapes</li> </ul>"},{"location":"development/audio-playback/backend/quality-caching.html#storage-management","title":"Storage Management","text":"<p>Monitor disk usage:</p> <pre><code># Check cache directory size\ndu -sh /app/cache/audio\n</code></pre> <p>Set cache size limits:</p> <pre><code># Example: Limit cache to 10GB\nMAX_CACHE_SIZE = 10 * 1024 * 1024 * 1024  # 10GB\n\nif cache.get_cache_size() &gt; MAX_CACHE_SIZE:\n    # Clear oldest files\n    cache.clear_cache(older_than_days=90)\n</code></pre> <p>Cleanup strategies:</p> <ul> <li>Delete files older than X days</li> <li>Delete least recently accessed files</li> <li>Delete least popular quality levels</li> <li>Keep only medium quality for space savings</li> </ul>"},{"location":"development/audio-playback/backend/quality-caching.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/audio-playback/backend/quality-caching.html#manual-testing","title":"Manual Testing","text":"<p>Test original quality:</p> <pre><code>curl -I http://localhost:5000/play/artist/album/song.flac\n# Should serve original FLAC\n</code></pre> <p>Test medium quality:</p> <pre><code>curl -I http://localhost:5000/play/artist/album/song.flac?quality=medium\n# Should serve cached MP3 (if cached) or original\n</code></pre> <p>Test cache stats:</p> <pre><code>curl http://localhost:5000/admin/cache/stats\n# Should return JSON with cache info\n</code></pre> <p>Test cache clear:</p> <pre><code>curl -X POST http://localhost:5000/admin/cache/clear\n# Should return deleted file count\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#check-cache-directory","title":"Check Cache Directory","text":"<p>View cached files:</p> <pre><code>ls -lh /app/cache/audio/artist/album/\n</code></pre> <p>Expected:</p> <pre><code>song_high.mp3     (256k)\nsong_medium.mp3   (192k)\nsong_low.mp3      (128k)\n</code></pre> <p>Check file sizes:</p> <pre><code># Original FLAC: ~40MB\n# High MP3: ~10MB\n# Medium MP3: ~7MB\n# Low MP3: ~5MB\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#-configuration","title":"\ud83d\udd17 Configuration","text":""},{"location":"development/audio-playback/backend/quality-caching.html#environment-variables","title":"Environment Variables","text":"<pre><code># Audio cache directory\nAUDIO_CACHE_DIR=/app/cache/audio\n\n# Enable/disable caching\nAUDIO_CACHE_ENABLED=true\n\n# Pre-cache on mixtape upload\nAUDIO_CACHE_PRECACHE_ON_UPLOAD=true\n</code></pre>"},{"location":"development/audio-playback/backend/quality-caching.html#docker-volume-mapping","title":"Docker Volume Mapping","text":"<pre><code># docker-compose.yml\nservices:\n  mixtape:\n    volumes:\n      - mixtape_data:/app/collection-data\n        # Cache is inside collection-data:\n        # /app/collection-data/cache/audio/\n</code></pre> <p>Persistence: Cache survives container restarts</p> <p>See: Docker Deployment</p>"},{"location":"development/audio-playback/backend/quality-caching.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Audio Streaming - Uses _get_serving_path()</li> <li>Audio Caching - Transcoding implementation</li> <li>Player Controls - Quality selector UI</li> <li>Configuration - Cache directory settings</li> </ul>"},{"location":"development/audio-playback/backend/quality-caching.html#-best-practices","title":"\ud83d\udca1 Best Practices","text":""},{"location":"development/audio-playback/backend/quality-caching.html#for-users","title":"For Users","text":"<p>WiFi:</p> <ul> <li>Use <code>high</code> or <code>original</code> quality</li> <li>Better audio quality</li> <li>No bandwidth concerns</li> </ul> <p>Cellular:</p> <ul> <li>Use <code>medium</code> or <code>low</code> quality</li> <li>Save data usage</li> <li>Faster streaming</li> </ul> <p>Storage-constrained:</p> <ul> <li>Use <code>low</code> quality</li> <li>Smallest cache size</li> <li>Adequate quality for most cases</li> </ul>"},{"location":"development/audio-playback/backend/quality-caching.html#for-administrators","title":"For Administrators","text":"<p>Cache management:</p> <ul> <li>Monitor cache size regularly</li> <li>Clear old files periodically</li> <li>Pre-cache popular mixtapes</li> <li>Balance quality vs storage</li> </ul> <p>Performance:</p> <ul> <li>Warm cache on startup</li> <li>Schedule cleanup during low-traffic hours</li> <li>Monitor hit/miss ratio</li> <li>Adjust cache strategy based on usage</li> </ul> <p>Implementation: <code>src/routes/play.py::_get_serving_path()</code> and <code>src/audio_cache/</code></p>"},{"location":"development/audio-playback/backend/range-requests.html","title":"Range Requests","text":""},{"location":"development/audio-playback/backend/range-requests.html#http-range-requests","title":"HTTP Range Requests","text":"<p>HTTP range requests enable seeking in audio files by allowing clients to request specific byte ranges instead of entire files. This is essential for Chromecast seeking and HTML5 audio scrubbing.</p>"},{"location":"development/audio-playback/backend/range-requests.html#-purpose","title":"\ud83c\udfaf Purpose","text":"<p>Range requests allow:</p> <ul> <li>Seeking in audio player - Jump to any position in track</li> <li>Chromecast timeline scrubbing - Seek from TV interface</li> <li>Bandwidth optimization - Download only needed portions</li> <li>Resume downloads - Continue from breakpoint</li> </ul> <p>Without range support: Clients must download entire file before seeking With range support: Jump instantly to any position</p>"},{"location":"development/audio-playback/backend/range-requests.html#-http-range-specification","title":"\ud83d\udccb HTTP Range Specification","text":""},{"location":"development/audio-playback/backend/range-requests.html#range-header-format","title":"Range Header Format","text":"<p>Request:</p> <pre><code>GET /play/artist/album/song.mp3 HTTP/1.1\nRange: bytes=1000-2000\n</code></pre> <p>Formats:</p> Format Meaning Example <code>bytes=start-end</code> Specific range <code>bytes=1000-2000</code> (bytes 1000-2000) <code>bytes=start-</code> From start to EOF <code>bytes=1000-</code> (byte 1000 to end) <code>bytes=-end</code> Last N bytes <code>bytes=-1000</code> (last 1000 bytes) <code>bytes=0-</code> Entire file <code>bytes=0-</code> (same as no Range header) <p>Multiple ranges (not currently supported):</p> <pre><code>Range: bytes=0-1000, 2000-3000\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#response-format","title":"Response Format","text":"<p>206 Partial Content:</p> <pre><code>HTTP/1.1 206 Partial Content\nContent-Type: audio/mpeg\nContent-Range: bytes 1000-2000/5000000\nContent-Length: 1001\nAccept-Ranges: bytes\nAccess-Control-Allow-Origin: *\nAccess-Control-Expose-Headers: Content-Range, Content-Length, Range\nCache-Control: public, max-age=3600\n\n[binary audio data: 1001 bytes]\n</code></pre> <p>Header breakdown:</p> Header Value Meaning Status <code>206</code> Partial Content (not 200) <code>Content-Range</code> <code>bytes 1000-2000/5000000</code> Bytes 1000-2000 of 5,000,000 total <code>Content-Length</code> <code>1001</code> Size of this chunk (end - start + 1) <code>Accept-Ranges</code> <code>bytes</code> Server supports byte ranges"},{"location":"development/audio-playback/backend/range-requests.html#-implementation","title":"\ud83d\udd27 Implementation","text":""},{"location":"development/audio-playback/backend/range-requests.html#_handle_range_request","title":"_handle_range_request()","text":"<p>Purpose: Parse range header and serve partial content</p> <p>Signature:</p> <pre><code>def _handle_range_request(\n    full_path: Path,\n    mime_type: str,\n    range_header: str,\n    file_size: int\n) -&gt; Response\n</code></pre> <p>Implementation:</p> <pre><code>def _handle_range_request(\n    full_path: Path,\n    mime_type: str,\n    range_header: str,\n    file_size: int\n) -&gt; Response:\n    \"\"\"\n    Handle HTTP range request for audio seeking\n\n    Returns 206 Partial Content or 416 Range Not Satisfiable\n    \"\"\"\n    # Parse Range header: \"bytes=start-end\"\n    import re\n    match = re.match(r\"bytes=(\\d+)-(\\d*)\", range_header)\n\n    if not match:\n        logger.warning(f\"Malformed range header: {range_header}\")\n        abort(416)  # Range Not Satisfiable\n\n    # Extract start and end\n    start = int(match.group(1))\n    end_str = match.group(2)\n    end = int(end_str) if end_str else file_size - 1\n\n    # Validate range\n    if start &gt;= file_size or end &gt;= file_size or start &gt; end:\n        logger.warning(\n            f\"Invalid range: bytes={start}-{end} \"\n            f\"for file size {file_size}\"\n        )\n        response = Response(status=416)\n        response.headers[\"Content-Range\"] = f\"bytes */{file_size}\"\n        return response\n\n    # Calculate chunk size\n    length = end - start + 1\n\n    # Stream chunk generator\n    def generate():\n        with open(full_path, \"rb\") as f:\n            f.seek(start)\n            remaining = length\n            while remaining &gt; 0:\n                chunk_size = min(8192, remaining)  # 8KB chunks\n                chunk = f.read(chunk_size)\n                if not chunk:\n                    break\n                remaining -= len(chunk)\n                yield chunk\n\n    # Build 206 response\n    response = Response(\n        generate(),\n        206,  # Partial Content\n        mimetype=mime_type,\n        direct_passthrough=True\n    )\n\n    # Set range headers\n    response.headers[\"Content-Range\"] = f\"bytes {start}-{end}/{file_size}\"\n    response.headers[\"Content-Length\"] = str(length)\n    response.headers[\"Accept-Ranges\"] = \"bytes\"\n\n    # CORS headers (required for Chromecast)\n    response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\n    response.headers[\"Access-Control-Expose-Headers\"] = \\\n        \"Content-Range, Content-Length, Range\"\n\n    # Caching\n    response.headers[\"Cache-Control\"] = \"public, max-age=3600\"\n\n    logger.info(\n        f\"Range request: {full_path.name} | \"\n        f\"Bytes {start}-{end} ({length} bytes)\"\n    )\n\n    return response\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#range-parsing","title":"Range Parsing","text":"<p>Regular expression: <code>r\"bytes=(\\d+)-(\\d*)\"</code></p> <p>Capture groups:</p> <ul> <li>Group 1: Start byte (required)</li> <li>Group 2: End byte (optional)</li> </ul> <p>Examples:</p> <pre><code>\"bytes=1000-2000\"  \u2192 start=1000, end=2000\n\"bytes=1000-\"      \u2192 start=1000, end=file_size-1\n\"bytes=0-999\"      \u2192 start=0, end=999\n\"bytes=-1000\"      \u2192 Not supported (negative offset)\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#validation","title":"Validation","text":"<p>Checks performed:</p> <ol> <li>Range format valid: Matches regex pattern</li> <li>Start within bounds: <code>start &lt; file_size</code></li> <li>End within bounds: <code>end &lt; file_size</code></li> <li>Start before end: <code>start &lt;= end</code></li> </ol> <p>Invalid range examples:</p> <pre><code># File size: 1000 bytes\nbytes=1000-2000   \u2192 Invalid (start &gt;= file_size)\nbytes=500-10000   \u2192 Invalid (end &gt;= file_size)\nbytes=500-100     \u2192 Invalid (start &gt; end)\nbytes=abc-def     \u2192 Invalid (not numbers)\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#-request-flow","title":"\ud83d\udd04 Request Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant stream_audio\n    participant _handle_range_request\n    participant FileSystem\n\n    Client-&gt;&gt;stream_audio: GET /play/song.mp3&lt;br&gt;Range: bytes=1000-2000\n    stream_audio-&gt;&gt;stream_audio: Validate path\n    stream_audio-&gt;&gt;stream_audio: Get MIME type\n    stream_audio-&gt;&gt;stream_audio: Check Range header\n\n    alt Range header present\n        stream_audio-&gt;&gt;_handle_range_request: handle(path, mime, range, size)\n        _handle_range_request-&gt;&gt;_handle_range_request: Parse \"bytes=1000-2000\"\n        _handle_range_request-&gt;&gt;_handle_range_request: Validate range\n\n        alt Range valid\n            _handle_range_request-&gt;&gt;FileSystem: seek(1000)\n            _handle_range_request-&gt;&gt;FileSystem: read(1001 bytes)\n            FileSystem--&gt;&gt;_handle_range_request: chunk data\n            _handle_range_request--&gt;&gt;Client: 206 Partial Content&lt;br&gt;Content-Range: bytes 1000-2000/5000\n        else Range invalid\n            _handle_range_request--&gt;&gt;Client: 416 Range Not Satisfiable&lt;br&gt;Content-Range: bytes */5000\n        end\n    else No Range header\n        stream_audio--&gt;&gt;Client: 200 OK&lt;br&gt;Full file\n    end</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/backend/range-requests.html#-chromecast-requirements","title":"\ud83d\udce1 Chromecast Requirements","text":""},{"location":"development/audio-playback/backend/range-requests.html#why-chromecast-needs-range-support","title":"Why Chromecast Needs Range Support","text":"<p>Problem: Chromecast uses range requests for seeking</p> <p>Without range support: Seeking doesn't work on Chromecast</p> <p>With range support: Full timeline scrubbing works</p>"},{"location":"development/audio-playback/backend/range-requests.html#required-headers","title":"Required Headers","text":"<p>CORS headers are critical:</p> <pre><code>response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\nresponse.headers[\"Access-Control-Expose-Headers\"] = \\\n    \"Content-Range, Content-Length, Range\"\n</code></pre> <p>Why <code>Access-Control-Expose-Headers</code>?</p> <p>Browsers hide certain headers from JavaScript by default. Chromecast needs to read:</p> <ul> <li><code>Content-Range</code> - To know what bytes it received</li> <li><code>Content-Length</code> - To know chunk size</li> <li><code>Range</code> - To verify its request</li> </ul>"},{"location":"development/audio-playback/backend/range-requests.html#testing-with-chromecast","title":"Testing with Chromecast","text":"<p>Manual test:</p> <ol> <li>Start casting a mixtape</li> <li>Use car dashboard/TV remote to scrub timeline</li> <li>Should jump instantly to new position</li> <li>Check network tab for 206 responses</li> </ol> <p>Debug logging:</p> <pre><code>INFO: Range request: song.mp3 | Bytes 1000000-2000000 (1000001 bytes)\nINFO: Range request: song.mp3 | Bytes 3000000-4000000 (1000001 bytes)\n</code></pre> <p>Common issues:</p> Symptom Cause Fix Seeking doesn't work Missing CORS headers Add Access-Control-* headers Gets 416 errors Invalid range calculation Check end &lt;= file_size Seeking is slow Not using ranges Verify Range header is sent <p>See: Chromecast Integration</p>"},{"location":"development/audio-playback/backend/range-requests.html#-error-handling","title":"\u26a0\ufe0f Error Handling","text":""},{"location":"development/audio-playback/backend/range-requests.html#416-range-not-satisfiable","title":"416 Range Not Satisfiable","text":"<p>When: Client requests invalid byte range</p> <p>Response:</p> <pre><code>HTTP/1.1 416 Range Not Satisfiable\nContent-Range: bytes */5000000\n</code></pre> <p><code>Content-Range: bytes */5000000</code> means:</p> <ul> <li>No valid range to return</li> <li>File size is 5,000,000 bytes</li> <li>Client should adjust request</li> </ul> <p>Causes:</p> <ol> <li>Start beyond file size:</li> </ol> <pre><code>File: 1000 bytes\nRequest: bytes=2000-3000\n\u2192 416\n</code></pre> <ol> <li>End beyond file size:</li> </ol> <pre><code>File: 1000 bytes\nRequest: bytes=500-2000\n\u2192 416\n</code></pre> <ol> <li>Start after end:</li> </ol> <pre><code>Request: bytes=500-100\n\u2192 416\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#logging","title":"Logging","text":"<p>Valid range:</p> <pre><code>INFO: Range request: song.mp3 | Bytes 1000-2000 (1001 bytes)\n</code></pre> <p>Invalid range:</p> <pre><code>WARNING: Invalid range: bytes=1000-2000 for file size 500\n</code></pre> <p>Malformed header:</p> <pre><code>WARNING: Malformed range header: bytes=abc-def\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#-streaming-optimization","title":"\ud83c\udfa8 Streaming Optimization","text":""},{"location":"development/audio-playback/backend/range-requests.html#chunk-size","title":"Chunk Size","text":"<p>Current implementation: 8KB chunks</p> <pre><code>chunk_size = min(8192, remaining)\n</code></pre> <p>Why 8KB?</p> <ul> <li>Balances memory usage vs. efficiency</li> <li>Small enough to not block event loop</li> <li>Large enough to minimize overhead</li> <li>Standard for HTTP streaming</li> </ul> <p>Alternative sizes:</p> Size Use Case Trade-off 4KB Low memory environments More overhead 8KB Default (balanced) Good for most cases 64KB High-speed networks More memory usage"},{"location":"development/audio-playback/backend/range-requests.html#generator-pattern","title":"Generator Pattern","text":"<p>Why use generator:</p> <pre><code>def generate():\n    with open(full_path, \"rb\") as f:\n        f.seek(start)\n        remaining = length\n        while remaining &gt; 0:\n            chunk = f.read(min(8192, remaining))\n            if not chunk:\n                break\n            remaining -= len(chunk)\n            yield chunk\n</code></pre> <p>Benefits:</p> <ul> <li>Streams data incrementally</li> <li>Doesn't load entire range into memory</li> <li>Client can start playing immediately</li> <li>Can be interrupted (if client disconnects)</li> </ul> <p>Memory usage:</p> <ul> <li>Without generator: <code>length</code> bytes in memory</li> <li>With generator: <code>8KB</code> bytes in memory (max)</li> </ul> <p>For 10MB range:</p> <ul> <li>Without: 10MB in memory</li> <li>With: 8KB in memory</li> </ul>"},{"location":"development/audio-playback/backend/range-requests.html#-examples","title":"\ud83d\udcca Examples","text":""},{"location":"development/audio-playback/backend/range-requests.html#example-1-seek-to-middle-of-track","title":"Example 1: Seek to Middle of Track","text":"<p>Request:</p> <pre><code>GET /play/jazz/miles-davis/so-what.mp3 HTTP/1.1\nRange: bytes=2500000-\n</code></pre> <p>Response:</p> <pre><code>HTTP/1.1 206 Partial Content\nContent-Type: audio/mpeg\nContent-Range: bytes 2500000-5000000/5000001\nContent-Length: 2500001\nAccept-Ranges: bytes\nAccess-Control-Allow-Origin: *\n\n[2,500,001 bytes of audio data]\n</code></pre> <p>What happened:</p> <ul> <li>File is 5,000,001 bytes total</li> <li>Requested from byte 2,500,000 to end</li> <li>Served 2,500,001 bytes (half the file)</li> </ul>"},{"location":"development/audio-playback/backend/range-requests.html#example-2-small-range-preview","title":"Example 2: Small Range (Preview)","text":"<p>Request:</p> <pre><code>GET /play/rock/the-beatles/hey-jude.mp3 HTTP/1.1\nRange: bytes=0-1023\n</code></pre> <p>Response:</p> <pre><code>HTTP/1.1 206 Partial Content\nContent-Range: bytes 0-1023/7654321\nContent-Length: 1024\n\n[1,024 bytes of audio data]\n</code></pre> <p>What happened:</p> <ul> <li>Requested first 1KB of file</li> <li>Useful for preview/metadata extraction</li> <li>Minimal bandwidth usage</li> </ul>"},{"location":"development/audio-playback/backend/range-requests.html#example-3-invalid-range","title":"Example 3: Invalid Range","text":"<p>Request:</p> <pre><code>GET /play/classical/beethoven/symphony-9.mp3 HTTP/1.1\nRange: bytes=10000000-20000000\n</code></pre> <p>Response (if file is 5MB):</p> <pre><code>HTTP/1.1 416 Range Not Satisfiable\nContent-Range: bytes */5000000\n</code></pre> <p>What happened:</p> <ul> <li>Requested bytes 10,000,000-20,000,000</li> <li>File is only 5,000,000 bytes</li> <li>Server returns 416 with file size</li> </ul>"},{"location":"development/audio-playback/backend/range-requests.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/audio-playback/backend/range-requests.html#using-curl","title":"Using curl","text":"<p>Test basic range:</p> <pre><code>curl -I \\\n  -H \"Range: bytes=0-1023\" \\\n  http://localhost:5000/play/artist/album/song.mp3\n</code></pre> <p>Expected response:</p> <pre><code>HTTP/1.1 206 Partial Content\nContent-Type: audio/mpeg\nContent-Range: bytes 0-1023/5000000\nContent-Length: 1024\nAccept-Ranges: bytes\n</code></pre> <p>Test full range:</p> <pre><code>curl -I \\\n  -H \"Range: bytes=1000-\" \\\n  http://localhost:5000/play/artist/album/song.mp3\n</code></pre> <p>Test invalid range:</p> <pre><code>curl -I \\\n  -H \"Range: bytes=9999999-\" \\\n  http://localhost:5000/play/artist/album/song.mp3\n</code></pre> <p>Expected: <code>416 Range Not Satisfiable</code></p>"},{"location":"development/audio-playback/backend/range-requests.html#using-browser-devtools","title":"Using Browser DevTools","text":"<p>Steps:</p> <ol> <li>Open player page</li> <li>Open DevTools (F12) \u2192 Network tab</li> <li>Play a track</li> <li>Seek to different position</li> <li>Look for 206 responses</li> </ol> <p>What to check:</p> <ul> <li>Request has <code>Range</code> header</li> <li>Response is <code>206 Partial Content</code></li> <li><code>Content-Range</code> header is present</li> <li>CORS headers are present</li> </ul> <p>Screenshot of successful range request:</p> <pre><code>Request Headers:\n  Range: bytes=1048576-2097151\n\nResponse Headers:\n  HTTP/1.1 206 Partial Content\n  Content-Range: bytes 1048576-2097151/5242880\n  Content-Length: 1048576\n  Accept-Ranges: bytes\n  Access-Control-Allow-Origin: *\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#automated-testing","title":"Automated Testing","text":"<p>Python test example:</p> <pre><code>import requests\n\ndef test_range_request():\n    url = \"http://localhost:5000/play/test/song.mp3\"\n    headers = {\"Range\": \"bytes=0-1023\"}\n\n    response = requests.get(url, headers=headers)\n\n    assert response.status_code == 206\n    assert \"Content-Range\" in response.headers\n    assert response.headers[\"Accept-Ranges\"] == \"bytes\"\n    assert len(response.content) == 1024\n\ndef test_invalid_range():\n    url = \"http://localhost:5000/play/test/song.mp3\"\n    headers = {\"Range\": \"bytes=9999999-\"}\n\n    response = requests.get(url, headers=headers)\n\n    assert response.status_code == 416\n    assert \"Content-Range\" in response.headers\n    assert response.headers[\"Content-Range\"].startswith(\"bytes */\")\n</code></pre>"},{"location":"development/audio-playback/backend/range-requests.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Audio Streaming - Main streaming implementation</li> <li>Chromecast Integration - Cast requirements</li> <li>Player Controls - Frontend seeking</li> </ul>"},{"location":"development/audio-playback/backend/range-requests.html#-references","title":"\ud83d\udd17 References","text":"<ul> <li>RFC 7233: HTTP Range Requests</li> <li>MDN: HTTP Range Requests</li> <li>Chromecast Media Documentation</li> </ul> <p>Implementation: <code>src/routes/play.py::_handle_range_request()</code></p>"},{"location":"development/audio-playback/backend/server-cache-system.html","title":"Server Cache System","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#audio-caching-system","title":"Audio Caching System","text":"<p>The audio\u2011caching subsystem automatically converts large lossless audio files (FLAC, WAV, AIFF, \u2026) into smaller MP3 streams, dramatically reducing bandwidth while preserving a pleasant listening experience.</p> <p>TL;DR \u2013 The cache turns a 40\u202fMB FLAC track into a ~5\u202fMB MP3 (\u2248\u202f87\u202f% bandwidth saving) and serves the MP3 via HTTP range requests.</p>"},{"location":"development/audio-playback/backend/server-cache-system.html#-overview","title":"\ud83d\udcd6 Overview","text":"<p>When streaming lossless audio over the web, bandwidth quickly becomes a bottleneck:</p> Format Approx. size (4\u2011min track) Typical bitrate FLAC (original) 40\u201150\u202fMB ~1\u202f000\u202fkbps MP3 \u2013 High (256\u202fkbps) \u2248\u202f8\u202fMB 256\u202fkbps MP3 \u2013 Medium (192\u202fkbps) \u2248\u202f5\u202fMB 192\u202fkbps MP3 \u2013 Low (128\u202fkbps) \u2248\u202f3\u202fMB 128\u202fkbps <p>Result: A 4\u2011minute track drops from ~45\u202fMB to ~5\u202fMB (\u2248\u202f87\u202f% bandwidth reduction) with negligible audible loss for casual listening.</p> <p>The cache is transparent to the rest of the application:</p> <ul> <li>The UI requests a track \u2192 the Flask route asks <code>AudioCache</code> for a cached version.</li> <li>If a suitable MP3 exists, it is streamed via HTTP range requests.</li> <li>If not, the original file is streamed (or a background job creates the cache for the next request).</li> </ul>"},{"location":"development/audio-playback/backend/server-cache-system.html#-architecture-overview","title":"\ud83c\udfdb\ufe0f Architecture Overview","text":"<pre><code>graph TD\n    A[\"AudioCache (core)\"] --&gt; B[\"Cache Path Generation\"]\n    A --&gt; C[\"Transcoding (ffmpeg)\"]\n    A --&gt; D[\"Cache Management (size, cleanup)\"]\n\n    E[CacheWorker] --&gt; A\n    E --&gt; F[\"ThreadPool (parallel batch)\"]\n    E --&gt; G[\"ProgressTracker (SSE)\"]\n\n    H[ProgressTracker] --&gt; I[\"Frontend (EventSource)\"]</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <ul> <li><code>audio_cache.py</code> \u2013 core logic (hash\u2011based filenames, transcoding, cache look\u2011ups).</li> <li><code>cache_worker.py</code> \u2013 batch processing, thread\u2011pool parallelism, progress callbacks.</li> <li><code>progress_tracker.py</code> \u2013 Server\u2011Sent Events (SSE) emitter that feeds the UI\u2019s \u201ccaching progress\u201d modal.</li> </ul>"},{"location":"development/audio-playback/backend/server-cache-system.html#-key-features","title":"\u2728 Key Features","text":"Feature Description Automatic transcoding FLAC, WAV, AIFF, APE, ALAC \u2192 MP3 (high/medium/low). Multiple quality levels <code>high</code> (256 kbps), <code>medium</code> (192 kbps), <code>low</code> (128 kbps). Smart caching Only creates a cached file when the source is lossless and the cache is missing/out-of-date. Pre-caching on upload When a mixtape is saved, the system can generate caches automatically. Parallel batch processing Thread-pool (configurable workers) for fast bulk transcoding. Progress tracking Real-time SSE updates displayed in a Bootstrap modal. Cache management utilities Size calculation, age-based cleanup, full purge. Config-driven All knobs live in <code>src/config/config.py</code> (<code>AUDIO_CACHE_*</code>)."},{"location":"development/audio-playback/backend/server-cache-system.html#-how-it-works-stepbystep","title":"\ud83d\udccb How It Works (Step\u2011by\u2011Step)","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#cache-path-generation","title":"Cache Path Generation","text":"<pre><code>flowchart LR\n    A[Original file path] --&gt; B[Normalize &amp; resolve]\n    B --&gt; C[MD5 hash of full path]\n    C --&gt; D[Compose filename: `&lt;hash&gt;_&lt;quality&gt;_&lt;bitrate&gt;.mp3`]\n    D --&gt; E[\"Cache directory (`AUDIO_CACHE_DIR`)\"]</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <ul> <li>The hash guarantees collision\u2011free filenames, even for identically named tracks in different folders.</li> <li>Example:     Original: <code>/music/Radiohead/OK Computer/01 Airbag.flac</code> Hash: <code>a1b2c3\u2026</code> \u2192 Cache file <code>a1b2c3_medium_192k.mp3</code>.</li> </ul>"},{"location":"development/audio-playback/backend/server-cache-system.html#transcoding-flow","title":"Transcoding Flow","text":"<pre><code>sequenceDiagram\n    participant UI\n    participant Flask\n    participant CacheWorker\n    participant AudioCache\n    participant ffmpeg\n\n    UI-&gt;&gt;Flask: Request play (quality=medium)\n    Flask-&gt;&gt;AudioCache: get_cached_or_original()\n    alt Cached version exists\n        AudioCache--&gt;&gt;Flask: Return cached path\n    else No cache\n        AudioCache-&gt;&gt;CacheWorker: transcode_file()\n        CacheWorker-&gt;&gt;ffmpeg: Run ffmpeg command\n        ffmpeg--&gt;&gt;CacheWorker: MP3 file created\n        CacheWorker-&gt;&gt;AudioCache: Store in cache dir\n        AudioCache--&gt;&gt;Flask: Return newly cached path\n    end\n    Flask-&gt;&gt;UI: Stream MP3</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <ul> <li>If a cached file is present, it is served immediately.</li> <li>Otherwise the worker spawns ffmpeg, writes the MP3, and returns the new path.</li> </ul>"},{"location":"development/audio-playback/backend/server-cache-system.html#playback-flow","title":"Playback Flow","text":"<pre><code>graph LR\n    A[User clicks Play] --&gt; B{Quality selected?}\n    B --&gt;|Original| C[Serve original FLAC]\n    B --&gt;|High/Med/Low| D{Is source lossless?}\n    D --&gt;|No| C\n    D --&gt;|Yes| E{Cache exists?}\n    E --&gt;|Yes| F[Serve cached MP3]\n    E --&gt;|No| G[Log warning \u2192 fall back to original]\n    F --&gt; H[User streams small file]\n    C --&gt; I[User streams large file]</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/backend/server-cache-system.html#-api-reference","title":"\ud83d\udd0c API Reference","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#audiocache-core","title":"AudioCache (core)","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache","title":"<code>AudioCache(cache_dir, logger=None)</code>","text":"<p>Manages audio file transcoding and caching for bandwidth optimization.</p> <p>Provides methods to check for cached versions, generate transcoded files, and manage the cache directory.</p> <p>Initialize the AudioCache manager.</p> <p>Parameters:</p> Name Type Description Default <code>cache_dir</code> <code>Path</code> <p>Directory where cached transcoded files will be stored.</p> required <code>logger</code> <code>Logger | None</code> <p>Optional logger for tracking operations.</p> <code>None</code> <p>Methods:</p> Name Description <code>get_cache_path</code> <p>Generate a cache filename based on the original path and quality level.</p> <code>should_transcode</code> <p>Determine if a file should be transcoded based on its format.</p> <code>is_cached</code> <p>Check if a cached version exists and is up-to-date.</p> <code>transcode_file</code> <p>Transcode an audio file to a cached version.</p> <code>get_cached_or_original</code> <p>Get the cached version if available, otherwise return original path.</p> <code>precache_file</code> <p>Pre-generate cached versions at multiple quality levels.</p> <code>get_cache_size</code> <p>Calculate total size of the cache directory in bytes.</p> <code>clear_cache</code> <p>Clear cached files, optionally only those older than specified days.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def __init__(self, cache_dir: Path, logger: Logger | None = None):\n    \"\"\"\n    Initialize the AudioCache manager.\n\n    Args:\n        cache_dir: Directory where cached transcoded files will be stored.\n        logger: Optional logger for tracking operations.\n    \"\"\"\n    self.cache_dir = Path(cache_dir)\n    self.cache_dir.mkdir(parents=True, exist_ok=True)\n    self.logger = logger or NullLogger()\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.get_cache_path","title":"<code>get_cache_path(original_path, quality='medium')</code>","text":"<p>Generate a cache filename based on the original path and quality level.</p> <p>Parameters:</p> Name Type Description Default <code>original_path</code> <code>Path</code> <p>Path to the original audio file.</p> required <code>quality</code> <code>QualityLevel</code> <p>Quality level for transcoding (high, medium, low).</p> <code>'medium'</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to the cached file location.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def get_cache_path(\n    self, original_path: Path, quality: QualityLevel = \"medium\"\n) -&gt; Path:\n    \"\"\"\n    Generate a cache filename based on the original path and quality level.\n\n    Args:\n        original_path: Path to the original audio file.\n        quality: Quality level for transcoding (high, medium, low).\n\n    Returns:\n        Path to the cached file location.\n    \"\"\"\n    if quality == \"original\":\n        return original_path\n\n    # Create unique hash from the normalized file path\n    path_str = self._normalize_path(original_path)\n    path_hash = hashlib.md5(path_str.encode()).hexdigest()\n\n    # Get quality settings\n    settings = QUALITY_SETTINGS[quality]\n    bitrate = settings[\"bitrate\"]\n    ext = settings[\"format\"]\n\n    cache_filename = f\"{path_hash}_{quality}_{bitrate}.{ext}\"\n\n    # Log for debugging\n    self.logger.debug(\n        f\"Cache path generation: {original_path.name} -&gt; {cache_filename} \"\n        f\"(hash of: {path_str})\"\n    )\n\n    return self.cache_dir / cache_filename\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.should_transcode","title":"<code>should_transcode(file_path)</code>","text":"<p>Determine if a file should be transcoded based on its format.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>Path</code> <p>Path to the audio file.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if the file should be transcoded, False otherwise.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def should_transcode(self, file_path: Path) -&gt; bool:\n    \"\"\"\n    Determine if a file should be transcoded based on its format.\n\n    Args:\n        file_path: Path to the audio file.\n\n    Returns:\n        True if the file should be transcoded, False otherwise.\n    \"\"\"\n    # Transcode lossless formats that are bandwidth-heavy\n    transcode_formats = {\".flac\", \".wav\", \".aiff\", \".ape\", \".alac\"}\n    return file_path.suffix.lower() in transcode_formats\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.is_cached","title":"<code>is_cached(original_path, quality='medium')</code>","text":"<p>Check if a cached version exists and is up-to-date.</p> <p>Parameters:</p> Name Type Description Default <code>original_path</code> <code>Path</code> <p>Path to the original audio file.</p> required <code>quality</code> <code>QualityLevel</code> <p>Quality level to check.</p> <code>'medium'</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if a valid cached version exists, False otherwise.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def is_cached(self, original_path: Path, quality: QualityLevel = \"medium\") -&gt; bool:\n    \"\"\"\n    Check if a cached version exists and is up-to-date.\n\n    Args:\n        original_path: Path to the original audio file.\n        quality: Quality level to check.\n\n    Returns:\n        True if a valid cached version exists, False otherwise.\n    \"\"\"\n    if quality == \"original\" or not self.should_transcode(original_path):\n        return True\n\n    cache_path = self.get_cache_path(original_path, quality)\n\n    if not cache_path.exists():\n        self.logger.debug(f\"Cache miss: {cache_path.name} does not exist\")\n        return False\n\n    # Check if cache is newer than original\n    try:\n        cache_mtime = cache_path.stat().st_mtime\n\n        # Only check mtime if original file exists\n        if original_path.exists():\n            original_mtime = original_path.stat().st_mtime\n            if cache_mtime &lt; original_mtime:\n                self.logger.debug(\n                    f\"Cache outdated: {cache_path.name} is older than source\"\n                )\n                return False\n\n        self.logger.debug(f\"Cache hit: {cache_path.name}\")\n        return True\n\n    except OSError as e:\n        self.logger.warning(f\"Error checking cache status for {cache_path}: {e}\")\n        return False\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.transcode_file","title":"<code>transcode_file(original_path, quality='medium', overwrite=False)</code>","text":"<p>Transcode an audio file to a cached version.</p> <p>Parameters:</p> Name Type Description Default <code>original_path</code> <code>Path</code> <p>Path to the original audio file.</p> required <code>quality</code> <code>QualityLevel</code> <p>Quality level for transcoding.</p> <code>'medium'</code> <code>overwrite</code> <code>bool</code> <p>If True, regenerate cache even if it exists.</p> <code>False</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to the transcoded file (or original if no transcoding needed).</p> <p>Raises:</p> Type Description <code>CalledProcessError</code> <p>If ffmpeg transcoding fails.</p> <code>FileNotFoundError</code> <p>If the original file doesn't exist.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def transcode_file(\n    self,\n    original_path: Path,\n    quality: QualityLevel = \"medium\",\n    overwrite: bool = False\n) -&gt; Path:\n    \"\"\"\n    Transcode an audio file to a cached version.\n\n    Args:\n        original_path: Path to the original audio file.\n        quality: Quality level for transcoding.\n        overwrite: If True, regenerate cache even if it exists.\n\n    Returns:\n        Path to the transcoded file (or original if no transcoding needed).\n\n    Raises:\n        subprocess.CalledProcessError: If ffmpeg transcoding fails.\n        FileNotFoundError: If the original file doesn't exist.\n    \"\"\"\n    if quality == \"original\" or not self.should_transcode(original_path):\n        return original_path\n\n    if not original_path.exists():\n        raise FileNotFoundError(f\"Original file not found: {original_path}\")\n\n    cache_path = self.get_cache_path(original_path, quality)\n\n    # Check if we need to transcode\n    if not overwrite and self.is_cached(original_path, quality):\n        self.logger.debug(f\"Using existing cache: {cache_path}\")\n        return cache_path\n\n    # Get transcoding settings\n    settings = QUALITY_SETTINGS[quality]\n    bitrate = settings[\"bitrate\"]\n\n    self.logger.debug(f\"Transcoding {original_path.name} to {quality} quality ({bitrate})\")\n\n    # Build ffmpeg command\n    cmd = [\n        \"ffmpeg\",\n        \"-y\",  # Overwrite output file\n        \"-i\", str(original_path),\n        \"-vn\",  # No video\n        \"-ar\", \"44100\",  # Sample rate\n        \"-ac\", \"2\",  # Stereo\n        \"-b:a\", bitrate,  # Target bitrate\n        \"-map_metadata\", \"0\",  # Copy metadata\n        \"-id3v2_version\", \"3\",  # ID3v2.3 for better compatibility\n        str(cache_path),\n    ]\n\n    try:\n        subprocess.run(\n            cmd,\n            capture_output=True,\n            check=True,\n            text=True,\n        )\n        self.logger.debug(f\"Successfully cached: {cache_path}\")\n        return cache_path\n\n    except subprocess.CalledProcessError as e:\n        self.logger.error(f\"Transcoding failed for {original_path}: {e.stderr}\")\n        # Clean up partial file if it exists\n        if cache_path.exists():\n            cache_path.unlink()\n        raise\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.get_cached_or_original","title":"<code>get_cached_or_original(original_path, quality='medium')</code>","text":"<p>Get the cached version if available, otherwise return original path.</p> <p>This method does NOT generate a cache if it doesn't exist. Use transcode_file() for that purpose.</p> <p>Parameters:</p> Name Type Description Default <code>original_path</code> <code>Path</code> <p>Path to the original audio file.</p> required <code>quality</code> <code>QualityLevel</code> <p>Quality level to retrieve.</p> <code>'medium'</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to cached version if available, otherwise original path.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def get_cached_or_original(\n    self, original_path: Path, quality: QualityLevel = \"medium\"\n) -&gt; Path:\n    \"\"\"\n    Get the cached version if available, otherwise return original path.\n\n    This method does NOT generate a cache if it doesn't exist.\n    Use transcode_file() for that purpose.\n\n    Args:\n        original_path: Path to the original audio file.\n        quality: Quality level to retrieve.\n\n    Returns:\n        Path to cached version if available, otherwise original path.\n    \"\"\"\n    if quality == \"original\" or not self.should_transcode(original_path):\n        return original_path\n\n    cache_path = self.get_cache_path(original_path, quality)\n\n    return cache_path if self.is_cached(original_path, quality) else original_path\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.precache_file","title":"<code>precache_file(original_path, qualities=None)</code>","text":"<p>Pre-generate cached versions at multiple quality levels.</p> <p>Parameters:</p> Name Type Description Default <code>original_path</code> <code>Path</code> <p>Path to the original audio file.</p> required <code>qualities</code> <code>list[QualityLevel]</code> <p>List of quality levels to generate. Defaults to [\"medium\"].</p> <code>None</code> <p>Returns:</p> Type Description <code>dict[QualityLevel, Path]</code> <p>Dictionary mapping quality levels to their cached paths.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def precache_file(\n    self,\n    original_path: Path,\n    qualities: list[QualityLevel] = None\n) -&gt; dict[QualityLevel, Path]:\n    \"\"\"\n    Pre-generate cached versions at multiple quality levels.\n\n    Args:\n        original_path: Path to the original audio file.\n        qualities: List of quality levels to generate. Defaults to [\"medium\"].\n\n    Returns:\n        Dictionary mapping quality levels to their cached paths.\n    \"\"\"\n    if qualities is None:\n        qualities = [\"medium\"]\n\n    results = {}\n\n    for quality in qualities:\n        if quality == \"original\":\n            results[quality] = original_path\n            continue\n\n        try:\n            cached_path = self.transcode_file(original_path, quality)\n            results[quality] = cached_path\n        except Exception as e:\n            self.logger.error(f\"Failed to precache {quality} version: {e}\")\n            results[quality] = original_path\n\n    return results\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.get_cache_size","title":"<code>get_cache_size()</code>","text":"<p>Calculate total size of the cache directory in bytes.</p> <p>Returns:</p> Type Description <code>int</code> <p>Total size in bytes.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def get_cache_size(self) -&gt; int:\n    \"\"\"\n    Calculate total size of the cache directory in bytes.\n\n    Returns:\n        Total size in bytes.\n    \"\"\"\n    total_size = sum(\n        file_path.stat().st_size\n        for file_path in self.cache_dir.rglob(\"*\")\n        if file_path.is_file()\n    )\n    return total_size\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.audio_cache.AudioCache.clear_cache","title":"<code>clear_cache(older_than_days=None)</code>","text":"<p>Clear cached files, optionally only those older than specified days.</p> <p>Parameters:</p> Name Type Description Default <code>older_than_days</code> <code>int | None</code> <p>If specified, only delete files older than this many days.</p> <code>None</code> <p>Returns:</p> Type Description <code>int</code> <p>Number of files deleted.</p> Source code in <code>src/audio_cache/audio_cache.py</code> <pre><code>def clear_cache(self, older_than_days: int | None = None) -&gt; int:\n    \"\"\"\n    Clear cached files, optionally only those older than specified days.\n\n    Args:\n        older_than_days: If specified, only delete files older than this many days.\n\n    Returns:\n        Number of files deleted.\n    \"\"\"\n    import time\n\n    deleted_count = 0\n    current_time = time.time()\n\n    for file_path in self.cache_dir.rglob(\"*.mp3\"):\n        if file_path.is_file():\n            should_delete = True\n\n            if older_than_days is not None:\n                file_age_days = (current_time - file_path.stat().st_mtime) / 86400\n                should_delete = file_age_days &gt; older_than_days\n\n            if should_delete:\n                try:\n                    file_path.unlink()\n                    deleted_count += 1\n                    self.logger.debug(f\"Deleted cached file: {file_path}\")\n                except OSError as e:\n                    self.logger.error(f\"Failed to delete {file_path}: {e}\")\n\n    self.logger.info(f\"Cache cleanup: deleted {deleted_count} files\")\n    return deleted_count\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#cacheworker-batch--async","title":"CacheWorker (batch &amp; async)","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.cache_worker.CacheWorker","title":"<code>CacheWorker(audio_cache, logger=None, max_workers=4)</code>","text":"<p>Worker for pre-caching audio files in the background.</p> <p>Provides methods to cache individual files or entire mixtapes at specified quality levels using thread pools for parallel processing.</p> <p>Initialize the cache worker.</p> <p>Parameters:</p> Name Type Description Default <code>audio_cache</code> <code>AudioCache</code> <p>AudioCache instance for transcoding operations.</p> required <code>logger</code> <code>Logger | None</code> <p>Optional logger for tracking operations.</p> <code>None</code> <code>max_workers</code> <code>int</code> <p>Maximum number of parallel transcoding threads.</p> <code>4</code> <p>Methods:</p> Name Description <code>cache_single_file</code> <p>Cache a single audio file at specified quality levels.</p> <code>cache_mixtape</code> <p>Cache all audio files in a mixtape.</p> <code>cache_mixtape_async</code> <p>Cache all audio files in a mixtape using parallel processing.</p> <code>verify_mixtape_cache</code> <p>Verify which tracks in a mixtape have valid cached versions.</p> <code>regenerate_outdated_cache</code> <p>Regenerate cached versions that are older than their source files.</p> Source code in <code>src/audio_cache/cache_worker.py</code> <pre><code>def __init__(\n    self,\n    audio_cache: AudioCache,\n    logger: Logger | None = None,\n    max_workers: int = 4,\n):\n    \"\"\"\n    Initialize the cache worker.\n\n    Args:\n        audio_cache: AudioCache instance for transcoding operations.\n        logger: Optional logger for tracking operations.\n        max_workers: Maximum number of parallel transcoding threads.\n    \"\"\"\n    self.audio_cache = audio_cache\n    self.logger = logger or NullLogger()\n    self.max_workers = max_workers\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.cache_worker.CacheWorker.cache_single_file","title":"<code>cache_single_file(file_path, qualities=None)</code>","text":"<p>Cache a single audio file at specified quality levels.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>Path</code> <p>Path to the audio file.</p> required <code>qualities</code> <code>list[QualityLevel]</code> <p>List of quality levels to cache. Defaults to [\"medium\"].</p> <code>None</code> <p>Returns:</p> Type Description <code>dict[QualityLevel, bool]</code> <p>Dictionary mapping quality levels to success status.</p> Source code in <code>src/audio_cache/cache_worker.py</code> <pre><code>def cache_single_file(\n    self,\n    file_path: Path,\n    qualities: list[QualityLevel] = None,\n) -&gt; dict[QualityLevel, bool]:\n    \"\"\"\n    Cache a single audio file at specified quality levels.\n\n    Args:\n        file_path: Path to the audio file.\n        qualities: List of quality levels to cache. Defaults to [\"medium\"].\n\n    Returns:\n        Dictionary mapping quality levels to success status.\n    \"\"\"\n    if qualities is None:\n        qualities = [\"medium\"]\n\n    results = {}\n\n    for quality in qualities:\n        if quality == \"original\":\n            results[quality] = True\n            continue\n\n        try:\n            self.audio_cache.transcode_file(file_path, quality)\n            results[quality] = True\n            self.logger.debug(f\"Cached {file_path.name} at {quality} quality\")\n        except Exception as e:\n            results[quality] = False\n            self.logger.error(f\"Failed to cache {file_path.name} at {quality}: {e}\")\n\n    return results\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.cache_worker.CacheWorker.cache_mixtape","title":"<code>cache_mixtape(track_paths, qualities=None, progress_callback=None)</code>","text":"<p>Cache all audio files in a mixtape.</p> <p>Parameters:</p> Name Type Description Default <code>track_paths</code> <code>list[Path]</code> <p>List of paths to audio files in the mixtape.</p> required <code>qualities</code> <code>list[QualityLevel]</code> <p>Quality levels to cache. Defaults to [\"medium\"].</p> <code>None</code> <code>progress_callback</code> <code>Callable[[int, int], None] | None</code> <p>Optional callback function(current, total) for progress updates.</p> <code>None</code> <p>Returns:</p> Type Description <code>dict[str, dict]</code> <p>Dictionary with results for each file.</p> Source code in <code>src/audio_cache/cache_worker.py</code> <pre><code>def cache_mixtape(\n    self,\n    track_paths: list[Path],\n    qualities: list[QualityLevel] = None,\n    progress_callback: Callable[[int, int], None] | None = None,\n) -&gt; dict[str, dict]:\n    \"\"\"\n    Cache all audio files in a mixtape.\n\n    Args:\n        track_paths: List of paths to audio files in the mixtape.\n        qualities: Quality levels to cache. Defaults to [\"medium\"].\n        progress_callback: Optional callback function(current, total) for progress updates.\n\n    Returns:\n        Dictionary with results for each file.\n    \"\"\"\n    if qualities is None:\n        qualities = [\"medium\"]\n\n    total_files = len(track_paths)\n    results = {}\n\n    self.logger.debug(\n        f\"Starting cache generation for {total_files} tracks at {qualities} quality levels\"\n    )\n\n    for idx, file_path in enumerate(track_paths, 1):\n        if not self.audio_cache.should_transcode(file_path):\n            self.logger.debug(f\"Skipping {file_path.name} (no transcoding needed)\")\n            results[str(file_path)] = {\"skipped\": True}\n            continue\n\n        file_results = self.cache_single_file(file_path, qualities)\n        results[str(file_path)] = file_results\n\n        if progress_callback:\n            progress_callback(idx, total_files)\n\n    self.logger.debug(f\"Cache generation complete for {total_files} tracks\")\n    return results\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.cache_worker.CacheWorker.cache_mixtape_async","title":"<code>cache_mixtape_async(track_paths, qualities=None, progress_callback=None)</code>","text":"<p>Cache all audio files in a mixtape using parallel processing.</p> <p>Parameters:</p> Name Type Description Default <code>track_paths</code> <code>list[Path]</code> <p>List of paths to audio files in the mixtape.</p> required <code>qualities</code> <code>list[QualityLevel]</code> <p>Quality levels to cache. Defaults to [\"medium\"].</p> <code>None</code> <code>progress_callback</code> <code>Callable[[int, int], None] | None</code> <p>Optional callback function(current, total) for progress updates.</p> <code>None</code> <p>Returns:</p> Type Description <code>dict[str, dict]</code> <p>Dictionary with results for each file.</p> Source code in <code>src/audio_cache/cache_worker.py</code> <pre><code>def cache_mixtape_async(\n    self,\n    track_paths: list[Path],\n    qualities: list[QualityLevel] = None,\n    progress_callback: Callable[[int, int], None] | None = None,\n) -&gt; dict[str, dict]:\n    \"\"\"\n    Cache all audio files in a mixtape using parallel processing.\n\n    Args:\n        track_paths: List of paths to audio files in the mixtape.\n        qualities: Quality levels to cache. Defaults to [\"medium\"].\n        progress_callback: Optional callback function(current, total) for progress updates.\n\n    Returns:\n        Dictionary with results for each file.\n    \"\"\"\n    if qualities is None:\n        qualities = [\"medium\"]\n\n    # Filter files that need transcoding\n    files_to_cache = [\n        path for path in track_paths if self.audio_cache.should_transcode(path)\n    ]\n\n    # Track skipped files (non-FLAC that don't need transcoding)\n    skipped_files = [\n        path for path in track_paths if not self.audio_cache.should_transcode(path)\n    ]\n\n    total_files = len(files_to_cache)\n    # Report skipped files via progress callback\n    if progress_callback and hasattr(progress_callback, 'track_skipped'):\n        for path in skipped_files:\n            progress_callback.track_skipped(path.name, reason=\"No transcoding needed (MP3/M4A/etc)\")\n\n    results = {\n        str(path): {\"skipped\": True, \"reason\": \"No transcoding needed\"}\n        for path in skipped_files\n    }\n    if total_files == 0:\n        self.logger.debug(f\"No files need transcoding ({len(skipped_files)} files skipped)\")\n        # Emit final progress if all files were skipped\n        if progress_callback and hasattr(progress_callback, '__call__'):\n            progress_callback(len(track_paths), len(track_paths))\n        return results\n\n    completed = 0\n\n    self.logger.debug(\n        f\"Starting parallel cache generation for {total_files} tracks \"\n        f\"at {qualities} quality levels (max workers: {self.max_workers})\"\n    )\n\n    with ThreadPoolExecutor(max_workers=self.max_workers) as executor:\n        # Submit all jobs\n        future_to_path = {\n            executor.submit(self.cache_single_file, path, qualities): path\n            for path in files_to_cache\n        }\n\n        # Process completed jobs\n        for future in as_completed(future_to_path):\n            path = future_to_path[future]\n            completed += 1\n\n            try:\n                file_results = future.result()\n                results[str(path)] = file_results\n                self.logger.debug(\n                    f\"[{completed}/{total_files}] Cached {path.name}\"\n                )\n            except Exception as e:\n                results[str(path)] = {\"error\": str(e)}\n                self.logger.error(f\"Failed to cache {path.name}: {e}\")\n\n            if progress_callback:\n                progress_callback(completed, total_files)\n\n    self.logger.debug(f\"Parallel cache generation complete for {total_files} tracks\")\n    return results\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.cache_worker.CacheWorker.verify_mixtape_cache","title":"<code>verify_mixtape_cache(track_paths, quality='medium')</code>","text":"<p>Verify which tracks in a mixtape have valid cached versions.</p> <p>Parameters:</p> Name Type Description Default <code>track_paths</code> <code>list[Path]</code> <p>List of paths to audio files in the mixtape.</p> required <code>quality</code> <code>QualityLevel</code> <p>Quality level to check.</p> <code>'medium'</code> <p>Returns:</p> Type Description <code>dict[str, bool]</code> <p>Dictionary mapping file paths to cache availability status.</p> Source code in <code>src/audio_cache/cache_worker.py</code> <pre><code>def verify_mixtape_cache(\n    self, track_paths: list[Path], quality: QualityLevel = \"medium\"\n) -&gt; dict[str, bool]:\n    \"\"\"\n    Verify which tracks in a mixtape have valid cached versions.\n\n    Args:\n        track_paths: List of paths to audio files in the mixtape.\n        quality: Quality level to check.\n\n    Returns:\n        Dictionary mapping file paths to cache availability status.\n    \"\"\"\n    results = {\n        str(path): (\n            self.audio_cache.is_cached(path, quality) if self.audio_cache.should_transcode(path) else True\n        )\n        for path in track_paths\n    }\n    return results\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.cache_worker.CacheWorker.regenerate_outdated_cache","title":"<code>regenerate_outdated_cache(track_paths, qualities=None)</code>","text":"<p>Regenerate cached versions that are older than their source files.</p> <p>Parameters:</p> Name Type Description Default <code>track_paths</code> <code>list[Path]</code> <p>List of paths to audio files.</p> required <code>qualities</code> <code>list[QualityLevel]</code> <p>Quality levels to regenerate.</p> <code>None</code> <p>Returns:</p> Type Description <code>dict[str, dict]</code> <p>Dictionary with regeneration results for each file.</p> Source code in <code>src/audio_cache/cache_worker.py</code> <pre><code>def regenerate_outdated_cache(\n    self, track_paths: list[Path], qualities: list[QualityLevel] = None\n) -&gt; dict[str, dict]:\n    \"\"\"\n    Regenerate cached versions that are older than their source files.\n\n    Args:\n        track_paths: List of paths to audio files.\n        qualities: Quality levels to regenerate.\n\n    Returns:\n        Dictionary with regeneration results for each file.\n    \"\"\"\n    if qualities is None:\n        qualities = [\"medium\"]\n\n    files_to_regenerate = []\n\n    for path in track_paths:\n        if not self.audio_cache.should_transcode(path):\n            continue\n\n        # Check each quality level\n        for quality in qualities:\n            if not self.audio_cache.is_cached(path, quality):\n                files_to_regenerate.append((path, quality))\n                self.logger.debug(\n                    f\"Cache outdated or missing: {path.name} at {quality}\"\n                )\n\n    if not files_to_regenerate:\n        self.logger.info(\"All caches are up-to-date\")\n        return {}\n\n    results = {}\n\n    for path, quality in files_to_regenerate:\n        try:\n            self.audio_cache.transcode_file(path, quality, overwrite=True)\n            key = f\"{path}_{quality}\"\n            results[key] = {\"success\": True}\n            self.logger.debug(f\"Regenerated cache: {path.name} at {quality}\")\n        except Exception as e:\n            key = f\"{path}_{quality}\"\n            results[key] = {\"success\": False, \"error\": str(e)}\n            self.logger.error(f\"Failed to regenerate {path.name}: {e}\")\n\n    return results\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#convenience-scheduler","title":"Convenience Scheduler","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.cache_worker.schedule_mixtape_caching","title":"<code>schedule_mixtape_caching(mixtape_tracks, music_root, audio_cache, logger=None, qualities=None, async_mode=True, progress_callback=None)</code>","text":"<p>Convenience function to schedule caching for a mixtape's tracks.</p> <p>Parameters:</p> Name Type Description Default <code>mixtape_tracks</code> <code>list[dict]</code> <p>List of track dictionaries with 'path' keys.</p> required <code>music_root</code> <code>Path</code> <p>Root directory for music files.</p> required <code>audio_cache</code> <code>AudioCache</code> <p>AudioCache instance.</p> required <code>logger</code> <code>Logger | None</code> <p>Optional logger.</p> <code>None</code> <code>qualities</code> <code>list[QualityLevel]</code> <p>Quality levels to cache. Defaults to [\"medium\"].</p> <code>None</code> <code>async_mode</code> <code>bool</code> <p>If True, use parallel processing.</p> <code>True</code> <code>progress_callback</code> <code>Callable[[int, int], None] | None</code> <p>Optional callback function(current, total) for progress updates.</p> <code>None</code> <p>Returns:</p> Type Description <code>dict</code> <p>Dictionary with caching results.</p> Source code in <code>src/audio_cache/cache_worker.py</code> <pre><code>def schedule_mixtape_caching(\n    mixtape_tracks: list[dict],\n    music_root: Path,\n    audio_cache: AudioCache,\n    logger: Logger | None = None,\n    qualities: list[QualityLevel] = None,\n    async_mode: bool = True,\n    progress_callback: Callable[[int, int], None] | None = None,\n) -&gt; dict:\n    \"\"\"\n    Convenience function to schedule caching for a mixtape's tracks.\n\n    Args:\n        mixtape_tracks: List of track dictionaries with 'path' keys.\n        music_root: Root directory for music files.\n        audio_cache: AudioCache instance.\n        logger: Optional logger.\n        qualities: Quality levels to cache. Defaults to [\"medium\"].\n        async_mode: If True, use parallel processing.\n        progress_callback: Optional callback function(current, total) for progress updates.\n\n    Returns:\n        Dictionary with caching results.\n    \"\"\"\n    if qualities is None:\n        qualities = [\"medium\"]\n\n    # Convert track dictionaries to Path objects\n    track_paths = [music_root / track[\"path\"] for track in mixtape_tracks]\n\n    # Filter out non-existent files\n    valid_paths = [path for path in track_paths if path.exists()]\n\n    if len(valid_paths) &lt; len(track_paths):\n        missing = len(track_paths) - len(valid_paths)\n        if logger:\n            logger.warning(f\"{missing} track files not found, skipping\")\n\n    # Create worker and cache files\n    worker = CacheWorker(audio_cache, logger)\n\n    if async_mode:\n        return worker.cache_mixtape_async(valid_paths, qualities, progress_callback)\n    else:\n        return worker.cache_mixtape(valid_paths, qualities, progress_callback)\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#progress-tracker-sse","title":"Progress Tracker (SSE)","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.get_progress_tracker","title":"<code>get_progress_tracker(logger=None)</code>","text":"<p>Get or create the global progress tracker instance.</p> Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def get_progress_tracker(logger: Logger | None = None) -&gt; ProgressTracker:\n    \"\"\"Get or create the global progress tracker instance.\"\"\"\n    global _progress_tracker\n    if _progress_tracker is None:\n        _progress_tracker = ProgressTracker(logger)\n    return _progress_tracker\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressTracker","title":"<code>ProgressTracker(logger=None)</code>","text":"<p>Tracks progress of long-running operations and broadcasts updates via SSE.</p> <p>Thread-safe implementation that allows multiple operations to report progress while clients listen for updates.</p> <p>Initializes a new progress tracker with optional logging.</p> <p>Sets up internal, thread-safe queues for tracking task-specific progress events that can be streamed to clients.</p> <p>Parameters:</p> Name Type Description Default <code>logger</code> <code>Logger | None</code> <p>Optional logger instance used to record progress tracker activity.</p> <code>None</code> <p>Methods:</p> Name Description <code>create_task</code> <p>Create a new task for tracking.</p> <code>emit</code> <p>Emit a progress event.</p> <code>listen</code> <p>Generator that yields SSE-formatted progress events.</p> <code>cleanup_task</code> <p>Remove a task and its queue.</p> Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def __init__(self, logger: Logger | None = None):\n    \"\"\"Initializes a new progress tracker with optional logging.\n\n    Sets up internal, thread-safe queues for tracking task-specific progress events that can be streamed to clients.\n\n    Args:\n        logger: Optional logger instance used to record progress tracker activity.\n    \"\"\"\n    self.logger = logger or NullLogger()\n    self._queues: dict[str, Queue] = {}\n    self._lock = threading.Lock()\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressTracker.create_task","title":"<code>create_task(task_id)</code>","text":"<p>Create a new task for tracking.</p> <p>Parameters:</p> Name Type Description Default <code>task_id</code> <code>str</code> <p>Unique identifier for this task (e.g., mixtape slug)</p> required Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def create_task(self, task_id: str) -&gt; None:\n    \"\"\"\n    Create a new task for tracking.\n\n    Args:\n        task_id: Unique identifier for this task (e.g., mixtape slug)\n    \"\"\"\n    with self._lock:\n        if task_id not in self._queues:\n            self._queues[task_id] = Queue()\n            self.logger.debug(f\"Created progress task: {task_id}\")\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressTracker.emit","title":"<code>emit(task_id, step, status, message, current=0, total=0)</code>","text":"<p>Emit a progress event.</p> <p>Parameters:</p> Name Type Description Default <code>task_id</code> <code>str</code> <p>Task identifier</p> required <code>step</code> <code>str</code> <p>Name of the current step (e.g., \"saving\", \"caching_track\")</p> required <code>status</code> <code>ProgressStatus</code> <p>Current status</p> required <code>message</code> <code>str</code> <p>Human-readable message</p> required <code>current</code> <code>int</code> <p>Current progress count</p> <code>0</code> <code>total</code> <code>int</code> <p>Total items to process</p> <code>0</code> Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def emit(\n    self,\n    task_id: str,\n    step: str,\n    status: ProgressStatus,\n    message: str,\n    current: int = 0,\n    total: int = 0\n) -&gt; None:\n    \"\"\"\n    Emit a progress event.\n\n    Args:\n        task_id: Task identifier\n        step: Name of the current step (e.g., \"saving\", \"caching_track\")\n        status: Current status\n        message: Human-readable message\n        current: Current progress count\n        total: Total items to process\n    \"\"\"\n    event = ProgressEvent(\n        task_id=task_id,\n        step=step,\n        status=status,\n        message=message,\n        current=current,\n        total=total\n    )\n\n    with self._lock:\n        if task_id in self._queues:\n            self._queues[task_id].put(event)\n            self.logger.debug(f\"[{task_id}] {step}: {message} ({current}/{total})\")\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressTracker.listen","title":"<code>listen(task_id, timeout=300)</code>","text":"<p>Generator that yields SSE-formatted progress events.</p> <p>Parameters:</p> Name Type Description Default <code>task_id</code> <code>str</code> <p>Task identifier to listen to</p> required <code>timeout</code> <code>int</code> <p>Maximum time to wait for events (seconds)</p> <code>300</code> <p>Yields:</p> Name Type Description <code>str</code> <p>SSE-formatted event strings</p> Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def listen(self, task_id: str, timeout: int = 300):\n    \"\"\"\n    Generator that yields SSE-formatted progress events.\n\n    Args:\n        task_id: Task identifier to listen to\n        timeout: Maximum time to wait for events (seconds)\n\n    Yields:\n        str: SSE-formatted event strings\n    \"\"\"\n    self.create_task(task_id)\n\n    start_time = time.time()\n\n    # Send initial connection event\n    yield f\"data: {json.dumps({'type': 'connected', 'task_id': task_id})}\\n\\n\"\n\n    while True:\n        # Check timeout\n        if time.time() - start_time &gt; timeout:\n            self.logger.warning(f\"Progress stream timeout for task: {task_id}\")\n            break\n\n        try:\n            with self._lock:\n                queue = self._queues.get(task_id)\n\n            if queue is None:\n                break\n\n            # Get event with short timeout to allow checking for completion\n            event = queue.get(timeout=1)\n\n            yield event.to_sse()\n\n            # If task is completed or failed, clean up and stop\n            if event.status in (ProgressStatus.COMPLETED, ProgressStatus.FAILED):\n                self.logger.debug(f\"Task completed: {task_id}\")\n                break\n\n        except Empty:\n            # Send keepalive\n            yield \": keepalive\\n\\n\"\n            continue\n\n    # Cleanup\n    self.cleanup_task(task_id)\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressTracker.cleanup_task","title":"<code>cleanup_task(task_id)</code>","text":"<p>Remove a task and its queue.</p> <p>Parameters:</p> Name Type Description Default <code>task_id</code> <code>str</code> <p>Task identifier to clean up</p> required Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def cleanup_task(self, task_id: str) -&gt; None:\n    \"\"\"\n    Remove a task and its queue.\n\n    Args:\n        task_id: Task identifier to clean up\n    \"\"\"\n    with self._lock:\n        if task_id in self._queues:\n            del self._queues[task_id]\n            self.logger.debug(f\"Cleaned up progress task: {task_id}\")\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressCallback","title":"<code>ProgressCallback(task_id, tracker, total_tracks)</code>","text":"<p>Callback wrapper for audio caching progress.</p> <p>Translates cache worker progress updates into SSE events.</p> <p>Initialize the progress callback.</p> <p>Parameters:</p> Name Type Description Default <code>task_id</code> <code>str</code> <p>Task identifier</p> required <code>tracker</code> <code>ProgressTracker</code> <p>ProgressTracker instance</p> required <code>total_tracks</code> <code>int</code> <p>Total number of tracks to cache</p> required <p>Methods:</p> Name Description <code>__call__</code> <p>Called by cache worker with progress updates.</p> <code>track_cached</code> <p>Records that a track has been successfully cached.</p> <code>track_skipped</code> <p>Records that a track was intentionally skipped during caching.</p> <code>track_failed</code> <p>Records that caching a track has failed.</p> Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def __init__(self, task_id: str, tracker: ProgressTracker, total_tracks: int):\n    \"\"\"\n    Initialize the progress callback.\n\n    Args:\n        task_id: Task identifier\n        tracker: ProgressTracker instance\n        total_tracks: Total number of tracks to cache\n    \"\"\"\n    self.task_id = task_id\n    self.tracker = tracker\n    self.total_tracks = total_tracks\n    self.cached_count = 0\n    self.skipped_count = 0\n    self.failed_count = 0\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressCallback.__call__","title":"<code>__call__(current, total)</code>","text":"<p>Called by cache worker with progress updates.</p> <p>Parameters:</p> Name Type Description Default <code>current</code> <code>int</code> <p>Current file number</p> required <code>total</code> <code>int</code> <p>Total files to process</p> required Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def __call__(self, current: int, total: int) -&gt; None:\n    \"\"\"\n    Called by cache worker with progress updates.\n\n    Args:\n        current: Current file number\n        total: Total files to process\n    \"\"\"\n    self.tracker.emit(\n        task_id=self.task_id,\n        step=\"caching\",\n        status=ProgressStatus.IN_PROGRESS,\n        message=f\"Caching track {current} of {total}\",\n        current=current,\n        total=total\n    )\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressCallback.track_cached","title":"<code>track_cached(track_name)</code>","text":"<p>Records that a track has been successfully cached.</p> <p>Increments the count of cached tracks and emits a progress event reflecting the updated completion state.</p> <p>Parameters:</p> Name Type Description Default <code>track_name</code> <code>str</code> <p>The display name or identifier of the cached track.</p> required Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def track_cached(self, track_name: str) -&gt; None:\n    \"\"\"Records that a track has been successfully cached.\n\n    Increments the count of cached tracks and emits a progress event reflecting the updated completion state.\n\n    Args:\n        track_name: The display name or identifier of the cached track.\n    \"\"\"\n    self.cached_count += 1\n    self.tracker.emit(\n        task_id=self.task_id,\n        step=\"track_cached\",\n        status=ProgressStatus.IN_PROGRESS,\n        message=f\"\u2713 Cached: {track_name}\",\n        current=self.cached_count,\n        total=self.total_tracks\n    )\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressCallback.track_skipped","title":"<code>track_skipped(track_name, reason='already cached')</code>","text":"<p>Records that a track was intentionally skipped during caching.</p> <p>Increments the skipped count and emits a progress event explaining why the track was not processed.</p> <p>Parameters:</p> Name Type Description Default <code>track_name</code> <code>str</code> <p>The display name or identifier of the skipped track.</p> required <code>reason</code> <code>str</code> <p>Human-readable explanation for why the track was skipped.</p> <code>'already cached'</code> Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def track_skipped(self, track_name: str, reason: str = \"already cached\") -&gt; None:\n    \"\"\"Records that a track was intentionally skipped during caching.\n\n    Increments the skipped count and emits a progress event explaining why the track was not processed.\n\n    Args:\n        track_name: The display name or identifier of the skipped track.\n        reason: Human-readable explanation for why the track was skipped.\n    \"\"\"\n    self.skipped_count += 1\n    self.tracker.emit(\n        task_id=self.task_id,\n        step=\"track_skipped\",\n        status=ProgressStatus.SKIPPED,\n        message=f\"\u2298 Skipped: {track_name} ({reason})\",\n        current=self.cached_count + self.skipped_count,\n        total=self.total_tracks\n    )\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#src.audio_cache.progress_tracker.ProgressCallback.track_failed","title":"<code>track_failed(track_name, error)</code>","text":"<p>Records that caching a track has failed.</p> <p>Increments the failed count and emits a progress event describing the error that occurred.</p> <p>Parameters:</p> Name Type Description Default <code>track_name</code> <code>str</code> <p>The display name or identifier of the track that failed to cache.</p> required <code>error</code> <code>str</code> <p>Human-readable error description explaining the failure.</p> required Source code in <code>src/audio_cache/progress_tracker.py</code> <pre><code>def track_failed(self, track_name: str, error: str) -&gt; None:\n    \"\"\"Records that caching a track has failed.\n\n    Increments the failed count and emits a progress event describing the error that occurred.\n\n    Args:\n        track_name: The display name or identifier of the track that failed to cache.\n        error: Human-readable error description explaining the failure.\n    \"\"\"\n    self.failed_count += 1\n    self.tracker.emit(\n        task_id=self.task_id,\n        step=\"track_failed\",\n        status=ProgressStatus.FAILED,\n        message=f\"\u2717 Failed: {track_name} - {error}\",\n        current=self.cached_count + self.skipped_count + self.failed_count,\n        total=self.total_tracks\n    )\n</code></pre>"},{"location":"development/audio-playback/backend/server-cache-system.html#-configuration-options","title":"\ud83d\udee0\ufe0f Configuration Options","text":"Option Default Description <code>AUDIO_CACHE_DIR</code> <code>\"cache/audio\"</code> Directory where MP3 caches are stored (relative to DATA_ROOT). <code>AUDIO_CACHE_ENABLED</code> <code>True</code> Master switch \u2013 set to <code>False</code> to bypass the entire subsystem. <code>AUDIO_CACHE_DEFAULT_QUALITY</code> <code>\"medium\"</code> Quality used when a client does not specify one. <code>AUDIO_CACHE_MAX_WORKERS</code> <code>4</code> Number of parallel threads for batch transcoding. <code>AUDIO_CACHE_PRECACHE_ON_UPLOAD</code> <code>True</code> Auto-cache mixtape tracks when a mixtape is saved. <code>AUDIO_CACHE_PRECACHE_QUALITIES</code> <code>[\"medium\"]</code> List of qualities to pre-generate (e.g., <code>[\"low\", \"medium\", \"high\"]</code>). <p>These values are defined in <code>src/config/config.py</code> and can be overridden with environment variables (e.g., <code>AUDIO_CACHE_MAX_WORKERS=8</code>).</p>"},{"location":"development/audio-playback/backend/server-cache-system.html#-progress-tracking-sse","title":"\u23f3 Progress Tracking (SSE)","text":"<p>The progress modal in the editor UI subscribes to the endpoint:</p> <pre><code>GET /editor/progress/&lt;slug&gt;\n</code></pre> <p>The server returns a Server\u2011Sent Events stream. Each event looks like:</p> <pre><code>{\n  \"task_id\": \"summer-vibes\",\n  \"step\": \"caching\",\n  \"status\": \"in_progress\",\n  \"message\": \"Caching track 3 of 15\",\n  \"current\": 3,\n  \"total\": 15,\n  \"timestamp\": \"2024-09-28T12:34:56.789012\"\n}\n</code></pre> <p>The modal updates the progress bar, logs messages, and shows a final summary when the <code>status</code> becomes <code>completed</code> or <code>failed</code>.</p> <p>Implementation note:<code>ProgressCallback.track_cached()</code>, <code>track_skipped()</code>, and <code>track_failed()</code> are called from <code>CacheWorker</code> to emit the above events.</p>"},{"location":"development/audio-playback/backend/server-cache-system.html#-troubleshooting-faq","title":"\ud83d\udd27 Troubleshooting FAQ","text":""},{"location":"development/audio-playback/backend/server-cache-system.html#cache-misses--why-isnt-my-file-being-cached","title":"Cache Misses \u2013 \u201cWhy isn\u2019t my file being cached?\u201d","text":"Symptom Check Fix Cache miss warning in logs <code>grep -i \"cache miss\" app.log</code> Verify <code>AUDIO_CACHE_ENABLED=True</code> and that the file\u2019s suffix is in <code>should_transcode</code> (FLAC, WAV, AIFF, APE, ALAC). Cache file exists but not found <code>ls collection-data/cache/audio/</code> Ensure the hash matches the current absolute path. If you moved the music folder, run <code>python debug_cache.py &lt;MUSIC_ROOT&gt; &lt;REL_PATH&gt; &lt;CACHE_DIR&gt;</code> (see debug_cache.py). Cache never generated <code>AUDIO_CACHE_PRECACHE_ON_UPLOAD=False</code> Enable pre-caching or trigger it manually via <code>schedule_mixtape_caching</code>. ffmpeg not found <code>ffmpeg -version</code> Install ffmpeg on the host (Ubuntu: <code>apt install ffmpeg</code>; Alpine: <code>apk add ffmpeg</code>). Permission denied on cache dir <code>ls -ld collection-data/cache/audio</code> The Flask process must have write permission (owner UID = the container user). High CPU usage during batch caching <code>top while caching</code> Reduce <code>AUDIO_CACHE_MAX_WORKERS</code> (e.g., <code>export AUDIO_CACHE_MAX_WORKERS=2</code>). Stale cache after source file change Compare timestamps (<code>stat -c %Y file</code>) Run <code>cache.clear_cache()</code> or set <code>overwrite=True</code> in <code>transcode_file</code>."},{"location":"development/audio-playback/backend/server-cache-system.html#transcoding-failures--ffmpeg-exited-with-error-code-1","title":"Transcoding Failures \u2013 \u201cffmpeg exited with error code 1\u201d\"","text":"<ol> <li>Inspect the ffmpeg stderr \u2013 it is logged by <code>AudioCache.transcode_file</code>.</li> <li>Common culprits:</li> <li>Corrupt source file \u2013 try re\u2011encoding the source with <code>ffmpeg -i inut.flac -c copy output.flac</code>.</li> <li>Unsupported codec \u2013 ensure the source is a supported lossless format.</li> <li>Insufficient disk space \u2013 check free space on the cache volume.</li> <li> <p>Manual test:</p> <pre><code>ffmpeg -i \"/music/Artist/Album/BadTrack.flac\" -b:a 192k -y \"/tmp/test.mp3\"\n</code></pre> <p>If this works, the problem is likely in the path handling (hash mismatch).</p> </li> <li> <p>Fix path mismatches \u2013 run debug_cache.py (see the script in the repo) to compare the hash generated by the app vs. the one you expect.</p> </li> </ol>"},{"location":"development/audio-playback/frontend/player-controls.html","title":"Player Controls","text":""},{"location":"development/audio-playback/frontend/player-controls.html#player-controls---complete-documentation","title":"Player Controls - Complete Documentation","text":"<p>The Player Controls system is a modular architecture that manages all playback functionality in Mixtape Society. It consists of specialized managers coordinated by the main <code>playerControls.js</code> orchestrator, handling local playback, Chromecast casting, and Android Auto integration with a unified user experience.</p>"},{"location":"development/audio-playback/frontend/player-controls.html#-purpose","title":"\ud83c\udfaf Purpose","text":"<p>Primary Responsibilities:</p> <ul> <li>Coordinate playback across multiple modes (local, Chromecast, Android Auto)</li> <li>Manage track selection and queue navigation with shuffle and repeat modes</li> <li>Handle quality settings and preferences</li> <li>Synchronize UI state across all controls</li> <li>Route user actions to appropriate playback system</li> <li>Prevent conflicting playback states</li> <li>Manage playback state persistence (resume on reload)</li> <li>Handle errors gracefully with recovery options</li> <li>Maintain wake lock during playback to prevent app suspension</li> <li>Ensure seamless auto-advance on mobile devices with autoplay restrictions</li> </ul> <p>Key Design Principle: Modular architecture with specialized managers, each handling a specific concern, coordinated by a central orchestrator.</p>"},{"location":"development/audio-playback/frontend/player-controls.html#-architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"development/audio-playback/frontend/player-controls.html#modular-structure","title":"Modular Structure","text":"<p>The player controls system is organized into focused managers:</p> <pre><code>player/\n\u251c\u2500\u2500 playerControls.js         Main orchestrator (1,000 lines)\n\u251c\u2500\u2500 queueManager.js           Shuffle &amp; repeat logic (306 lines)\n\u251c\u2500\u2500 playbackManager.js        Core playback operations (192 lines)\n\u251c\u2500\u2500 uiSyncManager.js          UI updates &amp; synchronization (178 lines)\n\u251c\u2500\u2500 autoAdvanceManager.js     Mobile auto-advance (137 lines)\n\u251c\u2500\u2500 qualityManager.js         Audio quality selection (93 lines)\n\u251c\u2500\u2500 stateManager.js           Playback state persistence (88 lines)\n\u251c\u2500\u2500 wakeLockManager.js        Wake lock management (75 lines)\n\u251c\u2500\u2500 playerUtils.js            Platform utilities\n\u251c\u2500\u2500 androidAuto.js            Android Auto integration\n\u2514\u2500\u2500 chromecast.js             Chromecast integration\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#component-relationships","title":"Component Relationships","text":"<pre><code>graph TB\n    PlayerControls[playerControls.js&lt;br/&gt;Main Orchestrator]\n\n    PlayerControls --&gt; QueueMgr[queueManager.js&lt;br/&gt;Shuffle &amp; Repeat]\n    PlayerControls --&gt; PlaybackMgr[playbackManager.js&lt;br/&gt;Core Playback]\n    PlayerControls --&gt; UIMgr[uiSyncManager.js&lt;br/&gt;UI Updates]\n    PlayerControls --&gt; AutoAdvMgr[autoAdvanceManager.js&lt;br/&gt;Auto-Advance]\n    PlayerControls --&gt; QualityMgr[qualityManager.js&lt;br/&gt;Quality Selection]\n    PlayerControls --&gt; StateMgr[stateManager.js&lt;br/&gt;State Persistence]\n    PlayerControls --&gt; WakeLockMgr[wakeLockManager.js&lt;br/&gt;Wake Lock]\n\n    PlayerControls --&gt; LocalPlayer[HTML5 Audio Element]\n    PlayerControls --&gt; Chromecast[chromecast.js]\n    PlayerControls --&gt; AndroidAuto[androidAuto.js]\n    PlayerControls --&gt; PlayerUtils[playerUtils.js]\n\n    PlaybackMgr --&gt; LocalPlayer\n    PlaybackMgr --&gt; QualityMgr\n    PlaybackMgr --&gt; StateMgr\n    AutoAdvMgr --&gt; WakeLockMgr\n\n    Chromecast --&gt; CastSDK[Google Cast SDK]\n    AndroidAuto --&gt; MediaSession[Media Session API]\n    PlayerUtils --&gt; MediaSession\n\n    LocalPlayer --&gt; Audio[Audio Playback]\n    CastSDK --&gt; ChromecastDevice[Chromecast Device]\n    MediaSession --&gt; CarDashboard[Car Dashboard/Lock Screen]\n\n    style PlayerControls fill:#4a6fa5,color:#fff\n    style QueueMgr fill:#5a8fa5,color:#fff\n    style PlaybackMgr fill:#5a8fa5,color:#fff\n    style UIMgr fill:#5a8fa5,color:#fff\n    style AutoAdvMgr fill:#5a8fa5,color:#fff\n    style QualityMgr fill:#5a8fa5,color:#fff\n    style StateMgr fill:#5a8fa5,color:#fff\n    style WakeLockMgr fill:#5a8fa5,color:#fff\n    style Chromecast fill:#c65d5d,color:#fff\n    style AndroidAuto fill:#4a8c5f,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/frontend/player-controls.html#state-flow","title":"State Flow","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Initialized\n    Initialized --&gt; Local: Local Playback\n    Initialized --&gt; Casting: Cast Connected\n    Local --&gt; Casting: Cast Button\n    Casting --&gt; Local: Cast Disconnected\n    Local --&gt; Paused: Pause\n    Paused --&gt; Local: Resume\n    Local --&gt; Error: Playback Error\n    Error --&gt; Retry: Auto Retry\n    Error --&gt; Skip: User Skip\n    Retry --&gt; Local: Success\n    Retry --&gt; Error: Failed\n    Skip --&gt; Local: Next Track</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/frontend/player-controls.html#-initialization","title":"\ud83d\ude80 Initialization","text":""},{"location":"development/audio-playback/frontend/player-controls.html#entry-point","title":"Entry Point","text":"<pre><code>export function initPlayerControls() {\n    // Initialization sequence:\n    // 1. Get DOM elements\n    // 2. Initialize managers (queue, state, wake lock, quality, UI, playback, auto-advance)\n    // 3. Set up audio control interception\n    // 4. Initialize cast listeners\n    // 5. Initialize event listeners\n    // 6. Restore queue state (shuffle &amp; repeat)\n    // 7. Restore playback state (if available)\n    // 8. Set up Media Session\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#manager-initialization","title":"Manager Initialization","text":"<p>The main orchestrator creates and coordinates specialized managers:</p> <pre><code>// Extract mixtape slug from URL for unique storage keys\nconst getMixtapeSlug = () =&gt; {\n    const match = window.location.pathname.match(/\\/share\\/([^\\/]+)/);\n    return match ? match[1] : 'default';\n};\n\nconst mixtapeSlug = getMixtapeSlug();  // e.g., \"summer-vibes-2024\"\n\n// Initialize managers with per-mixtape storage\nconst queueManager = new QueueManager(trackItems.length, mixtapeSlug);\nconst stateManager = new StateManager(mixtapeSlug);\nconst wakeLockManager = new WakeLockManager();\nconst qualityManager = new QualityManager('audioQuality');\nconst uiManager = new UISyncManager(container, trackItems, bottomTitle, bottomArtistAlbum, bottomCover);\nconst playbackManager = new PlaybackManager(player, qualityManager, stateManager);\nconst autoAdvanceManager = new AutoAdvanceManager(player, wakeLockManager);\n</code></pre> <p>Note: <code>QueueManager</code> and <code>StateManager</code> now require the mixtape slug for isolated storage per mixtape.</p>"},{"location":"development/audio-playback/frontend/player-controls.html#-manager-modules","title":"\ud83d\udce6 Manager Modules","text":""},{"location":"development/audio-playback/frontend/player-controls.html#queuemanager-queuemanagerjs","title":"QueueManager (<code>queueManager.js</code>)","text":"<p>Purpose: Manages track queue navigation with shuffle and repeat functionality.</p> <p>Responsibilities:</p> <ul> <li>Generate and maintain shuffle order using Fisher-Yates algorithm</li> <li>Handle repeat modes (Off, All, One)</li> <li>Calculate next/previous track indices</li> <li>Persist queue state to localStorage</li> </ul> <p>Key Methods:</p> <pre><code>enableShuffle()              // Enable shuffle mode\ndisableShuffle()             // Disable shuffle mode\ntoggleShuffle()              // Toggle shuffle on/off\ncycleRepeatMode()            // Cycle through repeat modes\ngetNextTrack(index, options) // Get next track respecting shuffle/repeat\ngetPreviousTrack(index)      // Get previous track\nsaveState() / restoreState() // Persist state\n</code></pre> <p>Constants:</p> <ul> <li><code>REPEAT_MODES</code> - Off, All, One</li> <li><code>REPEAT_MODE_LABELS</code> - UI labels</li> <li><code>REPEAT_MODE_ICONS</code> - Bootstrap icon classes</li> <li><code>REPEAT_MODE_STYLES</code> - Button style classes</li> </ul> <p>Example Usage:</p> <pre><code>const queue = new QueueManager(20); // 20 tracks\nqueue.enableShuffle();\nconst nextIdx = queue.getNextTrack(5); // Get next after track 5\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#playbackmanager-playbackmanagerjs","title":"PlaybackManager (<code>playbackManager.js</code>)","text":"<p>Purpose: Manages core audio playback operations.</p> <p>Responsibilities:</p> <ul> <li>Load tracks into HTML5 audio player</li> <li>Control playback (play, pause, stop, seek)</li> <li>Track current playback position</li> <li>Auto-save playback state</li> <li>Manage playback timing</li> </ul> <p>Key Methods:</p> <pre><code>loadTrack(index, trackPath, metadata) // Load track into player\nplay() / pause() / stop()              // Playback controls\nseek(time)                             // Seek to position\ngetCurrentTime() / getDuration()       // Get playback info\ngetCurrentIndex() / setCurrentIndex()  // Track index management\nhasSource()                            // Check if track loaded\nstartAutoSave() / stopAutoSave()       // State persistence\nseekWhenReady(targetTime)              // Seek when metadata ready\n</code></pre> <p>Integration:</p> <ul> <li>Uses <code>QualityManager</code> to build audio URLs with quality parameters</li> <li>Uses <code>StateManager</code> to save playback position every 5 seconds</li> </ul> <p>Example Usage:</p> <pre><code>playbackManager.loadTrack(5, 'path/to/song.flac', metadata);\nawait playbackManager.play();\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#uisyncmanager-uisyncmanagerjs","title":"UISyncManager (<code>uiSyncManager.js</code>)","text":"<p>Purpose: Handles all UI updates and synchronization.</p> <p>Responsibilities:</p> <ul> <li>Update bottom player info (title, artist, album, cover)</li> <li>Sync play/pause icons across all track items</li> <li>Update progress bar and time display</li> <li>Scroll to active track</li> <li>Highlight restored tracks</li> </ul> <p>Key Methods:</p> <pre><code>updateBottomPlayerInfo(track)           // Update bottom player display\nsetActiveTrack(track)                   // Mark track as active\nscrollToCurrentTrack(element)           // Scroll track into view\nsyncPlayIcons(currentIndex, isPlaying)  // Update all play icons\nupdateUIForTrack(index)                 // Complete UI update\nupdateProgress(currentTime, duration)   // Update progress bar\nformatTime(seconds)                     // Format time as mm:ss\napplyRestoredUIState(trackIndex)        // Restore with highlight\nshowPlayer() / hidePlayer()             // Show/hide player container\n</code></pre> <p>No Dependencies: Pure DOM manipulation, no business logic.</p>"},{"location":"development/audio-playback/frontend/player-controls.html#autoadvancemanager-autoadvancemanagerjs","title":"AutoAdvanceManager (<code>autoAdvanceManager.js</code>)","text":"<p>Purpose: Handles mobile-optimized automatic track advancement.</p> <p>Responsibilities:</p> <ul> <li>Manage track transition state</li> <li>Implement retry logic for blocked autoplay</li> <li>Handle Media Session API fallback</li> <li>Coordinate with wake lock during transitions</li> </ul> <p>Key Methods:</p> <pre><code>isTransitioningTracks()                      // Check transition state\nsetTransitioning(value)                      // Set transition flag\nattemptAutoAdvancePlay(onSuccess, onFailure) // Auto-advance with retries\nattemptStandardPlay(onSuccess, onFailure)    // Standard playback\n</code></pre> <p>Retry Strategy:</p> <ol> <li>Immediate play attempt</li> <li>Update Media Session state if blocked</li> <li>Retry after 50ms</li> <li>Retry after 100ms</li> <li>Retry after 200ms</li> </ol> <p>Integration:</p> <ul> <li>Uses <code>WakeLockManager</code> to maintain wake lock during transitions</li> <li>Prevents wake lock release between tracks</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#qualitymanager-qualitymanagerjs","title":"QualityManager (<code>qualityManager.js</code>)","text":"<p>Purpose: Manages audio quality selection and URL building.</p> <p>Responsibilities:</p> <ul> <li>Store current quality setting</li> <li>Build audio URLs with quality parameters</li> <li>Persist quality preference to localStorage</li> <li>Provide quality level metadata</li> </ul> <p>Key Methods:</p> <pre><code>getQuality()                        // Get current quality\nsetQuality(quality)                 // Set quality level\ngetQualityLevels()                  // Get available levels\ngetQualityLabel(quality)            // Get quality label\nbuildAudioUrl(basePath, quality)    // Build URL with quality param\nsaveQuality() / restoreQuality()    // Persist preference\n</code></pre> <p>Quality Levels:</p> <ul> <li><code>high</code> - 256kbps</li> <li><code>medium</code> - 192kbps (default)</li> <li><code>low</code> - 128kbps</li> <li><code>original</code> - No transcoding</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#statemanager-statemanagerjs","title":"StateManager (<code>stateManager.js</code>)","text":"<p>Purpose: Handles playback state persistence using localStorage with per-mixtape isolation.</p> <p>Responsibilities:</p> <ul> <li>Save current playback position per mixtape</li> <li>Restore playback state on page load</li> <li>Track last played position for each mixtape</li> <li>Validate state age (24-hour expiry)</li> <li>Prevent cross-mixtape state pollution</li> </ul> <p>Key Methods:</p> <pre><code>savePlaybackState(trackIndex, currentTime, paused, title)\nrestorePlaybackState()  // Returns saved state or null\nclearPlaybackState()    // Clear saved position\n</code></pre> <p>Storage Keys (Per-Mixtape):</p> <p>Storage keys are unique per mixtape using the slug from the URL:</p> <pre><code>// Example for mixtape with slug \"summer-vibes-2024\"\n- summer-vibes-2024_playback_position  // Full state object\n- summer-vibes-2024_current_track      // Track index\n- summer-vibes-2024_current_time       // Playback position\n- summer-vibes-2024_shuffle_state      // Shuffle state\n- summer-vibes-2024_repeat_mode        // Repeat mode\n</code></pre> <p>Initialization:</p> <pre><code>// Extract slug from URL: /play/share/summer-vibes-2024\nconst getMixtapeSlug = () =&gt; {\n    const match = window.location.pathname.match(/\\/share\\/([^\\/]+)/);\n    return match ? match[1] : 'default';\n};\n\nconst mixtapeSlug = getMixtapeSlug();  // \"summer-vibes-2024\"\nconst stateManager = new StateManager(mixtapeSlug);\n</code></pre> <p>State Object:</p> <pre><code>{\n    track: 5,               // Track index\n    time: 123.45,           // Playback position in seconds\n    title: \"Song Name\",     // Track title for validation\n    timestamp: 1234567890,  // Save timestamp (ms)\n    paused: false           // Playback state\n}\n</code></pre> <p>State Validation:</p> <p>When restoring state, the system validates that the saved track title matches the actual track at that index to prevent issues when mixtapes are edited:</p> <pre><code>const savedState = stateManager.restorePlaybackState();\nconst actualTrack = trackItems[savedState.track];\n\n// Validate title matches\nif (savedState.title !== actualTrack.dataset.title) {\n    console.warn('\u26a0\ufe0f Saved state invalid, clearing');\n    stateManager.clearPlaybackState();\n    // Start fresh from beginning\n}\n</code></pre> <p>Benefits of Per-Mixtape Storage:</p> <ul> <li>\u2705 Each mixtape remembers its own position</li> <li>\u2705 Switching mixtapes doesn't cause confusion</li> <li>\u2705 Can resume multiple mixtapes independently</li> <li>\u2705 Prevents stale state from affecting wrong mixtape</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#wakelockmanager-wakelockmanagerjs","title":"WakeLockManager (<code>wakeLockManager.js</code>)","text":"<p>Purpose: Manages Screen Wake Lock API to prevent app suspension.</p> <p>Responsibilities:</p> <ul> <li>Acquire wake lock during playback</li> <li>Release wake lock when paused</li> <li>Handle system-initiated releases</li> <li>Check browser support</li> </ul> <p>Key Methods:</p> <pre><code>isWakeLockSupported() // Check API availability\nisActive()            // Check if wake lock held\nacquire()             // Request wake lock\nrelease()             // Release wake lock\n</code></pre> <p>Why It's Critical:</p> <ul> <li>Prevents JavaScript suspension when phone is locked</li> <li>Ensures auto-advance works with screen off</li> <li>Maintains media notifications</li> <li>Essential for background playback</li> </ul> <p>Browser Support:</p> <ul> <li>Chrome 84+</li> <li>Safari 16.4+ (iOS)</li> <li>Requires HTTPS (secure context)</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#-core-functions-main-orchestrator","title":"\ud83c\udfae Core Functions (Main Orchestrator)","text":"<p>The main orchestrator (<code>playerControls.js</code>) coordinates all managers and handles:</p> <ul> <li>Event routing</li> <li>Casting integration</li> <li>Media Session updates</li> <li>DOM event listeners</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#playtrackindex-isautoadvance--false","title":"playTrack(index, isAutoAdvance = false)","text":"<p>Purpose: Primary function to start playback of a track. Coordinates all managers to load and play audio.</p> <p>Parameters:</p> <ul> <li><code>index</code> - Track index to play</li> <li><code>isAutoAdvance</code> - (Optional) True if this is an automatic track transition (not user-initiated)</li> </ul> <p>Behavior:</p> <ul> <li>Routes to Chromecast if casting</li> <li>Uses <code>PlaybackManager</code> to load track with quality settings</li> <li>Uses <code>UISyncManager</code> to update UI</li> <li>Uses <code>AutoAdvanceManager</code> for playback strategy</li> <li>Prefetches next track for smooth transitions</li> </ul> <p>Implementation:</p> <pre><code>const playTrack = (index, isAutoAdvance = false) =&gt; {\n    if (checkCastingState()) {\n        castJumpToTrack(index);\n        uiManager.updateUIForTrack(index);\n        playbackManager.setCurrentIndex(index);\n        return;\n    }\n\n    const track = trackItems[index];\n\n    // Load track via PlaybackManager\n    playbackManager.loadTrack(index, track.dataset.path, null);\n\n    // Update UI via UISyncManager\n    uiManager.updateUIForTrack(index);\n\n    // Update Media Session\n    const metadata = extractMetadataFromDOM(track);\n    updateLocalMediaSession(metadata);\n\n    // Use appropriate playback strategy via AutoAdvanceManager\n    if (isAutoAdvance) {\n        autoAdvanceManager.attemptAutoAdvancePlay();\n    } else {\n        autoAdvanceManager.attemptStandardPlay();\n    }\n\n    // Prefetch next track\n    prefetchNextTrack(index);\n};\n</code></pre> <p>Auto-Advance Strategy:</p> <p>When a track ends naturally on mobile devices, browsers may block auto-playing. The <code>AutoAdvanceManager</code> handles this with retry logic:</p> <ol> <li>Immediate play attempt</li> <li>Update Media Session state if blocked</li> <li>Retry attempts with delays: 50ms, 100ms, 200ms</li> <li>Media Session fallback - Keeps controls active for user</li> </ol> <p>Error Handling:</p> <ul> <li>Retries up to 3 times automatically with exponential backoff</li> <li>Shows non-blocking error toast</li> <li>Provides \"Skip Track\" action button</li> <li>Saves state before handling error</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#-playback-modes","title":"\ud83c\udfb5 Playback Modes","text":""},{"location":"development/audio-playback/frontend/player-controls.html#shuffle-mode","title":"Shuffle Mode","text":"<p>Purpose: Randomize playback order</p> <p>Implementation via QueueManager:</p> <pre><code>// Toggle shuffle\nconst toggleShuffle = () =&gt; {\n    queueManager.toggleShuffle();\n    updateShuffleButton();\n};\n</code></pre> <p>Key Features:</p> <ul> <li>Fisher-Yates shuffle algorithm</li> <li>Preserves current track position</li> <li>Persistent across sessions</li> <li>Works seamlessly with repeat modes</li> </ul> <p>Shuffle Order Generation:</p> <p>The <code>QueueManager</code> uses Fisher-Yates algorithm for true random shuffle:</p> <pre><code>// Inside QueueManager\n_generateShuffleOrder() {\n    const order = Array.from({ length: this.trackCount }, (_, i) =&gt; i);\n\n    for (let i = order.length - 1; i &gt; 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [order[i], order[j]] = [order[j], order[i]];\n    }\n\n    return order;\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#repeat-mode","title":"Repeat Mode","text":"<p>Purpose: Control playlist looping behavior</p> <p>Modes:</p> <ul> <li>\ud83d\udd01 Repeat Off - Play once, stop at end</li> <li>\ud83d\udd01 Repeat All - Loop entire playlist</li> <li>\ud83d\udd01\u2081 Repeat One - Loop current track</li> </ul> <p>Implementation via QueueManager:</p> <pre><code>// Cycle through repeat modes\nconst cycleRepeatMode = () =&gt; {\n    queueManager.cycleRepeatMode();\n    updateRepeatButton();\n};\n</code></pre> <p>Context Normalization:</p> <p>The <code>QueueManager</code> automatically normalizes repeat mode based on context:</p> <pre><code>// Inside QueueManager\n_normalizeRepeatMode(mode) {\n    // Force OFF when 0-1 tracks (repeat doesn't make sense)\n    if (this.trackCount &lt;= 1) {\n        return REPEAT_MODES.OFF;\n    }\n    return mode;\n}\n</code></pre> <p>Next Track Logic:</p> <pre><code>// QueueManager handles all navigation logic\nconst nextIndex = queueManager.getNextTrack(currentIndex, {\n    skipRepeatOne: false  // For prefetch, set to true\n});\n</code></pre> <p>Key Features:</p> <ul> <li>\u2705 Centralized constants for modes</li> <li>\u2705 Data-driven button updates</li> <li>\u2705 Defensive programming with validation</li> <li>\u2705 Context-aware restoration</li> <li>\u2705 Persistent across sessions via <code>QueueManager</code></li> <li>\u2705 Works seamlessly with shuffle</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#-wake-lock-management","title":"\ud83d\udd12 Wake Lock Management","text":"<p>Purpose: Prevent app suspension during playback, especially when phone is locked</p>"},{"location":"development/audio-playback/frontend/player-controls.html#why-wake-lock-is-critical","title":"Why Wake Lock is Critical","text":"<p>Mobile devices aggressively suspend background apps to save battery. Without wake lock:</p> <ul> <li>JavaScript execution may pause when screen locks</li> <li>Auto-advance to next track fails</li> <li>Media notifications disappear</li> <li>Playback interrupts unexpectedly</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#implementation-via-wakelockmanager","title":"Implementation via WakeLockManager","text":"<p>The <code>WakeLockManager</code> encapsulates all wake lock logic:</p> <pre><code>// Acquire wake lock\nplayer.addEventListener('play', () =&gt; {\n    wakeLockManager.acquire();\n});\n\n// Release wake lock (only when truly paused, not during transitions)\nplayer.addEventListener('pause', () =&gt; {\n    if (!autoAdvanceManager.isTransitioningTracks()) {\n        wakeLockManager.release();\n    }\n});\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#wake-lock-lifecycle","title":"Wake Lock Lifecycle","text":"<p>Acquire when:</p> <ul> <li>Playback starts (<code>play</code> event)</li> <li>App is backgrounded while playing (<code>visibilitychange</code>)</li> </ul> <p>Release when:</p> <ul> <li>Playback is explicitly paused by user</li> <li>Playlist completes entirely</li> </ul> <p>NOT released when:</p> <ul> <li>Auto-advancing between tracks</li> <li>Quality changes mid-playback</li> <li>Track fails and retries</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#visibility-change-handling","title":"Visibility Change Handling","text":"<pre><code>document.addEventListener('visibilitychange', () =&gt; {\n    if (document.hidden) {\n        if (player &amp;&amp; !player.paused &amp;&amp; !checkCastingState()) {\n            wakeLockManager.acquire();\n\n            // Reinforce Media Session state\n            if ('mediaSession' in navigator) {\n                navigator.mediaSession.playbackState = 'playing';\n            }\n        }\n    }\n});\n</code></pre> <p>Key Behaviors:</p> <ul> <li>\u2705 Requires HTTPS (secure context)</li> <li>\u2705 Gracefully degrades if unavailable</li> <li>\u2705 Automatically re-requested if system releases it</li> <li>\u2705 Essential for locked-screen playback</li> <li>\u2705 Works with both Android and iOS (iOS 16.4+)</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#-track-auto-advance","title":"\ud83d\udd04 Track Auto-Advance","text":""},{"location":"development/audio-playback/frontend/player-controls.html#overview","title":"Overview","text":"<p>Auto-advance ensures seamless transitions between tracks. This is challenging on mobile devices due to autoplay restrictions, which is why the <code>AutoAdvanceManager</code> uses sophisticated retry logic.</p>"},{"location":"development/audio-playback/frontend/player-controls.html#ended-event-handler","title":"'ended' Event Handler","text":"<pre><code>player.addEventListener('ended', () =&gt; {\n    syncPlayIcons();\n    const currentIndex = playbackManager.getCurrentIndex();\n    const trackTitle = trackItems[currentIndex]?.dataset.title;\n\n    if (!checkCastingState()) {\n        // Save completion state via StateManager\n        playbackManager.saveCurrentState(trackTitle);\n\n        // Get next track via QueueManager\n        const nextIndex = queueManager.getNextTrack(currentIndex);\n\n        if (nextIndex &gt;= 0 &amp;&amp; nextIndex &lt; trackItems.length) {\n            // CRITICAL: Pass isAutoAdvance=true\n            playTrack(nextIndex, true);\n\n            // WakeLockManager keeps lock active during transition\n        } else {\n            stateManager.clearPlaybackState();\n            wakeLockManager.release(); // Playlist finished\n        }\n    }\n});\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#mobile-auto-advance-strategy","title":"Mobile Auto-Advance Strategy","text":"<p>Problem: Mobile browsers block automatic playback after track ends</p> <p>Solution: Multi-layered approach via <code>AutoAdvanceManager</code></p> <ol> <li>Flag auto-advance - <code>playTrack(nextIndex, true)</code> enables special handling</li> <li>Immediate attempt - Try standard <code>player.play()</code></li> <li>Media Session update - If blocked, update Media Session state</li> <li>Delayed retries - Wait and try again (50ms, 100ms, 200ms)</li> <li>Notification controls - User can resume from lock screen if needed</li> </ol>"},{"location":"development/audio-playback/frontend/player-controls.html#key-behaviors","title":"Key Behaviors","text":"<p>\u2705 Wake lock maintained - <code>WakeLockManager</code> keeps lock during transitions \u2705 Respects repeat modes - <code>QueueManager</code> handles All/One/Off \u2705 Respects shuffle - Uses shuffle order if enabled \u2705 Prefetch ready - Next track likely already cached \u2705 State saved - <code>StateManager</code> saves position before advancing \u2705 Works offline - Service worker serves cached audio</p>"},{"location":"development/audio-playback/frontend/player-controls.html#browser-compatibility","title":"Browser Compatibility","text":"Platform Auto-Advance Notes Android Chrome \u2705 Full support Wake lock + Media Session Android Firefox \u2705 Full support Media Session fallback iOS Safari 15+ \u2705 Full support Media Session supported iOS Safari &lt;15 \u26a0\ufe0f Limited May require user action Desktop Chrome \u2705 Full support No restrictions Desktop Firefox \u2705 Full support No restrictions Desktop Safari \u2705 Full support No restrictions"},{"location":"development/audio-playback/frontend/player-controls.html#-constants--configuration","title":"\ud83d\udcca Constants &amp; Configuration","text":""},{"location":"development/audio-playback/frontend/player-controls.html#timing-constants","title":"Timing Constants","text":"<pre><code>// In playbackManager.js\nconst TIMING = {\n    AUTO_SAVE_INTERVAL: 5000,      // Save playback position every 5s\n    PLAYBACK_RESUME_DELAY: 50      // Delay before resuming after restoration\n};\n\n// In uiSyncManager.js\nconst TIMING = {\n    UI_RESTORE_DELAY: 500,          // Delay before scrolling to restored track\n    HIGHLIGHT_DURATION: 3000        // Track highlight duration\n};\n\n// In autoAdvanceManager.js\nconst AUTO_ADVANCE_TIMING = {\n    RETRY_DELAY_1: 50,              // First retry delay\n    RETRY_DELAY_2: 100,             // Second retry delay\n    RETRY_DELAY_3: 200,             // Third retry delay\n    MAX_RETRIES: 3                  // Maximum retry attempts\n};\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#quality-levels-qualitymanager","title":"Quality Levels (QualityManager)","text":"<pre><code>const QUALITY_LEVELS = {\n    high: { label: 'High (256k)', bandwidth: 'high' },\n    medium: { label: 'Medium (192k)', bandwidth: 'medium' },\n    low: { label: 'Low (128k)', bandwidth: 'low' },\n    original: { label: 'Original', bandwidth: 'highest' }\n};\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#repeat-mode-constants-queuemanager","title":"Repeat Mode Constants (QueueManager)","text":"<pre><code>const REPEAT_MODES = {\n    OFF: 'off',\n    ALL: 'all',\n    ONE: 'one'\n};\n\nconst REPEAT_MODE_LABELS = {\n    [REPEAT_MODES.OFF]: 'Repeat Off',\n    [REPEAT_MODES.ALL]: 'Repeat All',\n    [REPEAT_MODES.ONE]: 'Repeat One'\n};\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#-troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"development/audio-playback/frontend/player-controls.html#playback-issues","title":"Playback Issues","text":"<p>Problem: Track won't play</p> <ul> <li>Check console for error messages</li> <li>Verify audio URL is valid (check <code>QualityManager</code>)</li> <li>Check network connectivity</li> <li>Try different quality setting</li> <li>Error toast will show with \"Skip Track\" option</li> </ul> <p>Problem: Position not restored</p> <ul> <li>Check if saved state exists (<code>StateManager</code>)</li> <li>Verify state timestamp is within 24 hours</li> <li>Check console for restoration logs</li> <li>State saves correctly when paused</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#shufflerepeat-issues","title":"Shuffle/Repeat Issues","text":"<p>Problem: Repeat mode not working with 1 track</p> <ul> <li>By design: <code>QueueManager</code> normalizes to OFF for 0-1 tracks</li> <li>Check console for normalization log</li> </ul> <p>Problem: Prefetch not respecting modes</p> <ul> <li><code>QueueManager</code> handles this with <code>skipRepeatOne</code> option</li> <li>Check console for prefetch logs showing correct mode</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#mobile-auto-advance-issues","title":"Mobile Auto-Advance Issues","text":"<p>Problem: Playback stops after each track on mobile</p> <ul> <li>Check <code>AutoAdvanceManager</code> retry logs in console</li> <li>Verify wake lock is acquired (look for \"\ud83d\udd12 Wake lock acquired\")</li> <li>Ensure HTTPS is used (wake lock requires secure context)</li> <li>Check for \"\ud83d\udcf1 Auto-advance mode\" logs</li> </ul> <p>Problem: Auto-advance works with screen on, fails when locked</p> <ul> <li>Check <code>WakeLockManager</code> status in console</li> <li>Verify Media Session is being set up correctly</li> <li>On iOS, requires iOS 15+ for Media Session support</li> <li>On Android, should work on Android 5.0+</li> </ul> <p>Problem: Browser shows \"Autoplay prevented\" errors</p> <ul> <li>This is expected - <code>AutoAdvanceManager</code> handles this gracefully</li> <li>Look for follow-up \"Retry attempt\" logs</li> <li>Media Session API provides fallback</li> <li>User can use notification controls to resume</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#wake-lock-issues","title":"Wake Lock Issues","text":"<p>Problem: Wake lock not acquired</p> <ul> <li>Requires HTTPS (secure context)</li> <li>Check browser support: Chrome 84+, Safari 16.4+, Firefox not supported</li> <li>Check console for wake lock warnings via <code>WakeLockManager</code></li> <li>Gracefully degrades if unavailable</li> </ul> <p>Problem: Playback suspends when screen locks</p> <ul> <li>Verify wake lock acquired before locking screen</li> <li>Check for \"Page hidden\" log when screen locks</li> <li>Media Session should be reinforced on visibility change</li> <li>May still require user interaction on first lock (browser policy)</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#-performance-considerations","title":"\ud83d\udcc8 Performance Considerations","text":""},{"location":"development/audio-playback/frontend/player-controls.html#optimizations","title":"Optimizations","text":"<ol> <li>Prefetch Strategy</li> <li>Uses <code>requestIdleCallback</code> for low-priority</li> <li>Checks cache before fetching</li> <li> <p>Only prefetches actual next track via <code>QueueManager</code></p> </li> <li> <p>State Persistence</p> </li> <li>Auto-save throttled to every 5s via <code>PlaybackManager</code></li> <li>Try-catch around localStorage calls in <code>StateManager</code></li> <li> <p>Validates data before saving</p> </li> <li> <p>UI Updates</p> </li> <li>Debounced position updates (1s) via <code>UISyncManager</code></li> <li>Minimal DOM manipulation</li> <li> <p>Event delegation where possible</p> </li> <li> <p>Memory Management</p> </li> <li>Guard flags prevent duplicate listeners</li> <li>Timeouts properly cleared</li> <li> <p>Managers are lightweight and focused</p> </li> <li> <p>Power Management</p> </li> <li>Wake lock only during active playback via <code>WakeLockManager</code></li> <li>Released immediately when paused</li> <li>Automatically re-acquired if system releases it</li> <li>Not held during casting (Chromecast handles this)</li> </ol>"},{"location":"development/audio-playback/frontend/player-controls.html#-security-considerations","title":"\ud83d\udd10 Security Considerations","text":""},{"location":"development/audio-playback/frontend/player-controls.html#xss-prevention","title":"XSS Prevention","text":"<ul> <li>\u2705 No innerHTML usage - <code>UISyncManager</code> uses <code>textContent</code> or DOM creation</li> <li>\u2705 Safe DOM manipulation - createElement + appendChild pattern</li> <li>\u2705 Input validation - All user inputs validated</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#storage-safety","title":"Storage Safety","text":"<p>All managers handle storage errors gracefully:</p> <pre><code>// Example from StateManager\ntry {\n    localStorage.setItem(key, value);\n} catch (e) {\n    console.warn('Storage failed:', e);\n    // Graceful degradation\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-controls.html#-summary","title":"\ud83d\udcdd Summary","text":""},{"location":"development/audio-playback/frontend/player-controls.html#key-features","title":"Key Features","text":"<ul> <li>Modular Architecture - 8 focused managers, each under 310 lines</li> <li>Unified Playback Control across local, Chromecast, and Android Auto</li> <li>Shuffle &amp; Repeat Modes via <code>QueueManager</code> with persistent state</li> <li>Quality Management via <code>QualityManager</code> with seamless switching</li> <li>State Persistence via <code>StateManager</code> - Resume playback across sessions</li> <li>Error Recovery - Automatic retries with user actions</li> <li>Prefetch Intelligence - Respects all playback modes</li> <li>Wake Lock Support via <code>WakeLockManager</code> - Prevents app suspension</li> <li>Mobile Auto-Advance via <code>AutoAdvanceManager</code> - Reliable track transitions</li> <li>Memory Safe - No leaks, proper cleanup</li> <li>XSS Protected - Safe DOM manipulation throughout</li> <li>Testable - Each manager independently testable</li> </ul>"},{"location":"development/audio-playback/frontend/player-controls.html#module-summary","title":"Module Summary","text":"Module Lines Purpose playerControls.js 1,000 Main orchestrator queueManager.js 306 Shuffle &amp; repeat playbackManager.js 192 Core playback uiSyncManager.js 178 UI updates autoAdvanceManager.js 137 Auto-advance qualityManager.js 93 Quality selection stateManager.js 88 State persistence wakeLockManager.js 75 Wake lock <p>Status: Production Ready Dependencies: Bootstrap 5, Chromecast SDK, Media Session API, Wake Lock API (optional)</p>"},{"location":"development/audio-playback/frontend/player-utilities.html","title":"Player Utilities","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#player-utilities","title":"Player Utilities","text":"<p>The <code>playerUtils.js</code> module provides cross-cutting utilities for platform detection, Media Session management, player state control, and metadata extraction. It serves as a shared foundation for all player modules, enabling platform-specific optimizations and consistent behavior across different devices.</p>"},{"location":"development/audio-playback/frontend/player-utilities.html#-purpose","title":"\ud83c\udfaf Purpose","text":"<p>Core Responsibilities:</p> <ul> <li>Detect iOS, Android, and Android Auto platforms</li> <li>Manage Media Session API (standard and enhanced)</li> <li>Control local player state (silence/enable)</li> <li>Extract and optimize track metadata</li> <li>Provide platform-specific artwork sizing</li> <li>Log device capabilities for debugging</li> </ul> <p>Design Philosophy: Centralize common utilities to avoid duplication and ensure consistent platform handling across playerControls, chromecast, and androidAuto modules.</p>"},{"location":"development/audio-playback/frontend/player-utilities.html#-architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#module-structure","title":"Module Structure","text":"<pre><code>graph TB\n    PlayerUtils[playerUtils.js]\n\n    Detection[Platform Detection]\n    MediaSession[Media Session Management]\n    PlayerControl[Player State Control]\n    Metadata[Metadata Extraction]\n\n    PlayerUtils --&gt; Detection\n    PlayerUtils --&gt; MediaSession\n    PlayerUtils --&gt; PlayerControl\n    PlayerUtils --&gt; Metadata\n\n    Detection --&gt; iOS[detectiOS]\n    Detection --&gt; Android[detectAndroid]\n    Detection --&gt; Log[logDeviceInfo]\n\n    MediaSession --&gt; Setup[setupLocalMediaSession]\n    MediaSession --&gt; Clear[clearMediaSession]\n    MediaSession --&gt; UpdateState[updateMediaSessionPlaybackState]\n    MediaSession --&gt; UpdatePos[updateMediaSessionPosition]\n\n    PlayerControl --&gt; Silence[silenceLocalPlayer]\n    PlayerControl --&gt; Enable[enableLocalPlayer]\n\n    Metadata --&gt; Extract[extractMetadataFromDOM]\n    Metadata --&gt; MIME[getMimeTypeFromUrl]\n\n    style PlayerUtils fill:#4a6fa5,color:#fff\n    style Detection fill:#c65d5d,color:#fff\n    style MediaSession fill:#4a8c5f,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/frontend/player-utilities.html#used-by","title":"Used By","text":"<pre><code>graph LR\n    PlayerUtils[playerUtils.js]\n\n    PlayerControls[playerControls.js]\n    Chromecast[chromecast.js]\n    AndroidAuto[androidAuto.js]\n\n    PlayerControls --&gt; PlayerUtils\n    Chromecast --&gt; PlayerUtils\n    AndroidAuto --&gt; PlayerUtils\n\n    style PlayerUtils fill:#4a6fa5,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/frontend/player-utilities.html#-platform-detection","title":"\ud83d\udcf1 Platform Detection","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#detectios","title":"detectiOS()","text":"<p>Purpose: Detect iOS device and extract version information</p> <p>Returns: Object or <code>null</code></p> <pre><code>export function detectiOS() {\n    const ua = navigator.userAgent;\n    const isIOS = /iPad|iPhone|iPod/.test(ua) &amp;&amp; !window.MSStream;\n\n    if (!isIOS) return null;\n\n    // Extract iOS version\n    const match = ua.match(/OS (\\d+)_(\\d+)/);\n    const major = match ? parseInt(match[1], 10) : 0;\n    const minor = match ? parseInt(match[2], 10) : 0;\n\n    return {\n        isIOS: true,\n        version: major,\n        versionString: `${major}.${minor}`,\n        supportsMediaSession: major &gt;= 15,\n        isPWA: window.navigator.standalone === true ||\n               window.matchMedia('(display-mode: standalone)').matches\n    };\n}\n</code></pre> <p>Return value when iOS detected:</p> <pre><code>{\n    isIOS: true,\n    version: 17,                    // Major version number\n    versionString: \"17.2\",          // Full version string\n    supportsMediaSession: true,     // iOS 15+ supports Media Session API\n    isPWA: false                    // Whether running as installed PWA\n}\n</code></pre> <p>Return value when not iOS:</p> <pre><code>null\n</code></pre> <p>Key features:</p> <ul> <li>User agent parsing: Extracts iOS version from UA string</li> <li>Media Session support check: iOS 15+ required</li> <li>PWA detection: Multiple methods (standalone + display-mode)</li> <li>Excludes Windows Phone: <code>!window.MSStream</code> check</li> </ul> <p>User agent patterns matched:</p> <pre><code>Mozilla/5.0 (iPhone; CPU iPhone OS 17_2 like Mac OS X)...\nMozilla/5.0 (iPad; CPU OS 16_5 like Mac OS X)...\nMozilla/5.0 (iPod touch; CPU iPhone OS 15_0 like Mac OS X)...\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#detectandroid","title":"detectAndroid()","text":"<p>Purpose: Detect Android device, version, and Android Auto connection</p> <p>Returns: Object or <code>null</code></p> <pre><code>export function detectAndroid() {\n    const ua = navigator.userAgent;\n    const isAndroid = /android/i.test(ua);\n\n    if (!isAndroid) return null;\n\n    // Extract Android version\n    const match = ua.match(/Android (\\d+)\\.?(\\d+)?/);\n    const major = match ? parseInt(match[1], 10) : 0;\n    const minor = match ? parseInt(match[2], 10) : 0;\n\n    // Check for Android Auto indicators\n    const isAndroidAuto = ua.toLowerCase().includes('vehicle') ||\n                         ua.toLowerCase().includes('automotive');\n\n    return {\n        isAndroid: true,\n        version: major,\n        versionString: `${major}.${minor}`,\n        supportsMediaSession: major &gt;= 5,  // Android 5.0+\n        isAndroidAuto: isAndroidAuto,\n        isPWA: window.matchMedia('(display-mode: standalone)').matches\n    };\n}\n</code></pre> <p>Return value when Android detected:</p> <pre><code>{\n    isAndroid: true,\n    version: 13,                    // Major version number\n    versionString: \"13.0\",          // Full version string\n    supportsMediaSession: true,     // Android 5.0+ supports Media Session\n    isAndroidAuto: false,           // Whether Android Auto is connected\n    isPWA: false                    // Whether running as installed PWA\n}\n</code></pre> <p>Android Auto detection:</p> <p>User agent contains \"vehicle\" or \"automotive\":</p> <pre><code>Mozilla/5.0 (Linux; Android 13; automotive) AppleWebKit/537.36...\n</code></pre> <p>Key features:</p> <ul> <li>Version extraction: Parses major and minor version</li> <li>Media Session check: Android 5.0+ (Lollipop) required</li> <li>Android Auto detection: User agent keywords</li> <li>PWA detection: Display mode check</li> </ul>"},{"location":"development/audio-playback/frontend/player-utilities.html#logdeviceinfo","title":"logDeviceInfo()","text":"<p>Purpose: Log comprehensive device and feature support information</p> <p>Returns: <code>void</code></p> <p>Console output examples:</p> <p>iOS Device:</p> <pre><code>\ud83d\udcf1 iOS Device Detected\n   Version: iOS 17.2\n   PWA Mode: Yes\n   Media Session: Supported \u2705\n   Media Session API: Available \u2705\n   Cast API: Not Available \u274c\n</code></pre> <p>Android Device (Android Auto):</p> <pre><code>\ud83e\udd16 Android Device Detected\n   Version: Android 13.0\n   PWA Mode: No\n   Android Auto: Connected \u2705\n   Media Session: Supported \u2705\n   Media Session API: Available \u2705\n   Cast API: Available \u2705\n</code></pre> <p>Desktop:</p> <pre><code>\ud83d\udcbb Desktop/Other Device\n   Media Session API: Available \u2705\n   Cast API: Available \u2705\n</code></pre> <p>Usage:</p> <pre><code>// Called during playerControls initialization\nlogDeviceInfo();\n</code></pre> <p>Checks:</p> <ul> <li>Platform type (iOS, Android, Desktop)</li> <li>OS version</li> <li>PWA status</li> <li>Android Auto connection</li> <li>Media Session API availability</li> <li>Cast API availability</li> </ul>"},{"location":"development/audio-playback/frontend/player-utilities.html#-media-session-management","title":"\ud83c\udfb5 Media Session Management","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#setuplocalmediasessionmetadata-playercontrols","title":"setupLocalMediaSession(metadata, playerControls)","text":"<p>Purpose: Configure standard Media Session for iOS and Desktop</p> <p>Parameters:</p> <ul> <li><code>metadata</code> (object) - Track metadata</li> </ul> <pre><code>{\n    title: \"Song Title\",\n    artist: \"Artist Name\",\n    album: \"Album Name\",\n    artwork: [\n        { src: \"/covers/slug_192x192.jpg\", sizes: \"192x192\", type: \"image/jpeg\" },\n        { src: \"/covers/slug_512x512.jpg\", sizes: \"512x512\", type: \"image/jpeg\" }\n    ]\n}\n</code></pre> <ul> <li><code>playerControls</code> (object) - Control API with <code>play()</code>, <code>pause()</code>, <code>next()</code>, <code>previous()</code></li> </ul> <p>Implementation:</p> <pre><code>export function setupLocalMediaSession(metadata, playerControls) {\n    if (!('mediaSession' in navigator)) return;\n\n    try {\n        navigator.mediaSession.metadata = new MediaMetadata({\n            title: metadata.title,\n            artist: metadata.artist,\n            album: metadata.album,\n            artwork: metadata.artwork\n        });\n\n        navigator.mediaSession.setActionHandler('play', () =&gt; {\n            playerControls.play();\n        });\n\n        navigator.mediaSession.setActionHandler('pause', () =&gt; {\n            playerControls.pause();\n        });\n\n        navigator.mediaSession.setActionHandler('previoustrack', () =&gt; {\n            playerControls.previous();\n        });\n\n        navigator.mediaSession.setActionHandler('nexttrack', () =&gt; {\n            playerControls.next();\n        });\n\n        // Basic seeking support\n        navigator.mediaSession.setActionHandler('seekto', (details) =&gt; {\n            if (details.seekTime !== undefined) {\n                const player = document.getElementById('main-player');\n                if (player) {\n                    player.currentTime = details.seekTime;\n                }\n            }\n        });\n    } catch (error) {\n        console.warn('Error updating Media Session:', error);\n    }\n}\n</code></pre> <p>Features:</p> <ul> <li>Sets track metadata (title, artist, album, artwork)</li> <li>Configures 5 action handlers (play, pause, previous, next, seekto)</li> <li>Routes all actions to playerControls API</li> <li>Graceful error handling</li> </ul> <p>Difference from Android Auto:</p> <ul> <li>Simpler setup (no position state)</li> <li>Fewer artwork sizes (2 vs 5)</li> <li>No position update interval</li> <li>No audio event listeners</li> </ul>"},{"location":"development/audio-playback/frontend/player-utilities.html#clearmediasession","title":"clearMediaSession()","text":"<p>Purpose: Completely remove all Media Session state and handlers</p> <p>Returns: <code>void</code></p> <p>Implementation:</p> <pre><code>export function clearMediaSession() {\n    if (!('mediaSession' in navigator)) return;\n\n    try {\n        // CRITICAL: Set state to 'none' FIRST\n        navigator.mediaSession.playbackState = 'none';\n\n        // Clear metadata\n        navigator.mediaSession.metadata = null;\n\n        // Remove ALL action handlers\n        const actions = [\n            'play', 'pause', 'stop',\n            'previoustrack', 'nexttrack',\n            'seekbackward', 'seekforward',\n            'seekto'\n        ];\n\n        actions.forEach(action =&gt; {\n            try {\n                navigator.mediaSession.setActionHandler(action, null);\n            } catch (e) {\n                // Action may not be supported, that's fine\n            }\n        });\n\n        // Try to clear position state\n        try {\n            navigator.mediaSession.setPositionState(null);\n        } catch (e) {\n            // May not be supported\n        }\n    } catch (error) {\n        console.warn('Error clearing Media Session:', error);\n    }\n}\n</code></pre> <p>Why set playbackState to 'none' first?</p> <ul> <li>Prevents brief flash of stale metadata in lock screen</li> <li>Signals to OS that media is truly stopped</li> <li>Required before clearing metadata</li> </ul> <p>When called:</p> <ul> <li>User stops playback</li> <li>Chromecast session starts (local session must clear)</li> <li>Switching between playback modes</li> </ul>"},{"location":"development/audio-playback/frontend/player-utilities.html#updatemediasessionplaybackstatestate","title":"updateMediaSessionPlaybackState(state)","text":"<p>Purpose: Update only the playback state without changing metadata</p> <p>Parameters:</p> <ul> <li><code>state</code> (string) - One of: <code>'none'</code>, <code>'paused'</code>, <code>'playing'</code></li> </ul> <p>Implementation:</p> <pre><code>export function updateMediaSessionPlaybackState(state) {\n    if (!('mediaSession' in navigator)) return;\n\n    try {\n        navigator.mediaSession.playbackState = state;\n    } catch (e) {\n        console.warn('Error updating playback state:', e);\n    }\n}\n</code></pre> <p>Usage:</p> <pre><code>// Audio element events\nplayer.addEventListener('play', () =&gt; {\n    updateMediaSessionPlaybackState('playing');\n});\n\nplayer.addEventListener('pause', () =&gt; {\n    updateMediaSessionPlaybackState('paused');\n});\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#updatemediasessionpositioncurrenttime-duration-playbackrate","title":"updateMediaSessionPosition(currentTime, duration, playbackRate)","text":"<p>Purpose: Update position state for seeking and progress display</p> <p>Parameters:</p> <ul> <li><code>currentTime</code> (number) - Current playback position in seconds</li> <li><code>duration</code> (number) - Total track duration in seconds</li> <li><code>playbackRate</code> (number) - Playback speed (default: 1.0)</li> </ul> <p>Implementation:</p> <pre><code>export function updateMediaSessionPosition(currentTime, duration, playbackRate = 1.0) {\n    if (!('mediaSession' in navigator) ||\n        !('setPositionState' in navigator.mediaSession)) return;\n\n    if (duration &amp;&amp; !isNaN(duration) &amp;&amp; isFinite(duration) &amp;&amp; duration &gt; 0) {\n        try {\n            navigator.mediaSession.setPositionState({\n                duration: duration,\n                playbackRate: playbackRate,\n                position: Math.min(currentTime, duration)\n            });\n        } catch (error) {\n            console.debug('Could not set position state:', error);\n        }\n    }\n}\n</code></pre> <p>Validation:</p> <ul> <li>Checks <code>duration</code> is valid number</li> <li>Ensures <code>position</code> doesn't exceed <code>duration</code></li> <li>Silently fails if API not available</li> </ul> <p>Called by:</p> <ul> <li><code>playerControls.js</code> on audio events (loadedmetadata, timeupdate, seeked)</li> <li><code>androidAuto.js</code> for enhanced position tracking</li> </ul>"},{"location":"development/audio-playback/frontend/player-utilities.html#-player-state-control","title":"\ud83c\udf9b\ufe0f Player State Control","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#silencelocalplayer","title":"silenceLocalPlayer()","text":"<p>Purpose: Completely disable local player when casting starts</p> <p>Returns: <code>void</code></p> <p>Implementation:</p> <pre><code>export function silenceLocalPlayer() {\n    const player = document.getElementById('main-player');\n    if (!player) return;\n\n    // Pause and clear source\n    player.pause();\n    player.src = '';\n    player.load();\n\n    // Remove ALL player attributes that could trigger Media Session\n    player.removeAttribute('controls');\n    player.removeAttribute('autoplay');\n\n    // Set volume to 0 as extra safety\n    player.volume = 0;\n    player.muted = true;\n\n    // Remove from tab order\n    player.setAttribute('tabindex', '-1');\n}\n</code></pre> <p>Why so aggressive?</p> <p>When Chromecast is active, the local player must be completely silenced to prevent:</p> <ul> <li>Duplicate audio playback</li> <li>Conflicting Media Session controls</li> <li>Battery drain from background audio processing</li> <li>UI confusion (two sets of media controls)</li> </ul> <p>What gets disabled:</p> <ol> <li>Playback: Pause and clear source</li> <li>UI controls: Remove <code>controls</code> attribute</li> <li>Auto-play: Remove <code>autoplay</code> attribute</li> <li>Audio: Volume to 0 and mute</li> <li>Keyboard navigation: Tab order removed</li> </ol>"},{"location":"development/audio-playback/frontend/player-utilities.html#enablelocalplayer","title":"enableLocalPlayer()","text":"<p>Purpose: Restore local player when casting ends</p> <p>Returns: <code>void</code></p> <p>Implementation:</p> <pre><code>export function enableLocalPlayer() {\n    const player = document.getElementById('main-player');\n    if (!player) return;\n\n    // Restore controls\n    player.setAttribute('controls', '');\n\n    // Restore volume and unmute\n    player.volume = 1.0;\n    player.muted = false;\n\n    // Restore to tab order\n    player.removeAttribute('tabindex');\n}\n</code></pre> <p>Restoration:</p> <ol> <li>UI controls: Add back <code>controls</code> attribute</li> <li>Audio: Full volume and unmute</li> <li>Keyboard navigation: Back in tab order</li> </ol> <p>Note: Does NOT restore <code>src</code> - that happens when user plays next track</p>"},{"location":"development/audio-playback/frontend/player-utilities.html#-metadata-extraction","title":"\ud83c\udfa8 Metadata Extraction","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#extractmetadatafromdomtrackelement","title":"extractMetadataFromDOM(trackElement)","text":"<p>Purpose: Extract track metadata with platform-optimized artwork</p> <p>Parameters:</p> <ul> <li><code>trackElement</code> (HTMLElement) - Track list item containing data attributes and cover image</li> </ul> <p>Returns: Metadata object</p> <p>Implementation:</p> <pre><code>export function extractMetadataFromDOM(trackElement) {\n    const iOS = detectiOS();\n    const android = detectAndroid();\n    const coverImg = trackElement.querySelector('.track-cover');\n    let artwork = [];\n\n    if (coverImg &amp;&amp; coverImg.src) {\n        const mimeType = getMimeTypeFromUrl(coverImg.src);\n\n        // Parse cover URL to extract slug\n        const coverUrl = new URL(coverImg.src, window.location.origin);\n        const coverPath = coverUrl.pathname;\n        const slug = coverPath.split('/').pop()\n                              .replace('.jpg', '')\n                              .replace(/_\\d+x\\d+$/, '');\n\n        // Build size-optimized artwork URLs\n        if (iOS) {\n            // iOS optimization - prefers larger sizes for lock screen\n            artwork = [\n                {\n                    src: `/covers/${slug}_512x512.jpg`,\n                    sizes: '512x512',\n                    type: mimeType\n                },\n                {\n                    src: `/covers/${slug}_256x256.jpg`,\n                    sizes: '256x256',\n                    type: mimeType\n                },\n                {\n                    src: `/covers/${slug}_192x192.jpg`,\n                    sizes: '192x192',\n                    type: mimeType\n                }\n            ];\n        } else if (android &amp;&amp; android.isAndroidAuto) {\n            // Android Auto - requires full size spectrum\n            artwork = [\n                {\n                    src: `/covers/${slug}_96x96.jpg`,\n                    sizes: '96x96',\n                    type: mimeType\n                },\n                {\n                    src: `/covers/${slug}_128x128.jpg`,\n                    sizes: '128x128',\n                    type: mimeType\n                },\n                {\n                    src: `/covers/${slug}_192x192.jpg`,\n                    sizes: '192x192',\n                    type: mimeType\n                },\n                {\n                    src: `/covers/${slug}_256x256.jpg`,\n                    sizes: '256x256',\n                    type: mimeType\n                },\n                {\n                    src: `/covers/${slug}_512x512.jpg`,\n                    sizes: '512x512',\n                    type: mimeType\n                }\n            ];\n        } else {\n            // Desktop/other - simpler set\n            artwork = [\n                {\n                    src: `/covers/${slug}_192x192.jpg`,\n                    sizes: '192x192',\n                    type: mimeType\n                },\n                {\n                    src: `/covers/${slug}_512x512.jpg`,\n                    sizes: '512x512',\n                    type: mimeType\n                }\n            ];\n        }\n    }\n\n    return {\n        title: trackElement.dataset.title || 'Unknown',\n        artist: trackElement.dataset.artist || 'Unknown Artist',\n        album: trackElement.dataset.album || '',\n        artwork: artwork\n    };\n}\n</code></pre> <p>Platform-specific artwork optimization:</p> Platform Sizes Reasoning iOS 512, 256, 192 Lock screen prefers high resolution Android Auto 96, 128, 192, 256, 512 Dashboard requires full spectrum Desktop 192, 512 Simple set for browser controls <p>Slug extraction:</p> <pre><code>// Example: /covers/artist_album_192x192.jpg\nconst slug = \"artist_album_192x192\"\n              .replace('.jpg', '')        // \"artist_album_192x192\"\n              .replace(/_\\d+x\\d+$/, '');  // \"artist_album\"\n</code></pre> <p>Data attributes expected on trackElement:</p> <pre><code>&lt;div class=\"track-item\"\n     data-title=\"Song Title\"\n     data-artist=\"Artist Name\"\n     data-album=\"Album Name\"\n     data-path=\"artist/album/song.mp3\"&gt;\n    &lt;img class=\"track-cover\" src=\"/covers/artist_album_192x192.jpg\"&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#getmimetypefromurlurl","title":"getMimeTypeFromUrl(url)","text":"<p>Purpose: Determine MIME type from file extension</p> <p>Parameters:</p> <ul> <li><code>url</code> (string) - Image URL</li> </ul> <p>Returns: MIME type string</p> <p>Implementation:</p> <pre><code>export function getMimeTypeFromUrl(url) {\n    const extension = url.split('.').pop()\n                         .split('?')[0]    // Remove query params\n                         .toLowerCase();\n\n    const mimeMap = {\n        'jpg': 'image/jpeg',\n        'jpeg': 'image/jpeg',\n        'png': 'image/png',\n        'webp': 'image/webp',\n        'gif': 'image/gif',\n        'bmp': 'image/bmp',\n    };\n\n    return mimeMap[extension] || 'image/jpeg';\n}\n</code></pre> <p>Handles:</p> <ul> <li>Query parameters (e.g., <code>/covers/image.jpg?v=123</code>)</li> <li>Case insensitivity</li> <li>Fallback to <code>image/jpeg</code></li> </ul> <p>Examples:</p> <pre><code>getMimeTypeFromUrl('/covers/album.jpg')           // 'image/jpeg'\ngetMimeTypeFromUrl('/covers/album.PNG')           // 'image/png'\ngetMimeTypeFromUrl('/covers/album.webp?v=2')      // 'image/webp'\ngetMimeTypeFromUrl('/covers/album.unknown')       // 'image/jpeg' (fallback)\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#-integration-patterns","title":"\ud83d\udd04 Integration Patterns","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#with-playercontrolsjs","title":"With playerControls.js","text":"<pre><code>import {\n    detectiOS,\n    detectAndroid,\n    logDeviceInfo,\n    silenceLocalPlayer,\n    enableLocalPlayer,\n    clearMediaSession,\n    setupLocalMediaSession,\n    extractMetadataFromDOM\n} from './playerUtils.js';\n\n// During initialization\nconst iOS = detectiOS();\nconst androidInfo = detectAndroid();\nlogDeviceInfo();\n\n// When track starts\nconst metadata = extractMetadataFromDOM(trackElement);\nsetupLocalMediaSession(metadata, playerControlsAPI);\n\n// When casting starts\nsilenceLocalPlayer();\nclearMediaSession();\n\n// When casting ends\nenableLocalPlayer();\nconst metadata = extractMetadataFromDOM(currentTrackElement);\nsetupLocalMediaSession(metadata, playerControlsAPI);\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#with-androidautojs","title":"With androidAuto.js","text":"<pre><code>import { extractMetadataFromDOM } from './playerUtils.js';\n\n// Gets platform-optimized metadata\nconst metadata = extractMetadataFromDOM(trackElement);\n\n// Android Auto detected, so metadata.artwork contains 5 sizes\nsetupAndroidAutoMediaSession(metadata, playerControls, audioElement);\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#with-chromecastjs","title":"With chromecast.js","text":"<pre><code>import {\n    silenceLocalPlayer,\n    enableLocalPlayer,\n    clearMediaSession,\n    extractMetadataFromDOM\n} from './playerUtils.js';\n\nfunction onCastSessionStart() {\n    silenceLocalPlayer();\n    clearMediaSession();\n    // Now only Chromecast controls are active\n}\n\nfunction onCastSessionEnd() {\n    enableLocalPlayer();\n    // Restore local Media Session if track is playing\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#-testing-utilities","title":"\ud83e\uddea Testing Utilities","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#debug-logging","title":"Debug Logging","text":"<p>All detection functions log to console:</p> <pre><code>// Enable debug mode\nwindow.__PLAYER_UTILS_DEBUG__ = true;\n\n// Check detection\nconst iOS = detectiOS();\nconsole.log('iOS detection:', iOS);\n\nconst android = detectAndroid();\nconsole.log('Android detection:', android);\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#feature-detection","title":"Feature Detection","text":"<pre><code>// Check Media Session API\nif ('mediaSession' in navigator) {\n    console.log('\u2705 Media Session supported');\n\n    if ('setPositionState' in navigator.mediaSession) {\n        console.log('\u2705 Position state supported');\n    }\n}\n\n// Check Cast API\nif (typeof chrome !== 'undefined' &amp;&amp; chrome.cast) {\n    console.log('\u2705 Cast API available');\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#-api-reference","title":"\ud83d\udcca API Reference","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#exports","title":"Exports","text":"<pre><code>// Platform Detection\nexport function detectiOS()\nexport function detectAndroid()\nexport function logDeviceInfo()\n\n// Media Session Management\nexport function setupLocalMediaSession(metadata, playerControls)\nexport function clearMediaSession()\nexport function updateMediaSessionPlaybackState(state)\nexport function updateMediaSessionPosition(currentTime, duration, playbackRate)\n\n// Player Control\nexport function silenceLocalPlayer()\nexport function enableLocalPlayer()\n\n// Metadata Utilities\nexport function extractMetadataFromDOM(trackElement)\nexport function getMimeTypeFromUrl(url)\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#type-definitions","title":"Type Definitions","text":"<p>iOS Detection Result:</p> <pre><code>{\n    isIOS: true,\n    version: number,\n    versionString: string,\n    supportsMediaSession: boolean,\n    isPWA: boolean\n} | null\n</code></pre> <p>Android Detection Result:</p> <pre><code>{\n    isAndroid: true,\n    version: number,\n    versionString: string,\n    supportsMediaSession: boolean,\n    isAndroidAuto: boolean,\n    isPWA: boolean\n} | null\n</code></pre> <p>Metadata Object:</p> <pre><code>{\n    title: string,\n    artist: string,\n    album: string,\n    artwork: Array&lt;{\n        src: string,\n        sizes: string,\n        type: string\n    }&gt;\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#-best-practices","title":"\ud83c\udfaf Best Practices","text":""},{"location":"development/audio-playback/frontend/player-utilities.html#always-check-for-api-support","title":"Always Check for API Support","text":"<pre><code>if ('mediaSession' in navigator) {\n    setupLocalMediaSession(metadata, playerControls);\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#handle-platform-differences","title":"Handle Platform Differences","text":"<pre><code>const iOS = detectiOS();\nconst android = detectAndroid();\n\nif (iOS &amp;&amp; !iOS.supportsMediaSession) {\n    console.warn('Media Session not supported on this iOS version');\n}\n\nif (android &amp;&amp; android.isAndroidAuto) {\n    // Use enhanced setup\n    setupAndroidAutoMediaSession(...);\n} else {\n    // Use standard setup\n    setupLocalMediaSession(...);\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#clear-before-setting","title":"Clear Before Setting","text":"<pre><code>// When switching modes, always clear first\nclearMediaSession();\n// Then setup new mode\nsetupLocalMediaSession(newMetadata, controls);\n</code></pre>"},{"location":"development/audio-playback/frontend/player-utilities.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Player Controls - Main orchestration layer</li> <li>Chromecast Integration - Uses player control utilities</li> <li>Android Auto - Enhanced Media Session setup</li> <li>Playback Routes - Backend audio streaming</li> </ul> <p>Source: <code>static/js/player/playerUtils.js</code></p>"},{"location":"development/audio-playback/frontend/sleep-timer.html","title":"Sleep Timer","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#sleep-timer-module","title":"Sleep Timer Module","text":"<p>The <code>sleepTimer.js</code> module provides automatic playback shutdown functionality with configurable durations, graceful track-end handling, and persistent user preferences. It integrates seamlessly with the player controls and toast notification system to deliver a polished sleep timer experience.</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-purpose","title":"\ud83c\udfaf Purpose","text":"<p>Core Responsibilities:</p> <ul> <li>Manage sleep timer state and countdown</li> <li>Provide modal UI for duration configuration</li> <li>Handle automatic playback shutdown</li> <li>Show periodic countdown notifications</li> <li>Persist user preferences across sessions</li> <li>Coordinate with player controls for graceful stops</li> </ul> <p>Design Philosophy: Offer a simple, non-intrusive timer that respects user preferences and integrates naturally with existing playback controls without disrupting other functionality.</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#module-structure","title":"Module Structure","text":"<pre><code>graph TB\n    SleepTimer[sleepTimer.js]\n\n    UI[Modal UI]\n    Timer[Timer Management]\n    Notifications[Toast Notifications]\n    Persistence[Storage]\n\n    SleepTimer --&gt; UI\n    SleepTimer --&gt; Timer\n    SleepTimer --&gt; Notifications\n    SleepTimer --&gt; Persistence\n\n    UI --&gt; CreateModal[createSleepTimerModal]\n    UI --&gt; ShowModal[showSleepTimerModal]\n    UI --&gt; InitValues[initializeModalValues]\n\n    Timer --&gt; StartTimer[startSleepTimer]\n    Timer --&gt; StartCountdown[startCountdown]\n    Timer --&gt; StopPlayback[stopPlayback]\n    Timer --&gt; Cancel[cancelSleepTimer]\n    Timer --&gt; Cleanup[cleanupSleepTimer]\n\n    Notifications --&gt; Countdown[showCountdownNotification]\n    Notifications --&gt; UpdateButton[updateSleepTimerButton]\n\n    Persistence --&gt; GetDuration[getSavedDuration]\n    Persistence --&gt; SaveDuration[saveDuration]\n\n    style SleepTimer fill:#4a6fa5,color:#fff\n    style Timer fill:#c65d5d,color:#fff\n    style Notifications fill:#4a8c5f,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/frontend/sleep-timer.html#integration-points","title":"Integration Points","text":"<pre><code>graph LR\n    SleepTimer[sleepTimer.js]\n\n    PlayerControls[playerControls.js]\n    ToastSystem[toastSystem.js]\n    LocalStorage[localStorage]\n    AudioElement[#main-player]\n\n    SleepTimer --&gt; ToastSystem\n    SleepTimer --&gt; LocalStorage\n    SleepTimer --&gt; AudioElement\n    PlayerControls --&gt; SleepTimer\n\n    style SleepTimer fill:#4a6fa5,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/frontend/sleep-timer.html#-state-management","title":"\ud83d\udce6 State Management","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#sleep-timer-state","title":"Sleep Timer State","text":"<p>The module maintains a centralized state object:</p> <pre><code>let sleepTimerState = {\n    active: false,              // Is timer currently running?\n    endTime: null,              // Timestamp when timer will expire (Date.now())\n    duration: 30,               // Duration in minutes (for restoration)\n    waitForTrackEnd: true,      // Wait for current track to finish?\n    intervalId: null,           // setInterval ID for countdown\n    lastNotificationTime: 0     // Timestamp of last notification (prevents duplicates)\n};\n</code></pre> <p>Field Details:</p> Field Type Purpose Default <code>active</code> boolean Timer running status <code>false</code> <code>endTime</code> number|null Expiration timestamp (ms) <code>null</code> <code>duration</code> number User-selected duration (min) <code>30</code> <code>waitForTrackEnd</code> boolean Graceful track-end stop <code>true</code> <code>intervalId</code> number|null Countdown interval ID <code>null</code> <code>lastNotificationTime</code> number Last toast timestamp <code>0</code> <p>State Transitions:</p> <pre><code>stateDiagram-v2\n    [*] --&gt; Inactive: Initial\n    Inactive --&gt; Active: startSleepTimer()\n    Active --&gt; Active: startSleepTimer() (restart)\n    Active --&gt; Inactive: cancelSleepTimer()\n    Active --&gt; Stopping: Timer expires\n    Stopping --&gt; Inactive: Playback stopped\n    Inactive --&gt; [*]</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/audio-playback/frontend/sleep-timer.html#-timer-lifecycle","title":"\u23f0 Timer Lifecycle","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#starting-a-timer","title":"Starting a Timer","text":"<p>Function: <code>startSleepTimer(minutes, waitForTrackEnd)</code></p> <p>Parameters:</p> <ul> <li><code>minutes</code> (number) - Duration in minutes (5-120)</li> <li><code>waitForTrackEnd</code> (boolean) - Whether to wait for track completion</li> </ul> <p>Process:</p> <pre><code>function startSleepTimer(minutes, waitForTrackEnd) {\n    // 1. Cancel existing timer if any\n    if (sleepTimerState.active) {\n        cleanupSleepTimer();\n    }\n\n    // 2. Calculate expiration time\n    const now = Date.now();\n    const durationMs = minutes * 60 * 1000;\n    const endTime = now + durationMs;\n\n    // 3. Update state\n    sleepTimerState.active = true;\n    sleepTimerState.endTime = endTime;\n    sleepTimerState.duration = minutes;\n    sleepTimerState.waitForTrackEnd = waitForTrackEnd;\n    sleepTimerState.lastNotificationTime = 0;\n\n    // 4. Persist preference\n    saveDuration(minutes);\n\n    // 5. Start countdown\n    startCountdown();\n\n    // 6. Update UI\n    updateSleepTimerButton();\n\n    // 7. Show confirmation toast\n    showSuccessToast(message, { actions: [...] });\n}\n</code></pre> <p>Example usage:</p> <pre><code>// Start 30-minute timer that waits for track end\nstartSleepTimer(30, true);\n\n// Start 60-minute timer that stops immediately\nstartSleepTimer(60, false);\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#countdown-process","title":"Countdown Process","text":"<p>Function: <code>startCountdown()</code></p> <p>Implementation:</p> <pre><code>function startCountdown() {\n    // Clear any existing countdown\n    if (sleepTimerState.intervalId) {\n        clearInterval(sleepTimerState.intervalId);\n    }\n\n    // Check every second\n    sleepTimerState.intervalId = setInterval(() =&gt; {\n        const now = Date.now();\n        const secondsRemaining = Math.ceil((sleepTimerState.endTime - now) / 1000);\n\n        if (secondsRemaining &lt;= 0) {\n            // Timer expired\n            stopPlayback();\n            return;\n        }\n\n        // Update button tooltip every 30 seconds\n        if (secondsRemaining % 30 === 0) {\n            updateSleepTimerButton();\n        }\n\n        // Show countdown notifications\n        showCountdownNotification(secondsRemaining);\n\n    }, 1000);\n}\n</code></pre> <p>Countdown interval: 1 second (1000ms)</p> <p>Button tooltip updates: Every 30 seconds to show current time remaining</p> <p>Termination conditions:</p> <ul> <li>Timer expires (<code>secondsRemaining &lt;= 0</code>)</li> <li>Timer is cancelled (<code>cleanupSleepTimer()</code>)</li> <li>Page unloads (<code>beforeunload</code> event)</li> </ul>"},{"location":"development/audio-playback/frontend/sleep-timer.html#notification-schedule","title":"Notification Schedule","text":"<p>Function: <code>showCountdownNotification(secondsRemaining)</code></p> <p>Notification points:</p> <ul> <li>60 minutes remaining</li> <li>30 minutes remaining</li> <li>15 minutes remaining</li> <li>10 minutes remaining</li> <li>5 minutes remaining</li> <li>1 minute remaining</li> </ul> <p>Duplicate prevention:</p> <p>30-second cooldown between notifications prevents spam if user rapidly toggles timer.</p> <p>Race condition prevention:</p> <p>Checks <code>sleepTimerState.active</code> first to ensure no countdown notifications appear after timer cancellation.</p> <pre><code>function showCountdownNotification(secondsRemaining) {\n    // Don't show notification if timer is no longer active\n    if (!sleepTimerState.active) {\n        return;\n    }\n\n    const minutesRemaining = Math.ceil(secondsRemaining / 60);\n\n    // Check if this is a notification point\n    const notificationPoints = [60, 30, 15, 10, 5, 1];\n\n    if (notificationPoints.includes(minutesRemaining)) {\n        const now = Date.now();\n\n        // Prevent duplicates within 30 seconds\n        if (now - sleepTimerState.lastNotificationTime &lt; 30000) {\n            return;\n        }\n\n        sleepTimerState.lastNotificationTime = now;\n\n        // Show toast with actions\n        showInfoToast(message, {\n            duration: 4000,\n            actions: [\n                { label: 'Extend', handler: () =&gt; showSleepTimerModal() },\n                { label: 'Cancel', handler: () =&gt; cancelSleepTimer() }\n            ]\n        });\n    }\n}\n</code></pre> <p>Toast appearance:</p> <pre><code>\u2139\ufe0f Info\nPlayback will stop in 15m\n[Extend] [Cancel]\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#stopping-playback","title":"Stopping Playback","text":"<p>Function: <code>stopPlayback()</code></p> <p>Two modes:</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#immediate-stop","title":"Immediate Stop","text":"<p>When <code>waitForTrackEnd = false</code>:</p> <pre><code>const player = document.getElementById('main-player');\nif (player) {\n    player.pause();\n}\ncleanupSleepTimer();\nshowSuccessToast('Sleep timer ended - playback stopped');\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#graceful-stop-wait-for-track-end","title":"Graceful Stop (Wait for Track End)","text":"<p>When <code>waitForTrackEnd = true</code>:</p> <pre><code>const player = document.getElementById('main-player');\n\nif (player &amp;&amp; !player.paused) {\n    // Show waiting message\n    showInfoToast('Waiting for current track to finish...');\n\n    // Listen for track end\n    const handleEnd = () =&gt; {\n        player.pause();\n        cleanupSleepTimer();\n        showSuccessToast('Sleep timer ended - playback stopped');\n        player.removeEventListener('ended', handleEnd);\n    };\n\n    player.addEventListener('ended', handleEnd, { once: true });\n} else {\n    // Already paused, stop immediately\n    cleanupSleepTimer();\n    showSuccessToast('Sleep timer ended - playback stopped');\n}\n</code></pre> <p>Track end handling:</p> <ul> <li>Uses <code>{ once: true }</code> to auto-remove listener</li> <li>Prevents memory leaks</li> <li>Handles edge case of already-paused player</li> </ul>"},{"location":"development/audio-playback/frontend/sleep-timer.html#cancelling-a-timer","title":"Cancelling a Timer","text":"<p>Function: <code>cancelSleepTimer()</code></p> <p>Process:</p> <pre><code>function cancelSleepTimer() {\n    cleanupSleepTimer();\n    showInfoToast('Sleep timer cancelled');\n}\n</code></pre> <p>User-initiated cancellation:</p> <ul> <li>Click cancel in modal</li> <li>Click cancel in countdown toast</li> <li>Click pulsing timer button \u2192 modal \u2192 cancel</li> </ul>"},{"location":"development/audio-playback/frontend/sleep-timer.html#cleanup","title":"Cleanup","text":"<p>Function: <code>cleanupSleepTimer()</code></p> <p>Responsibilities:</p> <pre><code>function cleanupSleepTimer() {\n    // Clear interval\n    if (sleepTimerState.intervalId) {\n        clearInterval(sleepTimerState.intervalId);\n        sleepTimerState.intervalId = null;\n    }\n\n    // Reset state\n    sleepTimerState.active = false;\n    sleepTimerState.endTime = null;\n    sleepTimerState.lastNotificationTime = 0;\n\n    // Update UI\n    updateSleepTimerButton();\n}\n</code></pre> <p>Called by:</p> <ul> <li><code>cancelSleepTimer()</code> - User cancellation</li> <li><code>stopPlayback()</code> - Timer expiration</li> <li><code>startSleepTimer()</code> - Restart with new duration</li> <li><code>window.beforeunload</code> - Page unload</li> </ul>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-modal-ui","title":"\ud83c\udfa8 Modal UI","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#modal-structure","title":"Modal Structure","text":"<p>Function: <code>createSleepTimerModal()</code></p> <p>Returns: DOM element</p> <p>Modal HTML:</p> <pre><code>&lt;div class=\"modal fade\" id=\"sleepTimerModal\"&gt;\n    &lt;div class=\"modal-dialog modal-dialog-centered\"&gt;\n        &lt;div class=\"modal-content\"&gt;\n            &lt;!-- Header --&gt;\n            &lt;div class=\"modal-header border-bottom-0\"&gt;\n                &lt;h5 class=\"modal-title\"&gt;\n                    &lt;i class=\"bi bi-moon-stars me-2\"&gt;&lt;/i&gt;Sleep Timer\n                &lt;/h5&gt;\n                &lt;button class=\"btn-close\" data-bs-dismiss=\"modal\"&gt;&lt;/button&gt;\n            &lt;/div&gt;\n\n            &lt;!-- Body --&gt;\n            &lt;div class=\"modal-body\"&gt;\n                &lt;!-- Large time display --&gt;\n                &lt;div class=\"timer-display\"&gt;30&lt;span class=\"text-muted\"&gt;min&lt;/span&gt;&lt;/div&gt;\n\n                &lt;!-- Slider --&gt;\n                &lt;input type=\"range\" id=\"sleep-timer-slider\"\n                       min=\"5\" max=\"120\" step=\"5\" value=\"30\"&gt;\n                &lt;div class=\"d-flex justify-content-between small text-muted\"&gt;\n                    &lt;span&gt;5 min&lt;/span&gt;\n                    &lt;span&gt;2 hours&lt;/span&gt;\n                &lt;/div&gt;\n\n                &lt;!-- Quick presets --&gt;\n                &lt;div class=\"d-grid gap-2\"&gt;\n                    &lt;button class=\"sleep-preset\" data-minutes=\"15\"&gt;15 minutes&lt;/button&gt;\n                    &lt;button class=\"sleep-preset\" data-minutes=\"30\"&gt;30 minutes&lt;/button&gt;\n                    &lt;button class=\"sleep-preset\" data-minutes=\"45\"&gt;45 minutes&lt;/button&gt;\n                    &lt;button class=\"sleep-preset\" data-minutes=\"60\"&gt;1 hour&lt;/button&gt;\n                &lt;/div&gt;\n\n                &lt;!-- Wait for track end option --&gt;\n                &lt;div class=\"p-3 bg-body-secondary rounded\"&gt;\n                    &lt;div class=\"form-check d-flex align-items-center\"&gt;\n                        &lt;input class=\"form-check-input mt-0 me-2 flex-shrink-0\" type=\"checkbox\" id=\"sleep-wait-track-end\" checked&gt;\n                        &lt;label class=\"form-check-label mb-0\"&gt;\n                            &lt;i class=\"bi bi-skip-end me-2\"&gt;&lt;/i&gt;Wait until current track ends\n                        &lt;/label&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;!-- Footer --&gt;\n            &lt;div class=\"modal-footer border-top-0\"&gt;\n                &lt;!-- Cancel button (only if timer active) --&gt;\n                &lt;button class=\"btn btn-danger\" id=\"sleep-cancel-btn\"&gt;\n                    Cancel Timer\n                &lt;/button&gt;\n                &lt;button class=\"btn btn-secondary\" data-bs-dismiss=\"modal\"&gt;Close&lt;/button&gt;\n                &lt;button class=\"btn btn-success\" id=\"sleep-start-btn\"&gt;\n                    Start Timer\n                &lt;/button&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre> <p>Key components:</p> Component Element ID Purpose Time Display <code>#sleep-timer-display</code> Shows selected duration (30min) Slider <code>#sleep-timer-slider</code> Fine control (5-120 min) Preset Buttons <code>.sleep-preset</code> Quick selection (15/30/45/60) Checkbox <code>#sleep-wait-track-end</code> Track-end wait toggle Start Button <code>#sleep-start-btn</code> Activate timer Cancel Button <code>#sleep-cancel-btn</code> Cancel active timer"},{"location":"development/audio-playback/frontend/sleep-timer.html#showing-the-modal","title":"Showing the Modal","text":"<p>Function: <code>showSleepTimerModal()</code></p> <p>Process:</p> <pre><code>export function showSleepTimerModal() {\n    // 1. Remove existing modal if present (ensures fresh state)\n    let existingModal = document.getElementById('sleepTimerModal');\n    if (existingModal) {\n        // Clean up bootstrap modal instance\n        const bsModal = bootstrap.Modal.getInstance(existingModal);\n        if (bsModal) {\n            bsModal.dispose();\n        }\n        existingModal.remove();\n    }\n\n    // 2. Create fresh modal with current timer state\n    const modal = createSleepTimerModal();\n    document.body.appendChild(modal);\n\n    // 3. Initialize with saved/active duration\n    const duration = sleepTimerState.active\n        ? sleepTimerState.duration\n        : getSavedDuration();\n\n    initializeModalValues(modal, duration, sleepTimerState.waitForTrackEnd);\n\n    // 4. Show modal\n    const bsModal = new bootstrap.Modal(modal);\n    bsModal.show();\n\n    // 5. Clean up modal after it's hidden\n    modal.addEventListener('hidden.bs.modal', () =&gt; {\n        modal.remove();\n    }, { once: true });\n}\n</code></pre> <p>Modal recreation strategy:</p> <p>Modal is recreated fresh each time to ensure:</p> <ul> <li>Cancel button appears when timer is active</li> <li>Current timer duration is always accurate</li> <li>No stale state from previous modal instances</li> <li>Automatic cleanup after modal closes</li> </ul> <p>State restoration:</p> <ul> <li>Active timer: Shows current duration and settings, includes \"Cancel Timer\" button</li> <li>No timer: Shows last used duration (from localStorage)</li> </ul>"},{"location":"development/audio-playback/frontend/sleep-timer.html#initializing-modal-values","title":"Initializing Modal Values","text":"<p>Function: <code>initializeModalValues(modal, duration, waitForTrackEnd)</code></p> <p>Parameters:</p> <ul> <li><code>modal</code> (HTMLElement) - Modal DOM element</li> <li><code>duration</code> (number) - Initial duration in minutes</li> <li><code>waitForTrackEnd</code> (boolean) - Initial checkbox state</li> </ul> <p>Responsibilities:</p> <pre><code>function initializeModalValues(modal, duration, waitForTrackEnd) {\n    const slider = modal.querySelector('#sleep-timer-slider');\n    const display = modal.querySelector('#sleep-timer-display');\n    const checkbox = modal.querySelector('#sleep-wait-track-end');\n    const startBtn = modal.querySelector('#sleep-start-btn');\n    const cancelBtn = modal.querySelector('#sleep-cancel-btn');\n    const presetBtns = modal.querySelectorAll('.sleep-preset');\n\n    // Set initial values\n    slider.value = duration;\n    display.textContent = duration;\n    checkbox.checked = waitForTrackEnd;\n\n    // Slider listener\n    slider.addEventListener('input', (e) =&gt; {\n        display.textContent = e.target.value;\n    });\n\n    // Preset button listeners\n    presetBtns.forEach(btn =&gt; {\n        btn.addEventListener('click', () =&gt; {\n            const minutes = parseInt(btn.dataset.minutes, 10);\n            slider.value = minutes;\n            display.textContent = minutes;\n        });\n    });\n\n    // Start button listener\n    startBtn.addEventListener('click', () =&gt; {\n        const minutes = parseInt(slider.value, 10);\n        const wait = checkbox.checked;\n        startSleepTimer(minutes, wait);\n\n        const bsModal = bootstrap.Modal.getInstance(modal);\n        bsModal.hide();\n    });\n\n    // Cancel button listener (if present)\n    if (cancelBtn) {\n        cancelBtn.addEventListener('click', () =&gt; {\n            cancelSleepTimer();\n            const bsModal = bootstrap.Modal.getInstance(modal);\n            bsModal.hide();\n        });\n    }\n}\n</code></pre> <p>Event listeners:</p> <ul> <li>Slider: Updates display on input</li> <li>Presets: Set slider and display</li> <li>Start: Creates/updates timer and closes modal</li> <li>Cancel: Cancels timer and closes modal</li> </ul>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-button-state-management","title":"\ud83d\udd18 Button State Management","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#sleep-timer-button","title":"Sleep Timer Button","text":"<p>Element ID: <code>#sleep-timer-btn</code></p> <p>Location: Bottom player controls (between repeat and cast buttons)</p> <p>States:</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#inactive-state","title":"Inactive State","text":"<pre><code>sleepBtn.classList.remove('btn-warning');\nsleepBtn.classList.add('btn-outline-light');\nsleepBtn.title = 'Set sleep timer';\n\nicon.className = 'bi bi-alarm';  // Outline icon\n</code></pre> <p>Visual: Outlined button, static alarm icon \u23f0</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#active-state","title":"Active State","text":"<pre><code>sleepBtn.classList.remove('btn-outline-light');\nsleepBtn.classList.add('btn-warning');\nsleepBtn.title = 'Sleep timer active - click to modify';\n\nicon.className = 'bi bi-alarm-fill';  // Filled icon\n</code></pre> <p>Visual: Yellow button, filled alarm icon \u23f0, pulsing animation</p> <p>CSS Animation (add to <code>play_mixtape.css</code>):</p> <pre><code>/* Sleep timer button - active state */\n#sleep-timer-btn.btn-warning {\n  animation: pulse 2s infinite;\n}\n\n#sleep-timer-btn.btn-warning i {\n  animation: pulse 2s infinite;\n}\n</code></pre> <p>This reuses the existing <code>pulse</code> keyframe animation (already defined for the cast button).</p> <p>Note: The CSS file already contains the <code>@keyframes pulse</code> definition, so only the button-specific rules need to be added.</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#update-function","title":"Update Function","text":"<p>Function: <code>updateSleepTimerButton()</code></p> <pre><code>function updateSleepTimerButton() {\n    const sleepBtn = document.getElementById('sleep-timer-btn');\n    if (!sleepBtn) return;\n\n    const icon = sleepBtn.querySelector('i');\n\n    if (sleepTimerState.active) {\n        // Calculate time remaining\n        const now = Date.now();\n        const secondsRemaining = Math.ceil((sleepTimerState.endTime - now) / 1000);\n        const timeStr = formatTimeRemaining(secondsRemaining);\n\n        // Active state\n        sleepBtn.classList.remove('btn-outline-light');\n        sleepBtn.classList.add('btn-warning');\n        sleepBtn.title = `Sleep timer: ${timeStr} remaining - click to modify`;\n\n        if (icon) {\n            icon.className = 'bi bi-alarm-fill';\n        }\n    } else {\n        // Inactive state\n        sleepBtn.classList.remove('btn-warning');\n        sleepBtn.classList.add('btn-outline-light');\n        sleepBtn.title = 'Set sleep timer';\n\n        if (icon) {\n            icon.className = 'bi bi-alarm';\n        }\n    }\n}\n</code></pre> <p>Tooltip updates:</p> <ul> <li>Inactive: \"Set sleep timer\"</li> <li>Active: \"Sleep timer: 27m remaining - click to modify\" (updates every 30 seconds)</li> </ul> <p>Called by:</p> <ul> <li><code>startSleepTimer()</code> - After timer starts</li> <li><code>cleanupSleepTimer()</code> - After timer stops/cancels</li> <li><code>initSleepTimer()</code> - On module initialization</li> </ul>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-persistence","title":"\ud83d\udcbe Persistence","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#storage-key","title":"Storage Key","text":"<pre><code>const STORAGE_KEY_SLEEP_TIMER = 'sleep_timer_duration';\n</code></pre> <p>Stores: Last used duration in minutes (number)</p> <p>Scope: Per-origin (shared across all mixtapes on same domain)</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#save-duration","title":"Save Duration","text":"<p>Function: <code>saveDuration(minutes)</code></p> <pre><code>function saveDuration(minutes) {\n    try {\n        localStorage.setItem(STORAGE_KEY_SLEEP_TIMER, minutes.toString());\n    } catch (e) {\n        console.warn('Failed to save sleep timer duration:', e);\n    }\n}\n</code></pre> <p>Error handling: Gracefully degrades if localStorage blocked</p> <p>Called when: User starts timer (saves their preference)</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#get-saved-duration","title":"Get Saved Duration","text":"<p>Function: <code>getSavedDuration()</code></p> <p>Returns: Number (minutes) or default (30)</p> <pre><code>function getSavedDuration() {\n    try {\n        const saved = localStorage.getItem(STORAGE_KEY_SLEEP_TIMER);\n        return saved ? parseInt(saved, 10) : 30;\n    } catch (e) {\n        console.warn('Failed to load sleep timer duration:', e);\n        return 30;\n    }\n}\n</code></pre> <p>Fallback: 30 minutes if:</p> <ul> <li>No saved value exists</li> <li>localStorage access fails</li> <li>Saved value is invalid</li> </ul> <p>Called when: Modal opens without active timer</p>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-integration-patterns","title":"\ud83d\udd04 Integration Patterns","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#with-player-controls","title":"With Player Controls","text":"<pre><code>// In playerControls.js initialization\nimport { initSleepTimer } from './sleepTimer.js';\n\ndocument.addEventListener('DOMContentLoaded', () =&gt; {\n    // ... other initializations\n    initSleepTimer();\n});\n</code></pre> <p>Button placement:</p> <pre><code>&lt;!-- In bottom player controls --&gt;\n&lt;button id=\"shuffle-btn-bottom\"&gt;...&lt;/button&gt;\n&lt;button id=\"repeat-btn-bottom\"&gt;...&lt;/button&gt;\n&lt;button id=\"sleep-timer-btn\" class=\"btn btn-sm btn-outline-light\"&gt;\n    &lt;i class=\"bi bi-alarm\"&gt;&lt;/i&gt;\n&lt;/button&gt;\n&lt;button id=\"cast-button\"&gt;...&lt;/button&gt;\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#with-toast-system","title":"With Toast System","text":"<pre><code>import {\n    showInfoToast,\n    showSuccessToast\n} from '../common/toastSystem.js';\n\n// Confirmation toast\nshowSuccessToast('Sleep timer set for 30 minutes', {\n    duration: 4000,\n    actions: [\n        { label: 'Cancel', handler: () =&gt; cancelSleepTimer() }\n    ]\n});\n\n// Countdown toast\nshowInfoToast('Playback will stop in 15m', {\n    duration: 4000,\n    actions: [\n        { label: 'Extend', handler: () =&gt; showSleepTimerModal() },\n        { label: 'Cancel', handler: () =&gt; cancelSleepTimer() }\n    ]\n});\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#with-audio-element","title":"With Audio Element","text":"<pre><code>const player = document.getElementById('main-player');\n\n// Immediate stop\nplayer.pause();\n\n// Graceful stop (wait for track end)\nplayer.addEventListener('ended', handleEnd, { once: true });\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-helper-functions","title":"\ud83d\udee0\ufe0f Helper Functions","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#time-formatting","title":"Time Formatting","text":"<p>Function: <code>formatTimeRemaining(seconds)</code></p> <p>Purpose: Convert seconds to human-readable format</p> <p>Returns: String</p> <pre><code>function formatTimeRemaining(seconds) {\n    const minutes = Math.ceil(seconds / 60);\n\n    if (minutes &lt; 60) {\n        return `${minutes}m`;\n    }\n\n    const hours = Math.floor(minutes / 60);\n    const remainingMinutes = minutes % 60;\n\n    if (remainingMinutes === 0) {\n        return `${hours}h`;\n    }\n\n    return `${hours}h ${remainingMinutes}m`;\n}\n</code></pre> <p>Examples:</p> <pre><code>formatTimeRemaining(300)   // \"5m\"\nformatTimeRemaining(3600)  // \"1h\"\nformatTimeRemaining(5400)  // \"1h 30m\"\nformatTimeRemaining(7200)  // \"2h\"\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-testing--debugging","title":"\ud83e\uddea Testing &amp; Debugging","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#manual-testing","title":"Manual Testing","text":"<pre><code>// Enable sleep timer\nimport { showSleepTimerModal } from './sleepTimer.js';\nshowSleepTimerModal();\n\n// Check state\nconsole.log(sleepTimerState);\n\n// Test immediate stop (set to 1 minute for quick testing)\n// In modal: Set slider to 5 minutes, uncheck \"wait for track end\"\n\n// Test graceful stop\n// In modal: Set slider to 5 minutes, check \"wait for track end\"\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#console-logging","title":"Console Logging","text":"<pre><code>// Start timer\nconsole.log('\u23f0 Sleep timer started: 30 minutes, waitForTrackEnd: true');\n\n// Countdown\n// (Silent - only logs on expiration)\n\n// Timer expired\nconsole.log('\u23f0 Sleep timer expired - stopping playback');\n\n// Cleanup\nconsole.log('\ud83d\uded1 Sleep timer cleaned up');\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#edge-cases","title":"Edge Cases","text":"<p>Test scenarios:</p> <ol> <li>Multiple timer starts: Should cancel previous and restart</li> <li>Page reload during timer: Timer does not persist (by design)</li> <li>localStorage blocked: Should use default duration (30 min)</li> <li>Track ends before timer: Normal track change, timer continues</li> <li>Modal opened while timer active: Shows \"Cancel Timer\" button and current duration</li> <li>Rapid cancellation: Guard prevents countdown toast after cancellation</li> <li>Checkbox alignment: Properly contained within rounded box (horizontal and vertical)</li> </ol>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-api-reference","title":"\ud83d\udcca API Reference","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#public-exports","title":"Public Exports","text":"<pre><code>// Initialization\nexport function initSleepTimer()\n\n// Modal Control\nexport function showSleepTimerModal()\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#internal-functions","title":"Internal Functions","text":"<pre><code>// Storage\nfunction getSavedDuration()\nfunction saveDuration(minutes)\n\n// Timer Management\nfunction startSleepTimer(minutes, waitForTrackEnd)\nfunction startCountdown()\nfunction stopPlayback()\nfunction cancelSleepTimer()\nfunction cleanupSleepTimer()\n\n// UI Updates\nfunction updateSleepTimerButton()\nfunction showCountdownNotification(secondsRemaining)\nfunction formatTimeRemaining(seconds)\n\n// Modal\nfunction createSleepTimerModal()\nfunction initializeModalValues(modal, duration, waitForTrackEnd)\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#constants","title":"Constants","text":"<pre><code>const STORAGE_KEY_SLEEP_TIMER = 'sleep_timer_duration';\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-best-practices","title":"\ud83c\udf1f Best Practices","text":""},{"location":"development/audio-playback/frontend/sleep-timer.html#always-initialize-in-indexjs","title":"Always Initialize in index.js","text":"<pre><code>import { initSleepTimer } from './sleepTimer.js';\n\ndocument.addEventListener('DOMContentLoaded', () =&gt; {\n    initSleepTimer();  // Initialize after DOM ready\n});\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#use-exported-functions","title":"Use Exported Functions","text":"<pre><code>// \u2705 Correct\nimport { showSleepTimerModal } from './sleepTimer.js';\nshowSleepTimerModal();\n\n// \u274c Incorrect\n// Don't call internal functions directly\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#handle-missing-elements","title":"Handle Missing Elements","text":"<pre><code>const sleepBtn = document.getElementById('sleep-timer-btn');\nif (!sleepBtn) {\n    console.warn('Sleep timer button not found in DOM');\n    return;\n}\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#clean-up-on-unload","title":"Clean Up on Unload","text":"<pre><code>// Automatically handled by module\nwindow.addEventListener('beforeunload', () =&gt; {\n    cleanupSleepTimer();\n});\n</code></pre>"},{"location":"development/audio-playback/frontend/sleep-timer.html#-related-documentation","title":"\ud83d\udd17 Related Documentation","text":"<ul> <li>Player Controls - Main playback orchestration</li> <li>Toast System - Notification system</li> <li>Player Utilities - Shared player utilities</li> <li>Playback Routes - Backend audio streaming</li> </ul> <p>Source: <code>static/js/player/sleepTimer.js</code></p>"},{"location":"development/device-integration/android-auto/backend.html","title":"Backend Implementation","text":""},{"location":"development/device-integration/android-auto/backend.html#backend-implementation","title":"Backend Implementation","text":"<p>This page documents the server-side changes required for Android Auto integration, focusing on size-optimized cover art generation and serving.</p>"},{"location":"development/device-integration/android-auto/backend.html#-goals","title":"\ud83c\udfaf Goals","text":"<ol> <li>Generate multiple size variants of cover artwork</li> <li>Serve size-specific covers via query parameters</li> <li>Maintain backward compatibility with existing code</li> <li>Optimize bandwidth for mobile/in-car use</li> </ol>"},{"location":"development/device-integration/android-auto/backend.html#-modified-files","title":"\ud83d\udcc1 Modified Files","text":""},{"location":"development/device-integration/android-auto/backend.html#srcmusiclibreaderpy","title":"<code>src/musiclib/reader.py</code>","text":"<p>Added two new methods to <code>MusicCollection</code> class:</p> <ul> <li><code>_generate_cover_variants()</code> - Generates 6 size variants</li> <li><code>get_cover_sizes()</code> - Returns URLs for all size variants</li> </ul>"},{"location":"development/device-integration/android-auto/backend.html#srcapppy","title":"<code>src/app.py</code>","text":"<p>Added new API endpoint:</p> <ul> <li><code>/api/covers/&lt;release_dir_encoded&gt;?size=WxH</code> - Serves size-specific covers</li> </ul>"},{"location":"development/device-integration/android-auto/backend.html#-implementation-details","title":"\ud83d\udd27 Implementation Details","text":""},{"location":"development/device-integration/android-auto/backend.html#1-cover-variant-generation","title":"1. Cover Variant Generation","text":"<p>Method: <code>_generate_cover_variants(release_dir, slug)</code></p> <p>Location: <code>src/musiclib/reader.py</code> (added before <code>_extract_cover</code>)</p> <pre><code>def _generate_cover_variants(self, release_dir: str, slug: str) -&gt; bool:\n    \"\"\"Generates multiple size variants of a cover image for responsive serving.\n\n    Creates optimized versions at standard sizes for efficient bandwidth usage.\n\n    Args:\n        release_dir: The release directory relative to the music root.\n        slug: The sanitized slug identifier for the cover files.\n\n    Returns:\n        bool: True if at least one size variant was successfully generated.\n    \"\"\"\n    # Standard sizes for responsive cover art\n    sizes = [96, 128, 192, 256, 384, 512]\n\n    # Generate main cover first (existing behavior)\n    main_path = self.covers_dir / f\"{slug}.jpg\"\n    if not self._extract_cover(release_dir, main_path):\n        return False\n\n    # Generate size variants from main cover\n    try:\n        with Image.open(main_path) as main_img:\n            for size in sizes:\n                variant_path = self.covers_dir / f\"{slug}_{size}x{size}.jpg\"\n\n                # Skip if already exists\n                if variant_path.exists():\n                    continue\n\n                # Resize maintaining aspect ratio\n                img_copy = main_img.copy()\n                img_copy.thumbnail((size, size), Image.Resampling.LANCZOS)\n\n                # Save with appropriate quality\n                quality = 85 if size &gt;= 256 else 80\n                img_copy.save(variant_path, 'JPEG', quality=quality, optimize=True)\n\n                self._logger.debug(f\"Generated {size}x{size} variant for {slug}\")\n\n        return True\n    except Exception as e:\n        self._logger.warning(f\"Failed to generate cover variants: {e}\")\n        return False\n</code></pre> <p>File naming convention:</p> <ul> <li>Main cover: <code>{slug}.jpg</code> (e.g., <code>artist_album.jpg</code>)</li> <li>Variants: <code>{slug}_{size}x{size}.jpg</code> (e.g., <code>artist_album_256x256.jpg</code>)</li> </ul> <p>Standard sizes generated:</p> <ul> <li>96\u00d796 px - Thumbnails (5-8 KB)</li> <li>128\u00d7128 px - Small tiles (8-12 KB)</li> <li>192\u00d7192 px - Medium tiles (15-20 KB)</li> <li>256\u00d7256 px - Android Auto optimal (30-50 KB)</li> <li>384\u00d7384 px - High-DPI displays (60-90 KB)</li> <li>512\u00d7512 px - Full-screen player (100-150 KB)</li> </ul>"},{"location":"development/device-integration/android-auto/backend.html#2-size-url-retrieval","title":"2. Size URL Retrieval","text":"<p>Method: <code>get_cover_sizes(release_dir)</code></p> <p>Location: <code>src/musiclib/reader.py</code> (added after <code>get_cover</code>)</p> <pre><code>def get_cover_sizes(self, release_dir: str) -&gt; dict[str, str]:\n    \"\"\"Returns URLs for multiple size variants of a cover image.\n\n    Generates size variants on-demand if not already cached.\n\n    Args:\n        release_dir: The release directory identifier.\n\n    Returns:\n        dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to URLs.\n    \"\"\"\n    if not release_dir:\n        sizes = [96, 128, 192, 256, 384, 512]\n        return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    slug = self._sanitize_release_dir(release_dir)\n    sizes = [96, 128, 192, 256, 384, 512]\n\n    # Ensure main cover exists first\n    main_path = self.covers_dir / f\"{slug}.jpg\"\n    if not main_path.exists():\n        if not self._extract_cover(release_dir, main_path):\n            return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    # Check if variants exist, generate if needed\n    variants_exist = all(\n        (self.covers_dir / f\"{slug}_{s}x{s}.jpg\").exists() for s in sizes\n    )\n\n    if not variants_exist:\n        self._generate_cover_variants(release_dir, slug)\n\n    # Build URL dictionary\n    result = {}\n    for size in sizes:\n        variant_path = self.covers_dir / f\"{slug}_{size}x{size}.jpg\"\n        if variant_path.exists():\n            result[f\"{size}x{size}\"] = f\"covers/{slug}_{size}x{size}.jpg\"\n        else:\n            result[f\"{size}x{size}\"] = f\"covers/{slug}.jpg\"  # Fallback to main\n\n    return result\n</code></pre> <p>Return value example:</p> <pre><code>{\n    \"96x96\": \"covers/artist_album_96x96.jpg\",\n    \"128x128\": \"covers/artist_album_128x128.jpg\",\n    \"192x192\": \"covers/artist_album_192x192.jpg\",\n    \"256x256\": \"covers/artist_album_256x256.jpg\",\n    \"384x384\": \"covers/artist_album_384x384.jpg\",\n    \"512x512\": \"covers/artist_album_512x512.jpg\"\n}\n</code></pre>"},{"location":"development/device-integration/android-auto/backend.html#3-api-endpoint","title":"3. API Endpoint","text":"<p>Route: <code>/api/covers/&lt;release_dir_encoded&gt;</code></p> <p>Location: <code>src/app.py</code> (added after existing <code>/covers/&lt;filename&gt;</code> route)</p> <pre><code>@app.route(\"/api/covers/&lt;path:release_dir_encoded&gt;\")\ndef serve_cover_by_size(release_dir_encoded):\n    \"\"\"Serves cover art with optional size parameter.\n\n    Supports ?size=WxH query parameter (e.g., ?size=256x256).\n    Generates size variants on-demand and caches them.\n\n    Args:\n        release_dir_encoded: URL-encoded release directory path\n\n    Query Parameters:\n        size: Optional size in format WxH (e.g., 256x256)\n              Valid: 96x96, 128x128, 192x192, 256x256, 384x384, 512x512\n\n    Returns:\n        Image file from cache directory\n    \"\"\"\n    from urllib.parse import unquote\n\n    release_dir = unquote(release_dir_encoded)\n    requested_size = request.args.get('size', '').lower()\n\n    valid_sizes = ['96x96', '128x128', '192x192', '256x256', '384x384', '512x512']\n    covers_dir = app.config[\"DATA_ROOT\"] / \"cache\" / \"covers\"\n\n    if not requested_size:\n        # No size specified, return main cover\n        cover_url = collection.get_cover(release_dir)\n        if cover_url:\n            filename = cover_url.split('/')[-1]\n            return send_from_directory(covers_dir, filename)\n        abort(404)\n\n    # Validate size parameter\n    if requested_size not in valid_sizes:\n        return jsonify({\n            \"error\": \"Invalid size parameter\",\n            \"valid_sizes\": valid_sizes\n        }), 400\n\n    # Get or generate size-specific cover\n    slug = collection._sanitize_release_dir(release_dir)\n    size_filename = f\"{slug}_{requested_size}.jpg\"\n    size_path = covers_dir / size_filename\n\n    # Generate if doesn't exist\n    if not size_path.exists():\n        main_path = covers_dir / f\"{slug}.jpg\"\n        if not main_path.exists():\n            collection._extract_cover(release_dir, main_path)\n\n        if main_path.exists():\n            collection._generate_cover_variants(release_dir, slug)\n\n    # Serve size-specific cover\n    if size_path.exists():\n        return send_from_directory(covers_dir, size_filename)\n\n    # Fallback to main cover\n    main_filename = f\"{slug}.jpg\"\n    main_path = covers_dir / main_filename\n    if main_path.exists():\n        return send_from_directory(covers_dir, main_filename)\n\n    # Final fallback\n    return send_from_directory(covers_dir, \"_fallback.jpg\")\n</code></pre> <p>Usage examples:</p> <pre><code># Get 256\u00d7256 variant\nGET /api/covers/Artist%2FAlbum?size=256x256\n\n# Get main cover (no size)\nGET /api/covers/Artist%2FAlbum\n\n# Invalid size returns error\nGET /api/covers/Artist%2FAlbum?size=999x999\n# \u2192 {\"error\": \"Invalid size parameter\", \"valid_sizes\": [...]}\n</code></pre>"},{"location":"development/device-integration/android-auto/backend.html#-request-flow","title":"\ud83d\udd04 Request Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Flask\n    participant API Endpoint\n    participant Collection\n    participant Filesystem\n\n    Client-&gt;&gt;Flask: GET /api/covers/Artist%2FAlbum?size=256x256\n    Flask-&gt;&gt;API Endpoint: serve_cover_by_size()\n    API Endpoint-&gt;&gt;API Endpoint: Decode release_dir\n    API Endpoint-&gt;&gt;API Endpoint: Validate size parameter\n\n    alt Size variant exists\n        API Endpoint-&gt;&gt;Filesystem: Check cache\n        Filesystem--&gt;&gt;API Endpoint: File found\n        API Endpoint--&gt;&gt;Client: 200 + JPEG (40KB)\n    else Size variant missing\n        API Endpoint-&gt;&gt;Collection: _sanitize_release_dir()\n        Collection--&gt;&gt;API Endpoint: slug\n        API Endpoint-&gt;&gt;Collection: _extract_cover() if needed\n        Collection-&gt;&gt;Filesystem: Extract main cover\n        API Endpoint-&gt;&gt;Collection: _generate_cover_variants()\n        Collection-&gt;&gt;Filesystem: Generate 6 variants\n        Filesystem--&gt;&gt;Collection: Success\n        Collection--&gt;&gt;API Endpoint: True\n        API Endpoint-&gt;&gt;Filesystem: Read variant\n        Filesystem--&gt;&gt;API Endpoint: File bytes\n        API Endpoint--&gt;&gt;Client: 200 + JPEG (40KB)\n    end</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/device-integration/android-auto/backend.html#-performance-characteristics","title":"\ud83d\udcca Performance Characteristics","text":""},{"location":"development/device-integration/android-auto/backend.html#storage-impact","title":"Storage Impact","text":"<ul> <li>Main cover: 300-500 KB per album</li> <li>All 6 variants: 50-150 KB total per album</li> <li>Overhead: ~15-25% of main cover size</li> </ul>"},{"location":"development/device-integration/android-auto/backend.html#generation-performance","title":"Generation Performance","text":"<ul> <li>First request: +100-200ms (one-time)</li> <li>Subsequent requests: 0ms additional (served from cache)</li> <li>Batch generation: Can pre-generate for popular albums</li> </ul>"},{"location":"development/device-integration/android-auto/backend.html#caching-strategy","title":"Caching Strategy","text":"<ul> <li>Lazy generation: Only creates variants when requested</li> <li>Permanent cache: Variants never expire</li> <li>No cleanup: Variants remain until manual cleanup</li> <li>Cache location: <code>DATA_ROOT/cache/covers/</code></li> </ul>"},{"location":"development/device-integration/android-auto/backend.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/device-integration/android-auto/backend.html#unit-tests","title":"Unit Tests","text":"<pre><code>def test_generate_cover_variants():\n    \"\"\"Test variant generation creates all sizes.\"\"\"\n    collection = MusicCollection(music_root, db_path)\n    slug = \"test_album\"\n\n    result = collection._generate_cover_variants(\"Artist/Album\", slug)\n\n    assert result == True\n    assert (covers_dir / f\"{slug}_96x96.jpg\").exists()\n    assert (covers_dir / f\"{slug}_256x256.jpg\").exists()\n    assert (covers_dir / f\"{slug}_512x512.jpg\").exists()\n\ndef test_get_cover_sizes():\n    \"\"\"Test URL dictionary returns all sizes.\"\"\"\n    collection = MusicCollection(music_root, db_path)\n\n    sizes = collection.get_cover_sizes(\"Artist/Album\")\n\n    assert \"96x96\" in sizes\n    assert \"256x256\" in sizes\n    assert sizes[\"256x256\"].endswith(\"_256x256.jpg\")\n</code></pre>"},{"location":"development/device-integration/android-auto/backend.html#integration-tests","title":"Integration Tests","text":"<pre><code># Test API endpoint\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=256x256\" -o test.jpg\n\n# Verify file size\nls -lh test.jpg  # Should be ~40KB\n\n# Test invalid size\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=999x999\"\n# Should return JSON error\n\n# Test fallback\ncurl \"http://localhost:5000/api/covers/NonExistent%2FAlbum?size=256x256\"\n# Should return fallback image\n</code></pre>"},{"location":"development/device-integration/android-auto/backend.html#-troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"development/device-integration/android-auto/backend.html#issue-variants-not-generating","title":"Issue: Variants not generating","text":"<p>Symptoms: 404 on size-specific requests Check: Main cover exists? PIL/Pillow installed? Solution: Ensure <code>_extract_cover()</code> succeeds first</p>"},{"location":"development/device-integration/android-auto/backend.html#issue-large-file-sizes","title":"Issue: Large file sizes","text":"<p>Symptoms: Variants larger than expected Adjust: Quality setting in <code>_generate_cover_variants()</code>:</p> <pre><code>quality = 90 if size &gt;= 256 else 85  # Increase quality\n</code></pre>"},{"location":"development/device-integration/android-auto/backend.html#issue-slow-first-request","title":"Issue: Slow first request","text":"<p>Expected: 100-200ms delay on first size request Solution: Pre-generate for popular albums with background job</p>"},{"location":"development/device-integration/android-auto/backend.html#-api-documentation-update","title":"\ud83d\udcdd API Documentation Update","text":"<p>Add to your API docs (<code>src/musiclib/reader.py</code> docstrings):</p> <pre><code>def get_cover_sizes(self, release_dir: str) -&gt; dict[str, str]:\n    \"\"\"Returns URLs for multiple size variants of a cover image.\n\n    Generates size variants on-demand if not already cached.\n\n    Args:\n        release_dir: The release directory identifier for which to retrieve cover variants.\n\n    Returns:\n        dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to relative URL paths.\n\n    Example:\n        &gt;&gt;&gt; sizes = collection.get_cover_sizes(\"Prince/Purple Rain\")\n        &gt;&gt;&gt; print(sizes[\"256x256\"])\n        'covers/prince_purplerain_256x256.jpg'\n    \"\"\"\n</code></pre>"},{"location":"development/device-integration/android-auto/backend.html#next-steps","title":"Next Steps","text":"<p>\ud83d\udc49 Continue to Frontend Integration to update the client-side code.</p>"},{"location":"development/device-integration/android-auto/backend.html#-related-technologies","title":"\ud83d\udd17 Related Technologies","text":"<ul> <li>Chromecast Integration - Alternative casting method for TVs and speakers</li> <li>Player Controls - UI control coordination</li> <li>Media Session API - Lock screen controls</li> </ul>"},{"location":"development/device-integration/android-auto/frontend.html","title":"Frontend Implementation","text":""},{"location":"development/device-integration/android-auto/frontend.html#frontend-integration","title":"Frontend Integration","text":"<p>This page documents the client-side JavaScript changes required for Android Auto integration.</p>"},{"location":"development/device-integration/android-auto/frontend.html#-goals","title":"\ud83c\udfaf Goals","text":"<ol> <li>Detect Android Auto environment accurately</li> <li>Request size-optimized covers based on platform</li> <li>Update MediaSession with proper artwork</li> <li>Maintain backward compatibility</li> </ol>"},{"location":"development/device-integration/android-auto/frontend.html#-modified-files","title":"\ud83d\udcc1 Modified Files","text":""},{"location":"development/device-integration/android-auto/frontend.html#staticjsplayerplayerutilsjs","title":"<code>static/js/player/playerUtils.js</code>","text":"<p>Changed: <code>extractMetadataFromDOM()</code> function Purpose: Request size-appropriate covers based on platform</p>"},{"location":"development/device-integration/android-auto/frontend.html#staticjsplayerandroidautojs","title":"<code>static/js/player/androidAuto.js</code>","text":"<p>Changed: Entire file replaced Purpose: Fix detection and artwork handling</p>"},{"location":"development/device-integration/android-auto/frontend.html#-implementation-details","title":"\ud83d\udd27 Implementation Details","text":""},{"location":"development/device-integration/android-auto/frontend.html#1-update-metadata-extraction","title":"1. Update Metadata Extraction","text":"<p>File: <code>static/js/player/playerUtils.js</code></p> <p>Find this function (around line 268):</p> <pre><code>export function extractMetadataFromDOM(trackElement) {\n    // ... existing code\n}\n</code></pre> <p>Replace with:</p> <pre><code>/**\n * Extract metadata from DOM track element with platform-optimized artwork sizes\n * Uses the new size-optimized cover API endpoints\n */\nexport function extractMetadataFromDOM(trackElement) {\n    const iOS = detectiOS();\n    const android = detectAndroid();\n    const coverImg = trackElement.querySelector('.track-cover');\n    let artwork = [];\n\n    if (coverImg &amp;&amp; coverImg.src) {\n        const mimeType = getMimeTypeFromUrl(coverImg.src);\n\n        // Extract slug from cover URL\n        // Example: /covers/artist_album.jpg -&gt; artist_album\n        const coverUrl = new URL(coverImg.src, window.location.origin);\n        const coverPath = coverUrl.pathname;\n        const slug = coverPath.split('/').pop()\n                              .replace('.jpg', '')\n                              .replace(/_\\d+x\\d+$/, '');\n\n        // Build size-optimized URLs based on platform\n        if (iOS) {\n            // iOS prefers larger sizes for lock screen\n            artwork = [\n                { src: `/covers/${slug}_512x512.jpg`, sizes: '512x512', type: mimeType },\n                { src: `/covers/${slug}_256x256.jpg`, sizes: '256x256', type: mimeType },\n                { src: `/covers/${slug}_192x192.jpg`, sizes: '192x192', type: mimeType }\n            ];\n        } else if (android &amp;&amp; android.isAndroidAuto) {\n            // Android Auto needs full spectrum\n            artwork = [\n                { src: `/covers/${slug}_96x96.jpg`, sizes: '96x96', type: mimeType },\n                { src: `/covers/${slug}_128x128.jpg`, sizes: '128x128', type: mimeType },\n                { src: `/covers/${slug}_192x192.jpg`, sizes: '192x192', type: mimeType },\n                { src: `/covers/${slug}_256x256.jpg`, sizes: '256x256', type: mimeType },\n                { src: `/covers/${slug}_512x512.jpg`, sizes: '512x512', type: mimeType }\n            ];\n        } else {\n            // Desktop - simple set\n            artwork = [\n                { src: `/covers/${slug}_192x192.jpg`, sizes: '192x192', type: mimeType },\n                { src: `/covers/${slug}_512x512.jpg`, sizes: '512x512', type: mimeType }\n            ];\n        }\n    }\n\n    return {\n        title: trackElement.dataset.title || 'Unknown',\n        artist: trackElement.dataset.artist || 'Unknown Artist',\n        album: trackElement.dataset.album || '',\n        artwork: artwork\n    };\n}\n</code></pre> <p>What changed:</p> <ul> <li>Extracts slug from cover URL</li> <li>Builds size-specific URLs based on platform detection</li> <li>Returns array of artwork objects with multiple sizes</li> </ul>"},{"location":"development/device-integration/android-auto/frontend.html#2-replace-android-auto-module","title":"2. Replace Android Auto Module","text":"<p>File: <code>static/js/player/androidAuto.js</code></p> <p>Action: Replace entire file with the new version</p> <p>Key changes in new version:</p>"},{"location":"development/device-integration/android-auto/frontend.html#a-fixed-detection","title":"A. Fixed Detection","text":"<pre><code>async detectAndroidAuto() {\n    const userAgent = navigator.userAgent.toLowerCase();\n\n    // Check for Android Automotive OS or Android Auto indicators\n    const hasAutomotiveUA = userAgent.includes('android') &amp;&amp;\n                           (userAgent.includes('automotive') ||\n                            userAgent.includes('car'));\n\n    // Check for fullscreen/standalone mode\n    const isFullscreen = window.matchMedia('(display-mode: fullscreen)').matches ||\n                       window.matchMedia('(display-mode: standalone)').matches;\n\n    // Check for car-like display dimensions\n    const hasCarDimensions = window.screen.width &gt;= 800 &amp;&amp;\n                            window.screen.height &gt;= 480 &amp;&amp;\n                            window.screen.width / window.screen.height &gt; 1.5;\n\n    // Android Auto WebView exposes specific APIs\n    const hasAndroidAutoAPI = typeof window.AndroidAuto !== 'undefined';\n\n    // Check if running in WebView\n    const isWebView = userAgent.includes('wv');\n\n    // Combine signals for reliable detection\n    this.isAndroidAuto = hasAndroidAutoAPI ||\n                        (hasAutomotiveUA &amp;&amp; isFullscreen) ||\n                        (isWebView &amp;&amp; isFullscreen &amp;&amp; hasCarDimensions);\n\n    return this.isAndroidAuto;\n}\n</code></pre> <p>Why this fixes the bug:</p> <ul> <li>\u274c Removed <code>getInstalledRelatedApps()</code> - caused false positives</li> <li>\u2705 Added specific automotive indicators</li> <li>\u2705 Requires multiple signals to match</li> <li>\u2705 Validates display characteristics</li> </ul>"},{"location":"development/device-integration/android-auto/frontend.html#b-fixed-artwork-handling","title":"B. Fixed Artwork Handling","text":"<pre><code>prepareArtwork(artworkArray) {\n    if (!artworkArray || artworkArray.length === 0) {\n        return this.getFallbackArtwork();\n    }\n\n    // Preserve the size-specific URLs from the backend\n    // No longer duplicates a single URL\n    return artworkArray.map(art =&gt; ({\n        src: art.src,           // Keeps size-optimized URL\n        sizes: art.sizes,       // Keeps declared size\n        type: art.type || 'image/jpeg'\n    }));\n}\n</code></pre> <p>Why this is important:</p> <ul> <li>\u274c Old code duplicated one URL for all sizes</li> <li>\u2705 New code preserves each size-specific URL</li> <li>\u2705 Browser/Android Auto picks best size automatically</li> </ul>"},{"location":"development/device-integration/android-auto/frontend.html#-integration-flow","title":"\ud83d\udd04 Integration Flow","text":"<pre><code>sequenceDiagram\n    participant User\n    participant PlayerControls\n    participant PlayerUtils\n    participant AndroidAuto\n    participant Flask\n\n    User-&gt;&gt;PlayerControls: Click track\n    PlayerControls-&gt;&gt;PlayerUtils: extractMetadataFromDOM()\n    PlayerUtils-&gt;&gt;PlayerUtils: detectAndroid()\n\n    alt Is Android Auto\n        PlayerUtils-&gt;&gt;PlayerUtils: Build 5 size URLs\n        PlayerUtils--&gt;&gt;PlayerControls: metadata with 5 artwork entries\n    else Is iOS\n        PlayerUtils-&gt;&gt;PlayerUtils: Build 3 size URLs\n        PlayerUtils--&gt;&gt;PlayerControls: metadata with 3 artwork entries\n    else Is Desktop\n        PlayerUtils-&gt;&gt;PlayerUtils: Build 2 size URLs\n        PlayerUtils--&gt;&gt;PlayerControls: metadata with 2 artwork entries\n    end\n\n    PlayerControls-&gt;&gt;AndroidAuto: updateMediaMetadata(metadata)\n    AndroidAuto-&gt;&gt;AndroidAuto: prepareArtwork()\n    AndroidAuto-&gt;&gt;Navigator: Update MediaSession\n\n    Navigator-&gt;&gt;Flask: GET /covers/slug_256x256.jpg\n    Flask--&gt;&gt;Navigator: 200 OK (40KB)\n    Navigator-&gt;&gt;User: Display artwork in Android Auto</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/device-integration/android-auto/frontend.html#-platform-specific-artwork","title":"\ud83d\udcca Platform-Specific Artwork","text":""},{"location":"development/device-integration/android-auto/frontend.html#android-auto","title":"Android Auto","text":"<p>Sizes requested: 96, 128, 192, 256, 512 px</p> <pre><code>artwork = [\n    { src: '/covers/slug_96x96.jpg', sizes: '96x96', type: 'image/jpeg' },\n    { src: '/covers/slug_128x128.jpg', sizes: '128x128', type: 'image/jpeg' },\n    { src: '/covers/slug_192x192.jpg', sizes: '192x192', type: 'image/jpeg' },\n    { src: '/covers/slug_256x256.jpg', sizes: '256x256', type: 'image/jpeg' },\n    { src: '/covers/slug_512x512.jpg', sizes: '512x512', type: 'image/jpeg' }\n]\n</code></pre> <p>Android Auto typically chooses: 256\u00d7256 (optimal balance)</p>"},{"location":"development/device-integration/android-auto/frontend.html#ios","title":"iOS","text":"<p>Sizes requested: 192, 256, 512 px</p> <pre><code>artwork = [\n    { src: '/covers/slug_512x512.jpg', sizes: '512x512', type: 'image/jpeg' },\n    { src: '/covers/slug_256x256.jpg', sizes: '256x256', type: 'image/jpeg' },\n    { src: '/covers/slug_192x192.jpg', sizes: '192x192', type: 'image/jpeg' }\n]\n</code></pre> <p>iOS typically chooses: 512\u00d7512 (lock screen prefers larger)</p>"},{"location":"development/device-integration/android-auto/frontend.html#desktop","title":"Desktop","text":"<p>Sizes requested: 192, 512 px</p> <pre><code>artwork = [\n    { src: '/covers/slug_192x192.jpg', sizes: '192x192', type: 'image/jpeg' },\n    { src: '/covers/slug_512x512.jpg', sizes: '512x512', type: 'image/jpeg' }\n]\n</code></pre> <p>Desktop typically chooses: 512\u00d7512 (sufficient for most displays)</p>"},{"location":"development/device-integration/android-auto/frontend.html#-testing-in-browser","title":"\ud83e\uddea Testing in Browser","text":""},{"location":"development/device-integration/android-auto/frontend.html#test-detection","title":"Test Detection","text":"<p>Open browser console and run:</p> <pre><code>// Test Android Auto detection\nimport { detectAndroid } from './playerUtils.js';\nconst android = detectAndroid();\nconsole.log('Android Auto:', android?.isAndroidAuto);\n\n// Test metadata extraction\nconst trackEl = document.querySelector('.track-item');\nconst metadata = extractMetadataFromDOM(trackEl);\nconsole.log('Artwork sizes:', metadata.artwork.map(a =&gt; a.sizes));\n</code></pre>"},{"location":"development/device-integration/android-auto/frontend.html#expected-output","title":"Expected Output","text":"<p>On Android Auto:</p> <pre><code>{\n  isAndroid: true,\n  version: 11,\n  isAndroidAuto: true,\n  artwork: [\n    { sizes: '96x96', ... },\n    { sizes: '128x128', ... },\n    { sizes: '192x192', ... },\n    { sizes: '256x256', ... },\n    { sizes: '512x512', ... }\n  ]\n}\n</code></pre> <p>On Regular Mobile Chrome:</p> <pre><code>{\n  isAndroid: true,\n  version: 119,\n  isAndroidAuto: false,  // \u2190 Should be false!\n  artwork: [\n    { sizes: '192x192', ... },\n    { sizes: '512x512', ... }\n  ]\n}\n</code></pre>"},{"location":"development/device-integration/android-auto/frontend.html#-backward-compatibility","title":"\ud83d\udd19 Backward Compatibility","text":""},{"location":"development/device-integration/android-auto/frontend.html#existing-code-unaffected","title":"Existing Code Unaffected","text":"<p>\u2705 <code>playerControls.js</code> - No changes required \u2705 <code>chromecast.js</code> - No changes required \u2705 HTML templates - No changes required \u2705 CSS styles - No changes required</p>"},{"location":"development/device-integration/android-auto/frontend.html#progressive-enhancement","title":"Progressive Enhancement","text":"<ul> <li>Regular browsers get standard artwork</li> <li>Android Auto gets optimized artwork</li> <li>Fallback to main cover if variants missing</li> <li>No breaking changes to API</li> </ul>"},{"location":"development/device-integration/android-auto/frontend.html#-troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"development/device-integration/android-auto/frontend.html#issue-wrong-platform-detected","title":"Issue: Wrong platform detected","text":"<p>Check: Console logs from <code>detectAndroid()</code> and <code>detectiOS()</code> Solution: Verify user agent contains expected strings</p>"},{"location":"development/device-integration/android-auto/frontend.html#issue-all-requests-use-same-size","title":"Issue: All requests use same size","text":"<p>Check: Network tab - are URLs different? Solution: Verify <code>extractMetadataFromDOM()</code> builds proper URLs</p>"},{"location":"development/device-integration/android-auto/frontend.html#issue-images-not-loading","title":"Issue: Images not loading","text":"<p>Check: Browser console for 404 errors Solution: Ensure backend generates variants on first request</p>"},{"location":"development/device-integration/android-auto/frontend.html#issue-mediasession-not-updating","title":"Issue: MediaSession not updating","text":"<p>Check: Does <code>navigator.mediaSession</code> exist? Solution: Requires HTTPS or localhost for MediaSession API</p>"},{"location":"development/device-integration/android-auto/frontend.html#-mobile-testing","title":"\ud83d\udcf1 Mobile Testing","text":""},{"location":"development/device-integration/android-auto/frontend.html#test-on-real-android-device","title":"Test on Real Android Device","text":"<ol> <li>Connect device with USB debugging</li> <li>Open Chrome DevTools \u2192 Remote devices</li> <li>Inspect your app's page</li> <li>Check console logs and network requests</li> </ol>"},{"location":"development/device-integration/android-auto/frontend.html#test-on-ios-device","title":"Test on iOS Device","text":"<ol> <li>Enable Web Inspector on iOS device</li> <li>Connect to Mac with Safari</li> <li>Develop \u2192 Device \u2192 Your page</li> <li>Check console for detection results</li> </ol>"},{"location":"development/device-integration/android-auto/frontend.html#-mediasession-integration","title":"\ud83c\udfa8 MediaSession Integration","text":"<p>The new <code>androidAuto.js</code> properly integrates with MediaSession API:</p> <pre><code>updateMediaMetadata(metadata) {\n    if (!this.mediaSession) return;\n\n    try {\n        // Prepare size-optimized artwork array\n        const artwork = this.prepareArtwork(metadata.artwork);\n\n        // Create MediaMetadata object\n        this.currentMetadata = new MediaMetadata({\n            title: metadata.title || 'Unknown Title',\n            artist: metadata.artist || 'Unknown Artist',\n            album: metadata.album || 'Unknown Album',\n            artwork: artwork  // Multiple sizes for browser to choose\n        });\n\n        this.mediaSession.metadata = this.currentMetadata;\n    } catch (error) {\n        console.error('Failed to update MediaSession metadata:', error);\n    }\n}\n</code></pre> <p>What happens:</p> <ol> <li>Artwork array has multiple sizes</li> <li>Browser/Android Auto chooses best size</li> <li>Only chosen size is downloaded</li> <li>Bandwidth saved automatically</li> </ol>"},{"location":"development/device-integration/android-auto/frontend.html#-performance-monitoring","title":"\ud83d\udcc8 Performance Monitoring","text":"<p>Add performance tracking:</p> <pre><code>// In extractMetadataFromDOM()\nconst startTime = performance.now();\nconst metadata = extractMetadataFromDOM(trackElement);\nconst endTime = performance.now();\nconsole.log(`Metadata extraction: ${endTime - startTime}ms`);\n\n// Track artwork load times\nmetadata.artwork.forEach(art =&gt; {\n    const img = new Image();\n    const loadStart = performance.now();\n    img.onload = () =&gt; {\n        const loadTime = performance.now() - loadStart;\n        console.log(`Loaded ${art.sizes}: ${loadTime}ms`);\n    };\n    img.src = art.src;\n});\n</code></pre>"},{"location":"development/device-integration/android-auto/frontend.html#next-steps","title":"Next Steps","text":"<p>\ud83d\udc49 Continue to Testing Guide to verify your integration works correctly.</p>"},{"location":"development/device-integration/android-auto/overview.html","title":"Integration Overview","text":""},{"location":"development/device-integration/android-auto/overview.html#android-auto-integration","title":"Android Auto Integration","text":"<p>Mixtape Society supports Android Auto for seamless in-car playback through the Media Session API, providing steering wheel controls, dashboard integration, and voice command support.</p>"},{"location":"development/device-integration/android-auto/overview.html#-overview","title":"\ud83c\udfaf Overview","text":"<p>Android Auto integration enables:</p> <ul> <li>Dashboard integration - Control from car touchscreen</li> <li>Voice commands - \"OK Google, pause\", \"next song\"</li> <li>Steering wheel controls - Physical car buttons</li> <li>Safe driving mode - Simplified, distraction-free interface</li> <li>Full metadata display - Album art and track info on display</li> <li>Automatic connection - Works when phone connects to car</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#key-differences-from-chromecast","title":"Key Differences from Chromecast","text":"Feature Android Auto Chromecast Network Local playback WiFi casting Setup Automatic Manual device selection Server Reqs None CORS + Range requests API Media Session only Cast SDK + Media Session Artwork Platform-optimized Single size Seeking Built-in Requires range requests <p>Android Auto is simpler - it's just enhanced Media Session API with no network complexity.</p>"},{"location":"development/device-integration/android-auto/overview.html#-architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"development/device-integration/android-auto/overview.html#system-overview","title":"System Overview","text":"<pre><code>graph LR\n    User[User in Car]\n    Car[Car Dashboard]\n    Phone[Phone Browser]\n    PlayerControls[playerControls.js]\n    AndroidAuto[androidAuto.js]\n    MediaSession[Media Session API]\n    Audio[Audio Element]\n\n    User --&gt; Car\n    Car --&gt; Phone\n    Phone --&gt; PlayerControls\n    PlayerControls --&gt; AndroidAuto\n    AndroidAuto --&gt; MediaSession\n    MediaSession --&gt; Audio\n\n    style AndroidAuto fill:#4a6fa5\n    style MediaSession fill:#c65d5d\n    style Car fill:#4a8c5f</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/device-integration/android-auto/overview.html#component-interaction","title":"Component Interaction","text":"<pre><code>sequenceDiagram\n    actor User\n    participant PlayerControls as playerControls.js\n    participant PlayerUtils as playerUtils.js\n    participant AndroidAuto as androidAuto.js\n    participant Audio as main_player\n\n    User-&gt;&gt;PlayerControls: initPlayerControls()\n    PlayerControls-&gt;&gt;PlayerUtils: detectiOS()\n    PlayerControls-&gt;&gt;PlayerUtils: detectAndroid()\n    PlayerControls-&gt;&gt;PlayerUtils: logDeviceInfo()\n    alt Android device\n        PlayerControls-&gt;&gt;AndroidAuto: logAndroidAutoStatus()\n    end\n\n    User-&gt;&gt;PlayerControls: tap track item\n    PlayerControls-&gt;&gt;PlayerControls: playTrack(index)\n    alt Casting active\n        PlayerControls-&gt;&gt;PlayerControls: castJumpToTrack(index)\n        PlayerControls-&gt;&gt;PlayerControls: return (Chromecast handles Media Session)\n    else Local playback\n        PlayerControls-&gt;&gt;Audio: set src and play()\n        PlayerControls-&gt;&gt;PlayerUtils: extractMetadataFromDOM(trackElement)\n        PlayerUtils--&gt;&gt;PlayerControls: metadata (title, artist, album, artwork)\n        alt AndroidAuto connected\n            PlayerControls-&gt;&gt;AndroidAuto: isAndroidAutoConnected()\n            AndroidAuto--&gt;&gt;PlayerControls: true\n            PlayerControls-&gt;&gt;AndroidAuto: setupAndroidAutoMediaSession(metadata, playerControlsAPI, Audio)\n            AndroidAuto-&gt;&gt;AndroidAuto: prepareArtwork(metadata.artwork)\n            AndroidAuto-&gt;&gt;AndroidAuto: setupActionHandlers(playerControlsAPI, Audio)\n            AndroidAuto-&gt;&gt;AndroidAuto: setupAudioEventListeners(Audio)\n        else Not AndroidAuto\n            PlayerControls-&gt;&gt;AndroidAuto: isAndroidAutoConnected()\n            AndroidAuto--&gt;&gt;PlayerControls: false\n            PlayerControls-&gt;&gt;PlayerUtils: setupLocalMediaSession(metadata, playerControlsAPI)\n        end\n    end\n\n    User-&gt;&gt;PlayerControls: stop playback\n    alt AndroidAuto connected\n        PlayerControls-&gt;&gt;AndroidAuto: clearAndroidAutoMediaSession()\n    else Not AndroidAuto\n        PlayerControls-&gt;&gt;PlayerUtils: clearMediaSession()\n    end</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/device-integration/android-auto/overview.html#class-relationships","title":"Class Relationships","text":"<pre><code>classDiagram\n    class PlayerUtils {\n        +detectiOS()\n        +detectAndroid()\n        +logDeviceInfo()\n        +setupLocalMediaSession(metadata, playerControls)\n        +clearMediaSession()\n        +updateMediaSessionPlaybackState(state)\n        +updateMediaSessionPosition(position, duration, playbackRate)\n        +getMimeTypeFromUrl(url)\n        +extractMetadataFromDOM(trackElement)\n    }\n\n    class PlayerControls {\n        +initPlayerControls()\n        -checkCastingState()\n        -playTrack(index)\n        -updatePositionState()\n        -syncPlayIcons()\n        -togglePlayPause()\n        -silenceLocalPlayer()\n        -enableLocalPlayer()\n        -updateLocalMediaSession(metadata)\n        -currentIndex\n        -isCurrentlyCasting\n        -playerControlsAPI\n    }\n\n    class AndroidAutoModule {\n        +isAndroidAutoConnected()\n        +setupAndroidAutoMediaSession(metadata, playerControls, audioElement)\n        +clearAndroidAutoMediaSession()\n        +logAndroidAutoStatus()\n        -prepareArtwork(originalArtwork)\n        -setupActionHandlers(playerControls, audioElement)\n        -updatePositionState(audioElement)\n        -setupAudioEventListeners(audioElement)\n        -ANDROID_AUTO_ARTWORK_SIZES\n    }\n\n    class MediaSessionAPI {\n        +metadata\n        +playbackState\n        +setActionHandler(action, handler)\n        +setPositionState(state)\n    }\n\n    PlayerControls ..&gt; PlayerUtils : uses\n    PlayerControls ..&gt; AndroidAutoModule : uses\n    AndroidAutoModule ..&gt; MediaSessionAPI : configures\n    PlayerUtils ..&gt; MediaSessionAPI : setupLocalMediaSession()</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/device-integration/android-auto/overview.html#-quick-start","title":"\ud83d\ude80 Quick Start","text":""},{"location":"development/device-integration/android-auto/overview.html#prerequisites","title":"Prerequisites","text":"<p>User Requirements:</p> <ul> <li>Android phone (Android 5.0+)</li> <li>Car with Android Auto support OR Android Auto app</li> <li>USB cable or wireless Android Auto</li> </ul> <p>Developer Requirements:</p> <ul> <li>Media Session API support (already in Mixtape Society)</li> <li>Cover art optimization endpoints (already implemented)</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#testing-connection","title":"Testing Connection","text":"<ol> <li>Connect phone to car (USB or wireless)</li> <li>Open Mixtape Society in browser</li> <li>Play a mixtape</li> <li>Check car display - should show track info</li> <li>Test controls - steering wheel buttons, voice commands</li> </ol>"},{"location":"development/device-integration/android-auto/overview.html#verification","title":"Verification","text":"<p>Check browser console for:</p> <pre><code>\ud83d\ude97 Android Auto Status:\n   Connected: Yes \u2705\n   Media Session API: Available \u2705\n   User Agent: ... Android ... automotive ...\n</code></pre>"},{"location":"development/device-integration/android-auto/overview.html#-core-components","title":"\ud83d\udce6 Core Components","text":""},{"location":"development/device-integration/android-auto/overview.html#1-detection-module","title":"1. Detection Module","text":"<p>File: <code>static/js/player/androidAuto.js</code></p> <p>Detection logic:</p> <pre><code>export function isAndroidAutoConnected() {\n    const ua = navigator.userAgent.toLowerCase();\n    const isAndroidAuto = ua.includes('android') &amp;&amp; (\n        ua.includes('vehicle') ||\n        ua.includes('automotive') ||\n        document.referrer.includes('android-auto')\n    );\n\n    const hasAutoAPIs = 'getInstalledRelatedApps' in navigator;\n\n    return isAndroidAuto || hasAutoAPIs;\n}\n</code></pre> <p>User agent patterns:</p> <ul> <li>Contains \"android\"</li> <li>Contains \"vehicle\" OR \"automotive\"</li> <li>Referrer includes \"android-auto\"</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#2-media-session-setup","title":"2. Media Session Setup","text":"<p>Enhanced for Android Auto:</p> <pre><code>export function setupAndroidAutoMediaSession(metadata, playerControls, audioElement) {\n    // 1. Set metadata with optimized artwork\n    const artwork = prepareArtwork(metadata.artwork);\n\n    navigator.mediaSession.metadata = new MediaMetadata({\n        title: metadata.title || 'Unknown Track',\n        artist: metadata.artist || 'Unknown Artist',\n        album: metadata.album || 'Mixtape',\n        artwork: artwork  // Multiple sizes for Android Auto\n    });\n\n    // 2. Set playback state\n    navigator.mediaSession.playbackState = audioElement.paused ? 'paused' : 'playing';\n\n    // 3. Set ALL action handlers (including seek)\n    setupActionHandlers(playerControls, audioElement);\n\n    // 4. Set position state (CRITICAL for seeking)\n    updatePositionState(audioElement);\n\n    // 5. Listen for audio events\n    setupAudioEventListeners(audioElement);\n}\n</code></pre>"},{"location":"development/device-integration/android-auto/overview.html#3-artwork-optimization","title":"3. Artwork Optimization","text":"<p>Android Auto requires multiple sizes:</p> <pre><code>const ANDROID_AUTO_ARTWORK_SIZES = [\n    { size: '96x96', type: 'image/jpeg' },    // Required minimum\n    { size: '128x128', type: 'image/jpeg' },  // Recommended\n    { size: '192x192', type: 'image/jpeg' },  // Optimal\n    { size: '256x256', type: 'image/jpeg' },  // High quality\n    { size: '512x512', type: 'image/jpeg' }   // Maximum\n];\n</code></pre> <p>Platform detection in playerUtils.js:</p> <pre><code>export function extractMetadataFromDOM(trackElement) {\n    const android = detectAndroid();\n\n    if (android &amp;&amp; android.isAndroidAuto) {\n        // Request all sizes for Android Auto\n        artwork = [\n            { src: `/covers/${slug}_96x96.jpg`, sizes: '96x96', type: mimeType },\n            { src: `/covers/${slug}_128x128.jpg`, sizes: '128x128', type: mimeType },\n            { src: `/covers/${slug}_192x192.jpg`, sizes: '192x192', type: mimeType },\n            { src: `/covers/${slug}_256x256.jpg`, sizes: '256x256', type: mimeType },\n            { src: `/covers/${slug}_512x512.jpg`, sizes: '512x512', type: mimeType }\n        ];\n    }\n}\n</code></pre>"},{"location":"development/device-integration/android-auto/overview.html#4-action-handlers","title":"4. Action Handlers","text":"<p>Complete set for Android Auto:</p> <pre><code>function setupActionHandlers(playerControls, audioElement) {\n    // Basic playback\n    navigator.mediaSession.setActionHandler('play', () =&gt; playerControls.play());\n    navigator.mediaSession.setActionHandler('pause', () =&gt; playerControls.pause());\n    navigator.mediaSession.setActionHandler('stop', () =&gt; {\n        playerControls.pause();\n        audioElement.currentTime = 0;\n    });\n\n    // Track navigation\n    navigator.mediaSession.setActionHandler('previoustrack', () =&gt; playerControls.previous());\n    navigator.mediaSession.setActionHandler('nexttrack', () =&gt; playerControls.next());\n\n    // Seeking (CRITICAL for Android Auto)\n    navigator.mediaSession.setActionHandler('seekto', (details) =&gt; {\n        if (details.seekTime !== undefined) {\n            audioElement.currentTime = details.seekTime;\n            updatePositionState(audioElement);\n        }\n    });\n\n    // Optional: Seek forward/backward (10 seconds)\n    navigator.mediaSession.setActionHandler('seekforward', () =&gt; {\n        audioElement.currentTime = Math.min(\n            audioElement.currentTime + 10,\n            audioElement.duration\n        );\n    });\n\n    navigator.mediaSession.setActionHandler('seekbackward', () =&gt; {\n        audioElement.currentTime = Math.max(\n            audioElement.currentTime - 10,\n            0\n        );\n    });\n}\n</code></pre>"},{"location":"development/device-integration/android-auto/overview.html#5-position-state-management","title":"5. Position State Management","text":"<p>Updates every second during playback:</p> <pre><code>function updatePositionState(audioElement) {\n    if (!('setPositionState' in navigator.mediaSession)) return;\n\n    if (audioElement.duration &amp;&amp; !isNaN(audioElement.duration)) {\n        try {\n            navigator.mediaSession.setPositionState({\n                duration: audioElement.duration,\n                playbackRate: audioElement.playbackRate,\n                position: Math.min(audioElement.currentTime, audioElement.duration)\n            });\n        } catch (error) {\n            console.warn('Could not set position state:', error);\n        }\n    }\n}\n\n// Update automatically during playback\nlet positionUpdateInterval;\n\naudioElement.addEventListener('play', () =&gt; {\n    positionUpdateInterval = setInterval(() =&gt; {\n        updatePositionState(audioElement);\n    }, 1000);  // Update every second\n});\n\naudioElement.addEventListener('pause', () =&gt; {\n    clearInterval(positionUpdateInterval);\n});\n</code></pre>"},{"location":"development/device-integration/android-auto/overview.html#-how-it-works","title":"\ud83c\udfa8 How It Works","text":""},{"location":"development/device-integration/android-auto/overview.html#user-journey","title":"User Journey","text":"<ol> <li>User connects phone to car</li> <li>USB cable or wireless Android Auto</li> <li> <p>Car recognizes Android Auto device</p> </li> <li> <p>User opens Mixtape Society</p> </li> <li>Browser detects Android Auto environment</li> <li> <p><code>isAndroidAutoConnected()</code> returns true</p> </li> <li> <p>User plays a mixtape</p> </li> <li><code>setupAndroidAutoMediaSession()</code> called</li> <li>Enhanced metadata with multiple cover sizes</li> <li> <p>All action handlers configured</p> </li> <li> <p>Track displays on car dashboard</p> </li> <li>Cover art (optimal size selected)</li> <li>Track title and artist</li> <li> <p>Album name</p> </li> <li> <p>User controls playback</p> </li> <li>Steering wheel buttons \u2192 action handlers</li> <li>Voice commands \u2192 Media Session API</li> <li> <p>Touchscreen \u2192 browser controls</p> </li> <li> <p>Seeking works seamlessly</p> </li> <li>Car scrubs timeline \u2192 <code>seekto</code> handler</li> <li>Position updates every second</li> <li>Accurate progress display</li> </ol>"},{"location":"development/device-integration/android-auto/overview.html#technical-flow","title":"Technical Flow","text":"<p>Initialization:</p> <pre><code>initPlayerControls()\n  \u2192 detectAndroid()\n  \u2192 logAndroidAutoStatus()\n  \u2192 Ready for playback\n</code></pre> <p>Track Change:</p> <pre><code>playTrack(index)\n  \u2192 extractMetadataFromDOM()\n    \u2192 Detect Android Auto\n    \u2192 Build artwork array (5 sizes)\n  \u2192 setupAndroidAutoMediaSession()\n    \u2192 Set metadata\n    \u2192 Configure action handlers\n    \u2192 Start position updates\n</code></pre> <p>User Interaction:</p> <pre><code>User presses steering wheel button\n  \u2192 Car sends Media Session event\n  \u2192 Action handler fires\n  \u2192 Player responds (play/pause/next/etc)\n  \u2192 UI updates\n</code></pre>"},{"location":"development/device-integration/android-auto/overview.html#-backend-requirements","title":"\ud83d\udd27 Backend Requirements","text":""},{"location":"development/device-integration/android-auto/overview.html#cover-art-endpoints","title":"Cover Art Endpoints","text":"<p>Required endpoints (already implemented):</p> <pre><code>GET /covers/{slug}_96x96.jpg\nGET /covers/{slug}_128x128.jpg\nGET /covers/{slug}_192x192.jpg\nGET /covers/{slug}_256x256.jpg\nGET /covers/{slug}_512x512.jpg\n</code></pre> <p>Implementation: See Backend Implementation Guide</p>"},{"location":"development/device-integration/android-auto/overview.html#no-special-server-requirements","title":"No Special Server Requirements","text":"<p>Unlike Chromecast, Android Auto requires no server changes:</p> <ul> <li>\u274c No CORS headers needed (local playback)</li> <li>\u274c No range request handling needed</li> <li>\u274c No special MIME types</li> <li>\u2705 Just standard audio streaming</li> </ul> <p>The complexity is all client-side.</p>"},{"location":"development/device-integration/android-auto/overview.html#-platform-support","title":"\ud83d\udcf1 Platform Support","text":""},{"location":"development/device-integration/android-auto/overview.html#android-auto-in-car","title":"Android Auto (In-Car)","text":"<p>Full support:</p> <ul> <li>\u2705 Dashboard integration</li> <li>\u2705 Steering wheel controls</li> <li>\u2705 Voice commands</li> <li>\u2705 Position state and seeking</li> <li>\u2705 Multiple cover art sizes</li> </ul> <p>Requirements:</p> <ul> <li>Android 5.0+ phone</li> <li>Android Auto compatible car OR Android Auto app</li> <li>Media Session API support (all modern Android)</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#android-not-in-car","title":"Android (Not in Car)","text":"<p>Standard Media Session:</p> <ul> <li>\u2705 Notification controls</li> <li>\u2705 Lock screen controls</li> <li>\u2705 Basic metadata</li> <li>\u2705 Single cover art size</li> </ul> <p>Difference: Android Auto detection returns false, so it falls back to standard Media Session setup via <code>playerUtils.setupLocalMediaSession()</code>.</p>"},{"location":"development/device-integration/android-auto/overview.html#other-platforms","title":"Other Platforms","text":"<p>iOS, Desktop:</p> <ul> <li>Standard Media Session API</li> <li>No Android Auto enhancements</li> <li>Single cover art size</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#-testing","title":"\ud83e\uddea Testing","text":"<p>For complete testing procedures, see the Testing Guide.</p> <p>Quick checklist:</p> <ul> <li> Detection works (console shows \"Android Auto Connected\")</li> <li> Cover art displays on dashboard</li> <li> Metadata shows correctly (title, artist, album)</li> <li> Play/pause from steering wheel</li> <li> Next/previous track from controls</li> <li> Voice commands work (\"OK Google, pause\")</li> <li> Seeking from dashboard timeline</li> <li> Position updates in real-time</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#-troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"development/device-integration/android-auto/overview.html#detection-issues","title":"Detection Issues","text":"<p>Symptom: Android Auto not detected when connected</p> <p>Check:</p> <pre><code>// In browser console:\nnavigator.userAgent\n// Should contain \"android\" and (\"vehicle\" OR \"automotive\")\n</code></pre> <p>Solutions:</p> <ul> <li>Verify car is in Android Auto mode</li> <li>Check USB connection (or wireless pairing)</li> <li>Restart browser</li> <li>Check console for detection logs</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#cover-art-not-showing","title":"Cover Art Not Showing","text":"<p>Symptom: No album art on dashboard</p> <p>Check network tab:</p> <pre><code>GET /covers/artist_album_96x96.jpg - Should return 200\nGET /covers/artist_album_192x192.jpg - Should return 200\n</code></pre> <p>Solutions:</p> <ul> <li>Verify cover optimization is enabled</li> <li>Check cover endpoints return correct MIME type</li> <li>Ensure slugs match between frontend and backend</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#seeking-not-working","title":"Seeking Not Working","text":"<p>Symptom: Timeline scrubbing doesn't work</p> <p>Check:</p> <ul> <li>Position state being set: <code>navigator.mediaSession.setPositionState(...)</code></li> <li>Duration is valid: <code>audioElement.duration</code> is not NaN</li> <li><code>seekto</code> handler is registered</li> </ul> <p>Debug:</p> <pre><code>// Add to setupActionHandlers:\nnavigator.mediaSession.setActionHandler('seekto', (details) =&gt; {\n    console.log('\ud83c\udfaf Seek to:', details.seekTime);\n    audioElement.currentTime = details.seekTime;\n});\n</code></pre>"},{"location":"development/device-integration/android-auto/overview.html#-implementation-guides","title":"\ud83d\udcda Implementation Guides","text":""},{"location":"development/device-integration/android-auto/overview.html#detailed-documentation","title":"Detailed Documentation","text":"<ul> <li>Frontend Integration</li> <li>JavaScript code changes</li> <li>Platform detection</li> <li>Metadata extraction</li> <li> <p>Action handler setup</p> </li> <li> <p>Backend Implementation</p> </li> <li>Cover art optimization</li> <li>Size generation</li> <li> <p>Endpoint configuration</p> </li> <li> <p>Testing Guide</p> </li> <li>Test environment setup</li> <li>Validation procedures</li> <li>Common test cases</li> <li>Debug logging</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#related-technologies","title":"Related Technologies","text":"<ul> <li>Chromecast Integration</li> <li>Alternative casting method</li> <li>Network-based playback</li> <li> <p>Different use case</p> </li> <li> <p>Player Controls</p> </li> <li>UI control coordination</li> <li> <p>State management</p> </li> <li> <p>Cover Art System</p> </li> <li>Size optimization</li> <li>Image processing</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#-future-enhancements","title":"\ud83c\udfaf Future Enhancements","text":""},{"location":"development/device-integration/android-auto/overview.html#planned","title":"Planned","text":"<ul> <li>Lyrics sync - Display synchronized lyrics on dashboard</li> <li>Playlist editing - Reorder queue from car interface</li> <li>Enhanced voice - Natural language commands</li> </ul>"},{"location":"development/device-integration/android-auto/overview.html#under-consideration","title":"Under Consideration","text":"<ul> <li>Multiple queues - Save different playlists for different trips</li> <li>Offline mode - Download mixtapes for offline in-car playback</li> <li>Car profile - Remember settings per vehicle</li> </ul> <p>For implementation details, see the Frontend Integration Guide and Backend Implementation Guide.</p>"},{"location":"development/device-integration/android-auto/testing.html","title":"Testing Guide","text":""},{"location":"development/device-integration/android-auto/testing.html#testing-guide---android-auto","title":"Testing Guide - Android Auto","text":"<p>This page explains how to test your Android Auto integration using Google's Desktop Head Unit (DHU) tool.</p>"},{"location":"development/device-integration/android-auto/testing.html#overview","title":"Overview","text":"<p>The Desktop Head Unit (DHU) is Google's official tool for testing Android Auto apps without needing a physical car or compatible head unit. It simulates the car display on your computer while your Android device (physical or emulator) provides the processing.</p>"},{"location":"development/device-integration/android-auto/testing.html#prerequisites","title":"Prerequisites","text":""},{"location":"development/device-integration/android-auto/testing.html#required-software","title":"Required Software","text":"<ol> <li>Android Studio - Latest stable version</li> <li>Android SDK Platform Tools - Included with Android Studio</li> <li>Desktop Head Unit (DHU) - Download from Android SDK Manager</li> <li>Android Device or Emulator - Android 10+ with Google APIs</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#system-requirements","title":"System Requirements","text":"<ul> <li>OS: Windows, macOS, or Linux</li> <li>RAM: 8GB minimum (16GB recommended for emulator)</li> <li>Storage: 10GB free space</li> <li>Network: Android device and computer on same network</li> </ul>"},{"location":"development/device-integration/android-auto/testing.html#step-1-install-desktop-head-unit","title":"Step 1: Install Desktop Head Unit","text":""},{"location":"development/device-integration/android-auto/testing.html#option-a-android-studio-sdk-manager","title":"Option A: Android Studio SDK Manager","text":"<ol> <li>Open Android Studio</li> <li>Go to Tools \u2192 SDK Manager</li> <li>Select the SDK Tools tab</li> <li>Check Android Auto Desktop Head Unit</li> <li>Click Apply to download and install</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#option-b-command-line","title":"Option B: Command Line","text":"<pre><code># Navigate to Android SDK directory\ncd ~/Android/Sdk\n\n# Install DHU\n./tools/bin/sdkmanager \"extras;google;auto\"\n\n# Verify installation\nls platform-tools/desktop-head-unit*\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#step-2-prepare-android-device","title":"Step 2: Prepare Android Device","text":""},{"location":"development/device-integration/android-auto/testing.html#physical-device-setup","title":"Physical Device Setup","text":"<ol> <li>Enable Developer Mode:</li> <li>Go to Settings \u2192 About phone</li> <li>Tap Build number 7 times</li> <li> <p>Return to Settings, find Developer options</p> </li> <li> <p>Enable USB Debugging:</p> </li> <li>Settings \u2192 Developer options \u2192 USB debugging</li> <li> <p>Toggle ON</p> </li> <li> <p>Install Android Auto App:</p> </li> <li>Download from Google Play Store</li> <li> <p>Open and complete initial setup</p> </li> <li> <p>Enable Android Auto Developer Mode:</p> </li> <li>Open Android Auto app</li> <li>Tap hamburger menu (\u2261) \u2192 About</li> <li>Tap version number 10 times</li> <li> <p>Developer mode enabled message appears</p> </li> <li> <p>Enable Unknown Sources:</p> </li> <li>Return to menu \u2192 Developer settings</li> <li> <p>Toggle Unknown sources ON</p> </li> <li> <p>Connect to Computer:</p> </li> <li>Use USB cable</li> <li>Accept USB debugging prompt on device</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#android-emulator-setup","title":"Android Emulator Setup","text":"<ol> <li>Create AVD with Google APIs:</li> <li>Open Tools \u2192 Device Manager</li> <li>Click Create Device</li> <li>Select device (e.g., Pixel 5)</li> <li>Choose system image: Android 10+ with Google APIs</li> <li> <p>Click Finish</p> </li> <li> <p>Launch Emulator:</p> </li> <li>Click play button next to AVD</li> <li> <p>Wait for emulator to boot</p> </li> <li> <p>Install Android Auto:</p> </li> <li>Open Play Store in emulator</li> <li>Search for \"Android Auto\"</li> <li> <p>Install and set up</p> </li> <li> <p>Enable Developer Mode:</p> </li> <li>Follow same steps as physical device</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#step-3-start-flask-server","title":"Step 3: Start Flask Server","text":"<p>Your Flask app must be accessible from the Android device:</p> <pre><code># Start Flask with network access\nflask run --host=0.0.0.0 --port=5000\n\n# Verify Flask is running\ncurl http://localhost:5000/\n\n# Note your computer's local IP\n# macOS/Linux: ifconfig | grep \"inet \"\n# Windows: ipconfig\n\n# Example IP: 192.168.1.100\n</code></pre> <p>Important: Use your computer's local IP address (not localhost) when accessing from Android device.</p>"},{"location":"development/device-integration/android-auto/testing.html#step-4-launch-desktop-head-unit","title":"Step 4: Launch Desktop Head Unit","text":""},{"location":"development/device-integration/android-auto/testing.html#start-dhu","title":"Start DHU","text":"<pre><code># Navigate to platform-tools\ncd ~/Android/Sdk/platform-tools\n\n# Launch DHU (default port 5277)\n./desktop-head-unit\n\n# Or specify port\n./desktop-head-unit --port 5277\n</code></pre> <p>Windows:</p> <pre><code>cd %LOCALAPPDATA%\\Android\\Sdk\\platform-tools\ndesktop-head-unit.exe\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#dhu-window","title":"DHU Window","text":"<p>When DHU launches, you'll see:</p> <ul> <li>Simulated car display (touchscreen)</li> <li>Control buttons (home, back, etc.)</li> <li>Debug console in terminal</li> </ul>"},{"location":"development/device-integration/android-auto/testing.html#step-5-connect-android-device-to-dhu","title":"Step 5: Connect Android Device to DHU","text":""},{"location":"development/device-integration/android-auto/testing.html#automatic-connection","title":"Automatic Connection","text":"<p>DHU automatically connects to Android devices via ADB:</p> <pre><code># Verify device is connected\nadb devices\n\n# Should show:\n# List of devices attached\n# ABC123XYZ    device\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#manual-connection-if-needed","title":"Manual Connection (if needed)","text":"<pre><code># Forward DHU port to device\nadb forward tcp:5277 tcp:5277\n\n# Start Android Auto on device\nadb shell am start -n com.google.android.projection.gearhead/.MainActivity\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#verify-connection","title":"Verify Connection","text":"<p>On DHU window, you should see:</p> <ul> <li>Android Auto home screen</li> <li>Available apps listed</li> <li>\"Mixtape Society\" appears (if web app is accessible)</li> </ul>"},{"location":"development/device-integration/android-auto/testing.html#step-6-test-your-app","title":"Step 6: Test Your App","text":""},{"location":"development/device-integration/android-auto/testing.html#access-mixtape-society","title":"Access Mixtape Society","text":"<ol> <li>Open Browser on Android Device:</li> <li>Navigate to <code>http://192.168.1.100:5000</code> (your Flask IP)</li> <li> <p>Open a mixtape</p> </li> <li> <p>Check DHU Display:</p> </li> <li>Mixtape should appear in Android Auto interface</li> <li>Cover art should display</li> <li>Controls should be responsive</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#test-playback","title":"Test Playback","text":"<ol> <li>Play a Track:</li> <li>Click play button in DHU</li> <li>Audio should play on Android device</li> <li> <p>Metadata should update in DHU</p> </li> <li> <p>Test Controls:</p> </li> <li>\u25b6\ufe0f Play - Should start playback</li> <li>\u23f8\ufe0f Pause - Should pause playback</li> <li>\u23ed\ufe0f Next - Should skip to next track</li> <li> <p>\u23ee\ufe0f Previous - Should go to previous track</p> </li> <li> <p>Test Seeking:</p> </li> <li>Drag progress bar in DHU</li> <li>Playback position should update</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#step-7-verify-cover-art-optimization","title":"Step 7: Verify Cover Art Optimization","text":""},{"location":"development/device-integration/android-auto/testing.html#monitor-network-requests","title":"Monitor Network Requests","text":"<p>In Android Device Chrome:</p> <ol> <li>Enable Remote Debugging:</li> <li>Chrome desktop \u2192 <code>chrome://inspect</code></li> <li>Find your device</li> <li> <p>Click Inspect</p> </li> <li> <p>Check Network Tab:</p> </li> </ol> <pre><code>Request: /covers/artist_album_256x256.jpg\nStatus: 200 OK\nSize: 42.3 KB (transferred)\nTime: 45ms\n</code></pre> <ol> <li>Verify Sizes:</li> <li>Android Auto should request 256\u00d7256 (optimal)</li> <li>Regular mobile should request 128\u00d7128 or 192\u00d7192</li> <li>Desktop should request 512\u00d7512</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#check-dhu-console","title":"Check DHU Console","text":"<p>DHU terminal shows debug output:</p> <pre><code>[DHU] Media session updated\n[DHU] Artwork: http://192.168.1.100:5000/covers/artist_album_256x256.jpg\n[DHU] Title: Summer Vibes\n[DHU] Artist: Various Artists\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#measure-bandwidth-savings","title":"Measure Bandwidth Savings","text":"<p>Before optimization:</p> <pre><code>Request: /covers/artist_album.jpg\nSize: 387 KB\n</code></pre> <p>After optimization:</p> <pre><code>Request: /covers/artist_album_256x256.jpg\nSize: 41 KB\nSavings: 89.4%\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#common-testing-scenarios","title":"Common Testing Scenarios","text":""},{"location":"development/device-integration/android-auto/testing.html#test-case-1-first-time-cover-load","title":"Test Case 1: First-Time Cover Load","text":"<p>Goal: Verify lazy generation works</p> <p>Steps:</p> <ol> <li>Clear cover cache: <code>rm data/cache/covers/*_*x*.jpg</code></li> <li>Play track with no cached variants</li> <li>Observe ~200ms delay on first load</li> <li>Subsequent loads instant (cached)</li> </ol> <p>Expected:</p> <ul> <li>First request: 200-300ms</li> <li>Second request: &lt;10ms</li> <li>Variant files created in cache directory</li> </ul>"},{"location":"development/device-integration/android-auto/testing.html#test-case-2-platform-detection","title":"Test Case 2: Platform Detection","text":"<p>Goal: Verify correct platform detection</p> <p>Test on:</p> <ul> <li>\u2705 Desktop browser \u2192 Should NOT trigger Android Auto mode</li> <li>\u2705 Mobile Chrome \u2192 Should NOT trigger Android Auto mode</li> <li>\u2705 Android Auto DHU \u2192 Should trigger Android Auto mode</li> </ul> <p>Verify:</p> <ul> <li>Console logs show correct detection</li> <li>Appropriate artwork sizes requested</li> <li>UI changes applied (or not)</li> </ul>"},{"location":"development/device-integration/android-auto/testing.html#test-case-3-offline-playback","title":"Test Case 3: Offline Playback","text":"<p>Goal: Test PWA offline capabilities</p> <p>Steps:</p> <ol> <li>Load mixtape while online</li> <li>Disconnect network</li> <li>Attempt to play cached track</li> </ol> <p>Expected:</p> <ul> <li>Previously cached tracks play</li> <li>Cover art shows (if cached)</li> <li>Graceful error for non-cached content</li> </ul>"},{"location":"development/device-integration/android-auto/testing.html#test-case-4-multiple-devices","title":"Test Case 4: Multiple Devices","text":"<p>Goal: Test with different Android versions</p> <p>Test on:</p> <ul> <li>Android 10 device</li> <li>Android 13 device</li> <li>Emulator with different screen sizes</li> </ul> <p>Verify:</p> <ul> <li>All versions work correctly</li> <li>Cover art scales appropriately</li> <li>No crashes or errors</li> </ul>"},{"location":"development/device-integration/android-auto/testing.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/device-integration/android-auto/testing.html#dhu-wont-start","title":"DHU Won't Start","text":"<p>Symptoms: <code>desktop-head-unit</code> command not found</p> <p>Solution:</p> <pre><code># Add to PATH\nexport PATH=$PATH:~/Android/Sdk/platform-tools\n\n# Or use full path\n~/Android/Sdk/platform-tools/desktop-head-unit\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#device-not-connected","title":"Device Not Connected","text":"<p>Symptoms: DHU shows \"Waiting for device...\"</p> <p>Solution:</p> <pre><code># Check ADB connection\nadb devices\n\n# If no devices shown:\nadb kill-server\nadb start-server\nadb devices\n\n# Re-enable USB debugging on device\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#app-not-appearing-in-dhu","title":"App Not Appearing in DHU","text":"<p>Symptoms: DHU home screen doesn't show Mixtape Society</p> <p>Causes &amp; Solutions:</p> <ol> <li>Web app not accessible from device:</li> </ol> <pre><code># On Android device browser, test:\nhttp://YOUR_COMPUTER_IP:5000\n\n# Should load mixtape player\n</code></pre> <ol> <li>Wrong URL in Android Auto:</li> <li>Check device browser URL</li> <li> <p>Must use computer's local IP, not localhost</p> </li> <li> <p>Android Auto not in developer mode:</p> </li> <li>Re-enable developer settings</li> <li>Toggle \"Unknown sources\" ON</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#cover-art-not-showing","title":"Cover Art Not Showing","text":"<p>Symptoms: Tracks play but no cover art in DHU</p> <p>Debug:</p> <ol> <li>Check Network Tab:</li> </ol> <pre><code>Request: /covers/artist_album_256x256.jpg\nStatus: 404 (file not generated)\n</code></pre> <ol> <li>Verify Backend:</li> </ol> <pre><code># Check covers directory\nls -la data/cache/covers/\n\n# Should have variants\n</code></pre> <ol> <li>Check Console Logs:</li> </ol> <pre><code>// Should show:\n\"Generated 256x256 variant for artist_album\"\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#audio-doesnt-play","title":"Audio Doesn't Play","text":"<p>Symptoms: Controls work but no sound</p> <p>Causes:</p> <ol> <li>CORS headers missing:</li> <li>Check Flask response headers</li> <li> <p>Should include <code>Access-Control-Allow-Origin: *</code></p> </li> <li> <p>Audio format unsupported:</p> </li> <li>Check browser console for codec errors</li> <li> <p>Try different audio file</p> </li> <li> <p>Network issue:</p> </li> <li>Check Flask logs</li> <li>Verify HTTP 200 response for audio files</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#performance-benchmarks","title":"Performance Benchmarks","text":"<p>Target performance metrics for Android Auto:</p> Metric Target Acceptable Poor Cover load time (cached) &lt;50ms &lt;100ms &gt;200ms Cover load time (first) &lt;300ms &lt;500ms &gt;1s Cover file size (256\u00d7256) 30-50 KB 50-80 KB &gt;100 KB Playback start delay &lt;500ms &lt;1s &gt;2s Control response time &lt;100ms &lt;300ms &gt;500ms"},{"location":"development/device-integration/android-auto/testing.html#measure-performance","title":"Measure Performance","text":"<pre><code>// Add to playerUtils.js\nconsole.time('cover-load');\nfetch(coverUrl).then(() =&gt; {\n    console.timeEnd('cover-load');\n});\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#automated-testing","title":"Automated Testing","text":""},{"location":"development/device-integration/android-auto/testing.html#playwright-test-example","title":"Playwright Test Example","text":"<pre><code>// tests/android-auto.spec.js\nconst { test, expect } = require('@playwright/test');\n\ntest('Android Auto cover art optimization', async ({ page }) =&gt; {\n    // Navigate to mixtape\n    await page.goto('http://localhost:5000/share/test-mixtape');\n\n    // Play track\n    await page.click('#big-play-btn');\n\n    // Wait for cover art request\n    const coverRequest = await page.waitForRequest(\n        request =&gt; request.url().includes('_256x256.jpg')\n    );\n\n    // Verify correct size requested\n    expect(coverRequest.url()).toContain('_256x256.jpg');\n\n    // Verify response\n    const response = await coverRequest.response();\n    expect(response.status()).toBe(200);\n\n    // Check file size\n    const contentLength = parseInt(response.headers()['content-length']);\n    expect(contentLength).toBeLessThan(100 * 1024); // &lt;100KB\n});\n</code></pre>"},{"location":"development/device-integration/android-auto/testing.html#next-steps","title":"Next Steps","text":"<p>After successful DHU testing:</p> <ol> <li>\u2705 Verify all features work in DHU</li> <li>\u2705 Test on physical device in actual car (if available)</li> <li>\u2705 Monitor bandwidth usage in production</li> <li>\u2705 Gather user feedback</li> <li>\u2192 Deploy to production</li> </ol>"},{"location":"development/device-integration/android-auto/testing.html#related-documentation","title":"Related Documentation","text":"<ul> <li>Backend Implementation - Server-side setup</li> <li>Frontend Integration - Client-side code</li> <li>Android Auto Developer Docs - Official Google docs</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html","title":"Integration Guide","text":""},{"location":"development/device-integration/chromecast/integration.html#chromecast-integration","title":"Chromecast Integration","text":"<p>Mixtape Society supports casting entire mixtapes to Chromecast devices, enabling users to play their curated music collections on TVs and speakers throughout their home with seamless queue management and unified controls.</p>"},{"location":"development/device-integration/chromecast/integration.html#-overview","title":"\ud83c\udfaf Overview","text":"<p>Chromecast integration provides:</p> <ul> <li>Full mixtape casting - Load entire playlist as a queue</li> <li>Unified controls - Control Chromecast from phone, computer, or lock screen</li> <li>Media Session sync - Lock screen and notification controls mirror Chromecast state</li> <li>Local player silencing - Prevents duplicate media controls and battery drain</li> <li>Quality-aware streaming - Respects quality parameter for bandwidth management</li> <li>Cover art display - Shows mixtape and track artwork on TV/receiver</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#-architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"development/device-integration/chromecast/integration.html#system-components","title":"System Components","text":"<pre><code>graph TB\n    User[User Interface]\n    CastBtn[Cast Button]\n    ChromecastJS[chromecast.js]\n    PlayerControls[playerControls.js]\n    PlayerUtils[playerUtils.js]\n    CastSDK[Google Cast SDK]\n    MediaSession[Media Session API]\n    Server[Flask Server]\n    Receiver[Chromecast Device]\n\n    User --&gt; CastBtn\n    CastBtn --&gt; ChromecastJS\n    ChromecastJS --&gt; CastSDK\n    ChromecastJS --&gt; PlayerUtils\n    ChromecastJS --&gt; MediaSession\n    PlayerControls --&gt; ChromecastJS\n    CastSDK &lt;--&gt; Receiver\n    Receiver --&gt; Server\n\n    style ChromecastJS fill:#4a6fa5\n    style CastSDK fill:#c65d5d\n    style Receiver fill:#4a8c5f</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/device-integration/chromecast/integration.html#data-flow","title":"Data Flow","text":"<pre><code>sequenceDiagram\n    actor User\n    participant Browser as Browser Player\n    participant ChromecastJS as chromecast.js\n    participant CastSDK as Google Cast SDK\n    participant Receiver as Chromecast Device\n    participant Server as Flask Server\n\n    User-&gt;&gt;Browser: Click cast button\n    Browser-&gt;&gt;ChromecastJS: extractTracksFromDOM()\n    ChromecastJS--&gt;&gt;Browser: tracks array\n    Browser-&gt;&gt;ChromecastJS: loadPlaylistAndCast(tracks, startIndex)\n\n    alt Existing cast session\n        ChromecastJS-&gt;&gt;CastSDK: loadQueue(currentSession)\n    else No active session\n        ChromecastJS-&gt;&gt;CastSDK: requestSession()\n        CastSDK--&gt;&gt;ChromecastJS: new session\n        ChromecastJS-&gt;&gt;CastSDK: loadQueue(session)\n    end\n\n    ChromecastJS-&gt;&gt;ChromecastJS: silenceLocalPlayer()\n    ChromecastJS-&gt;&gt;ChromecastJS: clearMediaSession()\n\n    CastSDK-&gt;&gt;Receiver: QueueLoadRequest with tracks\n\n    loop For each track\n        Receiver-&gt;&gt;Server: GET /play/&lt;path&gt;?quality=medium\n        Server--&gt;&gt;Receiver: 206/200 audio stream + CORS headers\n        Receiver-&gt;&gt;Receiver: Buffer &amp; decode\n    end\n\n    Receiver-&gt;&gt;CastSDK: Media state updates\n    CastSDK-&gt;&gt;ChromecastJS: Player state callbacks\n    ChromecastJS-&gt;&gt;Browser: Update UI state\n\n    Note over Browser,Receiver: User controls playback via phone/computer\n    Note over Receiver: Audio plays on Chromecast device</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/device-integration/chromecast/integration.html#-core-modules","title":"\ud83d\udce6 Core Modules","text":""},{"location":"development/device-integration/chromecast/integration.html#1-chromecastjs","title":"1. chromecast.js","text":"<p>Location: <code>static/js/player/chromecast.js</code></p> <p>Main module handling all Chromecast interactions.</p>"},{"location":"development/device-integration/chromecast/integration.html#initialization","title":"Initialization","text":"<pre><code>export function initializeCast()\n</code></pre> <p>Responsibilities:</p> <ul> <li>Loads Google Cast SDK from CDN</li> <li>Waits for <code>__onGCastApiAvailable</code> callback</li> <li>Calls <code>initializeCastApi()</code> when ready</li> <li>Dispatches <code>cast:ready</code> event for UI components</li> </ul> <p>Implementation:</p> <pre><code>function initializeCast() {\n    if (typeof chrome === 'undefined' || !chrome.cast) {\n        console.warn('Chrome Cast API not available');\n        return;\n    }\n\n    window['__onGCastApiAvailable'] = function(isAvailable) {\n        if (isAvailable) {\n            initializeCastApi();\n        }\n    };\n\n    // Load Cast SDK\n    const script = document.createElement('script');\n    script.src = 'https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1';\n    document.head.appendChild(script);\n}\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#cast-api-configuration","title":"Cast API Configuration","text":"<pre><code>function initializeCastApi()\n</code></pre> <p>Configuration:</p> <ul> <li>Application ID: <code>CC1AD845</code> (Default Media Receiver)</li> <li>Auto Join Policy: <code>TAB_AND_ORIGIN_SCOPED</code></li> <li>Language: User's browser language</li> <li>Resume Saved Session: <code>true</code></li> </ul> <p>Session Listeners:</p> <ul> <li><code>sessionListener()</code> - Handles new cast sessions</li> <li><code>receiverListener()</code> - Monitors available cast devices</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#session-management","title":"Session Management","text":"<p>Starting a Session:</p> <pre><code>export function loadPlaylistAndCast(tracks, startIndex)\n</code></pre> <p>Process:</p> <ol> <li>Check for existing session</li> <li>Request new session if none active</li> <li>Build queue items with metadata for each track</li> <li>Create <code>QueueLoadRequest</code> with all tracks</li> <li>Load queue to Chromecast (triggers automatic track detection)</li> <li>Silence local player</li> <li>Update UI state</li> </ol> <p>Queue Item Structure:</p> <pre><code>const queueItem = new chrome.cast.media.QueueItem(mediaInfo);\nqueueItem.itemId = index; // Critical for track change detection\n</code></pre> <p>Stopping a Session:</p> <pre><code>export function stopCasting()\n</code></pre> <p>Process:</p> <ol> <li>Stop current Chromecast media</li> <li>End cast session</li> <li>Restore local player controls</li> <li>Clear Media Session</li> <li>Reset UI state</li> </ol>"},{"location":"development/device-integration/chromecast/integration.html#media-control-functions","title":"Media Control Functions","text":"<pre><code>export function castPlay()\nexport function castPause()\nexport function castNext()\nexport function castPrevious()\nexport function castSeek(time)\nexport function castJumpToTrack(index)\nexport function castTogglePlayPause()\n</code></pre> <p>Features:</p> <ul> <li>Direct Chromecast control</li> <li>Error handling</li> <li>State validation</li> <li>Callback notifications</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#state-management","title":"State Management","text":"<p>Global State Variables:</p> <pre><code>export let globalCastingState = false;  // Is casting active?\nlet currentCastSession = null;          // Current Cast session\nlet currentMedia = null;                // Current media controller\nlet castPlayState = 'IDLE';             // Current play state\n</code></pre> <p>State Change Callbacks:</p> <pre><code>let castControlCallbacks = {\n    onCastStart: null,\n    onCastEnd: null,\n    onTrackChange: null,\n    onPlayStateChange: null,\n    onTimeUpdate: null,\n    onVolumeChange: null\n};\n\nexport function setCastControlCallbacks(callbacks)\n</code></pre> <p>Callback Purposes:</p> <ul> <li><code>onCastStart</code> - Called when cast session begins</li> <li><code>onCastEnd</code> - Called when cast session ends</li> <li><code>onTrackChange</code> - Called when track changes (via queue events)</li> <li><code>onPlayStateChange</code> - Called when play/pause state changes</li> <li><code>onTimeUpdate</code> - Called every second with playback position</li> <li><code>onVolumeChange</code> - Called when Chromecast volume changes</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#track-change-detection","title":"Track Change Detection","text":"<p>Track changes are detected via the Cast SDK's queue events:</p> <pre><code>remotePlayerController.addEventListener(\n    cast.framework.RemotePlayerEventType.CURRENT_ITEM_CHANGED,\n    handleTrackChange\n);\n</code></pre> <p>Detection Process:</p> <ol> <li><code>CURRENT_ITEM_CHANGED</code> event fires when track changes</li> <li>Get current <code>itemId</code> from media session</li> <li>Map <code>itemId</code> to track index in playlist</li> <li>Call <code>onTrackChange(index)</code> callback</li> <li>UI updates to show new track</li> </ol> <p>Works with:</p> <ul> <li>Next/Previous buttons in your UI</li> <li>Google Home app controls</li> <li>Chromecast device controls</li> <li>Voice commands (\"Hey Google, next song\")</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#2-media-session-integration","title":"2. Media Session Integration","text":"<p>When casting is active, <code>chromecast.js</code> synchronizes the browser's Media Session API to mirror Chromecast state.</p> <p>Purpose:</p> <ul> <li>Lock screen controls</li> <li>Notification media controls</li> <li>Hardware media keys</li> <li>Consistent UI across platforms</li> </ul> <p>Implementation:</p> <pre><code>function updateMediaSessionForCast(media) {\n    if (!('mediaSession' in navigator)) return;\n\n    const mediaInfo = media.media;\n    const metadata = mediaInfo.metadata;\n\n    navigator.mediaSession.metadata = new MediaMetadata({\n        title: metadata.title,\n        artist: metadata.artist,\n        album: metadata.albumName,\n        artwork: metadata.images\n    });\n\n    // Route all actions to Chromecast\n    navigator.mediaSession.setActionHandler('play', () =&gt; castPlay());\n    navigator.mediaSession.setActionHandler('pause', () =&gt; castPause());\n    navigator.mediaSession.setActionHandler('previoustrack', () =&gt; castPrevious());\n    navigator.mediaSession.setActionHandler('nexttrack', () =&gt; castNext());\n    navigator.mediaSession.setActionHandler('seekto', (details) =&gt; {\n        if (details.seekTime !== undefined) {\n            castSeek(details.seekTime);\n        }\n    });\n\n    // Update playback state\n    const isPaused = media.playerState === chrome.cast.media.PlayerState.PAUSED;\n    navigator.mediaSession.playbackState = isPaused ? 'paused' : 'playing';\n}\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#3-player-controls-integration","title":"3. Player Controls Integration","text":"<p>Location: <code>static/js/player/playerControls.js</code></p> <p>The player controls module checks <code>globalCastingState</code> to route commands appropriately.</p> <p>Example - Play Track:</p> <pre><code>import { globalCastingState, castJumpToTrack } from './chromecast.js';\n\nfunction playTrack(index) {\n    if (globalCastingState) {\n        // Route to Chromecast\n        castJumpToTrack(index);\n        return;\n    }\n\n    // Local playback\n    const track = window.__mixtapeData.tracks[index];\n    const player = document.getElementById('main-player');\n    player.src = `/play/${track.file_path}?quality=medium`;\n    player.play();\n}\n</code></pre> <p>Example - Play/Pause:</p> <pre><code>function togglePlayPause() {\n    if (globalCastingState) {\n        castTogglePlayPause();\n        return;\n    }\n\n    const player = document.getElementById('main-player');\n    if (player.paused) {\n        player.play();\n    } else {\n        player.pause();\n    }\n}\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#4-local-player-management","title":"4. Local Player Management","text":"<p>Location: <code>static/js/player/playerUtils.js</code></p> <p>When casting starts, the local player must be silenced to prevent:</p> <ul> <li>Duplicate media controls</li> <li>Battery drain</li> <li>Conflicting Media Session handlers</li> </ul> <p>Silencing Local Player:</p> <pre><code>export function silenceLocalPlayer() {\n    const player = document.getElementById('main-player');\n    if (!player) return;\n\n    // Pause and clear source\n    player.pause();\n    player.src = '';\n    player.load();\n\n    // Remove media attributes\n    player.removeAttribute('controls');\n    player.removeAttribute('autoplay');\n\n    // Mute completely\n    player.volume = 0;\n    player.muted = true;\n\n    // Remove from tab order\n    player.setAttribute('tabindex', '-1');\n}\n</code></pre> <p>Restoring Local Player:</p> <pre><code>export function enableLocalPlayer() {\n    const player = document.getElementById('main-player');\n    if (!player) return;\n\n    // Restore controls\n    player.setAttribute('controls', '');\n\n    // Restore volume\n    player.volume = 1.0;\n    player.muted = false;\n\n    // Restore tab order\n    player.removeAttribute('tabindex');\n}\n</code></pre> <p>Clearing Media Session:</p> <pre><code>export function clearMediaSession() {\n    if (!('mediaSession' in navigator)) return;\n\n    // Set state to 'none' FIRST (critical order)\n    navigator.mediaSession.playbackState = 'none';\n\n    // Clear metadata\n    navigator.mediaSession.metadata = null;\n\n    // Remove all action handlers\n    const actions = [\n        'play', 'pause', 'stop',\n        'previoustrack', 'nexttrack',\n        'seekbackward', 'seekforward', 'seekto'\n    ];\n\n    actions.forEach(action =&gt; {\n        try {\n            navigator.mediaSession.setActionHandler(action, null);\n        } catch (e) {\n            // Action may not be supported\n        }\n    });\n}\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#-backend-requirements","title":"\ud83d\udd0c Backend Requirements","text":""},{"location":"development/device-integration/chromecast/integration.html#cors-headers","title":"CORS Headers","text":"<p>Chromecast devices make cross-origin requests to the Flask server and require proper CORS headers.</p> <p>Implementation in <code>routes/play.py</code>:</p> <pre><code>@play.route(\"/play/&lt;path:file_path&gt;\")\ndef stream_audio(file_path):\n    # ... validation and file resolution ...\n\n    response = send_file(serve_path, mimetype=mime_type)\n\n    # CRITICAL: CORS headers for Chromecast\n    response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\n    response.headers[\"Access-Control-Expose-Headers\"] = \"Content-Type, Accept-Encoding, Range\"\n\n    return response\n</code></pre> <p>Why these headers matter:</p> Header Purpose <code>Access-Control-Allow-Origin: *</code> Allows Chromecast devices to fetch audio from your server <code>Access-Control-Expose-Headers</code> Exposes headers needed for range requests and seeking"},{"location":"development/device-integration/chromecast/integration.html#range-request-support","title":"Range Request Support","text":"<p>Chromecast uses HTTP range requests for seeking and buffering.</p> <p>Implementation:</p> <pre><code>def _handle_range_request(file_path, mime_type):\n    \"\"\"Handle HTTP Range requests for seeking\"\"\"\n    range_header = request.headers.get(\"Range\")\n    if not range_header:\n        return None\n\n    size = os.path.getsize(file_path)\n    match = re.match(r\"bytes=(\\d+)-(\\d*)\", range_header)\n\n    if not match:\n        return abort(416)  # Range Not Satisfiable\n\n    start = int(match.group(1))\n    end = int(match.group(2)) if match.group(2) else size - 1\n\n    # Validate range\n    if start &gt;= size or end &gt;= size or start &gt; end:\n        return abort(416)\n\n    length = end - start + 1\n\n    def generate():\n        with open(file_path, \"rb\") as f:\n            f.seek(start)\n            remaining = length\n            while remaining &gt; 0:\n                chunk_size = min(8192, remaining)\n                chunk = f.read(chunk_size)\n                if not chunk:\n                    break\n                remaining -= len(chunk)\n                yield chunk\n\n    response = Response(\n        generate(),\n        206,  # Partial Content\n        mimetype=mime_type,\n        direct_passthrough=True\n    )\n\n    response.headers[\"Content-Range\"] = f\"bytes {start}-{end}/{size}\"\n    response.headers[\"Content-Length\"] = str(length)\n    response.headers[\"Accept-Ranges\"] = \"bytes\"\n\n    # CORS headers\n    response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\n    response.headers[\"Access-Control-Expose-Headers\"] = \"Content-Range, Content-Length, Range\"\n\n    return response\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#quality-parameter-support","title":"Quality Parameter Support","text":"<p>Chromecast respects the <code>quality</code> query parameter for bandwidth management.</p> <p>Example request:</p> <pre><code>GET /play/artist/album/track.flac?quality=medium\n</code></pre> <p>Server behavior:</p> <ol> <li>Check if transcoded version exists in cache</li> <li>Serve cached MP3 if available</li> <li>Fall back to original file if cache miss</li> </ol> <p>Implementation in <code>_get_serving_path()</code>:</p> <pre><code>def _get_serving_path(full_path, quality):\n    \"\"\"Return cached file if available, otherwise original\"\"\"\n    if quality and quality != 'original':\n        cache_path = audio_cache.get_cache_path(full_path, quality)\n        if os.path.exists(cache_path):\n            return cache_path\n    return full_path\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#-ui-integration","title":"\ud83c\udfa8 UI Integration","text":""},{"location":"development/device-integration/chromecast/integration.html#cast-button","title":"Cast Button","text":"<p>The cast button appears automatically when the Cast SDK loads successfully.</p> <p>HTML:</p> <pre><code>&lt;button id=\"cast-button\" class=\"btn btn-outline-secondary\" hidden&gt;\n    &lt;i class=\"bi bi-cast\"&gt;&lt;/i&gt;\n    &lt;span class=\"cast-label\"&gt;Cast&lt;/span&gt;\n&lt;/button&gt;\n</code></pre> <p>JavaScript initialization:</p> <pre><code>import {\n    initializeCast,\n    loadPlaylistAndCast,\n    extractTracksFromDOM,\n    stopCasting,\n    isCasting\n} from './chromecast.js';\n\n// Initialize Chromecast\ninitializeCast();\n\ndocument.addEventListener('cast:ready', () =&gt; {\n    const castBtn = document.getElementById('cast-button');\n    if (castBtn) {\n        castBtn.hidden = false;\n        castBtn.addEventListener('click', () =&gt; {\n            if (isCasting()) {\n                stopCasting();  // Stop if currently casting\n            } else {\n                // Extract tracks and start casting\n                const tracks = extractTracksFromDOM();\n                const currentIndex = window.currentTrackIndex || 0;\n                loadPlaylistAndCast(tracks, currentIndex);\n            }\n        });\n    }\n});\n</code></pre> <p>Key Functions:</p> <ul> <li><code>initializeCast()</code> - Initialize Chromecast (replaces old <code>initChromecast()</code>)</li> <li><code>loadPlaylistAndCast(tracks, startIndex)</code> - Start casting (replaces old <code>castMixtapePlaylist()</code>)</li> <li><code>extractTracksFromDOM()</code> - Get track list from page</li> <li><code>isCasting()</code> - Check if currently casting</li> <li><code>stopCasting()</code> - End cast session</li> </ul> <p>State classes:</p> <ul> <li><code>.connected</code> - Applied when casting is active</li> <li>Default state - Ready to cast</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#visual-feedback","title":"Visual Feedback","text":"<p>When casting starts:</p> <ol> <li>Cast button shows \"connected\" state</li> <li>Local player UI dims/hides</li> <li>\"Casting to [Device Name]\" indicator appears</li> <li>Track controls remain active</li> </ol> <p>During playback:</p> <ul> <li>Progress bar updates from Chromecast state</li> <li>Play/pause button reflects Chromecast state</li> <li>Track changes update UI automatically</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#-platform-support","title":"\ud83d\udcf1 Platform Support","text":""},{"location":"development/device-integration/chromecast/integration.html#desktop-chrome-edge","title":"Desktop (Chrome, Edge)","text":"<p>Full support:</p> <ul> <li>\u2705 Cast button</li> <li>\u2705 Device picker</li> <li>\u2705 Full queue management</li> <li>\u2705 Media Session controls</li> <li>\u2705 Seeking and scrubbing</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#android","title":"Android","text":"<p>Full support:</p> <ul> <li>\u2705 Native Cast integration</li> <li>\u2705 Notification controls</li> <li>\u2705 Lock screen controls</li> <li>\u2705 Background playback</li> <li>\u2705 Hardware button support</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#ios","title":"iOS","text":"<p>Limited support - requires workarounds:</p> <p>\u26a0\ufe0f Safari limitations:</p> <ul> <li>Cast SDK not supported in Safari</li> <li>Users must use Chrome for iOS</li> </ul> <p>\u2705 Chrome for iOS:</p> <ul> <li>Full Cast support</li> <li>Requires Google Home app installed</li> <li>Both devices must be on same WiFi network</li> </ul> <p>Helper message for iOS users:</p> <pre><code>function showiOSCastHelp() {\n    const helpHtml = `\n        &lt;div class=\"alert alert-info\"&gt;\n            &lt;h6&gt;\ud83d\udcf1 Casting from iPhone&lt;/h6&gt;\n            &lt;small&gt;\n                &lt;strong&gt;To cast to Chromecast:&lt;/strong&gt;&lt;br&gt;\n                1. Install Google Home app&lt;br&gt;\n                2. Use Chrome browser (not Safari)&lt;br&gt;\n                3. Connect to same WiFi network&lt;br&gt;\n                &lt;br&gt;\n                &lt;strong&gt;For best experience:&lt;/strong&gt;&lt;br&gt;\n                Add this page to your Home Screen (PWA mode)\n            &lt;/small&gt;\n        &lt;/div&gt;\n    `;\n    // Display in modal or banner\n}\n</code></pre> <p>Detection and help display:</p> <pre><code>const iOS = detectiOS();\nif (iOS &amp;&amp; !('chrome' in window)) {\n    // User is on iOS Safari - show help message\n    showiOSCastHelp();\n}\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#-configuration","title":"\ud83d\udd27 Configuration","text":""},{"location":"development/device-integration/chromecast/integration.html#cast-application-id","title":"Cast Application ID","text":"<p>Default Media Receiver: <code>CC1AD845</code></p> <p>This is Google's standard receiver application for basic media playback.</p> <p>Set in <code>initializeCastApi()</code>:</p> <pre><code>const applicationID = chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID;\nconst sessionRequest = new chrome.cast.SessionRequest(applicationID);\n</code></pre>"},{"location":"development/device-integration/chromecast/integration.html#queue-configuration","title":"Queue Configuration","text":"<p>Settings:</p> <pre><code>const queueLoadRequest = new chrome.cast.media.QueueLoadRequest(queueItems);\nqueueLoadRequest.repeatMode = chrome.cast.media.RepeatMode.OFF;\nqueueLoadRequest.startIndex = window.currentTrackIndex || 0;\nqueueLoadRequest.autoplay = true;\nqueueLoadRequest.preloadTime = 5;  // Preload 5 seconds of next track\n</code></pre> <p>Parameters:</p> Parameter Value Purpose <code>repeatMode</code> <code>OFF</code> No automatic repeat <code>startIndex</code> Current track Resume from current position <code>autoplay</code> <code>true</code> Start playing immediately <code>preloadTime</code> <code>5</code> Buffer next track 5s early"},{"location":"development/device-integration/chromecast/integration.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/device-integration/chromecast/integration.html#testing-checklist","title":"Testing Checklist","text":"<p>Basic Functionality:</p> <ul> <li> Cast button appears when Cast SDK loads</li> <li> Device picker opens on click</li> <li> Chromecast device is discoverable</li> <li> Connection establishes successfully</li> <li> Mixtape queue loads completely</li> </ul> <p>Playback:</p> <ul> <li> First track plays automatically</li> <li> Audio quality is acceptable</li> <li> No audio stuttering or buffering issues</li> <li> Queue advances through all tracks</li> <li> Last track completes properly</li> </ul> <p>Controls:</p> <ul> <li> Play/pause works from browser</li> <li> Play/pause works from lock screen</li> <li> Previous track button works</li> <li> Next track button works</li> <li> Seeking works (scrub bar)</li> <li> Volume control works</li> </ul> <p>State Management:</p> <ul> <li> Local player is silenced when casting starts</li> <li> UI shows \"Casting to [Device]\" indicator</li> <li> Cast button shows \"connected\" state</li> <li> Progress bar updates during playback</li> <li> Track metadata displays correctly</li> </ul> <p>Disconnection:</p> <ul> <li> Stop casting button works</li> <li> Local player controls restore</li> <li> Media Session clears properly</li> <li> UI returns to normal state</li> <li> Can restart casting immediately</li> </ul> <p>Edge Cases:</p> <ul> <li> Network interruption handling</li> <li> Chromecast device disconnection</li> <li> Browser tab closed while casting</li> <li> Multiple browser tabs casting simultaneously</li> <li> Quality switching during playback</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#test-devices","title":"Test Devices","text":"<p>Recommended test targets:</p> <ul> <li>Chromecast (Gen 3 or newer)</li> <li>Chromecast with Google TV</li> <li>Google Nest Audio / Home speakers</li> <li>Smart TVs with built-in Chromecast</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#debug-logging","title":"Debug Logging","text":"<p>Enable verbose Cast logging:</p> <pre><code>// Add to chromecast.js initialization\nwindow.__CHROMECAST_DEBUG__ = true;\n\nif (window.__CHROMECAST_DEBUG__) {\n    console.log('\ud83c\udfad Cast session started:', session);\n    console.log('\ud83c\udfb5 Loading queue:', queueItems);\n    console.log('\ud83d\udce1 Current media:', currentMedia);\n}\n</code></pre> <p>Check browser console for:</p> <ul> <li>Cast SDK load status</li> <li>Session establishment logs</li> <li>Media state changes</li> <li>Error messages</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#-troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"development/device-integration/chromecast/integration.html#cast-button-not-appearing","title":"Cast Button Not Appearing","text":"<p>Symptoms:</p> <ul> <li>Cast button remains hidden</li> <li>No <code>cast:ready</code> event fired</li> </ul> <p>Possible causes:</p> <ol> <li>Cast SDK failed to load</li> </ol> <pre><code>Check console: \"Failed to load Cast SDK\"\nSolution: Verify CDN accessibility\n</code></pre> <ol> <li>Not in secure context</li> </ol> <pre><code>Check console: \"Cast SDK requires HTTPS\"\nSolution: Access via HTTPS or localhost\n</code></pre> <ol> <li>Cast API not available</li> </ol> <pre><code>if (typeof chrome === 'undefined' || !chrome.cast) {\n    console.error('Chrome Cast API not available');\n}\n</code></pre> <p>Solution checklist:</p> <ul> <li>\u2705 Verify HTTPS connection</li> <li>\u2705 Check browser console for errors</li> <li>\u2705 Confirm <code>cast-framework.js</code> CDN is accessible</li> <li>\u2705 Try different browser (Chrome/Edge recommended)</li> <li>\u2705 Check network firewall settings</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#audio-not-playing-on-chromecast","title":"Audio Not Playing on Chromecast","text":"<p>Symptoms:</p> <ul> <li>Cast session connects but no audio plays</li> <li>Chromecast shows \"buffering\" indefinitely</li> </ul> <p>Possible causes:</p> <ol> <li>CORS headers missing</li> </ol> <pre><code>Check network tab:\nResponse: \"Cross-origin request blocked\"\n</code></pre> <p>Solution: Verify CORS headers in Flask:</p> <pre><code>response.headers[\"Access-Control-Allow-Origin\"] = \"*\"\n</code></pre> <ol> <li>Wrong audio URL format</li> </ol> <pre><code>// \u274c Wrong - relative URL\nsrc: 'audio/track.mp3'\n\n// \u2705 Correct - absolute URL\nsrc: 'https://yourdomain.com/play/artist/album/track.mp3'\n</code></pre> <ol> <li>MIME type incorrect</li> </ol> <pre><code>Check response headers:\nContent-Type: application/octet-stream  \u274c\nContent-Type: audio/mpeg  \u2705\n</code></pre> <ol> <li>File not accessible</li> </ol> <pre><code>Check server logs:\n404 Not Found\n403 Forbidden\n</code></pre> <p>Solution checklist:</p> <ul> <li>\u2705 Verify CORS headers present</li> <li>\u2705 Confirm audio URLs are absolute</li> <li>\u2705 Check MIME types are correct</li> <li>\u2705 Test audio URL directly in browser</li> <li>\u2705 Review server logs for errors</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#seeking-not-working","title":"Seeking Not Working","text":"<p>Symptoms:</p> <ul> <li>Seek bar doesn't respond</li> <li>Tapping seek position has no effect</li> <li>Range requests failing</li> </ul> <p>Possible causes:</p> <ol> <li>Range requests not supported</li> </ol> <pre><code>Check response:\nAccept-Ranges: none  \u274c\nAccept-Ranges: bytes  \u2705\n</code></pre> <ol> <li>CORS headers incomplete</li> </ol> <pre><code># Must expose Range header\nresponse.headers[\"Access-Control-Expose-Headers\"] = \"Content-Range, Content-Length, Range\"\n</code></pre> <ol> <li>Wrong HTTP status code</li> </ol> <pre><code>Response: 200 OK  \u274c (should be 206)\nResponse: 206 Partial Content  \u2705\n</code></pre> <p>Solution checklist:</p> <ul> <li>\u2705 Verify <code>_handle_range_request()</code> is called</li> <li>\u2705 Check 206 responses in network tab</li> <li>\u2705 Confirm <code>Accept-Ranges: bytes</code> header</li> <li>\u2705 Verify <code>Access-Control-Expose-Headers</code> includes \"Range\"</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#lock-screen-controls-not-working","title":"Lock Screen Controls Not Working","text":"<p>Symptoms:</p> <ul> <li>Lock screen shows controls but they don't work</li> <li>Notification controls unresponsive</li> </ul> <p>Possible causes:</p> <ol> <li>Media Session not updated</li> </ol> <pre><code>// Check if being called\nupdateMediaSessionForCast(media);\n</code></pre> <ol> <li>Action handlers not set</li> </ol> <pre><code>// Verify all handlers are set\nnavigator.mediaSession.setActionHandler('play', () =&gt; castPlay());\nnavigator.mediaSession.setActionHandler('pause', () =&gt; castPause());\n</code></pre> <ol> <li>Conflicting local Media Session</li> </ol> <pre><code>// Make sure local session is cleared\nclearMediaSession();\n</code></pre> <p>Solution checklist:</p> <ul> <li>\u2705 Verify <code>updateMediaSessionForCast()</code> called on track change</li> <li>\u2705 Check action handlers are set to cast functions</li> <li>\u2705 Confirm local Media Session is cleared</li> <li>\u2705 Test with browser DevTools Media panel</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#ios-casting-issues","title":"iOS Casting Issues","text":"<p>Symptoms:</p> <ul> <li>Cast button not appearing on iOS</li> <li>\"Chromecast not found\" error</li> </ul> <p>Common causes:</p> <ol> <li>Using Safari browser</li> </ol> <pre><code>Safari doesn't support Cast SDK\nSolution: Switch to Chrome for iOS\n</code></pre> <ol> <li>Google Home app not installed</li> </ol> <pre><code>Required for iOS Chromecast support\nSolution: Install Google Home app\n</code></pre> <ol> <li>Different WiFi networks</li> </ol> <pre><code>iPhone and Chromecast must be on same network\nSolution: Connect both to same WiFi\n</code></pre> <p>Solution checklist:</p> <ul> <li>\u2705 Switch to Chrome for iOS</li> <li>\u2705 Install Google Home app</li> <li>\u2705 Verify same WiFi network</li> <li>\u2705 Show helper message for iOS users</li> <li>\u2705 Recommend PWA mode for better experience</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#queue-not-loading-completely","title":"Queue Not Loading Completely","text":"<p>Symptoms:</p> <ul> <li>Only first few tracks load</li> <li>Queue stops mid-playlist</li> </ul> <p>Possible causes:</p> <ol> <li>Track data malformed</li> </ol> <pre><code>// Check window.__mixtapeData.tracks\nconsole.log(window.__mixtapeData.tracks);\n</code></pre> <ol> <li>Invalid audio URLs</li> </ol> <pre><code>// Verify URL construction\nconst url = `/play/${track.file_path}?quality=medium`;\n</code></pre> <ol> <li>Cover art missing</li> </ol> <pre><code>// Check artwork array\nartwork: track.cover ? [{\n    url: `${window.location.origin}/covers/${track.cover}`\n}] : []\n</code></pre> <p>Solution checklist:</p> <ul> <li>\u2705 Validate track data structure</li> <li>\u2705 Check audio URL construction</li> <li>\u2705 Verify cover art URLs</li> <li>\u2705 Test with smaller playlist first</li> <li>\u2705 Check browser console for errors</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#-additional-resources","title":"\ud83d\udcda Additional Resources","text":""},{"location":"development/device-integration/chromecast/integration.html#google-cast-documentation","title":"Google Cast Documentation","text":"<ul> <li>Cast SDK Overview</li> <li>Chrome Sender API</li> <li>Media Player API</li> <li>Queue Management</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#related-mixtape-society-documentation","title":"Related Mixtape Society Documentation","text":"<ul> <li>Playback Routes - Audio streaming implementation</li> <li>Android Auto Integration - Alternative casting method</li> <li>Audio Caching - Quality management</li> <li>Player Controls - UI controls integration</li> </ul>"},{"location":"development/device-integration/chromecast/integration.html#media-session-api","title":"Media Session API","text":"<ul> <li>MDN Media Session API</li> <li>Web Media Session Spec</li> </ul>"},{"location":"development/media-assets/opengraph.html","title":"OpenGraph Images","text":""},{"location":"development/media-assets/opengraph.html#add-logo-to-cover-for-open-graph","title":"Add logo to cover for Open Graph","text":"<p>The <code>logo_on_cover.py</code> file provides a Flask blueprint that dynamically generates cover images with a logo overlaid in a specified corner as an image that can be used for an Open Graph . It exposes an HTTP endpoint that takes a cover image filename and optional query parameters (logo scale, corner, margin), composites the logo onto the cover, and returns the resulting PNG image. The file also implements caching to optimize repeated requests for the same parameters.</p> <p>The main responsibilities of this file are:</p> <ul> <li>Loading and converting an SVG logo to PNG.</li> <li>Overlaying the logo onto a cover image at a configurable position and scale.</li> <li>Serving the composited image via a Flask route, with input validation and caching.</li> </ul>"},{"location":"development/media-assets/opengraph.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/media-assets/opengraph.html#src.routes.logo_on_cover","title":"<code>logo_on_cover</code>","text":"<p>Functions:</p> Name Description <code>create_og_cover_blueprint</code> <p>Creates a Flask blueprint for serving cover images with a logo overlay.</p> <code>overlay_logo_bytes</code> <p>Overlays a logo onto a cover image and returns the composited image as PNG bytes.</p>"},{"location":"development/media-assets/opengraph.html#src.routes.logo_on_cover.create_og_cover_blueprint","title":"<code>create_og_cover_blueprint(path_logo, logger=None)</code>","text":"<p>Creates a Flask blueprint for serving cover images with a logo overlay.</p> <p>This function sets up routes and logic for handling requests to overlay a logo on cover images, including caching and query parameter validation.</p> <p>Parameters:</p> Name Type Description Default <code>logger</code> <code>Logger | None</code> <p>An optional Logger instance for logging.</p> <code>None</code> <p>Returns:</p> Type Description <code>Blueprint</code> <p>A Flask Blueprint configured for cover image overlay routes.</p> Source code in <code>src/routes/logo_on_cover.py</code> <pre><code>def create_og_cover_blueprint(\n    path_logo: Path, logger: Logger | None = None\n) -&gt; Blueprint:\n    \"\"\"\n    Creates a Flask blueprint for serving cover images with a logo overlay.\n\n    This function sets up routes and logic for handling requests to overlay a logo on cover images,\n    including caching and query parameter validation.\n\n    Args:\n        logger: An optional Logger instance for logging.\n\n    Returns:\n        A Flask Blueprint configured for cover image overlay routes.\n    \"\"\"\n    og = Blueprint(\"og\", __name__)\n\n    logger: Logger = logger or NullLogger()\n\n    @og.route(\"/cover/&lt;path:filename&gt;\")\n    def cover_with_logo(filename):\n        \"\"\"\n        Serves a cover image with a logo overlaid, using query parameters for customization.\n\n        This function locates the requested cover image, validates input parameters, overlays the logo,\n        and returns the composited PNG image. Results are cached for performance.\n\n        Args:\n            filename: The name of the cover image file.\n\n        Returns:\n            A Flask response containing the PNG image with the logo overlaid.\n\n        Raises:\n            Aborts with a 404 error if the cover image is not found.\n            Aborts with a 400 error if query parameters are invalid.\n        \"\"\"\n        cover_path = _get_cover_path(filename)\n        _validate_cover_path(cover_path)\n        logo_scale, corner, margin = _get_query_params()\n        _validate_query_params(logo_scale, corner, margin)\n        # TODO: Add redis caching\n        # Use cover file modification time for cache key\n        # cover_mtime = cover_path.stat().st_mtime\n        # cache_key = f\"{filename}:{cover_mtime}:{logo_scale}:{corner}:{margin}\"\n        # if cached := current_app.cache.get(cache_key):\n        #     return send_file(BytesIO(cached), mimetype=\"image/png\")\n        with open(path_logo, \"rb\") as f:\n            file_logo = f.read()\n        result = overlay_logo_bytes(\n            cover_bytes=cover_path.read_bytes(),\n            svg_bytes=file_logo,\n            logo_scale=logo_scale,\n            corner=corner,\n            margin=margin,\n        )\n        # current_app.cache.set(cache_key, result, timeout=60 * 60 * 24)\n        return send_file(BytesIO(result), mimetype=\"image/png\")\n\n    return og\n</code></pre>"},{"location":"development/media-assets/opengraph.html#src.routes.logo_on_cover.overlay_logo_bytes","title":"<code>overlay_logo_bytes(cover_bytes, svg_bytes, *, logo_scale=0.4, corner='bottom_right', margin=10)</code>","text":"<p>Overlays a logo onto a cover image and returns the composited image as PNG bytes.</p> <p>This function places a logo, provided as SVG bytes, onto a cover image at a specified corner and scale.</p> <p>Parameters:</p> Name Type Description Default <code>cover_bytes</code> <code>bytes</code> <p>The cover image data as bytes.</p> required <code>svg_bytes</code> <code>bytes</code> <p>The SVG logo image data as bytes.</p> required <code>logo_scale</code> <code>float</code> <p>The scale of the logo relative to the shortest side of the cover image.</p> <code>0.4</code> <code>corner</code> <code>str</code> <p>The corner of the cover image to place the logo ('bottom_right', 'bottom_left', 'top_right', 'top_left').</p> <code>'bottom_right'</code> <code>margin</code> <code>int</code> <p>The margin in pixels between the logo and the edge of the cover image.</p> <code>10</code> <p>Returns:</p> Type Description <code>bytes</code> <p>PNG image data as bytes with the logo overlaid.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If an unsupported corner is specified.</p> Source code in <code>src/routes/logo_on_cover.py</code> <pre><code>def overlay_logo_bytes(\n    cover_bytes: bytes,\n    svg_bytes: bytes,\n    *,\n    logo_scale: float = 0.4,\n    corner: str = \"bottom_right\",\n    margin: int = 10,\n) -&gt; bytes:\n    \"\"\"Overlays a logo onto a cover image and returns the composited image as PNG bytes.\n\n    This function places a logo, provided as SVG bytes, onto a cover image at a specified corner and scale.\n\n    Args:\n        cover_bytes (bytes): The cover image data as bytes.\n        svg_bytes (bytes): The SVG logo image data as bytes.\n        logo_scale (float): The scale of the logo relative to the shortest side of the cover image.\n        corner (str): The corner of the cover image to place the logo ('bottom_right', 'bottom_left', 'top_right', 'top_left').\n        margin (int): The margin in pixels between the logo and the edge of the cover image.\n\n    Returns:\n        PNG image data as bytes with the logo overlaid.\n\n    Raises:\n        ValueError: If an unsupported corner is specified.\n    \"\"\"\n    cover = _prepare_cover(cover_bytes)\n    canvas = _create_blurred_canvas(cover)\n\n    orig_width, orig_height = cover.size\n    img_logo = _prepare_logo(svg_bytes, (orig_width, orig_height), logo_scale)\n    x, y = _calculate_logo_position(canvas.size, img_logo.size, corner, margin)\n\n    # Ensure logo has an alpha channel for use as mask\n    if img_logo.mode != \"RGBA\":\n        img_logo = img_logo.convert(\"RGBA\")\n\n    canvas.paste(img_logo, (x, y), img_logo)\n\n    return _save_image_to_bytes(canvas)\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html","title":"API Reference","text":""},{"location":"development/media-assets/cover-art/api.html#api-reference---cover-art-optimization","title":"API Reference - Cover Art Optimization","text":"<p>Complete API documentation for the size-optimized cover art endpoints.</p>"},{"location":"development/media-assets/cover-art/api.html#overview","title":"Overview","text":"<p>The cover art API provides two endpoints for serving album artwork:</p> <ol> <li>Direct file serving (<code>/covers/&lt;filename&gt;</code>) - Original endpoint, unchanged</li> <li>Size-parameterized API (<code>/api/covers/&lt;path&gt;</code>) - New endpoint with size selection</li> </ol>"},{"location":"development/media-assets/cover-art/api.html#endpoints","title":"Endpoints","text":""},{"location":"development/media-assets/cover-art/api.html#get-covers","title":"GET <code>/covers/&lt;filename&gt;</code>","text":"<p>Serves cover art files directly from the cache directory.</p> <p>Original endpoint - no changes to existing behavior.</p>"},{"location":"development/media-assets/cover-art/api.html#parameters","title":"Parameters","text":"Parameter Type Location Required Description <code>filename</code> string path Yes Cover filename (e.g., <code>artist_album.jpg</code>)"},{"location":"development/media-assets/cover-art/api.html#example-requests","title":"Example Requests","text":"<pre><code># Main cover\nGET /covers/artist_album.jpg\n\n# Size variant\nGET /covers/artist_album_256x256.jpg\n\n# Fallback image\nGET /covers/_fallback.jpg\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#response","title":"Response","text":"<p>Success (200 OK):</p> <pre><code>Content-Type: image/jpeg\nCache-Control: public, max-age=3600\nContent-Length: 42134\n\n[image binary data]\n</code></pre> <p>Not Found (404):</p> <pre><code>404 Not Found\n</code></pre> <p>Security:</p> <ul> <li>\u2705 Only serves files from covers directory</li> <li>\u2705 Restricted to <code>.jpg</code>, <code>.jpeg</code>, <code>.png</code> extensions</li> <li>\u2705 No directory traversal allowed</li> </ul>"},{"location":"development/media-assets/cover-art/api.html#usage","title":"Usage","text":"<pre><code>&lt;!-- In HTML template --&gt;\n&lt;img src=\"/covers/artist_album_256x256.jpg\" alt=\"Album Cover\"&gt;\n</code></pre> <pre><code>// In JavaScript\nconst coverUrl = `/covers/${slug}_256x256.jpg`;\nfetch(coverUrl).then(response =&gt; ...);\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#get-apicovers","title":"GET <code>/api/covers/&lt;path:release_dir&gt;</code>","text":"<p>Serves cover art with optional size parameter. Generates size variants on-demand.</p> <p>New endpoint for responsive cover art.</p>"},{"location":"development/media-assets/cover-art/api.html#parameters_1","title":"Parameters","text":"Parameter Type Location Required Description <code>release_dir</code> string path Yes Release directory path (URL-encoded) <code>size</code> string query No Desired size in <code>WxH</code> format"},{"location":"development/media-assets/cover-art/api.html#valid-sizes","title":"Valid Sizes","text":"Size Use Case Typical File Size <code>96x96</code> Thumbnails 5-8 KB <code>128x128</code> Small tiles 8-12 KB <code>192x192</code> Medium tiles 15-20 KB <code>256x256</code> Android Auto optimal 30-50 KB <code>384x384</code> High-DPI displays 60-90 KB <code>512x512</code> Full-screen player 100-150 KB"},{"location":"development/media-assets/cover-art/api.html#example-requests_1","title":"Example Requests","text":"<pre><code># Request specific size\nGET /api/covers/Artist%2FAlbum?size=256x256\n\n# Without size (returns main cover)\nGET /api/covers/Artist%2FAlbum\n\n# Another artist\nGET /api/covers/Prince%2FPurple%20Rain?size=96x96\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#response_1","title":"Response","text":"<p>Success (200 OK):</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: image/jpeg\nCache-Control: public, max-age=3600\nContent-Length: 42134\nAccess-Control-Allow-Origin: *\n\n[image binary data]\n</code></pre> <p>Invalid Size (400 Bad Request):</p> <pre><code>{\n  \"error\": \"Invalid size parameter\",\n  \"valid_sizes\": [\n    \"96x96\",\n    \"128x128\",\n    \"192x192\",\n    \"256x256\",\n    \"384x384\",\n    \"512x512\"\n  ]\n}\n</code></pre> <p>Not Found (404):</p> <pre><code>HTTP/1.1 404 Not Found\n\nRelease directory not found\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#behavior","title":"Behavior","text":"<ol> <li>Size Specified:</li> <li>Generates variant if doesn't exist</li> <li>Returns size-specific image</li> <li>Falls back to main cover if generation fails</li> <li> <p>Falls back to <code>_fallback.jpg</code> if no cover exists</p> </li> <li> <p>No Size Specified:</p> </li> <li>Returns main cover (800px max dimension)</li> <li> <p>Falls back to <code>_fallback.jpg</code> if no cover exists</p> </li> <li> <p>First Request:</p> </li> <li>~100-200ms delay while generating variants</li> <li> <p>All sizes generated at once (96\u00d796 through 512\u00d7512)</p> </li> <li> <p>Subsequent Requests:</p> </li> <li>&lt;10ms - served from cache</li> <li>No regeneration needed</li> </ol>"},{"location":"development/media-assets/cover-art/api.html#url-encoding","title":"URL Encoding","text":"<p>Release directories must be URL-encoded:</p> <pre><code>// JavaScript example\nconst releaseDir = \"Artist/Album Name\";\nconst encoded = encodeURIComponent(releaseDir);\nconst url = `/api/covers/${encoded}?size=256x256`;\n\n// Result: /api/covers/Artist%2FAlbum%20Name?size=256x256\n</code></pre> <pre><code># Python example\nfrom urllib.parse import quote\n\nrelease_dir = \"Artist/Album Name\"\nencoded = quote(release_dir, safe='')\nurl = f\"/api/covers/{encoded}?size=256x256\"\n\n# Result: /api/covers/Artist%2FAlbum%20Name?size=256x256\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#python-api","title":"Python API","text":""},{"location":"development/media-assets/cover-art/api.html#src.musiclib.reader.MusicCollection.get_cover","title":"<code>get_cover(release_dir)</code>","text":"<p>Retrieves or generates the cover image path for a given album release directory. Returns a relative path to a cached or newly extracted cover image if available, or a fallback image path if no cover is found.</p> <p>Parameters:</p> Name Type Description Default <code>release_dir</code> <code>str</code> <p>The release directory identifier used to locate or derive the cover image.</p> required <p>Returns:</p> Type Description <code>str | None</code> <p>str | None: Relative path to the cover image within the covers directory, or fallback image path if not found.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_cover(self, release_dir: str) -&gt; str | None:\n    \"\"\"Retrieves or generates the cover image path for a given album release directory.\n    Returns a relative path to a cached or newly extracted cover image if available,\n    or a fallback image path if no cover is found.\n\n    Args:\n        release_dir: The release directory identifier used to locate or derive the cover image.\n\n    Returns:\n        str | None: Relative path to the cover image within the covers directory, or fallback image path if not found.\n    \"\"\"\n    if not release_dir:\n        return \"covers/_fallback.jpg\"\n\n    # Sanitize to a safe filename slug\n    slug = self._sanitize_release_dir(release_dir)\n    cover_path = self.covers_dir / f\"{slug}.jpg\"\n\n    if cover_path.exists():\n        return f\"covers/{slug}.jpg\"\n\n    # Extract on demand\n    if self._extract_cover(release_dir, cover_path):\n        return f\"covers/{slug}.jpg\"\n\n    return \"covers/_fallback.jpg\"\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#src.musiclib.reader.MusicCollection.get_cover_sizes","title":"<code>get_cover_sizes(release_dir)</code>","text":"<p>Returns URLs for multiple size variants of a cover image. Generates size variants on-demand if not already cached.</p> <p>Parameters:</p> Name Type Description Default <code>release_dir</code> <code>str</code> <p>The release directory identifier for which to retrieve cover variants.</p> required <p>Returns:</p> Type Description <code>dict[str, str]</code> <p>dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to relative URL paths.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_cover_sizes(self, release_dir: str) -&gt; dict[str, str]:\n    \"\"\"Returns URLs for multiple size variants of a cover image.\n    Generates size variants on-demand if not already cached.\n\n    Args:\n        release_dir: The release directory identifier for which to retrieve cover variants.\n\n    Returns:\n        dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to relative URL paths.\n    \"\"\"\n    if not release_dir:\n        sizes = [96, 128, 192, 256, 384, 512]\n        return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    slug = self._sanitize_release_dir(release_dir)\n    sizes = [96, 128, 192, 256, 384, 512]\n\n    # Ensure main cover exists first\n    main_path = self.covers_dir / f\"{slug}.jpg\"\n    if not main_path.exists() and not self._extract_cover(release_dir, main_path):\n        return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    # Check if variants exist, generate if needed\n    variants_exist = all(\n        (self.covers_dir / f\"{slug}_{s}x{s}.jpg\").exists() for s in sizes\n    )\n\n    if not variants_exist:\n        self._generate_cover_variants(release_dir, slug)\n\n    # Build URL dictionary\n    result = {}\n    for size in sizes:\n        variant_path = self.covers_dir / f\"{slug}_{size}x{size}.jpg\"\n        if variant_path.exists():\n            result[f\"{size}x{size}\"] = f\"covers/{slug}_{size}x{size}.jpg\"\n        else:\n            # Fallback to main cover if variant doesn't exist\n            result[f\"{size}x{size}\"] = f\"covers/{slug}.jpg\"\n\n    return result\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#javascript-api","title":"JavaScript API","text":""},{"location":"development/media-assets/cover-art/api.html#extractmetadatafromdomtrackelement","title":"<code>extractMetadataFromDOM(trackElement)</code>","text":"<p>Extracts metadata including platform-optimized artwork URLs.</p> <pre><code>import { extractMetadataFromDOM } from './playerUtils.js';\n\nconst trackElement = document.querySelector('.track-item');\nconst metadata = extractMetadataFromDOM(trackElement);\n\n// Returns:\n{\n    title: \"Track Name\",\n    artist: \"Artist Name\",\n    album: \"Album Name\",\n    artwork: [\n        { src: \"/covers/slug_96x96.jpg\", sizes: \"96x96\", type: \"image/jpeg\" },\n        { src: \"/covers/slug_256x256.jpg\", sizes: \"256x256\", type: \"image/jpeg\" },\n        { src: \"/covers/slug_512x512.jpg\", sizes: \"512x512\", type: \"image/jpeg\" }\n    ]\n}\n</code></pre> <p>Platform-Specific Sizes:</p> <p>iOS:</p> <pre><code>artwork: [\n    { src: \"/covers/slug_512x512.jpg\", sizes: \"512x512\", type: \"image/jpeg\" },\n    { src: \"/covers/slug_256x256.jpg\", sizes: \"256x256\", type: \"image/jpeg\" },\n    { src: \"/covers/slug_192x192.jpg\", sizes: \"192x192\", type: \"image/jpeg\" }\n]\n</code></pre> <p>Android Auto:</p> <pre><code>artwork: [\n    { src: \"/covers/slug_96x96.jpg\", sizes: \"96x96\", type: \"image/jpeg\" },\n    { src: \"/covers/slug_128x128.jpg\", sizes: \"128x128\", type: \"image/jpeg\" },\n    { src: \"/covers/slug_192x192.jpg\", sizes: \"192x192\", type: \"image/jpeg\" },\n    { src: \"/covers/slug_256x256.jpg\", sizes: \"256x256\", type: \"image/jpeg\" },\n    { src: \"/covers/slug_512x512.jpg\", sizes: \"512x512\", type: \"image/jpeg\" }\n]\n</code></pre> <p>Desktop:</p> <pre><code>artwork: [\n    { src: \"/covers/slug_192x192.jpg\", sizes: \"192x192\", type: \"image/jpeg\" },\n    { src: \"/covers/slug_512x512.jpg\", sizes: \"512x512\", type: \"image/jpeg\" }\n]\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#androidautointegrationupdatemediametadatametadata","title":"<code>AndroidAutoIntegration.updateMediaMetadata(metadata)</code>","text":"<p>Updates MediaSession with size-optimized artwork.</p> <pre><code>const androidAuto = new AndroidAutoIntegration();\nawait androidAuto.initialize();\n\n// Update metadata\nandroidAuto.updateMediaMetadata({\n    title: \"Track Name\",\n    artist: \"Artist Name\",\n    album: \"Album Name\",\n    artwork: [\n        { src: \"/covers/slug_256x256.jpg\", sizes: \"256x256\", type: \"image/jpeg\" },\n        { src: \"/covers/slug_512x512.jpg\", sizes: \"512x512\", type: \"image/jpeg\" }\n    ]\n});\n</code></pre> <p>Result:</p> <ul> <li>MediaSession metadata updated</li> <li>Android Auto displays appropriate size</li> <li>Bandwidth optimized automatically</li> </ul>"},{"location":"development/media-assets/cover-art/api.html#rate-limiting","title":"Rate Limiting","text":"<p>Currently no rate limiting on cover art endpoints.</p> <p>Recommendations for production:</p> <pre><code>from flask_limiter import Limiter\n\nlimiter = Limiter(app, key_func=get_remote_address)\n\n@app.route(\"/api/covers/&lt;path:release_dir&gt;\")\n@limiter.limit(\"100 per minute\")  # Adjust as needed\ndef serve_cover_by_size(release_dir):\n    # ...\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#caching-headers","title":"Caching Headers","text":"<p>All cover art responses include caching headers:</p> <pre><code>Cache-Control: public, max-age=3600\n</code></pre> <p>Implications:</p> <ul> <li>Browsers cache for 1 hour</li> <li>CDN can cache responses</li> <li>Reduces server load</li> <li>Faster subsequent loads</li> </ul> <p>To force refresh:</p> <pre><code>// Bypass cache with timestamp\nconst url = `/covers/${slug}_256x256.jpg?t=${Date.now()}`;\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#error-handling","title":"Error Handling","text":""},{"location":"development/media-assets/cover-art/api.html#http-status-codes","title":"HTTP Status Codes","text":"Code Meaning When 200 OK Cover found and served 400 Bad Request Invalid size parameter 404 Not Found Release directory doesn't exist 500 Internal Server Error Server error during generation"},{"location":"development/media-assets/cover-art/api.html#fallback-behavior","title":"Fallback Behavior","text":"<p>The API implements multiple fallback levels:</p> <ol> <li> <p>Requested size variant (<code>artist_album_256x256.jpg</code>)    \u2193 if doesn't exist, try to generate    \u2193 if generation fails \u2193</p> </li> <li> <p>Main cover (<code>artist_album.jpg</code>)    \u2193 if doesn't exist \u2193</p> </li> <li> <p>Fallback image (<code>_fallback.jpg</code>)    \u2193 always exists</p> </li> </ol> <p>Result: Users never see broken images</p>"},{"location":"development/media-assets/cover-art/api.html#performance-considerations","title":"Performance Considerations","text":""},{"location":"development/media-assets/cover-art/api.html#first-request","title":"First Request","text":"<pre><code>GET /api/covers/Artist%2FAlbum?size=256x256\n\n[No cached variants exist]\n\u2192 Extract main cover from audio files (~50-100ms)\n\u2192 Generate all 6 size variants (~100-200ms)\n\u2192 Return requested variant\n\u2192 Cache all variants for future requests\n\nTotal: ~150-300ms\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#subsequent-requests","title":"Subsequent Requests","text":"<pre><code>GET /api/covers/Artist%2FAlbum?size=256x256\n\n[Variants already cached]\n\u2192 Serve from filesystem (~5-10ms)\n\nTotal: ~5-10ms\n</code></pre>"},{"location":"development/media-assets/cover-art/api.html#bandwidth-comparison","title":"Bandwidth Comparison","text":"Scenario Original Optimized Savings Android Auto 400 KB 40 KB 90% Mobile Web 400 KB 15 KB 96% 10 tracks \u00d7 Android Auto 4 MB 400 KB 90% 50 tracks \u00d7 Mobile 20 MB 750 KB 96%"},{"location":"development/media-assets/cover-art/optimization.html","title":"Size Optimization","text":""},{"location":"development/media-assets/cover-art/optimization.html#backend-implementation","title":"Backend Implementation","text":"<p>This page documents the server-side changes required for Android Auto integration, focusing on size-optimized cover art generation and serving.</p>"},{"location":"development/media-assets/cover-art/optimization.html#-goals","title":"\ud83c\udfaf Goals","text":"<ol> <li>Generate multiple size variants of cover artwork</li> <li>Serve size-specific covers via query parameters</li> <li>Maintain backward compatibility with existing code</li> <li>Optimize bandwidth for mobile/in-car use</li> </ol>"},{"location":"development/media-assets/cover-art/optimization.html#-modified-files","title":"\ud83d\udcc1 Modified Files","text":""},{"location":"development/media-assets/cover-art/optimization.html#srcmusiclibreaderpy","title":"<code>src/musiclib/reader.py</code>","text":"<p>Methods to <code>MusicCollection</code> class:</p> <ul> <li><code>_generate_cover_variants()</code> - Generates 6 size variants</li> <li><code>get_cover_sizes()</code> - Returns URLs for all size variants</li> </ul>"},{"location":"development/media-assets/cover-art/optimization.html#srcapppy","title":"<code>src/app.py</code>","text":"<p>API endpoint:</p> <ul> <li><code>/api/covers/&lt;release_dir_encoded&gt;?size=WxH</code> - Serves size-specific covers</li> </ul>"},{"location":"development/media-assets/cover-art/optimization.html#-implementation-details","title":"\ud83d\udd27 Implementation Details","text":""},{"location":"development/media-assets/cover-art/optimization.html#1-cover-variant-generation","title":"1. Cover Variant Generation","text":"<p>File naming convention:</p> <ul> <li>Main cover: <code>{slug}.jpg</code> (e.g., <code>artist_album.jpg</code>)</li> <li>Variants: <code>{slug}_{size}x{size}.jpg</code> (e.g., <code>artist_album_256x256.jpg</code>)</li> </ul> <p>Standard sizes generated:</p> <ul> <li>96\u00d796 px - Thumbnails (5-8 KB)</li> <li>128\u00d7128 px - Small tiles (8-12 KB)</li> <li>192\u00d7192 px - Medium tiles (15-20 KB)</li> <li>256\u00d7256 px - Android Auto optimal (30-50 KB)</li> <li>384\u00d7384 px - High-DPI displays (60-90 KB)</li> <li>512\u00d7512 px - Full-screen player (100-150 KB)</li> </ul>"},{"location":"development/media-assets/cover-art/optimization.html#src.musiclib.reader.MusicCollection._extract_cover","title":"<code>_extract_cover(release_dir, target_path)</code>","text":"<p>Attempts to locate or extract a cover image for a given release directory. Searches for existing image files or embedded artwork, resizes them to a reasonable size, and writes an optimized copy to the target path.</p> <p>Parameters:</p> Name Type Description Default <code>release_dir</code> <code>str</code> <p>The release directory relative to the music root where audio and image files are stored.</p> required <code>target_path</code> <code>Path</code> <p>The filesystem path where the discovered or extracted cover image should be written.</p> required <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True if a cover image was successfully found and written, otherwise False.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def _extract_cover(self, release_dir: str, target_path: Path) -&gt; bool:\n    \"\"\"Attempts to locate or extract a cover image for a given release directory.\n    Searches for existing image files or embedded artwork, resizes them to a reasonable size,\n    and writes an optimized copy to the target path.\n\n    Args:\n        release_dir: The release directory relative to the music root where audio and image files are stored.\n        target_path: The filesystem path where the discovered or extracted cover image should be written.\n\n    Returns:\n        bool: True if a cover image was successfully found and written, otherwise False.\n    \"\"\"\n    abs_dir = self.music_root / release_dir.rstrip(\"/\")\n    if not abs_dir.is_dir():\n        self._logger.warning(f\"Release directory not found: {abs_dir}\")\n        return False\n\n    # Configuration for cover optimization\n    MAX_SIZE = 800  # Maximum width/height in pixels\n    JPEG_QUALITY = 85  # JPEG quality (1-100)\n    MAX_FILE_SIZE = 500 * 1024  # 500KB max file size\n\n    # Step 1: Check for common image files in the folder\n    common_cover_names = [\n        \"cover.jpg\",\n        \"folder.jpg\",\n        \"album.jpg\",\n        \"front.jpg\",\n        \"cover.png\",\n        \"folder.png\",\n    ]\n\n    for name in common_cover_names:\n        img_path = abs_dir / name\n        if img_path.exists():\n            try:\n                if self._resize_and_save_cover(img_path, target_path, MAX_SIZE, JPEG_QUALITY, MAX_FILE_SIZE):\n                    self._logger.debug(f\"Processed cover from {img_path} for {release_dir}\")\n                    return True\n            except Exception as e:\n                self._logger.error(f\"Failed to process cover {img_path}: {e}\")\n                continue\n\n    # Step 2: Extract embedded art from audio files\n    for file in abs_dir.iterdir():\n        if file.suffix.lower() in CollectionExtractor.SUPPORTED_EXTS:\n            try:\n                tag = TinyTag.get(str(file), image=True)\n                if img_data := tag.get_image():\n                    if self._resize_and_save_cover_from_bytes(img_data, target_path, MAX_SIZE, JPEG_QUALITY, MAX_FILE_SIZE):\n                        self._logger.debug(\n                            f\"Extracted and processed embedded cover from {file} for {release_dir}\"\n                        )\n                        return True\n            except Exception as e:\n                self._logger.warning(f\"Failed to extract from {file}: {e}\")\n                continue\n\n    self._logger.info(f\"No cover found for {release_dir}\")\n    return False\n</code></pre>"},{"location":"development/media-assets/cover-art/optimization.html#2-size-url-retrieval","title":"2. Size URL Retrieval","text":"<p>Return value example:</p> <pre><code>{\n    \"96x96\": \"covers/artist_album_96x96.jpg\",\n    \"128x128\": \"covers/artist_album_128x128.jpg\",\n    \"192x192\": \"covers/artist_album_192x192.jpg\",\n    \"256x256\": \"covers/artist_album_256x256.jpg\",\n    \"384x384\": \"covers/artist_album_384x384.jpg\",\n    \"512x512\": \"covers/artist_album_512x512.jpg\"\n}\n</code></pre>"},{"location":"development/media-assets/cover-art/optimization.html#src.musiclib.reader.MusicCollection.get_cover_sizes","title":"<code>get_cover_sizes(release_dir)</code>","text":"<p>Returns URLs for multiple size variants of a cover image. Generates size variants on-demand if not already cached.</p> <p>Parameters:</p> Name Type Description Default <code>release_dir</code> <code>str</code> <p>The release directory identifier for which to retrieve cover variants.</p> required <p>Returns:</p> Type Description <code>dict[str, str]</code> <p>dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to relative URL paths.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_cover_sizes(self, release_dir: str) -&gt; dict[str, str]:\n    \"\"\"Returns URLs for multiple size variants of a cover image.\n    Generates size variants on-demand if not already cached.\n\n    Args:\n        release_dir: The release directory identifier for which to retrieve cover variants.\n\n    Returns:\n        dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to relative URL paths.\n    \"\"\"\n    if not release_dir:\n        sizes = [96, 128, 192, 256, 384, 512]\n        return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    slug = self._sanitize_release_dir(release_dir)\n    sizes = [96, 128, 192, 256, 384, 512]\n\n    # Ensure main cover exists first\n    main_path = self.covers_dir / f\"{slug}.jpg\"\n    if not main_path.exists() and not self._extract_cover(release_dir, main_path):\n        return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    # Check if variants exist, generate if needed\n    variants_exist = all(\n        (self.covers_dir / f\"{slug}_{s}x{s}.jpg\").exists() for s in sizes\n    )\n\n    if not variants_exist:\n        self._generate_cover_variants(release_dir, slug)\n\n    # Build URL dictionary\n    result = {}\n    for size in sizes:\n        variant_path = self.covers_dir / f\"{slug}_{size}x{size}.jpg\"\n        if variant_path.exists():\n            result[f\"{size}x{size}\"] = f\"covers/{slug}_{size}x{size}.jpg\"\n        else:\n            # Fallback to main cover if variant doesn't exist\n            result[f\"{size}x{size}\"] = f\"covers/{slug}.jpg\"\n\n    return result\n</code></pre>"},{"location":"development/media-assets/cover-art/optimization.html#3-api-endpoint","title":"3. API Endpoint","text":"<p>Route: <code>/api/covers/&lt;release_dir_encoded&gt;</code></p> <p>Location: <code>src/app.py</code> (added after existing <code>/covers/&lt;filename&gt;</code> route)</p> <pre><code>@app.route(\"/api/covers/&lt;path:release_dir_encoded&gt;\")\ndef serve_cover_by_size(release_dir_encoded):\n    \"\"\"Serves cover art with optional size parameter.\n\n    Supports ?size=WxH query parameter (e.g., ?size=256x256).\n    Generates size variants on-demand and caches them.\n\n    Args:\n        release_dir_encoded: URL-encoded release directory path\n\n    Query Parameters:\n        size: Optional size in format WxH (e.g., 256x256)\n              Valid: 96x96, 128x128, 192x192, 256x256, 384x384, 512x512\n\n    Returns:\n        Image file from cache directory\n    \"\"\"\n    from urllib.parse import unquote\n\n    release_dir = unquote(release_dir_encoded)\n    requested_size = request.args.get('size', '').lower()\n\n    valid_sizes = ['96x96', '128x128', '192x192', '256x256', '384x384', '512x512']\n    covers_dir = app.config[\"DATA_ROOT\"] / \"cache\" / \"covers\"\n\n    if not requested_size:\n        # No size specified, return main cover\n        cover_url = collection.get_cover(release_dir)\n        if cover_url:\n            filename = cover_url.split('/')[-1]\n            return send_from_directory(covers_dir, filename)\n        abort(404)\n\n    # Validate size parameter\n    if requested_size not in valid_sizes:\n        return jsonify({\n            \"error\": \"Invalid size parameter\",\n            \"valid_sizes\": valid_sizes\n        }), 400\n\n    # Get or generate size-specific cover\n    slug = collection._sanitize_release_dir(release_dir)\n    size_filename = f\"{slug}_{requested_size}.jpg\"\n    size_path = covers_dir / size_filename\n\n    # Generate if doesn't exist\n    if not size_path.exists():\n        main_path = covers_dir / f\"{slug}.jpg\"\n        if not main_path.exists():\n            collection._extract_cover(release_dir, main_path)\n\n        if main_path.exists():\n            collection._generate_cover_variants(release_dir, slug)\n\n    # Serve size-specific cover\n    if size_path.exists():\n        return send_from_directory(covers_dir, size_filename)\n\n    # Fallback to main cover\n    main_filename = f\"{slug}.jpg\"\n    main_path = covers_dir / main_filename\n    if main_path.exists():\n        return send_from_directory(covers_dir, main_filename)\n\n    # Final fallback\n    return send_from_directory(covers_dir, \"_fallback.jpg\")\n</code></pre> <p>Usage examples:</p> <pre><code># Get 256\u00d7256 variant\nGET /api/covers/Artist%2FAlbum?size=256x256\n\n# Get main cover (no size)\nGET /api/covers/Artist%2FAlbum\n\n# Invalid size returns error\nGET /api/covers/Artist%2FAlbum?size=999x999\n# \u2192 {\"error\": \"Invalid size parameter\", \"valid_sizes\": [...]}\n</code></pre>"},{"location":"development/media-assets/cover-art/optimization.html#-request-flow","title":"\ud83d\udd04 Request Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Flask\n    participant API Endpoint\n    participant Collection\n    participant Filesystem\n\n    Client-&gt;&gt;Flask: GET /api/covers/Artist%2FAlbum?size=256x256\n    Flask-&gt;&gt;API Endpoint: serve_cover_by_size()\n    API Endpoint-&gt;&gt;API Endpoint: Decode release_dir\n    API Endpoint-&gt;&gt;API Endpoint: Validate size parameter\n\n    alt Size variant exists\n        API Endpoint-&gt;&gt;Filesystem: Check cache\n        Filesystem--&gt;&gt;API Endpoint: File found\n        API Endpoint--&gt;&gt;Client: 200 + JPEG (40KB)\n    else Size variant missing\n        API Endpoint-&gt;&gt;Collection: _sanitize_release_dir()\n        Collection--&gt;&gt;API Endpoint: slug\n        API Endpoint-&gt;&gt;Collection: _extract_cover() if needed\n        Collection-&gt;&gt;Filesystem: Extract main cover\n        API Endpoint-&gt;&gt;Collection: _generate_cover_variants()\n        Collection-&gt;&gt;Filesystem: Generate 6 variants\n        Filesystem--&gt;&gt;Collection: Success\n        Collection--&gt;&gt;API Endpoint: True\n        API Endpoint-&gt;&gt;Filesystem: Read variant\n        Filesystem--&gt;&gt;API Endpoint: File bytes\n        API Endpoint--&gt;&gt;Client: 200 + JPEG (40KB)\n    end</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/media-assets/cover-art/optimization.html#-performance-characteristics","title":"\ud83d\udcca Performance Characteristics","text":""},{"location":"development/media-assets/cover-art/optimization.html#storage-impact","title":"Storage Impact","text":"<ul> <li>Main cover: 300-500 KB per album</li> <li>All 6 variants: 50-150 KB total per album</li> <li>Overhead: ~15-25% of main cover size</li> </ul>"},{"location":"development/media-assets/cover-art/optimization.html#generation-performance","title":"Generation Performance","text":"<ul> <li>First request: +100-200ms (one-time)</li> <li>Subsequent requests: 0ms additional (served from cache)</li> <li>Batch generation: Can pre-generate for popular albums</li> </ul>"},{"location":"development/media-assets/cover-art/optimization.html#caching-strategy","title":"Caching Strategy","text":"<ul> <li>Lazy generation: Only creates variants when requested</li> <li>Permanent cache: Variants never expire</li> <li>No cleanup: Variants remain until manual cleanup</li> <li>Cache location: <code>DATA_ROOT/cache/covers/</code></li> </ul>"},{"location":"development/media-assets/cover-art/optimization.html#-backward-compatibility","title":"\ud83d\udd19 Backward Compatibility","text":""},{"location":"development/media-assets/cover-art/optimization.html#existing-routes-unchanged","title":"Existing Routes Unchanged","text":"<p>\u2705 <code>/covers/&lt;filename&gt;</code> - Still works exactly as before \u2705 <code>get_cover(release_dir)</code> - Returns single URL as always \u2705 All existing templates - No changes required</p>"},{"location":"development/media-assets/cover-art/optimization.html#new-features-are-additive","title":"New Features Are Additive","text":"<ul> <li>New API endpoint doesn't affect existing code</li> <li><code>get_cover_sizes()</code> is additional, not replacement</li> <li>Variants generated only when needed</li> <li>Main cover extraction logic unchanged</li> </ul>"},{"location":"development/media-assets/cover-art/optimization.html#migration-path","title":"Migration Path","text":"<ol> <li>Deploy backend changes</li> <li>No immediate action required</li> <li>Update frontend when ready</li> <li>Variants generate automatically</li> </ol>"},{"location":"development/media-assets/cover-art/optimization.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/media-assets/cover-art/optimization.html#unit-tests","title":"Unit Tests","text":"<pre><code>def test_generate_cover_variants():\n    \"\"\"Test variant generation creates all sizes.\"\"\"\n    collection = MusicCollection(music_root, db_path)\n    slug = \"test_album\"\n\n    result = collection._generate_cover_variants(\"Artist/Album\", slug)\n\n    assert result == True\n    assert (covers_dir / f\"{slug}_96x96.jpg\").exists()\n    assert (covers_dir / f\"{slug}_256x256.jpg\").exists()\n    assert (covers_dir / f\"{slug}_512x512.jpg\").exists()\n\ndef test_get_cover_sizes():\n    \"\"\"Test URL dictionary returns all sizes.\"\"\"\n    collection = MusicCollection(music_root, db_path)\n\n    sizes = collection.get_cover_sizes(\"Artist/Album\")\n\n    assert \"96x96\" in sizes\n    assert \"256x256\" in sizes\n    assert sizes[\"256x256\"].endswith(\"_256x256.jpg\")\n</code></pre>"},{"location":"development/media-assets/cover-art/optimization.html#integration-tests","title":"Integration Tests","text":"<pre><code># Test API endpoint\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=256x256\" -o test.jpg\n\n# Verify file size\nls -lh test.jpg  # Should be ~40KB\n\n# Test invalid size\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=999x999\"\n# Should return JSON error\n\n# Test fallback\ncurl \"http://localhost:5000/api/covers/NonExistent%2FAlbum?size=256x256\"\n# Should return fallback image\n</code></pre>"},{"location":"development/media-assets/cover-art/optimization.html#-troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"development/media-assets/cover-art/optimization.html#issue-variants-not-generating","title":"Issue: Variants not generating","text":"<p>Symptoms: 404 on size-specific requests Check: Main cover exists? PIL/Pillow installed? Solution: Ensure <code>_extract_cover()</code> succeeds first</p>"},{"location":"development/media-assets/cover-art/optimization.html#issue-large-file-sizes","title":"Issue: Large file sizes","text":"<p>Symptoms: Variants larger than expected Adjust: Quality setting in <code>_generate_cover_variants()</code>:</p> <pre><code>quality = 90 if size &gt;= 256 else 85  # Increase quality\n</code></pre>"},{"location":"development/media-assets/cover-art/optimization.html#issue-slow-first-request","title":"Issue: Slow first request","text":"<p>Expected: 100-200ms delay on first size request Solution: Pre-generate for popular albums with background job</p>"},{"location":"development/media-assets/cover-art/overview.html","title":"Overview","text":""},{"location":"development/media-assets/cover-art/overview.html#cover-art-system---overview","title":"Cover Art System - Overview","text":""},{"location":"development/media-assets/cover-art/overview.html#purpose","title":"Purpose","text":"<p>The cover art system manages the extraction, optimization, caching, and serving of album artwork for the Mixtape Society application. It provides responsive, bandwidth-optimized images for different platforms and use cases.</p>"},{"location":"development/media-assets/cover-art/overview.html#key-features","title":"Key Features","text":"<ul> <li>Automatic Extraction - Finds cover art from folder images or embedded metadata</li> <li>Size Optimization - Generates 6 standard sizes (96\u00d796 to 512\u00d7512)</li> <li>Lazy Generation - Creates variants only when requested</li> <li>Permanent Caching - Stores optimized images for fast subsequent loads</li> <li>Fallback Handling - Graceful degradation when covers unavailable</li> <li>Platform Optimization - Serves appropriate sizes for iOS, Android Auto, and desktop</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#system-architecture","title":"System Architecture","text":"<pre><code>graph TD\n    A[Music File] --&gt; B[Cover Extraction]\n    B --&gt; C{Cover Found?}\n    C --&gt;|Yes| D[Generate Main Cover 800px]\n    C --&gt;|No| E[Use Fallback]\n    D --&gt; F[Cache Main Cover]\n    F --&gt; G{Size Variant Requested?}\n    G --&gt;|Yes| H[Generate Variants]\n    G --&gt;|No| I[Serve Main Cover]\n    H --&gt; J[Cache All Variants]\n    J --&gt; K[Serve Requested Size]\n    E --&gt; I</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/media-assets/cover-art/overview.html#components","title":"Components","text":""},{"location":"development/media-assets/cover-art/overview.html#1-extraction-readerpy","title":"1. Extraction (<code>reader.py</code>)","text":"<p>Located in <code>src/musiclib/reader.py</code>, the <code>MusicCollection</code> class handles cover extraction:</p> <p>Methods:</p> <ul> <li><code>get_cover(release_dir)</code> - Returns single cover URL</li> <li><code>get_cover_sizes(release_dir)</code> - Returns all size variants</li> <li><code>_extract_cover(release_dir, target_path)</code> - Extracts from files</li> <li><code>_generate_cover_variants(release_dir, slug)</code> - Creates size variants</li> </ul> <p>Extraction Priority:</p> <ol> <li>Common image files (<code>cover.jpg</code>, <code>folder.jpg</code>, <code>album.jpg</code>)</li> <li>Embedded artwork from audio files</li> <li>Fallback image</li> </ol> <p>Optimization:</p> <ul> <li>Resizes to max 800\u00d7800px</li> <li>Converts to RGB JPEG</li> <li>Compresses to 85% quality</li> <li>Limits file size to 500KB</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#2-storage","title":"2. Storage","text":"<p>Cache Directory: <code>DATA_ROOT/cache/covers/</code></p> <p>File Naming:</p> <pre><code>{slug}.jpg              # Main cover (800px max)\n{slug}_96x96.jpg        # Thumbnail variant\n{slug}_128x128.jpg      # Small variant\n{slug}_192x192.jpg      # Medium variant\n{slug}_256x256.jpg      # Android Auto optimal\n{slug}_384x384.jpg      # High-DPI variant\n{slug}_512x512.jpg      # Full-screen variant\n_fallback.jpg           # Default when no cover found\n</code></pre> <p>Slug Generation:</p> <ul> <li>Sanitizes release directory to safe filename</li> <li>Replaces special characters with underscores</li> <li>Truncates long paths (&gt;200 chars)</li> <li>Adds hash suffix for collision avoidance</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#3-serving-apppy","title":"3. Serving (<code>app.py</code>)","text":"<p>Two Flask routes serve cover images:</p> <p>Direct Serving: <code>/covers/&lt;filename&gt;</code></p> <ul> <li>Original endpoint (unchanged)</li> <li>Serves cached files directly</li> <li>Simple, fast file delivery</li> </ul> <p>API Serving: <code>/api/covers/&lt;release_dir&gt;?size=</code></p> <ul> <li>New size-parameterized endpoint</li> <li>Generates variants on-demand</li> <li>Returns appropriate size or fallback</li> </ul> <p>See: Cover Art Routes</p>"},{"location":"development/media-assets/cover-art/overview.html#standard-sizes","title":"Standard Sizes","text":"Size Dimensions Use Case Typical Size Tiny 96\u00d796 Thumbnails in lists 5-8 KB Small 128\u00d7128 Small tiles 8-12 KB Small-Medium 192\u00d7192 Medium tiles 15-20 KB Medium 256\u00d7256 Android Auto optimal 30-50 KB Large 384\u00d7384 High-DPI displays 60-90 KB Extra Large 512\u00d7512 Full-screen player 100-150 KB"},{"location":"development/media-assets/cover-art/overview.html#workflow","title":"Workflow","text":""},{"location":"development/media-assets/cover-art/overview.html#first-request-cold-cache","title":"First Request (Cold Cache)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Flask\n    participant Extraction\n    participant FileSystem\n    participant Cache\n\n    Client-&gt;&gt;Flask: GET /api/covers/Artist/Album?size=256x256\n    Flask-&gt;&gt;Cache: Check for variant\n    Cache--&gt;&gt;Flask: Not found\n    Flask-&gt;&gt;Cache: Check for main cover\n    Cache--&gt;&gt;Flask: Not found\n    Flask-&gt;&gt;Extraction: Extract cover from files\n    Extraction-&gt;&gt;FileSystem: Search folder images\n    alt Image found\n        FileSystem--&gt;&gt;Extraction: cover.jpg\n    else No image\n        Extraction-&gt;&gt;FileSystem: Check embedded art\n        FileSystem--&gt;&gt;Extraction: Audio file metadata\n    end\n    Extraction-&gt;&gt;Extraction: Optimize to 800x800, 85% quality\n    Extraction-&gt;&gt;Cache: Save main cover\n    Flask-&gt;&gt;Extraction: Generate all variants\n    Extraction-&gt;&gt;Extraction: Resize to 96\u00d796, 128\u00d7128, ..., 512\u00d7512\n    Extraction-&gt;&gt;Cache: Save all variants\n    Cache--&gt;&gt;Flask: Variant ready\n    Flask--&gt;&gt;Client: 256\u00d7256 JPEG (~40KB)</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>Total time: ~150-300ms (one-time cost)</p>"},{"location":"development/media-assets/cover-art/overview.html#subsequent-requests-warm-cache","title":"Subsequent Requests (Warm Cache)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Flask\n    participant Cache\n\n    Client-&gt;&gt;Flask: GET /api/covers/Artist/Album?size=256x256\n    Flask-&gt;&gt;Cache: Check for variant\n    Cache--&gt;&gt;Flask: Found!\n    Flask--&gt;&gt;Client: 256\u00d7256 JPEG (~40KB)</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>Total time: ~5-10ms (served from cache)</p>"},{"location":"development/media-assets/cover-art/overview.html#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"development/media-assets/cover-art/overview.html#storage-impact","title":"Storage Impact","text":"<p>Per album:</p> <ul> <li>Main cover: 300-500 KB</li> <li>All 6 variants: 50-150 KB</li> <li>Total increase: ~50-150 KB per album</li> </ul> <p>For 1000 albums:</p> <ul> <li>Main covers: ~400 MB</li> <li>All variants: ~100 MB</li> <li>Total: ~500 MB</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#bandwidth-savings","title":"Bandwidth Savings","text":"<p>Android Auto (256\u00d7256):</p> <ul> <li>Before: 400 KB per cover</li> <li>After: 40 KB per cover</li> <li>Savings: 90%</li> </ul> <p>Mobile Web (128\u00d7128):</p> <ul> <li>Before: 400 KB per cover</li> <li>After: 12 KB per cover</li> <li>Savings: 97%</li> </ul> <p>10-track mixtape on Android Auto:</p> <ul> <li>Before: 4 MB</li> <li>After: 400 KB</li> <li>Savings: 90%</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#generation-performance","title":"Generation Performance","text":"Operation First Request Cached Request Main cover extraction 50-100ms 0ms Variant generation 100-200ms 0ms File serving 5-10ms 5-10ms Total 150-300ms 5-10ms"},{"location":"development/media-assets/cover-art/overview.html#platform-optimization","title":"Platform Optimization","text":"<p>The system automatically selects appropriate sizes based on the requesting platform:</p>"},{"location":"development/media-assets/cover-art/overview.html#ios","title":"iOS","text":"<p>Prioritizes larger sizes for high-quality lock screen display:</p> <ul> <li>512\u00d7512 (primary)</li> <li>256\u00d7256 (secondary)</li> <li>192\u00d7192 (fallback)</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#android-auto","title":"Android Auto","text":"<p>Provides full spectrum for optimal selection:</p> <ul> <li>96\u00d796 (minimum required)</li> <li>128\u00d7128, 192\u00d7192, 256\u00d7256 (optimal range)</li> <li>384\u00d7384, 512\u00d7512 (high quality)</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#desktop","title":"Desktop","text":"<p>Simplified set for standard displays:</p> <ul> <li>192\u00d7192 (thumbnails/tiles)</li> <li>512\u00d7512 (full player)</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#error-handling","title":"Error Handling","text":""},{"location":"development/media-assets/cover-art/overview.html#extraction-failures","title":"Extraction Failures","text":"<p>No cover found:</p> <ol> <li>Search common image files \u2192 Not found</li> <li>Check embedded artwork \u2192 Not found</li> <li>Result: Return <code>_fallback.jpg</code></li> </ol> <p>Extraction error:</p> <ol> <li>Log warning message</li> <li>Return <code>_fallback.jpg</code></li> <li>Result: User never sees broken image</li> </ol>"},{"location":"development/media-assets/cover-art/overview.html#generation-failures","title":"Generation Failures","text":"<p>Variant generation fails:</p> <ol> <li>Log warning message</li> <li>Return main cover (800px) instead</li> <li>Retry on next request</li> <li>Result: Slightly larger file, but still functional</li> </ol>"},{"location":"development/media-assets/cover-art/overview.html#missing-files","title":"Missing Files","text":"<p>Requested file doesn't exist:</p> <ol> <li>Try to generate from main cover</li> <li>If main cover missing, extract from audio</li> <li>If extraction fails, return fallback</li> <li>Result: Multiple fallback levels ensure images always load</li> </ol>"},{"location":"development/media-assets/cover-art/overview.html#integration-points","title":"Integration Points","text":""},{"location":"development/media-assets/cover-art/overview.html#backend-python","title":"Backend (Python)","text":"<pre><code>from musiclib import MusicCollection\n\n# Initialize collection\nmc = MusicCollection(music_root=\"/music\", db_path=\"/data/music.db\")\n\n# Get single cover URL (original behavior)\ncover_url = mc.get_cover(\"Artist/Album\")\n# Returns: \"covers/artist_album.jpg\"\n\n# Get all size variants (new behavior)\ncover_sizes = mc.get_cover_sizes(\"Artist/Album\")\n# Returns: {\n#   \"96x96\": \"covers/artist_album_96x96.jpg\",\n#   \"256x256\": \"covers/artist_album_256x256.jpg\",\n#   ...\n# }\n</code></pre>"},{"location":"development/media-assets/cover-art/overview.html#frontend-javascript","title":"Frontend (JavaScript)","text":"<pre><code>// Extract metadata with platform-optimized artwork\nconst metadata = extractMetadataFromDOM(trackElement);\n\n// metadata.artwork contains size-specific URLs:\n// [\n//   { src: \"/covers/slug_96x96.jpg\", sizes: \"96x96\", type: \"image/jpeg\" },\n//   { src: \"/covers/slug_256x256.jpg\", sizes: \"256x256\", type: \"image/jpeg\" },\n//   ...\n// ]\n\n// Update MediaSession\nnavigator.mediaSession.metadata = new MediaMetadata({\n    title: metadata.title,\n    artist: metadata.artist,\n    artwork: metadata.artwork  // Browser picks best size\n});\n</code></pre>"},{"location":"development/media-assets/cover-art/overview.html#flask-routes","title":"Flask Routes","text":"<pre><code># Direct file serving (existing)\n@app.route(\"/covers/&lt;filename&gt;\")\ndef serve_album_cover(filename):\n    return send_from_directory(covers_dir, filename)\n\n# Size-parameterized API (new)\n@app.route(\"/api/covers/&lt;path:release_dir&gt;\")\ndef serve_cover_by_size(release_dir):\n    size = request.args.get('size')  # e.g., \"256x256\"\n    # ... generate if needed, return appropriate file\n</code></pre>"},{"location":"development/media-assets/cover-art/overview.html#related-documentation","title":"Related Documentation","text":"<p>Technical Details:</p> <ul> <li>Size Optimization Implementation - Code-level details</li> <li>API Reference - Complete API documentation</li> </ul> <p>Integrated with:</p> <ul> <li>Cover Art Routes - HTTP endpoint documentation</li> <li>Playback Routes - Audio streaming context</li> <li>Android Auto</li> </ul>"},{"location":"development/media-assets/cover-art/overview.html#future-enhancements","title":"Future Enhancements","text":"<p>Potential improvements to the cover art system:</p> <ul> <li> WebP format support - Better compression for modern browsers</li> <li> AVIF format support - Next-gen image format</li> <li> Automatic format selection - Serve WebP/AVIF to supporting browsers</li> <li> Custom size requests - Allow arbitrary dimensions with limits</li> <li> Bulk pre-generation - Background job for popular albums</li> <li> CDN integration - Serve from CDN for better global performance</li> <li> Smart caching - Delete unused variants after N days</li> <li> Analytics - Track most-requested sizes</li> <li> Color extraction - Dominant colors for UI theming</li> <li> Multiple covers - Support for disc-specific artwork</li> </ul>"},{"location":"development/media-assets/cover-art/routes.html","title":"Route Handler","text":""},{"location":"development/media-assets/cover-art/routes.html#cover-art-routes","title":"Cover Art Routes","text":"<p>This document describes the Flask routes for serving cover art images.</p>"},{"location":"development/media-assets/cover-art/routes.html#overview","title":"Overview","text":"<p>Two routes handle cover art serving:</p> <ol> <li>Direct File Serving - <code>/covers/&lt;filename&gt;</code> (original, unchanged)</li> <li>Size-Parameterized API - <code>/api/covers/&lt;path&gt;</code> (new, with size selection)</li> </ol> <p>Both routes are registered in the main Flask app (<code>app.py</code>).</p>"},{"location":"development/media-assets/cover-art/routes.html#route-1-direct-file-serving","title":"Route 1: Direct File Serving","text":""},{"location":"development/media-assets/cover-art/routes.html#get-covers","title":"<code>GET /covers/&lt;filename&gt;</code>","text":"<p>Serves cover art files directly from the cache directory.</p> <p>Original endpoint - preserves existing behavior for backward compatibility.</p>"},{"location":"development/media-assets/cover-art/routes.html#request","title":"Request","text":"<pre><code>GET /covers/artist_album_256x256.jpg HTTP/1.1\nHost: localhost:5000\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#parameters","title":"Parameters","text":"Parameter Type Location Required Description <code>filename</code> string path Yes Cover filename (must end with <code>.jpg</code>, <code>.jpeg</code>, or <code>.png</code>)"},{"location":"development/media-assets/cover-art/routes.html#response","title":"Response","text":"<p>Success (200 OK):</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: image/jpeg\nCache-Control: public, max-age=3600\nContent-Length: 42134\n\n[binary image data]\n</code></pre> <p>Not Found (404):</p> <pre><code>HTTP/1.1 404 Not Found\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#security","title":"Security","text":"<ul> <li>\u2705 Only serves from covers directory (<code>DATA_ROOT/cache/covers/</code>)</li> <li>\u2705 Restricts to image extensions (<code>.jpg</code>, <code>.jpeg</code>, <code>.png</code>)</li> <li>\u2705 No directory traversal allowed</li> </ul>"},{"location":"development/media-assets/cover-art/routes.html#implementation","title":"Implementation","text":"<pre><code>@app.route(\"/covers/&lt;filename&gt;\")\ndef serve_album_cover(filename):\n    \"\"\"Serves extracted album cover images from cache directory.\"\"\"\n    covers_dir = app.config[\"DATA_ROOT\"] / \"cache\" / \"covers\"\n\n    # Security: restrict to image extensions\n    if not filename.lower().endswith((\".jpg\", \".jpeg\", \".png\")):\n        abort(404)\n\n    return send_from_directory(covers_dir, filename)\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#usage","title":"Usage","text":"<pre><code>&lt;!-- Direct reference in HTML --&gt;\n&lt;img src=\"/covers/artist_album_256x256.jpg\" alt=\"Album Cover\"&gt;\n</code></pre> <pre><code>// JavaScript fetch\nfetch('/covers/artist_album_512x512.jpg')\n    .then(response =&gt; response.blob())\n    .then(blob =&gt; {\n        const url = URL.createObjectURL(blob);\n        img.src = url;\n    });\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#route-2-size-parameterized-api","title":"Route 2: Size-Parameterized API","text":""},{"location":"development/media-assets/cover-art/routes.html#get-apicovers","title":"<code>GET /api/covers/&lt;path:release_dir&gt;</code>","text":"<p>Serves cover art with optional size parameter. Generates variants on-demand.</p> <p>New endpoint for responsive, bandwidth-optimized cover art.</p>"},{"location":"development/media-assets/cover-art/routes.html#request_1","title":"Request","text":"<pre><code>GET /api/covers/Artist%2FAlbum?size=256x256 HTTP/1.1\nHost: localhost:5000\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#parameters_1","title":"Parameters","text":"Parameter Type Location Required Description <code>release_dir</code> string path Yes Release directory path (URL-encoded) <code>size</code> string query No Desired size in <code>WxH</code> format"},{"location":"development/media-assets/cover-art/routes.html#valid-sizes","title":"Valid Sizes","text":"Value Dimensions Use Case <code>96x96</code> 96\u00d796 Thumbnails <code>128x128</code> 128\u00d7128 Small tiles <code>192x192</code> 192\u00d7192 Medium tiles <code>256x256</code> 256\u00d7256 Android Auto optimal <code>384x384</code> 384\u00d7384 High-DPI displays <code>512x512</code> 512\u00d7512 Full-screen player"},{"location":"development/media-assets/cover-art/routes.html#response_1","title":"Response","text":"<p>Success (200 OK):</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: image/jpeg\nCache-Control: public, max-age=3600\nContent-Length: 42134\nAccess-Control-Allow-Origin: *\n\n[binary image data]\n</code></pre> <p>Invalid Size (400 Bad Request):</p> <pre><code>{\n  \"error\": \"Invalid size parameter\",\n  \"valid_sizes\": [\"96x96\", \"128x128\", \"192x192\", \"256x256\", \"384x384\", \"512x512\"]\n}\n</code></pre> <p>Not Found (404):</p> <pre><code>HTTP/1.1 404 Not Found\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#behavior","title":"Behavior","text":"<p>With <code>size</code> parameter:</p> <ol> <li>Check if size variant exists in cache</li> <li>If not, generate variant from main cover</li> <li>If main cover missing, extract from audio files</li> <li>Return requested size or fallback</li> </ol> <p>Without <code>size</code> parameter:</p> <ol> <li>Return main cover (800px max dimension)</li> <li>If not cached, extract from audio files</li> <li>Return fallback if extraction fails</li> </ol>"},{"location":"development/media-assets/cover-art/routes.html#implementation_1","title":"Implementation","text":"<pre><code>@app.route(\"/api/covers/&lt;path:release_dir_encoded&gt;\")\ndef serve_cover_by_size(release_dir_encoded):\n    \"\"\"Serves cover art with optional size parameter.\"\"\"\n    from urllib.parse import unquote\n\n    release_dir = unquote(release_dir_encoded)\n    requested_size = request.args.get('size', '').lower()\n\n    valid_sizes = ['96x96', '128x128', '192x192', '256x256', '384x384', '512x512']\n    covers_dir = app.config[\"DATA_ROOT\"] / \"cache\" / \"covers\"\n\n    # No size - return main cover\n    if not requested_size:\n        cover_url = collection.get_cover(release_dir)\n        if cover_url:\n            filename = cover_url.split('/')[-1]\n            return send_from_directory(covers_dir, filename)\n        abort(404)\n\n    # Validate size\n    if requested_size not in valid_sizes:\n        return jsonify({\n            \"error\": \"Invalid size parameter\",\n            \"valid_sizes\": valid_sizes\n        }), 400\n\n    # Get or generate size-specific cover\n    slug = collection._sanitize_release_dir(release_dir)\n    size_filename = f\"{slug}_{requested_size}.jpg\"\n    size_path = covers_dir / size_filename\n\n    # Generate if needed\n    if not size_path.exists():\n        main_path = covers_dir / f\"{slug}.jpg\"\n        if not main_path.exists():\n            collection._extract_cover(release_dir, main_path)\n\n        if main_path.exists():\n            collection._generate_cover_variants(release_dir, slug)\n\n    # Serve or fallback\n    if size_path.exists():\n        return send_from_directory(covers_dir, size_filename)\n\n    # Try main cover\n    if (covers_dir / f\"{slug}.jpg\").exists():\n        return send_from_directory(covers_dir, f\"{slug}.jpg\")\n\n    # Final fallback\n    return send_from_directory(covers_dir, \"_fallback.jpg\")\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#usage_1","title":"Usage","text":"<p>Python (Flask endpoint):</p> <pre><code>@app.route('/api/mixtape/&lt;mixtape_id&gt;/metadata')\ndef get_metadata(mixtape_id):\n    release_dir = get_release_dir(mixtape_id)\n\n    # Get size variants\n    cover_sizes = collection.get_cover_sizes(release_dir)\n\n    # Build URLs\n    base_url = request.host_url.rstrip('/')\n    artwork = [\n        {\"src\": f\"{base_url}/{cover_sizes['256x256']}\", \"sizes\": \"256x256\"},\n        {\"src\": f\"{base_url}/{cover_sizes['512x512']}\", \"sizes\": \"512x512\"}\n    ]\n\n    return jsonify({\"artwork\": artwork})\n</code></pre> <p>JavaScript (client-side):</p> <pre><code>// Request specific size\nconst coverUrl = `/api/covers/${encodeURIComponent(releaseDir)}?size=256x256`;\n\nfetch(coverUrl)\n    .then(response =&gt; {\n        if (!response.ok) throw new Error('Cover not found');\n        return response.blob();\n    })\n    .then(blob =&gt; {\n        img.src = URL.createObjectURL(blob);\n    });\n</code></pre> <p>cURL (testing):</p> <pre><code># Request 256\u00d7256 variant\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=256x256\" -o cover_256.jpg\n\n# Without size (main cover)\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum\" -o cover_main.jpg\n\n# Invalid size (returns JSON error)\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=999x999\"\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#performance","title":"Performance","text":""},{"location":"development/media-assets/cover-art/routes.html#first-request-cold-cache","title":"First Request (Cold Cache)","text":"<pre><code>GET /api/covers/Artist%2FAlbum?size=256x256\n\nTimeline:\n  0ms   - Request received\n  50ms  - Extract main cover from audio files\n  150ms - Generate all size variants (96\u00d796 to 512\u00d7512)\n  200ms - Response sent\n\nTotal: ~200ms (one-time cost)\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#subsequent-requests-warm-cache","title":"Subsequent Requests (Warm Cache)","text":"<pre><code>GET /api/covers/Artist%2FAlbum?size=256x256\n\nTimeline:\n  0ms  - Request received\n  5ms  - Serve from filesystem\n  5ms  - Response sent\n\nTotal: ~5ms (cached)\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#bandwidth-comparison","title":"Bandwidth Comparison","text":"Client Route Size Bandwidth Desktop <code>/covers/slug.jpg</code> 400 KB 400 KB Desktop <code>/api/covers/path?size=512x512</code> 120 KB 120 KB (70% savings) Android Auto <code>/covers/slug.jpg</code> 400 KB 400 KB Android Auto <code>/api/covers/path?size=256x256</code> 40 KB 40 KB (90% savings) Mobile <code>/covers/slug.jpg</code> 400 KB 400 KB Mobile <code>/api/covers/path?size=128x128</code> 12 KB 12 KB (97% savings)"},{"location":"development/media-assets/cover-art/routes.html#error-handling","title":"Error Handling","text":""},{"location":"development/media-assets/cover-art/routes.html#missing-cover","title":"Missing Cover","text":"<p>Scenario: Release directory has no cover art</p> <p>Fallback chain:</p> <ol> <li>Try <code>/covers/{slug}.jpg</code> \u2192 Not found</li> <li>Extract from audio files \u2192 No embedded art</li> <li>Return <code>/covers/_fallback.jpg</code> \u2192 Always exists</li> </ol> <p>Result: User sees fallback image, no 404 error</p>"},{"location":"development/media-assets/cover-art/routes.html#invalid-size-parameter","title":"Invalid Size Parameter","text":"<p>Request:</p> <pre><code>GET /api/covers/Artist%2FAlbum?size=999x999\n</code></pre> <p>Response:</p> <pre><code>HTTP/1.1 400 Bad Request\n\n{\n  \"error\": \"Invalid size parameter\",\n  \"valid_sizes\": [\"96x96\", \"128x128\", \"192x192\", \"256x256\", \"384x384\", \"512x512\"]\n}\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#generation-failure","title":"Generation Failure","text":"<p>Scenario: Cannot generate variant (disk full, PIL error, etc.)</p> <p>Behavior:</p> <ol> <li>Log warning message</li> <li>Return main cover instead of variant</li> <li>Retry generation on next request</li> </ol> <p>Result: Slightly larger file served, but request succeeds</p>"},{"location":"development/media-assets/cover-art/routes.html#caching-headers","title":"Caching Headers","text":"<p>Both routes include caching headers:</p> <pre><code>Cache-Control: public, max-age=3600\n</code></pre> <p>Implications:</p> <ul> <li>Browsers cache for 1 hour</li> <li>CDNs can cache responses</li> <li>Reduces server load</li> <li>Faster repeat visits</li> </ul> <p>To bypass cache:</p> <pre><code>// Add timestamp parameter\nconst url = `/covers/slug_256x256.jpg?t=${Date.now()}`;\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#related-documentation","title":"Related Documentation","text":"<p>Architecture:</p> <ul> <li>Cover Art System Overview - System architecture</li> <li>Size Optimization - Implementation details</li> <li>API Reference - Python/JavaScript API</li> </ul> <p>Integration:</p> <ul> <li>Android Auto Integration - Android Auto context</li> <li>Playback Routes - Audio streaming context</li> </ul>"},{"location":"development/media-assets/cover-art/routes.html#testing","title":"Testing","text":""},{"location":"development/media-assets/cover-art/routes.html#manual-testing","title":"Manual Testing","text":"<pre><code># Start Flask\nflask run --host=0.0.0.0\n\n# Test direct route\ncurl http://localhost:5000/covers/artist_album.jpg -o test1.jpg\n\n# Test API route with size\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=256x256\" -o test2.jpg\n\n# Test API route without size\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum\" -o test3.jpg\n\n# Test invalid size\ncurl \"http://localhost:5000/api/covers/Artist%2FAlbum?size=invalid\"\n\n# Compare file sizes\nls -lh test*.jpg\n</code></pre>"},{"location":"development/media-assets/cover-art/routes.html#automated-testing","title":"Automated Testing","text":"<pre><code># tests/test_cover_routes.py\ndef test_direct_cover_route(client):\n    response = client.get('/covers/artist_album_256x256.jpg')\n    assert response.status_code == 200\n    assert response.content_type == 'image/jpeg'\n\ndef test_api_cover_route_with_size(client):\n    response = client.get('/api/covers/Artist%2FAlbum?size=256x256')\n    assert response.status_code == 200\n    assert len(response.data) &lt; 100 * 1024  # &lt; 100KB\n\ndef test_api_cover_route_invalid_size(client):\n    response = client.get('/api/covers/Artist%2FAlbum?size=invalid')\n    assert response.status_code == 400\n    assert 'error' in response.json\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html","title":"Editor API (Backend)","text":""},{"location":"development/mixtape-system/editor-api.html#editor-backend-api","title":"Editor Backend API","text":"<p>This page documents the Flask backend routes, server-side logic, and API contracts for the Mixtape Editor. All routes are protected by authentication and handle mixtape creation, editing, search, and cover generation.</p>"},{"location":"development/mixtape-system/editor-api.html#-overview","title":"\ud83c\udfaf Overview","text":"<p>The editor backend (<code>routes/editor.py</code>) provides:</p> <ul> <li>Mixtape CRUD operations - Create, read, update mixtapes</li> <li>Library search integration - Full-text search via <code>MusicCollectionUI</code></li> <li>Cover image handling - Upload processing and composite generation</li> <li>Progress streaming - Server-Sent Events for background operations</li> <li>Data persistence - JSON files on disk via <code>MixtapeManager</code></li> </ul> <p>Flask Blueprint: <code>editor</code> URL Prefix: <code>/editor/*</code> Authentication: All routes use <code>@require_auth</code> decorator</p>"},{"location":"development/mixtape-system/editor-api.html#-authentication","title":"\ud83d\udd12 Authentication","text":""},{"location":"development/mixtape-system/editor-api.html#require_auth-decorator","title":"@require_auth Decorator","text":"<p>All editor routes require authentication:</p> <pre><code>from src.routes.authentication import require_auth\n\n@editor.route(\"/\")\n@require_auth\ndef new_mixtape():\n    # Only accessible to authenticated users\n    pass\n</code></pre> <p>Behavior:</p> <ul> <li>Checks session for authentication</li> <li>Redirects to <code>/auth/login</code> if not authenticated</li> <li>Sets <code>next</code> parameter for post-login redirect</li> <li>Returns to requested page after login</li> </ul> <p>See: Authentication Routes</p>"},{"location":"development/mixtape-system/editor-api.html#-routes-reference","title":"\ud83d\uddfa\ufe0f Routes Reference","text":""},{"location":"development/mixtape-system/editor-api.html#mixtape-management","title":"Mixtape Management","text":"HTTP URL Pattern Handler Purpose <code>GET</code> <code>/editor/</code> <code>new_mixtape()</code> Render blank editor for new mixtape <code>GET</code> <code>/editor/&lt;slug&gt;</code> <code>edit_mixtape(slug)</code> Load existing mixtape for editing <code>POST</code> <code>/editor/save</code> <code>save_mixtape()</code> Create new or update existing mixtape"},{"location":"development/mixtape-system/editor-api.html#library-search","title":"Library Search","text":"HTTP URL Pattern Handler Purpose <code>GET</code> <code>/editor/search?q=</code> <code>search()</code> Search library (50 results max) <code>GET</code> <code>/editor/artist_details?artist=</code> <code>artist_details()</code> Get artist's albums and tracks <code>GET</code> <code>/editor/album_details?release_dir=</code> <code>album_details()</code> Get album's tracks and metadata"},{"location":"development/mixtape-system/editor-api.html#cover--progress","title":"Cover &amp; Progress","text":"HTTP URL Pattern Handler Purpose <code>POST</code> <code>/editor/generate_composite</code> <code>generate_composite()</code> Create composite cover from track art <code>GET</code> <code>/editor/progress/&lt;slug&gt;</code> <code>progress_stream(slug)</code> SSE progress updates for caching"},{"location":"development/mixtape-system/editor-api.html#qr-codes","title":"QR Codes","text":"HTTP URL Pattern Handler Purpose <code>GET</code> <code>/qr/&lt;slug&gt;.png</code> <code>qr.generate_qr(slug)</code> Simple QR code PNG <code>GET</code> <code>/qr/&lt;slug&gt;/download</code> <code>qr.download_qr(slug)</code> Enhanced QR with cover and title <p>See: QR Code Routes for QR documentation</p>"},{"location":"development/mixtape-system/editor-api.html#-route-handlers","title":"\ud83d\udccb Route Handlers","text":""},{"location":"development/mixtape-system/editor-api.html#new_mixtape","title":"new_mixtape()","text":"<p>Purpose: Render blank editor for creating a new mixtape</p> <p>Route:</p> <pre><code>@editor.route(\"/\")\n@require_auth\ndef new_mixtape()\n</code></pre> <p>Implementation:</p> <pre><code>def new_mixtape():\n    \"\"\"\n    Render editor with empty mixtape template\n    \"\"\"\n    # Build empty mixtape structure\n    empty_mixtape = {\n        'title': '',\n        'cover': None,\n        'liner_notes': '',\n        'tracks': [],\n        'slug': None,\n        'created_at': None,\n        'updated_at': None\n    }\n\n    return render_template(\n        'editor.html',\n        preload_mixtape=empty_mixtape\n    )\n</code></pre> <p>Template receives:</p> <pre><code>window.PRELOADED_MIXTAPE = {\n    title: '',\n    cover: null,\n    liner_notes: '',\n    tracks: [],\n    slug: null\n};\n</code></pre> <p>Frontend behavior:</p> <ul> <li>Generates new <code>client_id</code> via <code>crypto.randomUUID()</code></li> <li>Stores in <code>localStorage['current_mixtape_client_id']</code></li> <li>Used for idempotent creates (prevents duplicates)</li> </ul>"},{"location":"development/mixtape-system/editor-api.html#edit_mixtapeslug","title":"edit_mixtape(slug)","text":"<p>Purpose: Load existing mixtape for editing</p> <p>Route:</p> <pre><code>@editor.route(\"/&lt;slug&gt;\")\n@require_auth\ndef edit_mixtape(slug: str)\n</code></pre> <p>Implementation:</p> <pre><code>def edit_mixtape(slug):\n    \"\"\"\n    Load mixtape data and render pre-filled editor\n    \"\"\"\n    mixtape_manager = current_app.mixtape_manager\n\n    # Load mixtape from disk\n    mixtape = mixtape_manager.get(slug)\n\n    if not mixtape:\n        logger.warning(f\"Mixtape not found: {slug}\")\n        abort(404)\n\n    # Render with pre-loaded data\n    return render_template(\n        'editor.html',\n        preload_mixtape=mixtape\n    )\n</code></pre> <p>Returns 404 if: Slug doesn't exist</p> <p>Template receives:</p> <pre><code>window.PRELOADED_MIXTAPE = {\n    title: 'My Mixtape',\n    cover: '/covers/slug.jpg',\n    liner_notes: '# Notes here',\n    tracks: [{...}, {...}],\n    slug: 'my-mixtape',\n    created_at: '2025-01-16T10:00:00',\n    updated_at: '2025-01-16T15:30:00'\n};\n</code></pre> <p>Hidden input:</p> <pre><code>&lt;input type=\"hidden\" id=\"editing-slug\" value=\"my-mixtape\"&gt;\n</code></pre> <p>Frontend uses this to determine create vs update mode.</p>"},{"location":"development/mixtape-system/editor-api.html#save_mixtape","title":"save_mixtape()","text":"<p>Purpose: Create new mixtape or update existing one</p> <p>Route:</p> <pre><code>@editor.route(\"/save\", methods=[\"POST\"])\n@require_auth\ndef save_mixtape()\n</code></pre> <p>Request payload:</p> <pre><code>{\n  \"title\": \"My Summer Mix\",\n  \"cover\": \"data:image/jpeg;base64,...\",\n  \"liner_notes\": \"# Summer vibes\\n\\nTrack #1 is amazing!\",\n  \"tracks\": [\n    {\n      \"artist\": \"The Beatles\",\n      \"album\": \"Abbey Road\",\n      \"track\": \"Come Together\",\n      \"duration\": \"4:20\",\n      \"path\": \"The Beatles/Abbey Road/01 Come Together.flac\",\n      \"filename\": \"01 Come Together.flac\",\n      \"cover\": \"/covers/abbey_road.jpg\"\n    }\n  ],\n  \"slug\": null,\n  \"client_id\": \"123e4567-e89b-12d3-a456-426614174000\"\n}\n</code></pre> <p>Flow diagram:</p> <pre><code>flowchart TD\n    Start[POST /editor/save]\n    Parse[Parse JSON payload]\n    CheckSlug{slug present?}\n\n    Enrich[Enrich track metadata]\n    ProcessCover[Process cover image]\n\n    Create[MixtapeManager.save]\n    Update[MixtapeManager.update]\n\n    Cache{Caching enabled?}\n    TriggerCache[Trigger background caching]\n\n    Response[Return success JSON]\n\n    Start --&gt; Parse\n    Parse --&gt; CheckSlug\n    CheckSlug --&gt;|No| Enrich\n    CheckSlug --&gt;|Yes| Enrich\n\n    Enrich --&gt; ProcessCover\n    ProcessCover --&gt; CheckSlug\n\n    CheckSlug --&gt;|No slug| Create\n    CheckSlug --&gt;|Has slug| Update\n\n    Create --&gt; Cache\n    Update --&gt; Cache\n\n    Cache --&gt;|Yes| TriggerCache\n    Cache --&gt;|No| Response\n    TriggerCache --&gt; Response\n\n    style Create fill:#4a8c5f,color:#fff\n    style Update fill:#4a6fa5,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>Implementation:</p> <pre><code>def save_mixtape():\n    \"\"\"\n    Save or update mixtape with background caching\n    \"\"\"\n    data = request.get_json()\n\n    # Extract data\n    title = data.get('title', 'Unnamed Mixtape')\n    cover = data.get('cover')\n    liner_notes = data.get('liner_notes', '')\n    tracks = data.get('tracks', [])\n    slug = data.get('slug')\n    client_id = data.get('client_id')\n\n    # Enrich track metadata\n    collection = current_app.music_collection\n    for track in tracks:\n        release_dir = Path(track['path']).parent\n        track['cover'] = collection.get_cover(release_dir)\n\n    # Process cover image\n    cover_filename = None\n    if cover and cover.startswith('data:image'):\n        # Decode base64, resize, and save\n        cover_filename = _process_cover_upload(cover, slug or client_id)\n\n    # Create or update\n    if slug:\n        # Update existing\n        mixtape_manager.update(slug, {\n            'title': title,\n            'cover': cover_filename,\n            'liner_notes': liner_notes,\n            'tracks': tracks,\n            'client_id': client_id\n        })\n    else:\n        # Create new (generates UUID slug)\n        slug = mixtape_manager.save({\n            'title': title,\n            'cover': cover_filename,\n            'liner_notes': liner_notes,\n            'tracks': tracks,\n            'client_id': client_id\n        })\n\n    # Trigger background caching\n    if current_app.config.get('AUDIO_CACHE_PRECACHE_ON_UPLOAD'):\n        _trigger_audio_caching_async(slug)\n\n    return jsonify({\n        'success': True,\n        'slug': slug,\n        'title': title,\n        'client_id': client_id,\n        'url': f'/editor/{slug}'\n    })\n</code></pre> <p>Key behaviors:</p> <ol> <li>Track enrichment - Refreshes cover paths from library</li> <li>Cover processing - Decodes base64, resizes to max 1200px width</li> <li>Slug generation - New mixtapes get UUID4 slug</li> <li>Timestamps - <code>created_at</code> on create, <code>updated_at</code> on update</li> <li>Client-ID preservation - Maintains idempotency token</li> <li>Background caching - Optional async transcoding</li> </ol> <p>Response:</p> <pre><code>{\n  \"success\": true,\n  \"slug\": \"my-summer-mix\",\n  \"title\": \"My Summer Mix\",\n  \"client_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n  \"url\": \"/editor/my-summer-mix\"\n}\n</code></pre> <p>Error responses:</p> <ul> <li><code>400</code> - Invalid JSON or missing required fields</li> <li><code>404</code> - Slug not found (on update)</li> <li><code>500</code> - Server error (disk write failure, etc.)</li> </ul>"},{"location":"development/mixtape-system/editor-api.html#search","title":"search()","text":"<p>Purpose: Search music library with highlighting</p> <p>Route:</p> <pre><code>@editor.route(\"/search\")\n@require_auth\ndef search()\n</code></pre> <p>Query parameters:</p> <ul> <li><code>q</code> (required) - Search query (minimum 3 characters)</li> </ul> <p>Request:</p> <pre><code>GET /editor/search?q=beatles\n</code></pre> <p>Implementation:</p> <pre><code>def search():\n    \"\"\"\n    Full-text search with highlighting\n    \"\"\"\n    query = request.args.get('q', '').strip()\n\n    # Minimum query length\n    if len(query) &lt; 3:\n        return jsonify([])\n\n    # Search via MusicCollectionUI\n    collection = current_app.music_collection\n    results = collection.search_highlighting(query, limit=50)\n\n    return jsonify(results)\n</code></pre> <p>Response format:</p> <pre><code>[\n  {\n    \"type\": \"artist\",\n    \"artist\": \"The Beatles\",\n    \"raw_artist\": \"The Beatles\",\n    \"reasons\": [{\"type\": \"album\", \"text\": \"3 album(s)\"}],\n    \"num_albums\": 3,\n    \"albums\": [],\n    \"load_on_demand\": true,\n    \"clickable\": true,\n    \"click_query\": \"artist:'The Beatles'\"\n  },\n  {\n    \"type\": \"album\",\n    \"artist\": \"The Beatles\",\n    \"album\": \"Abbey Road\",\n    \"raw_album\": \"Abbey Road\",\n    \"cover\": \"/covers/abbey_road.jpg\",\n    \"is_compilation\": false,\n    \"reasons\": [{\"type\": \"track\", \"text\": \"17 track(s)\"}],\n    \"num_tracks\": 17,\n    \"tracks\": [],\n    \"load_on_demand\": true,\n    \"click_query\": \"release_dir:/The%20Beatles/Abbey%20Road/\"\n  },\n  {\n    \"type\": \"track\",\n    \"artist\": \"The Beatles\",\n    \"album\": \"Abbey Road\",\n    \"track\": \"Come Together\",\n    \"duration\": \"4:20\",\n    \"path\": \"The Beatles/Abbey Road/01 Come Together.flac\",\n    \"filename\": \"01 Come Together.flac\",\n    \"cover\": \"/covers/abbey_road.jpg\",\n    \"highlighted_track\": \"&lt;mark&gt;Come&lt;/mark&gt; &lt;mark&gt;Together&lt;/mark&gt;\"\n  }\n]\n</code></pre> <p>Result types:</p> <ul> <li><code>artist</code> - Artist entry with album count</li> <li><code>album</code> - Album entry with track count</li> <li><code>track</code> - Individual track (immediately addable)</li> </ul> <p>Lazy loading:</p> <ul> <li>Artists/albums have <code>load_on_demand: true</code></li> <li>Details loaded via separate requests</li> </ul>"},{"location":"development/mixtape-system/editor-api.html#artist_details","title":"artist_details()","text":"<p>Purpose: Get full details for an artist (all albums and tracks)</p> <p>Route:</p> <pre><code>@editor.route(\"/artist_details\")\n@require_auth\ndef artist_details()\n</code></pre> <p>Query parameters:</p> <ul> <li><code>artist</code> (required) - Artist name</li> </ul> <p>Request:</p> <pre><code>GET /editor/artist_details?artist=The%20Beatles\n</code></pre> <p>Implementation:</p> <pre><code>def artist_details():\n    \"\"\"\n    Get artist's albums and tracks\n    \"\"\"\n    artist = request.args.get('artist')\n\n    if not artist:\n        return jsonify({'error': 'Missing artist parameter'}), 400\n\n    collection = current_app.music_collection\n    details = collection.get_artist_details(artist)\n\n    return jsonify(details)\n</code></pre> <p>Response:</p> <pre><code>{\n  \"artist\": \"The Beatles\",\n  \"albums\": [\n    {\n      \"album\": \"Abbey Road\",\n      \"cover\": \"/covers/abbey_road.jpg\",\n      \"tracks\": [\n        {\n          \"track\": \"Come Together\",\n          \"duration\": \"4:20\",\n          \"path\": \"The Beatles/Abbey Road/01 Come Together.flac\"\n        }\n      ],\n      \"is_compilation\": false\n    }\n  ]\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#album_details","title":"album_details()","text":"<p>Purpose: Get full track list for an album</p> <p>Route:</p> <pre><code>@editor.route(\"/album_details\")\n@require_auth\ndef album_details()\n</code></pre> <p>Query parameters:</p> <ul> <li><code>release_dir</code> (required) - Album directory path</li> </ul> <p>Request:</p> <pre><code>GET /editor/album_details?release_dir=/The%20Beatles/Abbey%20Road/\n</code></pre> <p>Implementation:</p> <pre><code>def album_details():\n    \"\"\"\n    Get album's tracks and metadata\n    \"\"\"\n    release_dir = request.args.get('release_dir')\n\n    if not release_dir:\n        return jsonify({'error': 'Missing release_dir parameter'}), 400\n\n    collection = current_app.music_collection\n    details = collection.get_album_details(release_dir)\n\n    return jsonify(details)\n</code></pre> <p>Response:</p> <pre><code>{\n  \"artist\": \"The Beatles\",\n  \"album\": \"Abbey Road\",\n  \"cover\": \"/covers/abbey_road.jpg\",\n  \"is_compilation\": false,\n  \"tracks\": [\n    {\n      \"track\": \"Come Together\",\n      \"duration\": \"4:20\",\n      \"path\": \"The Beatles/Abbey Road/01 Come Together.flac\",\n      \"filename\": \"01 Come Together.flac\"\n    }\n  ]\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#generate_composite","title":"generate_composite()","text":"<p>Purpose: Create composite cover from multiple track covers</p> <p>Route:</p> <pre><code>@editor.route(\"/generate_composite\", methods=[\"POST\"])\n@require_auth\ndef generate_composite()\n</code></pre> <p>Request payload:</p> <pre><code>{\n  \"covers\": [\n    \"/covers/album1.jpg\",\n    \"/covers/album2.jpg\",\n    \"/covers/album3.jpg\",\n    \"/covers/album4.jpg\"\n  ]\n}\n</code></pre> <p>Implementation:</p> <pre><code>def generate_composite():\n    \"\"\"\n    Generate grid composite from cover URLs\n    \"\"\"\n    data = request.get_json()\n    covers = data.get('covers', [])\n\n    if not covers:\n        return jsonify({'error': 'No covers provided'}), 400\n\n    try:\n        # Generate composite using CoverCompositor\n        compositor = CoverCompositor()\n        composite_data = compositor.generate_grid_composite(covers)\n\n        return jsonify({\n            'data_url': composite_data  # data:image/png;base64,...\n        })\n    except Exception as e:\n        logger.error(f\"Composite generation failed: {e}\")\n        return jsonify({'error': str(e)}), 500\n</code></pre> <p>Response:</p> <pre><code>{\n  \"data_url\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUg...\"\n}\n</code></pre> <p>Grid layout:</p> <ul> <li>1-4 covers: 2x2 grid</li> <li>Resizes images to fit</li> <li>Equal spacing</li> <li>Transparent background for odd counts</li> </ul>"},{"location":"development/mixtape-system/editor-api.html#progress_streamslug","title":"progress_stream(slug)","text":"<p>Purpose: Server-Sent Events for background caching progress</p> <p>Route:</p> <pre><code>@editor.route(\"/progress/&lt;slug&gt;\")\n@require_auth\ndef progress_stream(slug: str)\n</code></pre> <p>Request:</p> <pre><code>GET /editor/progress/my-mixtape\nAccept: text/event-stream\n</code></pre> <p>Implementation:</p> <pre><code>def progress_stream(slug):\n    \"\"\"\n    SSE stream of caching progress\n    \"\"\"\n    audio_cache = current_app.audio_cache\n    tracker = audio_cache.get_progress_tracker(slug)\n\n    def generate():\n        # Send connected event\n        yield f\"data: {json.dumps({'type': 'connected'})}\\n\\n\"\n\n        # Stream progress updates\n        for event in tracker.events():\n            yield f\"data: {json.dumps(event)}\\n\\n\"\n\n    return Response(\n        generate(),\n        mimetype='text/event-stream',\n        headers={\n            'Cache-Control': 'no-cache',\n            'X-Accel-Buffering': 'no'  # Disable nginx buffering\n        }\n    )\n</code></pre> <p>Event format:</p> <pre><code>{\n  \"type\": \"progress\",\n  \"step\": \"caching\",\n  \"status\": \"in_progress\",\n  \"message\": \"Caching 3/12 files...\",\n  \"current\": 3,\n  \"total\": 12\n}\n</code></pre> <p>Progress steps:</p> <ul> <li><code>initializing</code> - Setting up caching job</li> <li><code>analyzing</code> - Checking which files need transcoding</li> <li><code>caching</code> - Transcoding files</li> <li><code>completed</code> - All done</li> <li><code>error</code> - Failed</li> </ul> <p>Status values:</p> <ul> <li><code>pending</code> - Not started</li> <li><code>in_progress</code> - Currently running</li> <li><code>completed</code> - Successfully finished</li> <li><code>failed</code> - Error occurred</li> <li><code>skipped</code> - Not needed</li> </ul> <p>See: Frontend Modules for client implementation</p>"},{"location":"development/mixtape-system/editor-api.html#-helper-functions","title":"\ud83d\udd27 Helper Functions","text":""},{"location":"development/mixtape-system/editor-api.html#_process_cover_upload","title":"_process_cover_upload()","text":"<p>Purpose: Decode and save uploaded cover image</p> <pre><code>def _process_cover_upload(data_url: str, identifier: str) -&gt; str:\n    \"\"\"\n    Process base64 cover upload\n\n    Args:\n        data_url: data:image/jpeg;base64,...\n        identifier: slug or client_id\n\n    Returns:\n        Filename (e.g., \"my-mixtape.jpg\")\n    \"\"\"\n    # Decode base64\n    header, encoded = data_url.split(',', 1)\n    image_data = base64.b64decode(encoded)\n\n    # Open and resize\n    image = Image.open(BytesIO(image_data))\n\n    # Resize to max 1200px width (maintain aspect ratio)\n    max_width = 1200\n    if image.width &gt; max_width:\n        ratio = max_width / image.width\n        new_height = int(image.height * ratio)\n        image = image.resize((max_width, new_height), Image.LANCZOS)\n\n    # Save as JPEG\n    cover_dir = current_app.config['COVER_DIR']\n    filename = f\"{identifier}.jpg\"\n    filepath = Path(cover_dir) / filename\n\n    image.save(filepath, 'JPEG', quality=90)\n\n    return filename\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#_trigger_audio_caching_async","title":"_trigger_audio_caching_async()","text":"<p>Purpose: Launch background transcoding job</p> <pre><code>def _trigger_audio_caching_async(slug: str):\n    \"\"\"\n    Start background caching in daemon thread\n    \"\"\"\n    def cache_job():\n        audio_cache = current_app.audio_cache\n        mixtape_manager = current_app.mixtape_manager\n\n        mixtape = mixtape_manager.get(slug)\n        if not mixtape:\n            return\n\n        # Schedule caching for all tracks\n        schedule_mixtape_caching(\n            mixtape,\n            audio_cache,\n            logger\n        )\n\n    # Start daemon thread (dies with main process)\n    thread = threading.Thread(target=cache_job, daemon=True)\n    thread.start()\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#-api-contracts","title":"\ud83d\udcc4 API Contracts","text":""},{"location":"development/mixtape-system/editor-api.html#save-request-schema","title":"Save Request Schema","text":"<pre><code>interface SaveRequest {\n  title?: string;              // Default: \"Unnamed Mixtape\"\n  cover?: string | null;       // data:image/*;base64,... or null\n  liner_notes?: string;        // Markdown\n  tracks: Track[];\n  slug?: string | null;        // Present for updates\n  client_id: string;           // UUID from frontend\n}\n\ninterface Track {\n  artist: string;\n  album: string;\n  track: string;\n  duration: string;            // \"MM:SS\" or seconds\n  path: string;                // Relative to MUSIC_ROOT\n  filename: string;\n  cover?: string | null;       // Relative URL\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#save-response-schema","title":"Save Response Schema","text":"<pre><code>interface SaveResponse {\n  success: boolean;\n  slug: string;\n  title: string;\n  client_id: string;\n  url: string;                 // /editor/&lt;slug&gt;\n}\n\ninterface SaveError {\n  error: string;\n  details?: any;\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#search-response-schema","title":"Search Response Schema","text":"<pre><code>type SearchResult = ArtistResult | AlbumResult | TrackResult;\n\ninterface ArtistResult {\n  type: 'artist';\n  artist: string;\n  raw_artist: string;\n  reasons: Reason[];\n  num_albums: number;\n  albums: any[];               // Empty, loaded on demand\n  load_on_demand: boolean;\n  clickable: boolean;\n  click_query: string;\n}\n\ninterface AlbumResult {\n  type: 'album';\n  artist: string;\n  album: string;\n  raw_album: string;\n  cover: string;\n  is_compilation: boolean;\n  reasons: Reason[];\n  num_tracks: number;\n  tracks: any[];               // Empty, loaded on demand\n  load_on_demand: boolean;\n  click_query: string;\n}\n\ninterface TrackResult {\n  type: 'track';\n  artist: string;\n  album: string;\n  track: string;\n  duration: string;\n  path: string;\n  filename: string;\n  cover: string;\n  highlighted_track?: string;  // With &lt;mark&gt; tags\n}\n\ninterface Reason {\n  type: 'album' | 'track';\n  text: string;\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#progress-event-schema","title":"Progress Event Schema","text":"<pre><code>interface ProgressEvent {\n  type: 'connected' | 'progress';\n  step?: 'initializing' | 'analyzing' | 'caching' | 'completed' | 'error';\n  status?: 'pending' | 'in_progress' | 'completed' | 'failed' | 'skipped';\n  message?: string;\n  current?: number;\n  total?: number;\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#-error-handling","title":"\u26a0\ufe0f Error Handling","text":""},{"location":"development/mixtape-system/editor-api.html#status-codes","title":"Status Codes","text":"Code Situation Response 200 Success JSON response with data 400 Bad Request Missing required parameters, invalid JSON 404 Not Found Mixtape slug doesn't exist 500 Server Error Disk write failure, transcoding error"},{"location":"development/mixtape-system/editor-api.html#error-response-format","title":"Error Response Format","text":"<pre><code>{\n  \"error\": \"Error message\",\n  \"details\": \"Additional context (optional)\"\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#common-errors","title":"Common Errors","text":"<p>Missing parameters:</p> <pre><code>{\n  \"error\": \"Missing artist parameter\"\n}\n</code></pre> <p>Not found:</p> <pre><code>{\n  \"error\": \"Mixtape not found: invalid-slug\"\n}\n</code></pre> <p>Server error:</p> <pre><code>{\n  \"error\": \"Failed to save mixtape\",\n  \"details\": \"Disk full\"\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/mixtape-system/editor-api.html#manual-api-testing","title":"Manual API Testing","text":"<p>Create new mixtape:</p> <pre><code>curl -X POST http://localhost:5000/editor/save \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Cookie: session=...\" \\\n  -d '{\n    \"title\": \"Test Mix\",\n    \"tracks\": [],\n    \"client_id\": \"test-123\"\n  }'\n</code></pre> <p>Search library:</p> <pre><code>curl \"http://localhost:5000/editor/search?q=beatles\" \\\n  -H \"Cookie: session=...\"\n</code></pre> <p>Get artist details:</p> <pre><code>curl \"http://localhost:5000/editor/artist_details?artist=The%20Beatles\" \\\n  -H \"Cookie: session=...\"\n</code></pre> <p>Watch progress stream:</p> <pre><code>curl -N \"http://localhost:5000/editor/progress/my-mixtape\" \\\n  -H \"Cookie: session=...\" \\\n  -H \"Accept: text/event-stream\"\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#integration-testing","title":"Integration Testing","text":"<pre><code>def test_save_mixtape(client, auth):\n    # Authenticate\n    auth.login()\n\n    # Create mixtape\n    response = client.post('/editor/save', json={\n        'title': 'Test',\n        'tracks': [],\n        'client_id': 'test-123'\n    })\n\n    assert response.status_code == 200\n    data = response.get_json()\n    assert data['success'] is True\n    assert 'slug' in data\n</code></pre>"},{"location":"development/mixtape-system/editor-api.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Frontend Modules - JavaScript implementation</li> <li>Mixtape Manager - Data persistence</li> <li>Music Library - Search integration</li> <li>Audio Caching - Background transcoding</li> <li>Authentication - <code>@require_auth</code> decorator</li> </ul> <p>Implementation: <code>src/routes/editor.py</code></p>"},{"location":"development/mixtape-system/editor-frontend.html","title":"Editor (Frontend)","text":""},{"location":"development/mixtape-system/editor-frontend.html#editor-frontend-modules","title":"Editor Frontend Modules","text":"<p>This page documents the client-side JavaScript architecture for the Mixtape Editor. All modules use ES6 imports/exports and communicate via a shared playlist state and callback system.</p>"},{"location":"development/mixtape-system/editor-frontend.html#-overview","title":"\ud83c\udfaf Overview","text":"<p>The editor frontend consists of modular JavaScript files that handle:</p> <ul> <li>Search - Debounced library search with lazy-loaded details</li> <li>Playlist - Drag-and-drop track management and preview playback</li> <li>Notes - Markdown editor with track reference expansion</li> <li>UI - Cover upload, save button, unsaved changes detection</li> <li>Progress - Real-time SSE connection for background caching</li> </ul> <p>Location: <code>static/js/editor/</code> Architecture: ES6 modules with no circular dependencies State management: Single source of truth (playlist array)</p>"},{"location":"development/mixtape-system/editor-frontend.html#-module-structure","title":"\ud83d\udce6 Module Structure","text":"<pre><code>graph TD\n    Index[index.js&lt;br/&gt;Bootstrap]\n\n    Search[search.js&lt;br/&gt;Library Search]\n    Playlist[playlist.js&lt;br/&gt;Track Management]\n    Notes[editorNotes.js&lt;br/&gt;Markdown Editor]\n    UI[ui.js&lt;br/&gt;UI Controls]\n    Progress[progressModal.js&lt;br/&gt;SSE Progress]\n    Utils[utils.js&lt;br/&gt;Helpers]\n\n    Index --&gt; Search\n    Index --&gt; Playlist\n    Index --&gt; Notes\n    Index --&gt; UI\n\n    Search --&gt; Utils\n    Playlist --&gt; Utils\n    UI --&gt; Progress\n    UI --&gt; Playlist\n    Notes --&gt; Playlist\n\n    style Index fill:#4a6fa5,color:#fff\n    style Playlist fill:#c65d5d,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/mixtape-system/editor-frontend.html#-core-modules","title":"\ud83d\udcda Core Modules","text":""},{"location":"development/mixtape-system/editor-frontend.html#indexjs","title":"index.js","text":"<p>Purpose: Bootstrap the entire editor page</p> <p>Responsibilities:</p> <ul> <li>Load preloaded mixtape data from <code>window.PRELOADED_MIXTAPE</code></li> <li>Initialize all other modules</li> <li>Set up initial state (playlist, cover, title)</li> <li>Activate appropriate liner notes tab</li> </ul> <p>Key code:</p> <pre><code>document.addEventListener(\"DOMContentLoaded\", () =&gt; {\n    // 1. Load preloaded data\n    const preloadedMixtape = window.PRELOADED_MIXTAPE;\n\n    // 2. Set playlist\n    setPlaylist(preloadedMixtape.tracks || []);\n\n    // 3. Initialize modules\n    initSearch();\n    initPlaylist();\n    initEditorNotes(preloadedMixtape.liner_notes);\n    initUI();\n\n    // 4. Set initial UI state\n    if (preloadedMixtape.cover) {\n        document.getElementById('playlist-cover').src = preloadedMixtape.cover;\n    }\n\n    document.getElementById('playlist-title').value = preloadedMixtape.title;\n\n    // 5. Activate notes tab\n    activateInitialNotesTab(preloadedMixtape.liner_notes);\n});\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#searchjs","title":"search.js","text":"<p>Purpose: Library search with debounced input and lazy loading</p> <p>Exports:</p> <pre><code>export function initSearch()\n</code></pre> <p>Features:</p> <ul> <li>300ms debounce on search input</li> <li>Minimum 3 character query length</li> <li>Grouped results by type (artist, album, track)</li> <li>Lazy loading of artist/album details</li> <li>Add buttons for immediate track addition</li> <li>Preview play/pause for tracks</li> </ul> <p>Search flow:</p> <pre><code>sequenceDiagram\n    participant User\n    participant Input\n    participant Debounce\n    participant API\n    participant Results\n\n    User-&gt;&gt;Input: Types \"beatles\"\n    Input-&gt;&gt;Debounce: Queue search (300ms)\n    Debounce-&gt;&gt;API: GET /editor/search?q=beatles\n    API-&gt;&gt;Results: JSON results\n    Results-&gt;&gt;Results: Group by type\n    Results-&gt;&gt;Results: Render artists, albums, tracks\n\n    User-&gt;&gt;Results: Click artist\n    Results-&gt;&gt;API: GET /editor/artist_details\n    API-&gt;&gt;Results: Albums and tracks\n    Results-&gt;&gt;Results: Expand artist section</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>Key functions:</p> <pre><code>// Debounced search\nfunction performSearch(query) {\n    if (query.length &lt; 3) return;\n\n    fetch(`/editor/search?q=${encodeURIComponent(query)}`)\n        .then(r =&gt; r.json())\n        .then(results =&gt; renderResults(results));\n}\n\n// Render grouped results\nfunction renderResults(results) {\n    const artists = results.filter(r =&gt; r.type === 'artist');\n    const albums = results.filter(r =&gt; r.type === 'album');\n    const tracks = results.filter(r =&gt; r.type === 'track');\n\n    // Render each group\n}\n\n// Lazy load details\nfunction loadArtistDetails(artist) {\n    fetch(`/editor/artist_details?artist=${encodeURIComponent(artist)}`)\n        .then(r =&gt; r.json())\n        .then(details =&gt; expandArtist(details));\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#playlistjs","title":"playlist.js","text":"<p>Purpose: Central playlist state management</p> <p>Exports:</p> <pre><code>export const playlist = [];  // Shared state\nexport function initPlaylist()\nexport function addToPlaylist(track)\nexport function setPlaylist(tracks)\nexport function registerUnsavedChangesCallback(callback)\nexport function registerToastCallback(callback)\n</code></pre> <p>State management:</p> <p>The <code>playlist</code> array is the single source of truth:</p> <pre><code>// Shared state (exported)\nexport const playlist = [];\n\n// Add track\nexport function addToPlaylist(track) {\n    playlist.push(track);\n    renderPlaylist();\n    notifyUnsavedChanges();\n    showToast('Track added');\n}\n\n// Remove track\nfunction removeTrack(index) {\n    playlist.splice(index, 1);\n    renderPlaylist();\n    notifyUnsavedChanges();\n    showToast('Track removed');\n}\n\n// Reorder (via drag-and-drop)\nfunction reorderPlaylist(oldIndex, newIndex) {\n    const [track] = playlist.splice(oldIndex, 1);\n    playlist.splice(newIndex, 0, track);\n    renderPlaylist();\n    notifyUnsavedChanges();\n}\n</code></pre> <p>Drag-and-drop:</p> <p>Uses SortableJS for drag-and-drop:</p> <pre><code>import Sortable from 'sortablejs';\n\nfunction initPlaylist() {\n    const playlistEl = document.getElementById('playlist');\n\n    Sortable.create(playlistEl, {\n        animation: 150,\n        handle: '.drag-handle',\n        onEnd: (evt) =&gt; {\n            reorderPlaylist(evt.oldIndex, evt.newIndex);\n        }\n    });\n}\n</code></pre> <p>Preview playback:</p> <p>Tracks can be previewed before saving:</p> <pre><code>function playPreview(index) {\n    const track = playlist[index];\n    const audio = document.getElementById('preview-audio');\n\n    audio.src = `/play/${track.path}?quality=low`;\n    audio.play();\n\n    // Update UI\n    updatePreviewDisplay(track);\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#editornotesjs","title":"editorNotes.js","text":"<p>Purpose: Markdown editor with track reference expansion</p> <p>Exports:</p> <pre><code>export function initEditorNotes(initialNotes)\n</code></pre> <p>Features:</p> <ul> <li>EasyMDE markdown editor</li> <li>Custom preview rendering</li> <li>Track reference expansion (#1, #2-4)</li> <li>Write/Preview tabs</li> </ul> <p>Track reference syntax:</p> <pre><code>Check out track #1 - it's amazing!\n\nThe sequence from #3-5 is perfect.\n\nMy favorite is #12.\n</code></pre> <p>Expansion logic:</p> <pre><code>function expandTrackReferences(markdown) {\n    // #1 \u2192 [Track Title](artist)\n    markdown = markdown.replace(/#(\\d+)/g, (match, num) =&gt; {\n        const index = parseInt(num) - 1;\n        const track = playlist[index];\n        return track ? `[${track.track}](${track.artist})` : match;\n    });\n\n    // #3-5 \u2192 [Track 3](artist), [Track 4](artist), [Track 5](artist)\n    markdown = markdown.replace(/#(\\d+)-(\\d+)/g, (match, start, end) =&gt; {\n        const tracks = [];\n        for (let i = parseInt(start) - 1; i &lt; parseInt(end); i++) {\n            const track = playlist[i];\n            if (track) {\n                tracks.push(`[${track.track}](${track.artist})`);\n            }\n        }\n        return tracks.join(', ');\n    });\n\n    return markdown;\n}\n</code></pre> <p>EasyMDE setup:</p> <pre><code>function initEditorNotes(initialNotes) {\n    const easyMDE = new EasyMDE({\n        element: document.getElementById('liner-notes'),\n        initialValue: initialNotes || '',\n        spellChecker: false,\n        previewRender: (plainText) =&gt; {\n            // Expand track references\n            const expanded = expandTrackReferences(plainText);\n            // Render markdown\n            return marked.parse(expanded);\n        }\n    });\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#uijs","title":"ui.js","text":"<p>Purpose: UI interactions and state management</p> <p>Exports:</p> <pre><code>export function initUI()\nexport function activateInitialNotesTab(hasNotes)\n</code></pre> <p>Responsibilities:</p> <ul> <li>Cover upload and composite modal</li> <li>Save button with client-id handling</li> <li>Floating buttons (mobile)</li> <li>Unsaved changes detection</li> <li>Navigation guard (beforeunload)</li> <li>Bottom audio player</li> </ul> <p>Save flow:</p> <pre><code>flowchart TD\n    User[User clicks Save]\n    GetData[Collect form data]\n    GetClientID[Get/generate client_id]\n    BuildPayload[Build JSON payload]\n    Post[POST /editor/save]\n    Response{Success?}\n    UpdateURL[Update URL to /editor/slug]\n    ShowQR[Show QR share button]\n    Error[Show error message]\n\n    User --&gt; GetData\n    GetData --&gt; GetClientID\n    GetClientID --&gt; BuildPayload\n    BuildPayload --&gt; Post\n    Post --&gt; Response\n    Response --&gt;|Yes| UpdateURL\n    UpdateURL --&gt; ShowQR\n    Response --&gt;|No| Error</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>Unsaved changes:</p> <pre><code>let hasUnsavedChanges = false;\n\n// Register callback from playlist\nregisterUnsavedChangesCallback((changed) =&gt; {\n    hasUnsavedChanges = changed;\n    updateSaveButtonState();\n});\n\n// Warn before navigation\nwindow.addEventListener('beforeunload', (e) =&gt; {\n    if (hasUnsavedChanges) {\n        e.preventDefault();\n        e.returnValue = 'You have unsaved changes';\n    }\n});\n</code></pre> <p>Cover upload:</p> <pre><code>function handleCoverUpload(file) {\n    const reader = new FileReader();\n\n    reader.onload = (e) =&gt; {\n        const dataURL = e.target.result;\n\n        // Display preview\n        document.getElementById('playlist-cover').src = dataURL;\n\n        // Will be sent in save payload\n        coverData = dataURL;\n\n        notifyUnsavedChanges();\n    };\n\n    reader.readAsDataURL(file);\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#progressmodaljs","title":"progressModal.js","text":"<p>Purpose: Display background caching progress via SSE</p> <p>Exports:</p> <pre><code>export function showProgressModal(slug)\n</code></pre> <p>SSE connection:</p> <pre><code>export function showProgressModal(slug) {\n    // Create modal\n    const modal = createProgressModal();\n\n    // Connect to SSE endpoint\n    const eventSource = new EventSource(`/editor/progress/${slug}`);\n\n    eventSource.onmessage = (event) =&gt; {\n        const data = JSON.parse(event.data);\n\n        if (data.type === 'connected') {\n            updateStatus('Connected to server');\n        } else if (data.type === 'progress') {\n            updateProgress(data);\n        }\n    };\n\n    eventSource.onerror = () =&gt; {\n        updateStatus('Connection lost');\n        eventSource.close();\n    };\n}\n</code></pre> <p>Progress display:</p> <pre><code>function updateProgress(data) {\n    const { step, status, message, current, total } = data;\n\n    // Update progress bar\n    const percent = (current / total) * 100;\n    progressBar.style.width = `${percent}%`;\n\n    // Update message\n    messageEl.textContent = message;\n\n    // Add to log\n    logEl.innerHTML += `&lt;div&gt;${step}: ${message}&lt;/div&gt;`;\n\n    // Show close button when complete\n    if (step === 'completed') {\n        closeBtn.style.display = 'block';\n    }\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#utilsjs","title":"utils.js","text":"<p>Purpose: Shared helper functions</p> <p>Exports:</p> <pre><code>export function escapeHtml(text)\nexport function escapeRegExp(text)\nexport function highlightText(text, query)\nexport function showAlert(message)\nexport function showConfirm(message)\nexport function renderTrackReferences(markdown, playlist)\nexport function htmlSafeJson(obj)\n</code></pre> <p>Common helpers:</p> <pre><code>// HTML escaping\nexport function escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// Highlight search terms\nexport function highlightText(text, query) {\n    const escaped = escapeRegExp(query);\n    const regex = new RegExp(`(${escaped})`, 'gi');\n    return text.replace(regex, '&lt;mark&gt;$1&lt;/mark&gt;');\n}\n\n// Modal dialogs\nexport function showAlert(message) {\n    return new Promise((resolve) =&gt; {\n        // Bootstrap modal\n        const modal = new bootstrap.Modal(document.getElementById('appModal'));\n        // ... setup and show\n        modal.show();\n    });\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#-communication-patterns","title":"\ud83d\udd04 Communication Patterns","text":""},{"location":"development/mixtape-system/editor-frontend.html#callback-registration","title":"Callback Registration","text":"<p>Modules communicate via registered callbacks:</p> <pre><code>// playlist.js\nconst unsavedChangesCallbacks = [];\nconst toastCallbacks = [];\n\nexport function registerUnsavedChangesCallback(callback) {\n    unsavedChangesCallbacks.push(callback);\n}\n\nfunction notifyUnsavedChanges() {\n    unsavedChangesCallbacks.forEach(cb =&gt; cb(true));\n}\n\n// ui.js\nregisterUnsavedChangesCallback((changed) =&gt; {\n    hasUnsavedChanges = changed;\n    updateUI();\n});\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#event-dispatching","title":"Event Dispatching","text":"<p>Custom events for module communication:</p> <pre><code>// Dispatch event\ndocument.dispatchEvent(new CustomEvent('mixtape-saved', {\n    detail: { slug: 'my-mixtape' }\n}));\n\n// Listen for event\ndocument.addEventListener('mixtape-saved', (e) =&gt; {\n    console.log('Mixtape saved:', e.detail.slug);\n});\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#-ui-components","title":"\ud83c\udfa8 UI Components","text":""},{"location":"development/mixtape-system/editor-frontend.html#track-list-item","title":"Track List Item","text":"<pre><code>&lt;li class=\"track-item\" data-index=\"0\"&gt;\n    &lt;div class=\"drag-handle\"&gt;\u22ee\u22ee&lt;/div&gt;\n    &lt;img class=\"track-cover\" src=\"/covers/album.jpg\"&gt;\n    &lt;div class=\"track-info\"&gt;\n        &lt;div class=\"track-title\"&gt;Come Together&lt;/div&gt;\n        &lt;div class=\"track-artist\"&gt;The Beatles \u2022 Abbey Road&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div class=\"track-actions\"&gt;\n        &lt;button class=\"preview-btn\"&gt;\u25b6\ufe0f&lt;/button&gt;\n        &lt;button class=\"remove-btn\"&gt;\u2715&lt;/button&gt;\n    &lt;/div&gt;\n&lt;/li&gt;\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#search-result-track","title":"Search Result (Track)","text":"<pre><code>&lt;div class=\"search-result track\"&gt;\n    &lt;img class=\"result-cover\" src=\"/covers/album.jpg\"&gt;\n    &lt;div class=\"result-info\"&gt;\n        &lt;div class=\"result-title\"&gt;Come Together&lt;/div&gt;\n        &lt;div class=\"result-artist\"&gt;The Beatles \u2022 Abbey Road&lt;/div&gt;\n        &lt;div class=\"result-duration\"&gt;4:20&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;button class=\"add-btn\"&gt;Add&lt;/button&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#-state-management","title":"\ud83d\udcca State Management","text":""},{"location":"development/mixtape-system/editor-frontend.html#playlist-state","title":"Playlist State","text":"<pre><code>// playlist.js - SINGLE SOURCE OF TRUTH\nexport const playlist = [\n    {\n        artist: 'The Beatles',\n        album: 'Abbey Road',\n        track: 'Come Together',\n        duration: '4:20',\n        path: 'The Beatles/Abbey Road/01 Come Together.flac',\n        filename: '01 Come Together.flac',\n        cover: '/covers/abbey_road.jpg'\n    }\n];\n</code></pre> <p>All modules read from this shared array:</p> <ul> <li>search.js - Checks for duplicates before adding</li> <li>editorNotes.js - Expands track references</li> <li>ui.js - Builds save payload</li> <li>No module owns exclusive write access</li> </ul>"},{"location":"development/mixtape-system/editor-frontend.html#unsaved-changes","title":"Unsaved Changes","text":"<pre><code>// ui.js\nlet hasUnsavedChanges = false;\nlet savedPlaylistHash = '';\n\n// Calculate hash on save\nfunction onSaveSuccess() {\n    savedPlaylistHash = hashPlaylist(playlist);\n    hasUnsavedChanges = false;\n}\n\n// Check on changes\nfunction checkForChanges() {\n    const currentHash = hashPlaylist(playlist);\n    hasUnsavedChanges = (currentHash !== savedPlaylistHash);\n}\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/mixtape-system/editor-frontend.html#manual-testing","title":"Manual Testing","text":"<p>Search:</p> <ol> <li>Type in search box</li> <li>Verify debounce (300ms delay)</li> <li>Check grouped results</li> <li>Expand artist/album</li> <li>Add track to playlist</li> </ol> <p>Playlist:</p> <ol> <li>Drag track to reorder</li> <li>Click preview button</li> <li>Remove track</li> <li>Verify unsaved changes indicator</li> </ol> <p>Notes:</p> <ol> <li>Write markdown with track references</li> <li>Switch to Preview tab</li> <li>Verify references expand correctly</li> </ol> <p>Save:</p> <ol> <li>Make changes</li> <li>Click Save</li> <li>Verify progress modal</li> <li>Check URL updates</li> </ol>"},{"location":"development/mixtape-system/editor-frontend.html#console-debugging","title":"Console Debugging","text":"<pre><code>// Check playlist state\nconsole.log('Playlist:', playlist);\n\n// Monitor search\nwindow.searchDebug = true;\n\n// Track unsaved changes\nwindow.addEventListener('unsaved-changes', (e) =&gt; {\n    console.log('Unsaved:', e.detail);\n});\n</code></pre>"},{"location":"development/mixtape-system/editor-frontend.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Backend API - Flask routes and server logic</li> <li>Editor Overview - Complete system architecture</li> <li>Player Controls - Preview playback</li> <li>QR Share - Shared QR functionality</li> </ul> <p>Implementation: <code>static/js/editor/</code></p>"},{"location":"development/mixtape-system/manager-backend.html","title":"Mixtape Manager (Backend)","text":""},{"location":"development/mixtape-system/manager-backend.html#mixtape-manager","title":"Mixtape Manager","text":"<p>The <code>mixtape_manager</code> package defines the <code>MixtapeManager</code> class, This class acts as the core data access and management layer for mixtape-related features in the larger system, abstracting away file system operations and data consistency concerns.</p> <p>It is responsible for managing the storage, retrieval, and organization of mixtape data and their associated cover images on disk. It provides a high-level interface for saving, deleting, listing, and loading mixtape metadata, handling both JSON data and image files. The class ensures that mixtape data is consistently stored, cover images are processed from base64, and metadata is maintained for easy retrieval and display.</p>"},{"location":"development/mixtape-system/manager-backend.html#-architecture-overview","title":"\ud83c\udfdb\ufe0f Architecture Overview","text":"<pre><code>classDiagram\n    class MixtapeManager {\n        -Path path_mixtapes\n        -Path path_cover\n        -MusicCollection collection\n        -Logger _logger\n        +MixtapeManager(path_mixtapes, collection, logger=None)\n        +save(mixtape_data) str\n        +update(slug, updated_data) str\n        +get(slug) dict|None\n        +list_all() list[dict]\n        +delete(slug) None\n        -_sanitize_title(title) str\n        -_generate_unique_slug(base_slug, current_slug=None) str\n        -_save_with_slug(mixtape_data, title, slug) str\n        -_process_cover(cover_data, slug) str|None\n        -_cover_resize(image, new_width=1200) Image\n        -_find_by_client_id(client_id) dict|None\n        -_verify_against_collection(data) (dict, bool|None)\n        -_verify_mixtape_metadata(data) dict\n        -_normalize_timestamps(data) dict\n        -_convert_old_mixtape(data) dict\n    }</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <ul> <li>Storage root \u2013 <code>path_mixtapes</code> (provided by the caller).</li> <li>Cover sub\u2011directory \u2013 <code>path_cover = path_mixtapes / \"covers\"</code> (created automatically).</li> <li>Dependency \u2013 <code>Pillow</code> (<code>PIL.Image</code>) is required for cover\u2011image resizing.</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#-filesystem-layout--json-schema","title":"\ud83d\udcc2 Filesystem Layout &amp; JSON Schema","text":"<pre><code>/path/to/mixtapes/\n\u2502\n\u251c\u2500 my\u2011awesome\u2011mix.json          \u2190 Mixtape metadata (UTF\u20118 JSON)\n\u251c\u2500 another\u2011mix.json\n\u2502\n\u2514\u2500 covers/\n   \u251c\u2500 my\u2011awesome\u2011mix.jpg       \u2190 JPEG cover (max width 1200\u202fpx, quality\u202f100)\n   \u2514\u2500 another\u2011mix.jpg\n</code></pre>"},{"location":"development/mixtape-system/manager-backend.html#minimal-json-structure-all-fields-are-optional-unless-noted","title":"Minimal JSON structure (all fields are optional unless noted)","text":"Field Type Description <code>title</code> <code>str</code> Human-readable title (used for slug generation). <code>client_id</code> <code>str</code> Optional identifier that ties a mixtape to a specific client/device. <code>created_at</code> ISO-8601 <code>str</code> Set on first save; auto-filled if missing. <code>updated_at</code> ISO-8601 <code>str</code> Refreshed on every save or update. <code>cover</code> <code>str</code> Relative path to the JPEG cover (<code>covers/&lt;slug&gt;.jpg</code>) or a data-URI (<code>data:image/...</code>). <code>liner_notes</code> <code>str</code> Free-form notes; defaults to <code>\"\"</code>. <code>tracks</code> <code>list[dict]</code> Each entry must contain at least <code>path</code> (relative to the music root). Other keys (<code>artist</code>, <code>album</code>, <code>track</code>, <code>duration</code>, <code>filename</code>, <code>cover</code>) are filled/validated on read. <code>slug</code> <code>str</code> (added on output) Filesystem-safe identifier derived from <code>title</code>, added by the manager on output."},{"location":"development/mixtape-system/manager-backend.html#-behavior-details","title":"\u2699\ufe0f Behavior Details","text":""},{"location":"development/mixtape-system/manager-backend.html#slug-generation--uniqueness","title":"Slug generation &amp; uniqueness","text":"<ul> <li><code>_sanitize_title</code> removes any character that isn\u2019t alphanumeric, hyphen, underscore, or space, then strips surrounding whitespace.</li> <li><code>_generate_unique_slug</code> checks <code>path_mixtapes/*.json</code>. If a conflict exists it appends <code>-1</code>, <code>-2</code>, \u2026 until a free filename is found.</li> <li>When updating an existing mixtape you may pass <code>current_slug</code> so the method can reuse the same filename.</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#clientid-reuse-on-save","title":"Client\u2011ID reuse on save","text":"<ul> <li>If <code>mixtape_data</code> contains a <code>client_id</code>, <code>save()</code> first calls <code>_find_by_client_id</code>.</li> <li>The first mixtape that matches that <code>client_id</code> is updated in\u2011place (the same slug is kept).</li> <li>If no match is found a brand\u2011new mixtape is created.</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#timestamp-handling--legacy-migration","title":"Timestamp handling &amp; legacy migration","text":"<ul> <li>On first creation both <code>created_at</code> and <code>updated_at</code> are set to <code>datetime.now().isoformat()</code>.</li> <li>On every <code>update</code> only <code>updated_at</code> is refreshed.</li> <li><code>_normalize_timestamps</code> migrates a historic <code>saved_at</code> field to <code>updated_at</code> and guarantees that <code>created_at</code> and <code>updated_at</code> are present (fills missing values with <code>None</code> or the current time).</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#cover-image-handling","title":"Cover image handling","text":"Helper What it does Important details <code>_process_cover(cover_data: str, slug: str) \u2192 str \\| None</code> Decodes a <code>data:image/...;base64,\u2026</code> string, resizes the image, saves it as a JPEG under <code>covers/&lt;slug&gt;.jpg</code>, and returns the relative path (<code>covers/&lt;slug&gt;.jpg</code>). Returns <code>None</code> on any error; the calling code keeps the original <code>cover</code> value. <code>_cover_resize(image: Image, new_width: int = 1200) \u2192 Image</code> Resizes the Pillow <code>Image</code> to a maximum width of <code>new_width</code> while preserving aspect ratio. Uses <code>Image.LANCZOS</code> for high-quality down-sampling. <code>_save_with_slug</code> Handles cover persistence during save operations. If <code>cover</code> starts with <code>data:image</code>, delegates to <code>_process_cover</code>. If it is a plain string (already a relative path), it is stored unchanged. Errors during cover processing are logged but do not abort the mixtape save. <ul> <li>The JPEG is saved with quality\u202f=\u202f100 (lossless as far as JPEG permits).</li> <li>The filename on disk is exactly <code>covers/&lt;slug&gt;.jpg</code> \u2013 the method builds the relative path string for the JSON field.</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#verification-against-the-music-collection","title":"Verification against the music collection","text":"<ul> <li><code>get(slug)</code> loads the JSON, then calls <code>_verify_against_collection.</code></li> <li>For each track it fetches the canonical record from the injected MusicCollection (<code>self.collection.get_track(path=Path(track* [\"path\"]))</code>).</li> <li>Missing or stale fields (<code>artist</code>, <code>album</code>, <code>track</code>, <code>filename</code>, <code>duration</code>, <code>cover</code>) are refreshed.</li> <li>If the collection cannot be accessed (e.g., DB corruption) the method falls back to the raw JSON and logs a warning.</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#legacy-field-conversion","title":"Legacy field conversion","text":"<ul> <li>Older mixtapes stored a track title under the key <code>title</code>. <code>_convert_old_mixtape</code> renames that key to <code>track</code> so the rest of the code can rely on a uniform schema.</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#error-handling--robustness","title":"Error handling &amp; robustness","text":"<ul> <li>Corrupted JSON files \u2013 both <code>list_all</code> and <code>_find_by_client_id</code> catch json.JSONDecodeError / OSError, log a warning, and simply skip the offending file.</li> <li>Cover\u2011image failures \u2013 <code>_process_cover</code> catches any exception, logs an error, and returns None. The mixtape is still saved; the <code>cover</code> field will be omitted or retain its previous value.</li> <li>Missing slug on update \u2013 <code>update</code> raises <code>FileNotFoundError</code> if the target JSON does not exist, making the failure explicit to the caller.</li> </ul>"},{"location":"development/mixtape-system/manager-backend.html#-sequence-diagram","title":"\ud83d\udd01 Sequence Diagram","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant MixtapeManager\n    participant Disk\n    participant MusicCollection\n\n    Client-&gt;&gt;MixtapeManager: save(mixtape_data)\n    MixtapeManager-&gt;&gt;Disk: Write JSON file (&lt;slug&gt;.json)\n    alt cover is a data\u2011uri\n        MixtapeManager-&gt;&gt;Disk: Decode + resize + JPEG \u2192 covers/&lt;slug&gt;.jpg\n    end\n    MixtapeManager--&gt;&gt;Client: slug\n\n    Client-&gt;&gt;MixtapeManager: get(slug)\n    MixtapeManager-&gt;&gt;Disk: Read JSON file\n    MixtapeManager-&gt;&gt;MusicCollection: get_track for each track\n    MusicCollection--&gt;&gt;MixtapeManager: track metadata\n    MixtapeManager--&gt;&gt;Client: enriched mixtape dict\n\n    Client-&gt;&gt;MixtapeManager: list_all()\n    MixtapeManager-&gt;&gt;Disk: glob *.json, read each\n    MixtapeManager--&gt;&gt;Client: sorted list of mixtapes\n\n    Client-&gt;&gt;MixtapeManager: delete(slug)\n    MixtapeManager-&gt;&gt;Disk: Delete JSON + optional cover\n    MixtapeManager--&gt;&gt;Client: (none)</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/mixtape-system/manager-backend.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/mixtape-system/manager-backend.html#src.mixtape_manager.mixtape_manager.MixtapeManager","title":"<code>MixtapeManager(path_mixtapes, collection, logger=None)</code>","text":"<p>Manages mixtape files and their associated cover images.</p> <p>Provides functionality to create, update, delete, list, and retrieve mixtapes stored on disk.</p> <p>Initializes the MixtapeManager with paths for mixtapes and covers.</p> <p>Sets up the directory structure for storing mixtape JSON files and cover images.</p> <p>Parameters:</p> Name Type Description Default <code>path_mixtapes</code> <code>Path</code> <p>Path to the directory where mixtapes are stored.</p> required <code>collection</code> <code>MusicCollection</code> <p>Access to the collection's metadata</p> required <code>logger</code> <code>Logger</code> <p>Optional logger instance for logging actions.</p> <code>None</code> <p>Methods:</p> Name Description <code>save</code> <p>Creates a new mixtape or updates an existing one based on client identity.</p> <code>update</code> <p>Updates an existing mixtape's data while preserving key metadata.</p> <code>delete</code> <p>Deletes a mixtape and its associated cover image by slug.</p> <code>list_all</code> <p>Lists all mixtapes stored on disk.</p> <code>get</code> <p>Retrieves a single mixtape by its slug if it exists and is valid.</p> Source code in <code>src/mixtape_manager/mixtape_manager.py</code> <pre><code>def __init__(\n    self,\n    path_mixtapes: Path,\n    collection: MusicCollection,\n    logger: Logger | None = None,\n) -&gt; None:\n    \"\"\"Initializes the MixtapeManager with paths for mixtapes and covers.\n\n    Sets up the directory structure for storing mixtape JSON files and cover images.\n\n    Args:\n        path_mixtapes (Path): Path to the directory where mixtapes are stored.\n        collection (MusicCollection): Access to the collection's metadata\n        logger (Logger): Optional logger instance for logging actions.\n    \"\"\"\n    self._logger: Logger = logger or NullLogger()\n    self.path_mixtapes: Path = path_mixtapes\n    self.path_cover: Path = path_mixtapes / \"covers\"\n    self.path_mixtapes.mkdir(exist_ok=True)\n    self.path_cover.mkdir(exist_ok=True)\n    self.collection = collection\n</code></pre>"},{"location":"development/mixtape-system/manager-backend.html#src.mixtape_manager.mixtape_manager.MixtapeManager.save","title":"<code>save(mixtape_data)</code>","text":"<p>Creates a new mixtape or updates an existing one based on client identity.</p> <p>Reuses an existing mixtape when a matching client_id is found, otherwise generates a fresh mixtape entry.</p> <p>Parameters:</p> Name Type Description Default <code>mixtape_data</code> <code>dict</code> <p>Dictionary containing mixtape information, including optional client_id, title, and tracks.</p> required <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>The slug of the created or updated mixtape.</p> Source code in <code>src/mixtape_manager/mixtape_manager.py</code> <pre><code>def save(self, mixtape_data: dict) -&gt; str:\n    \"\"\"Creates a new mixtape or updates an existing one based on client identity.\n\n    Reuses an existing mixtape when a matching client_id is found, otherwise generates a fresh mixtape entry.\n\n    Args:\n        mixtape_data (dict): Dictionary containing mixtape information, including optional client_id, title, and tracks.\n\n    Returns:\n        str: The slug of the created or updated mixtape.\n    \"\"\"\n    client_id = mixtape_data.get(\"client_id\")\n    now = datetime.now().isoformat()\n\n    if existing := self._find_by_client_id(client_id):\n        slug = existing[\"slug\"]\n        self._logger.info(\n            f\"Found existing mixtape for client_id {client_id}, updating slug {slug}\"\n        )\n        return self.update(slug, mixtape_data)\n\n    # New creation\n    mixtape_data[\"schema_version\"] = self.CURRENT_SCHEMA_VERSION\n    title = mixtape_data.get(\"title\", \"Untitled Mixtape\")\n    base_slug = self._sanitize_title(title)\n    slug = self._generate_unique_slug(base_slug)\n\n    # Preserve the client_id in the saved data\n    if client_id:\n        mixtape_data[\"client_id\"] = client_id\n\n    # Set both timestamps on first save\n    mixtape_data[\"created_at\"] = now\n    mixtape_data[\"updated_at\"] = now\n\n    # Ensure gift flow fields have defaults if not provided\n    mixtape_data = self._ensure_gift_flow_fields(mixtape_data)\n\n    return self._save_with_slug(mixtape_data=mixtape_data, title=title, slug=slug)\n</code></pre>"},{"location":"development/mixtape-system/manager-backend.html#src.mixtape_manager.mixtape_manager.MixtapeManager.update","title":"<code>update(slug, updated_data)</code>","text":"<p>Updates an existing mixtape's data while preserving key metadata.</p> <p>Loads the stored mixtape, applies changes only to allowed fields, maintains backward compatibility, and refreshes the update timestamp before saving.</p> <p>Parameters:</p> Name Type Description Default <code>slug</code> <code>str</code> <p>The slug of the mixtape to update.</p> required <code>updated_data</code> <code>dict</code> <p>A dictionary of fields to update on the mixtape.</p> required <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>The slug of the updated mixtape.</p> <p>Raises:</p> Type Description <code>FileNotFoundError</code> <p>If a mixtape with the given slug does not exist.</p> Source code in <code>src/mixtape_manager/mixtape_manager.py</code> <pre><code>def update(self, slug: str, updated_data: dict) -&gt; str:\n    \"\"\"Updates an existing mixtape's data while preserving key metadata.\n\n    Loads the stored mixtape, applies changes only to allowed fields, maintains backward compatibility, and\n    refreshes the update timestamp before saving.\n\n    Args:\n        slug (str): The slug of the mixtape to update.\n        updated_data (dict): A dictionary of fields to update on the mixtape.\n\n    Returns:\n        str: The slug of the updated mixtape.\n\n    Raises:\n        FileNotFoundError: If a mixtape with the given slug does not exist.\n    \"\"\"\n    existing_data = self._load_existing_mixtape(slug)\n    updated_data = self._preserve_client_id(existing_data, updated_data)\n    existing_data = self._apply_allowed_updates(existing_data, updated_data)\n    existing_data = self._ensure_required_fields(existing_data)\n    existing_data[\"updated_at\"] = datetime.now().isoformat()\n\n    return self._save_with_slug(\n        mixtape_data=existing_data, title=existing_data[\"title\"], slug=slug\n    )\n</code></pre>"},{"location":"development/mixtape-system/manager-backend.html#src.mixtape_manager.mixtape_manager.MixtapeManager.delete","title":"<code>delete(slug)</code>","text":"<p>Deletes a mixtape and its associated cover image by slug.</p> <p>Removes the mixtape JSON file and cover image from disk if they exist.</p> <p>Parameters:</p> Name Type Description Default <code>slug</code> <code>str</code> <p>The slug of the mixtape to delete.</p> required Source code in <code>src/mixtape_manager/mixtape_manager.py</code> <pre><code>def delete(self, slug: str) -&gt; None:\n    \"\"\"\n    Deletes a mixtape and its associated cover image by slug.\n\n    Removes the mixtape JSON file and cover image from disk if they exist.\n\n    Args:\n        slug (str): The slug of the mixtape to delete.\n    \"\"\"\n    json_path = self.path_mixtapes / f\"{slug}.json\"\n    json_path.unlink(missing_ok=True)\n\n    cover_path = self.path_cover / f\"{slug}.jpg\"\n    cover_path.unlink(missing_ok=True)\n</code></pre>"},{"location":"development/mixtape-system/manager-backend.html#src.mixtape_manager.mixtape_manager.MixtapeManager.list_all","title":"<code>list_all()</code>","text":"<p>Lists all mixtapes stored on disk.</p> <p>Returns a list of dictionaries containing mixtape data, sorted by update or save time.</p> <p>Returns:</p> Type Description <code>list[dict]</code> <p>list[dict]: List of all mixtape data dictionaries.</p> Source code in <code>src/mixtape_manager/mixtape_manager.py</code> <pre><code>def list_all(self) -&gt; list[dict]:\n    \"\"\"\n    Lists all mixtapes stored on disk.\n\n    Returns a list of dictionaries containing mixtape data, sorted by update or save time.\n\n    Returns:\n        list[dict]: List of all mixtape data dictionaries.\n    \"\"\"\n    mixtapes = []\n    for file in self.path_mixtapes.glob(\"*.json\"):\n        try:\n            with open(file, \"r\", encoding=\"utf-8\") as f:\n                data = json.load(f)\n        except (json.JSONDecodeError, OSError) as e:\n            self._logger.warning(f\"Skipping corrupted mixtape file {file}: {e}\")\n            continue\n\n        slug = file.stem\n        data[\"slug\"] = slug\n        if \"liner_notes\" not in data:\n            data[\"liner_notes\"] = \"\"\n        if \"client_id\" not in data:\n            data[\"client_id\"] = None\n\n        # Normalize timestamps (will also handle legacy saved_at)\n        data = self._normalize_timestamps(data)\n\n        mixtapes.append(data)\n\n    # Sort by most recently updated first\n    mixtapes.sort(\n        key=lambda x: x.get(\"updated_at\") or x.get(\"created_at\") or \"\", reverse=True\n    )\n    return mixtapes\n</code></pre>"},{"location":"development/mixtape-system/manager-backend.html#src.mixtape_manager.mixtape_manager.MixtapeManager.get","title":"<code>get(slug)</code>","text":"<p>Retrieves a single mixtape by its slug if it exists and is valid.</p> <p>Loads the mixtape from disk, validates its tracks against the collection, and normalizes optional fields.</p> <p>Parameters:</p> Name Type Description Default <code>slug</code> <code>str</code> <p>The slug identifier of the mixtape to retrieve.</p> required <p>Returns:</p> Type Description <code>dict | None</code> <p>dict | None: The validated and normalized mixtape data, or None if the mixtape is missing or invalid.</p> Source code in <code>src/mixtape_manager/mixtape_manager.py</code> <pre><code>def get(self, slug: str) -&gt; dict | None:\n    \"\"\"Retrieves a single mixtape by its slug if it exists and is valid.\n\n    Loads the mixtape from disk, validates its tracks against the collection, and normalizes optional fields.\n\n    Args:\n        slug (str): The slug identifier of the mixtape to retrieve.\n\n    Returns:\n        dict | None: The validated and normalized mixtape data, or None if the mixtape is missing or invalid.\n    \"\"\"\n    path = self.path_mixtapes / f\"{slug}.json\"\n    if not path.exists():\n        return None\n\n    try:\n        with open(path, \"r\", encoding=\"utf-8\") as f:\n            data = json.load(f)\n    except (json.JSONDecodeError, OSError) as e:\n        self._logger.error(f\"Failed to read mixtape {slug}: {e}\")\n        return None\n\n    try:\n        data_verified, has_changed = self._verify_against_collection(data=data)\n        if data_verified:\n            data_verified = self._verify_mixtape_metadata(data=data_verified)\n            data_verified[\"slug\"] = slug\n            return data_verified\n        else:\n            return None\n    except Exception as e:\n        # Database unavailable (corruption, indexing, etc.)\n        # Just use the mixtape data as-is from the JSON file\n        self._logger.warning(\n            f\"Could not verify mixtape {slug} against collection: {e}. \"\n            f\"Using cached data from JSON.\"\n        )\n\n    # Always normalize metadata\n    data = self._verify_mixtape_metadata(data=data)\n    data[\"slug\"] = slug\n    return data\n</code></pre>"},{"location":"development/mixtape-system/overview.html","title":"Overview","text":""},{"location":"development/mixtape-system/overview.html#mixtape-editor-overview","title":"Mixtape Editor Overview","text":"<p>The Mixtape Editor is a full-featured web interface for creating and editing mixtapes. It combines a Flask backend for data persistence with a sophisticated JavaScript frontend for search, playlist management, and rich markdown editing.</p>"},{"location":"development/mixtape-system/overview.html#-purpose","title":"\ud83c\udfaf Purpose","text":"<p>The editor provides authenticated users with tools to:</p> <ul> <li>Search and discover tracks from the music library</li> <li>Build playlists with drag-and-drop track management</li> <li>Write liner notes using markdown with track references</li> <li>Design covers by uploading images or generating composites</li> <li>Share mixtapes via QR codes</li> <li>Track progress of background audio caching</li> </ul> <p>All functionality is protected by authentication and persists mixtapes as JSON files on disk.</p>"},{"location":"development/mixtape-system/overview.html#-features","title":"\u2728 Features","text":"Feature Description Library Search Full-text search with highlighting powered by SQLite FTS5 Playlist Management Drag-and-drop reordering, preview playback, track removal Cover Handling Upload custom images or generate grid composites from track art Liner Notes Markdown editor (EasyMDE) with track reference syntax (#1, #2-4) Save/Update Creates new mixtapes or updates existing ones with timestamps QR Code Sharing Generate simple QR codes or enhanced versions with cover art Background Caching Automatic audio transcoding with real-time progress updates Unsaved Changes Detection Warns before leaving with unsaved work"},{"location":"development/mixtape-system/overview.html#-architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"development/mixtape-system/overview.html#system-overview","title":"System Overview","text":"<pre><code>graph TB\n    User[Authenticated User]\n\n    Frontend[Frontend JavaScript]\n    Backend[Flask Backend]\n\n    Search[search.js]\n    Playlist[playlist.js]\n    Notes[editorNotes.js]\n    UI[ui.js]\n\n    Routes[Flask Routes]\n    Collection[MusicCollectionUI]\n    Manager[MixtapeManager]\n    Cache[AudioCache]\n\n    User --&gt; Frontend\n    Frontend --&gt; Backend\n\n    Frontend --&gt; Search\n    Frontend --&gt; Playlist\n    Frontend --&gt; Notes\n    Frontend --&gt; UI\n\n    Backend --&gt; Routes\n    Routes --&gt; Collection\n    Routes --&gt; Manager\n    Routes --&gt; Cache\n\n    style Frontend fill:#4a6fa5,color:#fff\n    style Backend fill:#c65d5d,color:#fff</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/mixtape-system/overview.html#component-split","title":"Component Split","text":"<p>Backend (Flask):</p> <ul> <li>Route handlers for all editor operations</li> <li>Integration with music library search</li> <li>Mixtape data persistence (JSON files)</li> <li>Cover image processing and storage</li> <li>Background audio caching orchestration</li> </ul> <p>Frontend (JavaScript):</p> <ul> <li>ES6 modules with clear responsibilities</li> <li>Real-time search with debouncing</li> <li>Drag-and-drop playlist management</li> <li>Markdown editor with custom preview</li> <li>Progress modal for long operations</li> </ul>"},{"location":"development/mixtape-system/overview.html#-quick-reference","title":"\ud83d\uddfa\ufe0f Quick Reference","text":""},{"location":"development/mixtape-system/overview.html#flask-routes","title":"Flask Routes","text":"HTTP URL Pattern Handler Purpose <code>GET</code> <code>/editor/</code> <code>new_mixtape()</code> Blank editor for new mixtape <code>GET</code> <code>/editor/&lt;slug&gt;</code> <code>edit_mixtape(slug)</code> Load existing mixtape for editing <code>GET</code> <code>/editor/search?q=</code> <code>search()</code> Search library (50 results max) <code>GET</code> <code>/editor/artist_details?artist=</code> <code>artist_details()</code> Get artist's albums <code>GET</code> <code>/editor/album_details?release_dir=</code> <code>album_details()</code> Get album's tracks <code>POST</code> <code>/editor/save</code> <code>save_mixtape()</code> Create or update mixtape <code>GET</code> <code>/editor/progress/&lt;slug&gt;</code> <code>progress_stream(slug)</code> SSE progress updates <code>POST</code> <code>/editor/generate_composite</code> <code>generate_composite()</code> Create cover from track art <p>See: Backend API Documentation</p>"},{"location":"development/mixtape-system/overview.html#javascript-modules","title":"JavaScript Modules","text":"Module Responsibility <code>index.js</code> Page initialization and bootstrapping <code>search.js</code> Debounced search, results rendering <code>playlist.js</code> Playlist state, drag-and-drop, track management <code>editorNotes.js</code> EasyMDE integration, track references <code>ui.js</code> Cover upload, save button, unsaved changes <code>progressModal.js</code> SSE connection, progress display <code>utils.js</code> Helper functions, HTML escaping, dialogs <p>See: Frontend Modules Documentation</p>"},{"location":"development/mixtape-system/overview.html#-data-flow","title":"\ud83d\udd04 Data Flow","text":""},{"location":"development/mixtape-system/overview.html#creating-a-new-mixtape","title":"Creating a New Mixtape","text":"<pre><code>sequenceDiagram\n    participant User\n    participant Frontend\n    participant Backend\n    participant MixtapeManager\n\n    User-&gt;&gt;Frontend: Visit /editor/\n    Frontend-&gt;&gt;Backend: GET /editor/\n    Backend-&gt;&gt;Frontend: Render empty form\n\n    User-&gt;&gt;Frontend: Search, add tracks\n    User-&gt;&gt;Frontend: Write notes, upload cover\n    User-&gt;&gt;Frontend: Click Save\n\n    Frontend-&gt;&gt;Backend: POST /editor/save\n    Backend-&gt;&gt;Backend: Generate UUID slug\n    Backend-&gt;&gt;Backend: Enrich track metadata\n    Backend-&gt;&gt;MixtapeManager: save(mixtape_data)\n    MixtapeManager-&gt;&gt;Backend: Success\n    Backend-&gt;&gt;Backend: Trigger background caching\n    Backend-&gt;&gt;Frontend: {success: true, slug, url}\n\n    Frontend-&gt;&gt;Frontend: Update URL to /editor/&lt;slug&gt;\n    Frontend-&gt;&gt;Frontend: Show QR share button</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/mixtape-system/overview.html#editing-an-existing-mixtape","title":"Editing an Existing Mixtape","text":"<pre><code>sequenceDiagram\n    participant User\n    participant Frontend\n    participant Backend\n    participant MixtapeManager\n\n    User-&gt;&gt;Frontend: Visit /editor/&lt;slug&gt;\n    Frontend-&gt;&gt;Backend: GET /editor/&lt;slug&gt;\n    Backend-&gt;&gt;MixtapeManager: get(slug)\n    MixtapeManager-&gt;&gt;Backend: Mixtape data\n    Backend-&gt;&gt;Frontend: Render pre-filled form\n\n    User-&gt;&gt;Frontend: Modify tracks/notes\n    User-&gt;&gt;Frontend: Click Save\n\n    Frontend-&gt;&gt;Backend: POST /editor/save (with slug)\n    Backend-&gt;&gt;MixtapeManager: update(slug, data)\n    MixtapeManager-&gt;&gt;Backend: Success\n    Backend-&gt;&gt;Frontend: {success: true, slug, url}</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/mixtape-system/overview.html#-ui-layout","title":"\ud83c\udfa8 UI Layout","text":""},{"location":"development/mixtape-system/overview.html#main-components","title":"Main Components","text":"<pre><code>flowchart TB\n    App[\"Mixtape Editor Screen\"]\n\n    Header[\"Header\\nCreate Mixtape / Edit: Title\"]\n    Search[\"Search Bar\\n\ud83d\udd0d Search library\u2026 | \u2139\ufe0f | \u27f3\"]\n\n    Content[\"Main Content\"]\n\n    Library[\"Library Results\\n\u2022 Artists\\n\u2022 Albums\\n\u2022 Tracks\\n[Add]\\n[Load more\u2026]\"]\n    Mixtape[\"My Mixtape\\n[Cover]\\nTitle\\nTabs: Tracks | Notes\\n1. Track one\\n2. Track two\\n3. Track three\\n[Clear Playlist]\"]\n\n    Player[\"Bottom Player\\n\u25b6\ufe0f Now Playing: Track \u2022 Artist\"]\n    Floating[\"Floating Actions (Mobile)\\n\ud83d\udcbe Save | \ud83c\udfb5 Tracks\"]\n\n    App --&gt; Header --&gt; Search --&gt; Content --&gt; Player\n    Content --&gt; Library\n    Content --&gt; Mixtape\n    App -.-&gt; Floating</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/mixtape-system/overview.html#modals","title":"Modals","text":"<ul> <li>Cover Options - Upload image or generate composite</li> <li>Progress Modal - Background caching progress with log</li> <li>QR Share Modal - Display and download QR codes</li> <li>Generic Alerts/Confirms - User confirmations</li> </ul>"},{"location":"development/mixtape-system/overview.html#-quick-start-guide","title":"\ud83d\ude80 Quick Start Guide","text":""},{"location":"development/mixtape-system/overview.html#for-backend-developers","title":"For Backend Developers","text":"<p>Understanding the API:</p> <ol> <li>Read Backend API Documentation</li> <li>Focus on route handlers section</li> <li>Review API contracts (JSON schemas)</li> <li>Check authentication requirements</li> </ol> <p>Common tasks:</p> <ul> <li>Adding new search filters \u2192 Modify <code>search()</code> handler</li> <li>Changing save logic \u2192 Update <code>save_mixtape()</code></li> <li>New metadata fields \u2192 Update JSON schema</li> </ul>"},{"location":"development/mixtape-system/overview.html#for-frontend-developers","title":"For Frontend Developers","text":"<p>Understanding the modules:</p> <ol> <li>Read Frontend Modules Documentation</li> <li>Understand module relationships</li> <li>Review state management (playlist array)</li> <li>Check event flow diagrams</li> </ol> <p>Common tasks:</p> <ul> <li>Adding UI feature \u2192 Extend <code>ui.js</code></li> <li>Changing search behavior \u2192 Modify <code>search.js</code></li> <li>Playlist customization \u2192 Update <code>playlist.js</code></li> </ul>"},{"location":"development/mixtape-system/overview.html#for-both","title":"For Both","text":"<p>Full feature development:</p> <ol> <li>Design data flow (frontend \u2192 backend \u2192 storage)</li> <li>Update API contract backend</li> <li>Implement backend route handler</li> <li>Create/modify frontend module</li> <li>Update both documentation pages</li> </ol>"},{"location":"development/mixtape-system/overview.html#-common-development-tasks","title":"\ud83d\udd27 Common Development Tasks","text":""},{"location":"development/mixtape-system/overview.html#adding-a-new-metadata-field","title":"Adding a New Metadata Field","text":"<p>Backend:</p> <pre><code># In save_mixtape()\nmixtape_data = {\n    'title': data.get('title'),\n    'new_field': data.get('new_field'),  # Add here\n    # ... rest\n}\n</code></pre> <p>Frontend:</p> <pre><code>// In ui.js saveMixtape()\nconst payload = {\n    title: titleInput.value,\n    new_field: newFieldInput.value,  // Add here\n    // ... rest\n};\n</code></pre>"},{"location":"development/mixtape-system/overview.html#extending-search-results","title":"Extending Search Results","text":"<p>Backend:</p> <pre><code># In search()\nresults = collection.search_highlighting(query, limit=50)\n# Process results to add new fields\nreturn jsonify(results)\n</code></pre> <p>Frontend:</p> <pre><code>// In search.js renderResults()\nresults.forEach(result =&gt; {\n    // Add new rendering logic\n});\n</code></pre>"},{"location":"development/mixtape-system/overview.html#adding-progress-tracking","title":"Adding Progress Tracking","text":"<p>Backend:</p> <pre><code># In any long operation\ntracker = audio_cache.get_progress_tracker(slug)\ntracker.update(step='processing', current=5, total=10)\n</code></pre> <p>Frontend:</p> <pre><code>// Progress modal automatically picks up SSE events\nshowProgressModal(slug);\n</code></pre>"},{"location":"development/mixtape-system/overview.html#-detailed-documentation","title":"\ud83d\udcda Detailed Documentation","text":""},{"location":"development/mixtape-system/overview.html#backend-development","title":"Backend Development","text":"<p>Backend API Documentation</p> <p>Complete guide to Flask routes, server-side logic, and API contracts:</p> <ul> <li>Route handlers and authentication</li> <li>Data flow for create/edit/save operations</li> <li>Helper functions and utilities</li> <li>JSON schemas for requests/responses</li> <li>Progress streaming (SSE)</li> <li>Cover generation</li> <li>Error handling</li> <li>Testing</li> </ul>"},{"location":"development/mixtape-system/overview.html#frontend-development","title":"Frontend Development","text":"<p>Frontend Modules Documentation</p> <p>Complete guide to JavaScript architecture and modules:</p> <ul> <li>ES6 module structure</li> <li>Module responsibilities and relationships</li> <li>Search implementation</li> <li>Playlist management and drag-and-drop</li> <li>Markdown editor integration</li> <li>UI interactions and state management</li> <li>Progress modal and SSE connection</li> <li>Helper utilities</li> </ul>"},{"location":"development/mixtape-system/overview.html#-testing","title":"\ud83e\uddea Testing","text":""},{"location":"development/mixtape-system/overview.html#backend-testing","title":"Backend Testing","text":"<pre><code># Test new mixtape creation\ncurl http://localhost:5000/editor/\n\n# Test search\ncurl \"http://localhost:5000/editor/search?q=beatles\"\n\n# Test save (requires auth cookie)\ncurl -X POST http://localhost:5000/editor/save \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"title\":\"Test\",\"tracks\":[]}'\n</code></pre>"},{"location":"development/mixtape-system/overview.html#frontend-testing","title":"Frontend Testing","text":"<p>Manual testing:</p> <ol> <li>Open <code>/editor/</code> in browser</li> <li>Search for tracks</li> <li>Add to playlist</li> <li>Drag to reorder</li> <li>Save mixtape</li> <li>Verify progress modal appears</li> </ol> <p>Console debugging:</p> <pre><code>// Check playlist state\nconsole.log(playlist);\n\n// Monitor search\nwindow.addEventListener('search:results', (e) =&gt; {\n    console.log('Search results:', e.detail);\n});\n</code></pre>"},{"location":"development/mixtape-system/overview.html#-related-documentation","title":"\ud83d\udd17 Related Documentation","text":""},{"location":"development/mixtape-system/overview.html#core-systems","title":"Core Systems","text":"<ul> <li>Music Library - Search and metadata extraction</li> <li>Mixtape Manager - JSON file persistence</li> <li>Audio Caching - Background transcoding</li> <li>Cover Art System - Image processing</li> </ul>"},{"location":"development/mixtape-system/overview.html#routes","title":"Routes","text":"<ul> <li>Browser Routes - Public mixtape browsing</li> <li>Playback Routes - Audio streaming</li> <li>QR Code Routes - QR generation</li> </ul>"},{"location":"development/mixtape-system/overview.html#frontend","title":"Frontend","text":"<ul> <li>Player Controls - Preview playback</li> <li>PWA Features - Progressive web app</li> </ul>"},{"location":"development/mixtape-system/overview.html#-learning-path","title":"\ud83c\udf93 Learning Path","text":"<p>New to the editor?</p> <ol> <li>Start here - This overview (you are here)</li> <li>Backend focus - Read Backend API</li> <li>Frontend focus - Read Frontend Modules</li> <li>Hands-on - Create a test mixtape</li> </ol> <p>Adding a feature?</p> <ol> <li>Design - Plan data flow (frontend \u2192 backend \u2192 storage)</li> <li>Backend - Implement route handler (see Backend API)</li> <li>Frontend - Update or create module (see Frontend Modules)</li> <li>Test - Manual testing + console debugging</li> <li>Document - Update both documentation pages</li> </ol> <p>The editor is the creative heart of Mixtape Society. For implementation details, see the Backend API and Frontend Modules documentation linked above.</p>"},{"location":"development/mixtape-system/qr-generation.html","title":"QR Code Generation","text":""},{"location":"development/mixtape-system/qr-generation.html#qr-code-generation","title":"QR Code Generation","text":""},{"location":"development/mixtape-system/qr-generation.html#-what-the-package-does","title":"\ud83c\udfaf What the Package Does","text":"<p>The <code>qr_generator</code> package creates PNG QR\u2011code images that encode a mixtape\u2019s public URL. Two flavours are offered:</p> Function Output Extra visual elements <code>generate_mixtape_qr</code> Plain QR code (square) Optional centred logo (SVG/PNG) <code>generate_mixtape_qr_with_cover</code> Composite image (cover \u2192 title banner \u2192 QR) Optional cover art, title banner, centred logo <p>Both functions return raw <code>bytes</code> (PNG data) ready to be sent as a Flask <code>Response</code> or saved to disk.</p>"},{"location":"development/mixtape-system/qr-generation.html#-installation--dependencies","title":"\ud83d\udd27 Installation &amp; Dependencies","text":"Setting Where it lives Default Remarks <code>qrcode</code> (Python library) <code>project.toml</code> / <code>uv.lock</code> <code>&gt;=7.4</code> Required for both endpoints. <code>Pillow</code> (image handling) <code>project.toml</code> <code>&gt;=10.0</code> Needed for compositing the logo/cover. Static logo files <code>static/images/logo.svg</code> or <code>static/logo.png</code> \u2014 The blueprint prefers SVG; falls back to PNG. Cover directory <code>app.config[\"COVER_DIR\"]</code> (set in config.py) <code>collection-data/mixtapes/covers</code> Used only by the download endpoint. Cache-Control Hard-coded in the view (<code>public, max-age=3600</code>). \u2014 Adjust in the source if you need a different TTL."},{"location":"development/mixtape-system/qr-generation.html#-error-handling","title":"\u26a0\ufe0f Error Handling","text":"Situation Raised Exception Message (visible to caller) <code>qrcode</code> library missing <code>ImportError</code> (raised at the top of each public function) <code>\"qrcode library not installed. Install with: uv add qrcode pillow\"</code> Logo or cover path does not exist Silently ignored \u2014 the function falls back to a plain QR or a QR without cover. Errors are printed to stdout (<code>print</code>) but not propagated. \u2014 <code>Pillow</code> fails to open an image (corrupt file) Caught inside the helper; continues processing Prints <code>\"Failed to load cover: \u2026\"</code> or <code>\"Failed to add logo to QR code: \u2026\"</code> and continues with the rest of the image. Invalid <code>size</code> / <code>qr_size</code> (negative, zero) Not explicitly validated \u2014 <code>Pillow</code> raises a <code>ValueError</code> during resize Exception propagates to the caller (treated as a 500 error in the Flask view). <p>Best practice \u2013 Validate user\u2011supplied sizes before calling the functions, or wrap the call in a <code>try/except</code> block and return a friendly error page.</p>"},{"location":"development/mixtape-system/qr-generation.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/mixtape-system/qr-generation.html#src.qr_generator.qr_generator","title":"<code>qr_generator</code>","text":"<p>Enhanced QR Code generation with mixtape cover art and title.</p> <p>Functions:</p> Name Description <code>generate_mixtape_qr_with_cover</code> <p>Generate a branded QR code with mixtape cover art and title.</p> <code>generate_mixtape_qr</code> <p>Generate a simple QR code (backward compatibility).</p>"},{"location":"development/mixtape-system/qr-generation.html#src.qr_generator.qr_generator.generate_mixtape_qr_with_cover","title":"<code>generate_mixtape_qr_with_cover(url, title, cover_path=None, logo_path=None, qr_size=400, include_title=True)</code>","text":"<p>Generate a branded QR code with mixtape cover art and title.</p> <p>Creates a composite image with: - Mixtape cover art at the top - Title banner below cover - QR code at the bottom - Optional logo in QR center</p> <p>Parameters:</p> Name Type Description Default <code>url</code> <code>str</code> <p>The full URL to encode in the QR code</p> required <code>title</code> <code>str</code> <p>The mixtape title to display</p> required <code>cover_path</code> <code>Path | None</code> <p>Path to mixtape cover image</p> <code>None</code> <code>logo_path</code> <code>Path | None</code> <p>Optional path to logo for QR center</p> <code>None</code> <code>qr_size</code> <code>int</code> <p>Size of the QR code portion (default 400)</p> <code>400</code> <code>include_title</code> <code>bool</code> <p>Whether to include title banner (default True)</p> <code>True</code> <p>Returns:</p> Name Type Description <code>bytes</code> <code>bytes</code> <p>PNG image data of the complete branded QR code</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If qrcode library is not installed</p> Source code in <code>src/qr_generator/qr_generator.py</code> <pre><code>def generate_mixtape_qr_with_cover(\n    url: str,\n    title: str,\n    cover_path: Path | None = None,\n    logo_path: Path | None = None,\n    qr_size: int = 400,\n    include_title: bool = True,\n) -&gt; bytes:\n    \"\"\"\n    Generate a branded QR code with mixtape cover art and title.\n\n    Creates a composite image with:\n    - Mixtape cover art at the top\n    - Title banner below cover\n    - QR code at the bottom\n    - Optional logo in QR center\n\n    Args:\n        url: The full URL to encode in the QR code\n        title: The mixtape title to display\n        cover_path: Path to mixtape cover image\n        logo_path: Optional path to logo for QR center\n        qr_size: Size of the QR code portion (default 400)\n        include_title: Whether to include title banner (default True)\n\n    Returns:\n        bytes: PNG image data of the complete branded QR code\n\n    Raises:\n        ImportError: If qrcode library is not installed\n    \"\"\"\n    if not QR_AVAILABLE:\n        raise ImportError(\n            \"qrcode library not installed. Install with: uv add qrcode pillow\"\n        )\n\n    # Generate base QR code\n    qr = qrcode.QRCode(\n        version=1,\n        error_correction=qrcode.constants.ERROR_CORRECT_H,\n        box_size=10,\n        border=2,\n    )\n\n    qr.add_data(url)\n    qr.make(fit=True)\n\n    # Create styled QR code\n    qr_img = qr.make_image(\n        image_factory=StyledPilImage,\n        module_drawer=RoundedModuleDrawer(),\n        color_mask=SolidFillColorMask(\n            back_color=(255, 255, 255),\n            front_color=(30, 58, 95),  # Navy blue\n        ),\n    )\n\n    qr_img = qr_img.resize((qr_size, qr_size), Image.Resampling.LANCZOS)\n\n    # Add logo to QR center if provided\n    if logo_path and logo_path.exists():\n        qr_img = _add_logo_to_qr(qr_img, logo_path)\n\n    # Create composite image with cover and title\n    composite = _create_composite_image(\n        qr_img=qr_img, title=title, cover_path=cover_path, include_title=include_title\n    )\n\n    # Convert to bytes\n    buffer = io.BytesIO()\n    composite.save(buffer, format=\"PNG\", optimize=True)\n    buffer.seek(0)\n\n    return buffer.getvalue()\n</code></pre>"},{"location":"development/mixtape-system/qr-generation.html#src.qr_generator.qr_generator.generate_mixtape_qr","title":"<code>generate_mixtape_qr(url, title, logo_path=None, size=400)</code>","text":"<p>Generate a simple QR code (backward compatibility).</p> <p>This is the original function for basic QR generation.</p> Source code in <code>src/qr_generator/qr_generator.py</code> <pre><code>def generate_mixtape_qr(\n    url: str, title: str, logo_path: Path | None = None, size: int = 400\n) -&gt; bytes:\n    \"\"\"\n    Generate a simple QR code (backward compatibility).\n\n    This is the original function for basic QR generation.\n    \"\"\"\n    if not QR_AVAILABLE:\n        raise ImportError(\n            \"qrcode library not installed. Install with: uv add qrcode pillow\"\n        )\n\n    qr = qrcode.QRCode(\n        version=1,\n        error_correction=qrcode.constants.ERROR_CORRECT_H,\n        box_size=10,\n        border=2,\n    )\n\n    qr.add_data(url)\n    qr.make(fit=True)\n\n    img = qr.make_image(\n        image_factory=StyledPilImage,\n        module_drawer=RoundedModuleDrawer(),\n        color_mask=SolidFillColorMask(\n            back_color=(255, 255, 255), front_color=(30, 58, 95)\n        ),\n    )\n\n    img = img.resize((size, size), Image.Resampling.LANCZOS)\n\n    if logo_path and logo_path.exists():\n        img = _add_logo_to_qr(img, logo_path)\n\n    buffer = io.BytesIO()\n    img.save(buffer, format=\"PNG\", optimize=True)\n    buffer.seek(0)\n\n    return buffer.getvalue()\n</code></pre>"},{"location":"development/music-collection/loading.html","title":"Loading & Indexing","text":""},{"location":"development/music-collection/loading.html#creatingmaintaining-the-music-collection-database","title":"Creating/maintaining the music collection database","text":""},{"location":"development/music-collection/loading.html#-highlevel-picture","title":"\ud83d\udcd8 High\u2011level picture","text":"<ul> <li>Watchdog watches the music directory for creations, modifications, and deletions.</li> <li>Detected changes are turned into IndexEvent objects and placed on a thread\u2011safe <code>Queue</code>.</li> <li>A dedicated writer thread (<code>_db_writer_loop</code>) consumes those events and performs the actual SQLite writes.</li> <li>The database consists of a normal <code>tracks</code> table (metadata) and an FTS5 virtual table <code>tracks_fts</code> that mirrors the metadata for fast full\u2011text search.</li> <li>Helper functions in <code>indexing_status.py</code> keep a tiny JSON status file (<code>indexing_status.json</code>) that the UI can poll to show progress during a rebuild or resync operation.</li> </ul>"},{"location":"development/music-collection/loading.html#loadingresyncing-process","title":"Loading/resyncing process","text":"<pre><code>flowchart LR\n    A[\"User initiates process (rebuild() / resync())\"] --&gt; B[\"Log start and set indexing status\"]\n    B --&gt; C{\"Operation type?\"}\n    C --&gt;|\"'rebuild()'\"| D[\"Clear database and prepare for file scan\"]\n    C --&gt;|\"'resync()'\"| E[\"Scan filesystem and compare with DB\"]\n\n    D --&gt; F[\"Scan music root for files to index\"]\n    E --&gt; G[\"Identify changes: files to add or remove\"]\n    F --&gt; H[\"Queue file operations to process\"]\n    G --&gt; H\n\n    H --&gt; I[\"Start job, update counters &amp; status\"]\n    I --&gt; J[\"Process queued file operations (Delete/Index)\"]\n\n    J --&gt; K{\"Job complete?\"}\n    K --&gt;|Yes| L[\"Finalize job, log completion, clear status\"]\n    K --&gt;|No| J\n\n    L --&gt; M[\"Indexing complete, external indexing status cleared\"]</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/music-collection/loading.html#monitoring-process","title":"Monitoring process","text":"<pre><code>flowchart LR\n    A[\"'start_monitoring()' called\"] --&gt; B{\"Is Observer running?\"}\n    B --&gt;|Yes| C[\"No-op (return immediately)\"]\n    B --&gt;|No| D[\"Create and start Observer instance\"]\n\n    D --&gt; E[\"Schedule file watcher for 'music_root'\"]\n    E --&gt; F[\"Start Observer thread\"]\n\n    F --&gt; G[\"FS event in 'music_root' (create/modify/delete)\"]\n    G --&gt; H[\"Process event\"]\n\n    H --&gt; I{\"Is directory?\"}\n    I --&gt;|Yes| J[\"Ignore event\"]\n    I --&gt;|No| K[\"Check if extension is supported\"]\n\n    K --&gt;|No| J\n    K --&gt;|Yes| L[\"Enqueue event (Index or Delete file)\"]\n\n    L --&gt; M[\"Writer thread processes events\"]\n\n    %% Shutdown flow\n    N[\"'stop()' called\"] --&gt; O[\"Stop writer thread and join\"]\n    O --&gt; P{\"Is Observer running?\"}\n    P --&gt;|Yes| Q[\"Stop and join Observer thread\"]\n    P --&gt;|No| R[\"No monitoring to stop\"]</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/music-collection/loading.html#-core-data-structures","title":"\ud83e\uddf1 Core data structures","text":"Name Type Purpose <code>IndexEvent</code> <code>@dataclass</code> with fields <code>type: EventType</code> and <code>path: Optional[Path]</code> Represents a single action for the writer thread (index a file, delete a file, clear DB, signal rebuild/resync completion). <code>EventType</code> <code>Literal[\"INDEX_FILE\", \"DELETE_FILE\", \"CLEAR_DB\", \"REBUILD_DONE\", \"RESYNC_DONE\"]</code> Enumerates the possible actions. <code>_write_queue</code> <code>queue.Queue[IndexEvent]</code> Thread\u2011safe hand\u2011off from the watcher / public methods to the writer thread. <code>_writer_stop</code> <code>threading.Event</code> Signals the writer thread to shut down cleanly. <code>tracks</code> table SQLite table with columns <code>path, filename, artist, album, title, albumartist, genre, year, duration, mtime</code> Stores the canonical metadata for each audio file. <code>tracks_fts</code> SQLite FTS5 virtual table mirroring most columns of <code>tracks</code> Enables fast full\u2011text search across artist, album, title, etc."},{"location":"development/music-collection/loading.html#-database-initialization","title":"\ud83d\uddc4\ufe0f Database initialization","text":"<p>Started in <code>_init_db</code>:</p> <ol> <li>Opens a connection (<code>sqlite3.connect(self.db_path)</code>).</li> <li>Sets WAL journal mode and normal sync for better concurrency.</li> <li>Creates the tracks <code>table</code> if it does not exist.</li> <li>Creates indexes on <code>artist</code>, <code>album</code>, <code>title</code>, and composite indexes on <code>artist+album</code> and <code>release_dir</code> expression for faster grouped queries.</li> <li>Creates the FTS5 virtual table <code>tracks_fts</code> with a Unicode tokenizer that removes diacritics.</li> <li>Installs three triggers (<code>tracks_ai</code>, <code>tracks_ad</code>, <code>tracks_au</code>) that keep <code>tracks_fts</code> in sync with inserts, deletes, and updates on <code>tracks</code>.</li> </ol> <p>Result: the DB is ready for both ordinary queries and full\u2011text search without any manual maintenance.</p>"},{"location":"development/music-collection/loading.html#-fulltext-table-bootstrap","title":"\ud83d\udee0\ufe0f Full\u2011text table boot\u2011strap","text":"<p>Starts in <code>_populate_fts_if_needed</code></p> <ul> <li>Opens a read\u2011only connection.</li> <li>Checks <code>SELECT count(*) FROM tracks_fts</code>.</li> <li>If the count is zero, executes a single <code>INSERT \u2026 SELECT</code> that copies every row from <code>tracks</code> into <code>tracks_fts</code>.</li> <li>Commits the transaction.</li> </ul> <p>This routine is called once after a fresh DB creation or after a manual purge of the FTS table.</p>"},{"location":"development/music-collection/loading.html#-public-connection-helper","title":"\ud83d\udd17 Public connection helper","text":"<p>Function <code>get_conn</code>:</p> <ul> <li>Read\u2011only mode (<code>readonly=True</code>) uses the URI <code>file:&lt;path&gt;?mode=ro</code>.</li> <li>Write mode opens a normal connection.</li> <li>Both connections set <code>row_factory = sqlite3.Row</code> so callers can treat rows like dictionaries.</li> </ul> <p>All higher\u2011level code (search, UI, etc.) obtains connections via this method.</p>"},{"location":"development/music-collection/loading.html#-writer-thread","title":"\u270d\ufe0f Writer thread","text":"<p>Function <code>_db_writer_loop</code></p> <ul> <li>Runs forever until _writer_stop is set.</li> <li>Pulls an IndexEvent from _write_queue with a 1.0\u202fs timeout (so it can notice the stop flag).</li> <li> <p>Handles each event type:</p> Event type Action performed <code>CLEAR_DB</code> <code>DELETE FROM tracks</code> (removes all rows). <code>INDEX_FILE</code> Calls <code>_index_file(conn, path)</code> \u2013 extracts metadata and <code>INSERT OR REPLACE</code> into <code>tracks</code>. <code>DELETE_FILE</code> <code>DELETE FROM tracks WHERE path = ?</code>. <code>REBUILD_DONE</code> / <code>RESYNC_DONE</code> <code>conn.commit()</code> \u2013 flushes any pending changes. </li> <li> <p>After every 50 processed events it forces a commit to keep the transaction size reasonable.</p> </li> <li>Errors are caught and logged via the injected Logger.</li> <li>When the loop exits, it commits any remaining work and closes the connection.</li> </ul>"},{"location":"development/music-collection/loading.html#-metadata-extraction","title":"\ud83d\udd0d Metadata extraction","text":"<p>Function <code>_index_file</code>:</p> <ol> <li>Calls TinyTag.get(path, tags=True, duration=True).</li> <li> <p>Safely extracts the following fields (fallbacks shown in parentheses):</p> Field Source Fallback <code>artist</code> <code>tag.artist</code> \u2192 <code>tag.albumartist</code> <code>\"Unknown\"</code> <code>album</code> <code>tag.album</code> <code>\"Unknown\"</code> <code>title</code> <code>tag.title</code> \u2192 <code>path.stem</code> <code>\"Unknown\"</code> <code>year</code> <code>int(str(tag.year)[:4])</code> (if parsable) <code>None</code> <code>duration</code> <code>tag.duration</code> <code>None</code> <code>mtime</code> <code>path.stat().st_mtime</code> \u2013 </li> <li> <p>Executes a single INSERT OR REPLACE INTO tracks (\u2026) VALUES (\u2026) with the gathered values.</p> </li> <li>Because of the triggers defined in _init_db, the same row is automatically mirrored into tracks_fts.</li> </ol>"},{"location":"development/music-collection/loading.html#-full-rebuild","title":"\ud83c\udfd7\ufe0f Full rebuild","text":"<p>Function: <code>rebuild</code></p> <ul> <li>Purpose \u2013 create a fresh DB from the current file system state.</li> <li> <p>Steps:</p> <ol> <li>Write status rebuilding with <code>total = -1</code> (unknown) and <code>current = 0</code>.</li> <li>Enqueue a <code>CLEAR_DB</code> event (empties the DB).</li> <li>Recursively walk <code>music_root</code> (<code>rglob(\"*\")</code>) and collect every file whose suffix is in <code>SUPPORTED_EXTS</code>.</li> <li>Update the status file with the exact <code>total</code> count.</li> <li>For each discovered file, enqueue <code>INDEX_FILE</code> events. Every 100 files the status file is refreshed (<code>set_indexing_status</code>).</li> <li>After the loop, enqueue <code>REBUILD_DONE</code> and call <code>join()</code> on the queue (wait until the writer thread finishes processing).</li> <li>Remove the status file (<code>clear_indexing_status</code>).</li> </ol> </li> <li> <p>The UI can poll <code>indexing_status.json</code> to display a progress bar that reflects the <code>total</code>/<code>current</code>/<code>progress</code> fields.</p> </li> </ul>"},{"location":"development/music-collection/loading.html#-incremental-resynchronisation","title":"\ud83d\udd04 Incremental resynchronisation","text":"<p>Function: <code>resync</code></p> <ul> <li>Purpose \u2013 bring the DB up\u2011to\u2011date after files have been added, removed, or renamed since the last run.</li> <li> <p>Steps:</p> <ol> <li>Set status <code>resyncing</code> with unknown totals (<code>total = -1</code>).</li> <li>Build a set of absolute paths for all supported files currently on disk (<code>fs_paths</code>).</li> <li>Query the DB for all stored paths (<code>db_paths</code>).</li> <li>Compute <code>to_add = fs_paths - db_paths</code> and <code>to_remove = db_paths - fs_paths</code>.</li> <li><code>total = len(to_add) + len(to_remove)</code> and update the status file.</li> <li>Enqueue <code>DELETE_FILE</code> events for each path in <code>to_remove</code>; every 100 deletions the status file is refreshed.</li> <li>Enqueue <code>INDEX_FILE</code> events for each path in <code>to_add</code>; every 100 additions the status file is refreshed.</li> <li>Enqueue <code>RESYNC_DONE</code>, clear the status file, and log a summary.</li> </ol> </li> <li> <p>As with <code>rebuild</code>, the writer thread processes the queued events sequentially, guaranteeing that the DB ends up exactly matching the file system.</p> </li> </ul>"},{"location":"development/music-collection/loading.html#-realtime-monitoring","title":"\ud83d\udc40 Real\u2011time monitoring","text":"<ul> <li> <p><code>start_monitoring</code> creates a <code>watchdog.observers.Observer</code> (if none exists), registers a <code>EnhancedWatcher</code> instance for the <code>music_root</code>, and starts the observer thread.</p> </li> <li> <p><code>EnhancedWatcher</code> inherits from <code>FileSystemEventHandler</code>. Its <code>on_any_event</code> method:</p> <ol> <li>Ignores directory events.</li> <li>Filters out files whose extensions are not in <code>SUPPORTED_EXTS</code>.</li> <li>For <code>created</code> or <code>modified</code> events \u2192 enqueues <code>INDEX_FILE</code>.</li> <li>For <code>deleted</code> events \u2192 enqueues <code>DELETE_FILE</code>.</li> </ol> </li> <li> <p>This mechanism guarantees that any change made while the application is running is eventually reflected in the DB (subject to the writer thread\u2019s batching policy).</p> </li> </ul>"},{"location":"development/music-collection/loading.html#-graceful-shutdown","title":"\ud83d\uded1 Graceful shutdown","text":"<p>Function <code>stop</code></p> <ul> <li>Sets the <code>_writer_stop</code> flag, joins the writer thread (max 5\u202fseconds).</li> <li>Stops and joins the watchdog observer if it was started.</li> <li>After this call the extractor is fully stopped and the SQLite connection is closed.</li> </ul>"},{"location":"development/music-collection/loading.html#-indexingstatus-helper","title":"\ud83d\udcdd Indexing\u2011status helper","text":"<p>File <code>indexing_status.py</code>:</p> Function Role <code>set_indexing_status(data_root, status, total, current)</code> Computes progress (<code>current/total</code>), preserves the original <code>started_at</code> timestamp (or creates a new one), builds a dictionary with <code>status, started_at, updated_at, total, current, progress</code>, and writes it atomically to <code>indexing_status.json</code>. <code>_atomic_write_json(status_file, data)</code> Writes JSON to a temporary file in the same directory, flushes, <code>fsync</code>s, then atomically renames the temp file onto the target. Guarantees that a partially\u2011written file never appears. <code>_calculate_progress(total, current)</code> Returns a float in <code>[0.0, 1.0]</code>; guards against division by zero or negative totals. <code>_get_started_at(status_file)</code> Reads the existing JSON (if any) and returns the original <code>started_at</code> value, allowing a rebuild/resync to keep the same start\u2011time across restarts. <code>_build_status_data(...)</code> Packages all fields into a plain dict ready for JSON serialization. <code>clear_indexing_status(data_root)</code> Deletes the JSON file if it exists. <code>get_indexing_status(data_root, logger=None)</code> Reads and parses the JSON file, returning the dict or <code>None</code> on missing/corrupt files. Logs JSON decode errors via the supplied logger (defaults to <code>NullLogger</code>). <p>These utilities are deliberately lightweight: they operate purely on the filesystem and do not depend on the SQLite connection, making them safe to call from any thread (including the writer thread).</p>"},{"location":"development/music-collection/loading.html#-endtoend-flow-for-a-typical-user-session","title":"\ud83e\uddd1\u200d\ud83d\udcbb End\u2011to\u2011end flow for a typical user session","text":"<pre><code>sequenceDiagram\n    actor User\n    participant CollectionExtractor\n    participant DBWriterThread\n    participant SQLite as SQLite_DB\n    participant FS\n\n    User-&gt;&gt;CollectionExtractor: resync()\n    CollectionExtractor-&gt;&gt;CollectionExtractor: set_indexing_status(resyncing, total=-1, current=0)\n\n    CollectionExtractor-&gt;&gt;CollectionExtractor: _scan_filesystem_paths()\n    FS--&gt;&gt;CollectionExtractor: fs_paths (relative)\n    CollectionExtractor-&gt;&gt;CollectionExtractor: _get_database_paths()\n    SQLite--&gt;&gt;CollectionExtractor: db_paths (relative)\n\n    CollectionExtractor-&gt;&gt;CollectionExtractor: compute to_add_rel, to_remove_rel\n    CollectionExtractor-&gt;&gt;CollectionExtractor: to_add_abs = _to_abspath(to_add_rel)\n    CollectionExtractor-&gt;&gt;CollectionExtractor: set_indexing_status(resyncing, total, current=0)\n\n    CollectionExtractor-&gt;&gt;CollectionExtractor: _start_job(\"resyncing\", total)\n    loop for each path in to_remove_rel\n        CollectionExtractor-&gt;&gt;DBWriterThread: enqueue IndexEvent(DELETE_FILE, rel_path)\n    end\n    loop for each path in to_add_abs\n        CollectionExtractor-&gt;&gt;DBWriterThread: enqueue IndexEvent(INDEX_FILE, abs_path)\n    end\n    CollectionExtractor-&gt;&gt;DBWriterThread: enqueue IndexEvent(RESYNC_DONE)\n\n    loop DB writer loop\n        alt DELETE_FILE\n            DBWriterThread-&gt;&gt;SQLite: DELETE FROM tracks WHERE path = rel_path\n        else INDEX_FILE\n            DBWriterThread-&gt;&gt;SQLite: _index_file(abs_path) INSERT OR REPLACE\n        end\n        DBWriterThread-&gt;&gt;CollectionExtractor: _processed_count++\n        alt batch_size reached\n            DBWriterThread-&gt;&gt;SQLite: COMMIT\n            DBWriterThread-&gt;&gt;CollectionExtractor: _update_progress_status()\n            CollectionExtractor-&gt;&gt;CollectionExtractor: set_indexing_status(resyncing, total, current)\n        end\n    end\n\n    DBWriterThread-&gt;&gt;SQLite: COMMIT\n    DBWriterThread-&gt;&gt;SQLite: wal_checkpoint(PASSIVE)\n    DBWriterThread-&gt;&gt;CollectionExtractor: _handle_job_completion()\n    CollectionExtractor-&gt;&gt;CollectionExtractor: set_indexing_status(resyncing, total, current=total)\n    CollectionExtractor-&gt;&gt;CollectionExtractor: clear_indexing_status()</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/music-collection/loading.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/music-collection/loading.html#src.musiclib._extractor.EventType","title":"<code>EventType = Literal['INDEX_FILE', 'DELETE_FILE', 'CLEAR_DB', 'REBUILD_DONE', 'RESYNC_DONE']</code>  <code>module-attribute</code>","text":""},{"location":"development/music-collection/loading.html#src.musiclib._extractor.IndexEvent","title":"<code>IndexEvent(type, path=None)</code>  <code>dataclass</code>","text":"<p>Represents an event for indexing or modifying music files in the collection.</p>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor","title":"<code>CollectionExtractor(music_root, db_path, logger=None)</code>","text":"<p>Manages extraction, indexing, and synchronization of music files in a collection.</p> <p>Creates a new collection extractor for managing a music library index.</p> <p>This initializer wires together filesystem paths, logging, database schema, and background worker infrastructure so that music files can be scanned, indexed, and kept in sync with the underlying SQLite database.</p> <p>Parameters:</p> Name Type Description Default <code>music_root</code> <code>Path</code> <p>Root directory containing the music files to be indexed.</p> required <code>db_path</code> <code>Path</code> <p>Path to the SQLite database file storing track metadata and search index.</p> required <code>logger</code> <code>Logger | None</code> <p>Optional logger for recording indexing progress and errors; if omitted, a NullLogger is used.</p> <code>None</code> <p>Methods:</p> Name Description <code>get_conn</code> <p>Opens and returns a configured SQLite connection for this collection.</p> <code>is_initial_indexing_done</code> <p>Checks whether an initial full indexing pass has been completed.</p> <code>set_initial_indexing_done</code> <p>Marks that the initial full indexing pass has completed successfully.</p> <code>rebuild</code> <p>Performs a full rebuild of the music collection index from the current filesystem state.</p> <code>resync</code> <p>Synchronizes the database with the current set of music files on disk.</p> <code>start_monitoring</code> <p>Starts monitoring the music directory for file system changes.</p> <code>stop</code> <p>Stops the database writer thread and file system observer.</p> <code>enable_bulk_edit_mode</code> <p>Enables bulk edit mode by pausing file system monitoring.</p> <code>disable_bulk_edit_mode</code> <p>Disables bulk edit mode and resyncs the database.</p> <code>wait_for_indexing_start</code> <p>Waits until indexing has started or the specified timeout elapses.</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def __init__(\n    self, music_root: Path, db_path: Path, logger: Logger | None = None\n) -&gt; None:\n    \"\"\"Creates a new collection extractor for managing a music library index.\n\n    This initializer wires together filesystem paths, logging, database schema,\n    and background worker infrastructure so that music files can be scanned,\n    indexed, and kept in sync with the underlying SQLite database.\n\n    Args:\n        music_root (Path): Root directory containing the music files to be indexed.\n        db_path (Path): Path to the SQLite database file storing track metadata and search index.\n        logger (Logger | None): Optional logger for recording indexing progress and errors;\n            if omitted, a NullLogger is used.\n    \"\"\"\n    self.music_root = music_root.resolve()\n    self.db_path = db_path\n    self.data_root = db_path.parent\n    self._logger = logger or NullLogger()\n\n    self.data_root.mkdir(parents=True, exist_ok=True)\n\n    # Progress tracking\n    self._initial_status_event = ThreadEvent()\n    self._processed_count = 0\n    self._total_for_current_job = None\n    self._current_job_status = None\n\n    # Threading\n    self._write_queue: Queue[IndexEvent] = Queue()\n    self._writer_stop = ThreadEvent()\n    self._observer: Observer | None = None\n    self._db_lock = Lock()\n\n    try:\n        self._init_db()\n    except sqlite3.DatabaseError as e:\n        if (\n            'malformed' not in str(e).lower()\n            and 'corrupt' not in str(e).lower()\n        ):\n            raise\n        self._logger.error(f\"Corruption detected: {e}\")\n        self._delete_database_files()\n        self._init_db()  # Retry\n    self._start_writer_thread()\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.get_conn","title":"<code>get_conn(readonly=False)</code>","text":"<p>Opens and returns a configured SQLite connection for this collection.</p> <p>This method creates either a read-only or read-write connection depending on the <code>readonly</code> flag, applies a row factory for dict-like row access, and sets a busy timeout to make concurrent access more robust.</p> <p>Parameters:</p> Name Type Description Default <code>readonly</code> <code>bool</code> <p>Whether to open the connection in read-only mode. Defaults to False.</p> <code>False</code> <p>Returns:</p> Type Description <code>Connection</code> <p>sqlite3.Connection: A SQLite connection configured with an appropriate busy timeout.</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def get_conn(self, readonly: bool = False) -&gt; sqlite3.Connection:\n    \"\"\"Opens and returns a configured SQLite connection for this collection.\n\n    This method creates either a read-only or read-write connection depending\n    on the ``readonly`` flag, applies a row factory for dict-like row access,\n    and sets a busy timeout to make concurrent access more robust.\n\n    Args:\n        readonly (bool): Whether to open the connection in read-only mode. Defaults to False.\n\n    Returns:\n        sqlite3.Connection: A SQLite connection configured with an appropriate busy timeout.\n    \"\"\"\n    if readonly:\n        uri = f\"file:{self.db_path}?mode=ro\"\n        conn = sqlite3.connect(uri, uri=True)\n    else:\n        conn = sqlite3.connect(self.db_path)\n\n    conn.row_factory = sqlite3.Row\n    # PRAGMA doesn't support parameters, but BUSY_TIMEOUT_MS is validated as int at module load\n    conn.execute(f\"PRAGMA busy_timeout={BUSY_TIMEOUT_MS}\")\n    return conn\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.is_initial_indexing_done","title":"<code>is_initial_indexing_done()</code>","text":"<p>Checks whether an initial full indexing pass has been completed.</p> <p>This method looks up the <code>initial_indexing_done</code> flag in the meta table and interprets a stored value of \"1\" as meaning the first full index has successfully run.</p> <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True if initial indexing has been marked as done, otherwise False.</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def is_initial_indexing_done(self) -&gt; bool:\n    \"\"\"Checks whether an initial full indexing pass has been completed.\n\n    This method looks up the ``initial_indexing_done`` flag in the meta table\n    and interprets a stored value of \"1\" as meaning the first full index has\n    successfully run.\n\n    Returns:\n        bool: True if initial indexing has been marked as done, otherwise False.\n    \"\"\"\n    with self.get_conn(readonly=True) as conn:\n        cur = conn.execute(\n            \"SELECT value FROM meta WHERE key = ?\", (\"initial_indexing_done\",)\n        )\n        row = cur.fetchone()\n        return row is not None and row[\"value\"] == \"1\"\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.set_initial_indexing_done","title":"<code>set_initial_indexing_done()</code>","text":"<p>Marks that the initial full indexing pass has completed successfully.</p> <p>This method updates the meta table flag so future runs and external callers can detect that a complete initial index of the collection is already in place.</p> <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def set_initial_indexing_done(self) -&gt; None:\n    \"\"\"Marks that the initial full indexing pass has completed successfully.\n\n    This method updates the meta table flag so future runs and external\n    callers can detect that a complete initial index of the collection is\n    already in place.\n\n    Returns:\n        None\n    \"\"\"\n    with self.get_conn() as conn:\n        conn.execute(\n            \"UPDATE meta SET value = ? WHERE key = ?\",\n            (\"1\", \"initial_indexing_done\"),\n        )\n        conn.commit()\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.rebuild","title":"<code>rebuild()</code>","text":"<p>Performs a full rebuild of the music collection index from the current filesystem state.</p> <p>This method clears existing track data, scans the music root for all supported files, and queues indexing operations so that the database is fully regenerated to match the contents of the collection.</p> <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def rebuild(self) -&gt; None:\n    \"\"\"Performs a full rebuild of the music collection index from the current filesystem state.\n\n    This method clears existing track data, scans the music root for all supported files,\n    and queues indexing operations so that the database is fully regenerated to match\n    the contents of the collection.\n\n    Returns:\n        None\n    \"\"\"\n    self._logger.info(\"Starting full rebuild\")\n    self._initial_status_event.set()\n\n    # Pause file monitoring to prevent race conditions with watcher\n    with self._pause_observer():\n        set_indexing_status(self.data_root, \"rebuilding\", total=-1, current=0)\n        self._write_queue.put(IndexEvent(\"CLEAR_DB\"))\n        self._write_queue.join()\n\n        files = self._scan_music_files(\"rebuilding\")\n        set_indexing_status(self.data_root, \"rebuilding\", total=len(files), current=0)\n\n        self._queue_file_operations(\n            to_delete=[],\n            to_index=files,\n            job_type=\"rebuilding\",\n        )\n\n    self.set_initial_indexing_done()\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.resync","title":"<code>resync()</code>","text":"<p>Synchronizes the database with the current set of music files on disk.</p> <p>This method compares the filesystem under the music root with the paths stored in the database, then enqueues add and delete operations so that the index reflects files that have been created, removed, or renamed since the last run.</p> <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def resync(self) -&gt; None:\n    \"\"\"Synchronizes the database with the current set of music files on disk.\n\n    This method compares the filesystem under the music root with the paths\n    stored in the database, then enqueues add and delete operations so that\n    the index reflects files that have been created, removed, or renamed\n    since the last run.\n\n    Returns:\n        None\n    \"\"\"\n    self._logger.info(\"Starting resync\")\n\n    # Pause file monitoring to prevent race conditions with watcher\n    with self._pause_observer():\n        set_indexing_status(self.data_root, \"resyncing\", total=-1, current=0)\n\n        with self._db_lock:\n            fs_paths = self._scan_filesystem_paths()\n            db_paths = self._get_database_paths()\n\n        to_add_rel = fs_paths - db_paths\n        to_remove_rel = db_paths - fs_paths\n        to_add_abs = [self._to_abspath(p) for p in to_add_rel]\n\n        self._logger.info(\n            f\"Resync: {len(to_add_rel)} to add, {len(to_remove_rel)} to remove\"\n        )\n        set_indexing_status(\n            self.data_root,\n            \"resyncing\",\n            total=len(to_add_rel) + len(to_remove_rel),\n            current=0,\n        )\n\n        self._queue_file_operations(\n            to_delete=to_remove_rel,\n            to_index=to_add_abs,\n            job_type=\"resyncing\",\n        )\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.start_monitoring","title":"<code>start_monitoring()</code>","text":"<p>Starts monitoring the music directory for file system changes.</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def start_monitoring(self) -&gt; None:\n    \"\"\"Starts monitoring the music directory for file system changes.\"\"\"\n    if self._observer:\n        return\n    self._observer = Observer()\n    self._observer.schedule(_Watcher(self), str(self.music_root), recursive=True)\n    self._observer.start()\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.stop","title":"<code>stop(timeout=30.0)</code>","text":"<p>Stops the database writer thread and file system observer.</p> <p>Parameters:</p> Name Type Description Default <code>timeout</code> <code>float</code> <p>Maximum time to wait for shutdown (seconds).</p> <code>30.0</code> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def stop(self, timeout: float = 30.0) -&gt; None:\n    \"\"\"Stops the database writer thread and file system observer.\n\n    Args:\n        timeout: Maximum time to wait for shutdown (seconds).\n    \"\"\"\n    # Shutdown watcher first to flush pending events\n    if self._observer:\n        for handler_list in self._observer._handlers.values():\n            for handler in handler_list:\n                if hasattr(handler, 'shutdown'):\n                    handler.shutdown()\n        self._observer.stop()\n        self._observer.join(timeout=5)\n\n    # Stop writer thread\n    self._writer_stop.set()\n    self._writer_thread.join(timeout=5)\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.enable_bulk_edit_mode","title":"<code>enable_bulk_edit_mode()</code>","text":"<p>Enables bulk edit mode by pausing file system monitoring.</p> <p>Call this before performing bulk file operations (e.g., tagging 100+ files) to prevent event flooding. File changes will not be indexed in real-time while bulk edit mode is active.</p> Example <p>extractor.enable_bulk_edit_mode() try:     # Perform bulk file operations here     for file in files:         update_tags(file) finally:     extractor.disable_bulk_edit_mode()</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def enable_bulk_edit_mode(self) -&gt; None:\n    \"\"\"Enables bulk edit mode by pausing file system monitoring.\n\n    Call this before performing bulk file operations (e.g., tagging 100+ files)\n    to prevent event flooding. File changes will not be indexed in real-time\n    while bulk edit mode is active.\n\n    Example:\n        extractor.enable_bulk_edit_mode()\n        try:\n            # Perform bulk file operations here\n            for file in files:\n                update_tags(file)\n        finally:\n            extractor.disable_bulk_edit_mode()\n    \"\"\"\n    if self._observer:\n        self._observer.unschedule_all()\n        self._logger.debug(\"File monitoring paused for bulk edit mode\")\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.disable_bulk_edit_mode","title":"<code>disable_bulk_edit_mode()</code>","text":"<p>Disables bulk edit mode and resyncs the database.</p> <p>Call this after completing bulk file operations. This will resume file system monitoring and trigger a resync to catch all changes made during bulk edit mode.</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def disable_bulk_edit_mode(self) -&gt; None:\n    \"\"\"Disables bulk edit mode and resyncs the database.\n\n    Call this after completing bulk file operations. This will resume file\n    system monitoring and trigger a resync to catch all changes made during\n    bulk edit mode.\n    \"\"\"\n    if self._observer:\n        # Resume monitoring with a new watcher instance\n        watcher = _Watcher(self)\n        self._observer.schedule(watcher, str(self.music_root), recursive=True)\n        self._logger.debug(\"File monitoring resumed, triggering resync\")\n\n    # Trigger resync to catch all changes\n    self.resync()\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._extractor.CollectionExtractor.wait_for_indexing_start","title":"<code>wait_for_indexing_start(timeout=5.0)</code>","text":"<p>Waits until indexing has started or the specified timeout elapses.</p> <p>This method blocks until the internal event indicating the beginning of a rebuild or resync job is set, allowing callers to synchronize with the start of indexing work.</p> <p>Parameters:</p> Name Type Description Default <code>timeout</code> <code>float</code> <p>The maximum number of seconds to wait for indexing to start.</p> <code>5.0</code> <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True if indexing started before the timeout, or False if the timeout expired first.</p> Source code in <code>src/musiclib/_extractor.py</code> <pre><code>def wait_for_indexing_start(self, timeout: float = 5.0) -&gt; bool:\n    \"\"\"Waits until indexing has started or the specified timeout elapses.\n\n    This method blocks until the internal event indicating the beginning of\n    a rebuild or resync job is set, allowing callers to synchronize with the\n    start of indexing work.\n\n    Args:\n        timeout (float): The maximum number of seconds to wait for indexing to start.\n\n    Returns:\n        bool: True if indexing started before the timeout, or False if the timeout expired first.\n    \"\"\"\n    return self._initial_status_event.wait(timeout=timeout)\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib.indexing_status","title":"<code>indexing_status</code>","text":"<p>Functions:</p> Name Description <code>set_indexing_status</code> <p>Writes the current indexing status to a JSON file.</p> <code>clear_indexing_status</code> <p>Removes the indexing status file for the given data root.</p> <code>get_indexing_status</code> <p>Retrieves the current indexing status from the status file for the given data root.</p>"},{"location":"development/music-collection/loading.html#src.musiclib.indexing_status.set_indexing_status","title":"<code>set_indexing_status(data_root, status, total, current)</code>","text":"<p>Writes the current indexing status to a JSON file.</p> <p>Calculates progress, determines the start time, builds the status data, and writes it atomically to the status file for the given data root.</p> <p>Parameters:</p> Name Type Description Default <code>data_root</code> <code>Path | str</code> <p>The root directory containing the indexing status file.</p> required <code>status</code> <code>str</code> <p>The current status string (e.g., 'rebuilding', 'resyncing').</p> required <code>total</code> <code>int</code> <p>The total number of items to process.</p> required <code>current</code> <code>int</code> <p>The number of items processed so far.</p> required <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/indexing_status.py</code> <pre><code>def set_indexing_status(\n    data_root: Path | str, status: str, total: int | None, current: int\n) -&gt; None:\n    \"\"\"Writes the current indexing status to a JSON file.\n\n    Calculates progress, determines the start time, builds the status data, and writes it atomically to the status file for the given data root.\n\n    Args:\n        data_root (Path | str): The root directory containing the indexing status file.\n        status (str): The current status string (e.g., 'rebuilding', 'resyncing').\n        total (int): The total number of items to process.\n        current (int): The number of items processed so far.\n\n    Returns:\n        None\n    \"\"\"\n    data_root = Path(data_root)\n    status_file = data_root / \"indexing_status.json\"\n    status_file.parent.mkdir(parents=True, exist_ok=True)\n    if total is None or total &lt; 0:\n        progress = 0.0\n    else:\n        progress = _calculate_progress(total, current)\n    started_at = _get_started_at(status_file) or datetime.now(timezone.utc).isoformat()\n    data = _build_status_data(status, started_at, total, current, progress)\n    _atomic_write_json(status_file, data)\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib.indexing_status.clear_indexing_status","title":"<code>clear_indexing_status(data_root)</code>","text":"<p>Removes the indexing status file for the given data root.</p> <p>Deletes the indexing status JSON file if it exists, effectively clearing any current indexing progress or state.</p> <p>Parameters:</p> Name Type Description Default <code>data_root</code> <code>Path | str</code> <p>The root directory containing the indexing status file.</p> required <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/indexing_status.py</code> <pre><code>def clear_indexing_status(data_root: Path | str) -&gt; None:\n    \"\"\"Removes the indexing status file for the given data root.\n\n    Deletes the indexing status JSON file if it exists, effectively clearing any current indexing progress or state.\n\n    Args:\n        data_root (Path | str): The root directory containing the indexing status file.\n\n    Returns:\n        None\n    \"\"\"\n    data_root = Path(data_root)\n    status_file = data_root / \"indexing_status.json\"\n    status_file.unlink(missing_ok=True)\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib.indexing_status.get_indexing_status","title":"<code>get_indexing_status(data_root, logger=None)</code>","text":"<p>Retrieves the current indexing status from the status file for the given data root.</p> <p>Attempts to read and parse the indexing status JSON file, returning its contents as a dictionary. Handles missing files and JSON decode errors gracefully, logging errors if a logger is provided.</p> <p>Parameters:</p> Name Type Description Default <code>data_root</code> <code>Path | str</code> <p>The root directory containing the indexing status file.</p> required <code>logger</code> <code>Logger</code> <p>Logger for error reporting. Uses NullLogger if not provided.</p> <code>None</code> <p>Returns:</p> Type Description <code>dict | None</code> <p>dict | None: The indexing status data as a dictionary, or None if the file does not exist or cannot be read.</p> Source code in <code>src/musiclib/indexing_status.py</code> <pre><code>def get_indexing_status(\n    data_root: Path | str, logger: Logger | None = None\n) -&gt; dict | None:\n    \"\"\"\n    Retrieves the current indexing status from the status file for the given data root.\n\n    Attempts to read and parse the indexing status JSON file, returning its contents as a dictionary.\n    Handles missing files and JSON decode errors gracefully, logging errors if a logger is provided.\n\n    Args:\n        data_root (Path | str): The root directory containing the indexing status file.\n        logger (Logger, optional): Logger for error reporting. Uses NullLogger if not provided.\n\n    Returns:\n        dict | None: The indexing status data as a dictionary, or None if the file does not exist or cannot be read.\n    \"\"\"\n    logger = logger or NullLogger()\n    data_root = Path(data_root)\n    status_file = data_root / \"indexing_status.json\"\n\n    try:\n        with status_file.open(\"r\", encoding=\"utf-8\") as f:\n            return json.load(f)\n    except FileNotFoundError:\n        return None\n    except json.JSONDecodeError as e:\n        logger.error(f\"JSON decode error in {status_file}: {e}\")\n        return None\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._watcher.EnhancedWatcher","title":"<code>EnhancedWatcher(extractor)</code>","text":"<p>               Bases: <code>FileSystemEventHandler</code></p> <p>Enhanced file system watcher with debouncing to prevent corruption.</p> <p>This watcher prevents database corruption during bulk file editing by: 1. Waiting DEBOUNCE_DELAY seconds after the last file change before indexing 2. Coalescing multiple modifications to the same file into a single operation 3. Properly flushing all pending events on shutdown</p> Example <p>Without debouncing:     Edit file.mp3 5 times rapidly \u2192 5 index operations \u2192 corruption risk</p> <p>With debouncing:     Edit file.mp3 5 times rapidly \u2192 wait 2 seconds \u2192 1 index operation \u2192 safe</p> <p>Attributes:</p> Name Type Description <code>extractor</code> <p>The CollectionExtractor instance that processes index/delete events.</p> <code>debounce_delay</code> <p>Number of seconds to wait after last file change (default: 2.0).</p> <code>pending_events</code> <code>Dict[str, Tuple[str, float]]</code> <p>Dict mapping file paths to their pending event type and timestamp.</p> <code>pending_lock</code> <p>Thread lock for synchronizing access to pending events.</p> <code>timers</code> <code>Dict[str, Timer]</code> <p>Dict mapping file paths to their active debounce timers.</p> <p>Initializes the enhanced watcher with debouncing.</p> <p>Parameters:</p> Name Type Description Default <code>extractor</code> <p>The CollectionExtractor instance that will handle the events.</p> required <p>Methods:</p> Name Description <code>on_any_event</code> <p>Handles file system events with debouncing.</p> <code>shutdown</code> <p>Cancels all pending timers and processes remaining events immediately.</p> Source code in <code>src/musiclib/_watcher.py</code> <pre><code>def __init__(self, extractor) -&gt; None:\n    \"\"\"Initializes the enhanced watcher with debouncing.\n\n    Args:\n        extractor: The CollectionExtractor instance that will handle the events.\n    \"\"\"\n    self.extractor = extractor\n    self.debounce_delay = DEBOUNCE_DELAY\n\n    # Track pending events: path -&gt; (event_type, timestamp)\n    self.pending_events: Dict[str, Tuple[str, float]] = {}\n    self.pending_lock = Lock()\n\n    # Track active timers: path -&gt; Timer\n    self.timers: Dict[str, Timer] = {}\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._watcher.EnhancedWatcher.on_any_event","title":"<code>on_any_event(event)</code>","text":"<p>Handles file system events with debouncing.</p> <p>This method ignores directory changes and unsupported file types, then applies debouncing to file modification and deletion events. Multiple rapid changes to the same file are coalesced into a single operation.</p> <p>Parameters:</p> Name Type Description Default <code>event</code> <code>object</code> <p>A watchdog file system event with is_directory, src_path,    and event_type attributes.</p> required Source code in <code>src/musiclib/_watcher.py</code> <pre><code>def on_any_event(self, event: object) -&gt; None:\n    \"\"\"Handles file system events with debouncing.\n\n    This method ignores directory changes and unsupported file types, then\n    applies debouncing to file modification and deletion events. Multiple\n    rapid changes to the same file are coalesced into a single operation.\n\n    Args:\n        event: A watchdog file system event with is_directory, src_path,\n               and event_type attributes.\n    \"\"\"\n    # Ignore directory changes\n    if event.is_directory:\n        return\n\n    path = Path(event.src_path)\n\n    # Only process supported audio file extensions\n    if path.suffix.lower() not in self.extractor.SUPPORTED_EXTS:\n        return\n\n    path_str = str(path)\n    event_type = event.event_type\n\n    with self.pending_lock:\n        # Cancel any existing timer for this file\n        if path_str in self.timers:\n            self.timers[path_str].cancel()\n\n        # Update pending event (this coalesces multiple events)\n        if event_type in (\"created\", \"modified\"):\n            # Both created and modified should result in reindexing\n            self.pending_events[path_str] = (\"modified\", time.time())\n        elif event_type == \"deleted\":\n            # Delete takes precedence over everything\n            self.pending_events[path_str] = (\"deleted\", time.time())\n\n        # Set new debounce timer\n        timer = Timer(\n            self.debounce_delay,\n            self._process_debounced_event,\n            args=(path_str,)\n        )\n        self.timers[path_str] = timer\n        timer.start()\n</code></pre>"},{"location":"development/music-collection/loading.html#src.musiclib._watcher.EnhancedWatcher.shutdown","title":"<code>shutdown()</code>","text":"<p>Cancels all pending timers and processes remaining events immediately.</p> <p>This ensures no events are lost when stopping the watcher. All pending events are flushed to the processing queue before shutdown completes.</p> <p>This method should be called before stopping the file system observer.</p> Source code in <code>src/musiclib/_watcher.py</code> <pre><code>def shutdown(self) -&gt; None:\n    \"\"\"Cancels all pending timers and processes remaining events immediately.\n\n    This ensures no events are lost when stopping the watcher. All pending\n    events are flushed to the processing queue before shutdown completes.\n\n    This method should be called before stopping the file system observer.\n    \"\"\"\n    # Import IndexEvent here to avoid circular imports\n    from ._extractor import IndexEvent\n\n    with self.pending_lock:\n        # Cancel all pending timers\n        for timer in self.timers.values():\n            timer.cancel()\n\n        # Process all remaining pending events immediately\n        for path_str, (event_type, _) in self.pending_events.items():\n            path = Path(path_str)\n            if event_type == \"modified\":\n                self.extractor._write_queue.put(IndexEvent(\"INDEX_FILE\", path))\n            elif event_type == \"deleted\":\n                self.extractor._write_queue.put(IndexEvent(\"DELETE_FILE\", path))\n\n        # Clear all state\n        self.pending_events.clear()\n        self.timers.clear()\n</code></pre>"},{"location":"development/music-collection/overview.html","title":"Overview","text":""},{"location":"development/music-collection/overview.html#musiclib---music-collection-handling","title":"Musiclib - Music Collection handling","text":""},{"location":"development/music-collection/overview.html#-overview-and-introduction","title":"\ud83d\udcd8 Overview and introduction","text":"<p>The musiclib package is the heart of the mixtape music\u2011collection service. It turns a plain directory tree of audio files into a searchable, fully\u2011indexed library that can be queried instantly from the UI.</p> <p>Below is a concise, high\u2011level walkthrough of the module\u2019s responsibilities, its main components, and how they interact to deliver a robust \u201cscan\u2011once\u2011search\u2011forever\u201d experience.</p>"},{"location":"development/music-collection/overview.html#class-diagram","title":"Class diagram","text":"<pre><code>classDiagram\n    %% ==== Core data types ====\n    class IndexEvent {\n        &lt;&lt;dataclass&gt;&gt;\n        +EventType type\n        +Path? path\n    }\n\n    class EventType {\n        &lt;&lt;enumeration&gt;&gt;\n        INDEX_FILE\n        DELETE_FILE\n        CLEAR_DB\n        REBUILD_DONE\n        RESYNC_DONE\n    }\n\n    %% ==== CollectionExtractor (main engine) ====\n    class CollectionExtractor {\n        -Path music_root\n        -Path db_path\n        -Path data_root\n        -Logger _logger\n        -Queue[IndexEvent] _write_queue\n        -Event _writer_stop\n        -Observer? _observer\n        -Thread _writer_thread\n        -set SUPPORTED_EXTS\n        +CollectionExtractor(music_root, db_path, logger=None)\n        +rebuild()\n        +resync()\n        +start_monitoring()\n        +stop()\n        +get_conn(readonly=False) Connection\n        -_init_db()\n        -_populate_fts_if_needed()\n        -_db_writer_loop()\n        -_index_file(conn, path)\n        -_write_queue.put(event)\n    }\n\n    %% ==== EnhancedWatcher (filesystem event handler) ====\n    class EnhancedWatcher {\n        -CollectionExtractor extractor\n        +EnhancedWatcher(extractor)\n        +on_any_event(event)\n        +shutdown()\n    }\n\n    %% ==== Indexing status helpers (module-level functions) ====\n    class indexing_status {\n        &lt;&lt;module&gt;&gt;\n        +set_indexing_status(data_root, status, total, current)\n        +clear_indexing_status(data_root)\n        +get_indexing_status(data_root, logger=None)\n        -_atomic_write_json(status_file, data)\n        -_calculate_progress(total, current) float\n        -_get_started_at(status_file) str|None\n        -_build_status_data(status, started_at, total, current, progress) dict\n    }\n\n    %% ==== Relationships ====\n    CollectionExtractor --&gt; IndexEvent : produces / consumes\n    CollectionExtractor --&gt; EventType : uses literals\n    CollectionExtractor --&gt; EnhancedWatcher : creates &amp; registers\n    CollectionExtractor --&gt; indexing_status : writes progress JSON\n    EnhancedWatcher --&gt; IndexEvent : enqueues events\n    EnhancedWatcher --&gt; CollectionExtractor : holds reference\n    indexing_status ..&gt; Path : works with filesystem paths</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/music-collection/overview.html#-what-the-module-does","title":"\ud83e\udde9 What the module does","text":"Goal How it\u2019s achieved Detect every supported audio file A watchdog observer (implemented as <code>EnhancedWatcher</code>) monitors the <code>music_root</code> directory in real time. It includes a 2\u202fsecond debounce to coalesce rapid edits and avoid duplicate indexing. Extract reliable metadata <code>tinytag.TinyTag</code> reads ID3/metadata tags (artist, album, title, year, duration, etc.). Persist metadata efficiently A SQLite database stores the canonical rows (<code>tracks</code> table) and an FTS5 virtual table (<code>tracks_fts</code>) that mirrors the same columns for lightning\u2011fast full\u2011text search. Keep the DB in sync A single writer thread serialises all write operations (adds, deletes, clears) via a thread\u2011safe <code>Queue[IndexEvent]</code>. Expose progress to the UI A tiny JSON file (<code>indexing_status.json</code>) is updated atomically during long\u2011running operations (rebuild, resync) so the front\u2011end can render progress bars. Provide a clean API for the UI <code>MusicCollection</code> (in <code>reader.py</code>) builds the search expression, runs the query, groups results by release directory, and returns a ready\u2011to\u2011render structure (artists, albums, tracks) together with the list of terms that need highlighting."},{"location":"development/music-collection/overview.html#-core-building-blocks","title":"\ud83e\uddf1 Core building blocks","text":"Module / Class Primary responsibility <code>_extractor.py</code> \u2022 Low\u2011level DB schema creation (<code>_init_db</code>). \u2022 Full\u2011text table bootstrap (<code>_populate_fts_if_needed</code>). \u2022 <code>CollectionExtractor</code> \u2013 orchestrates indexing, resync, rebuild, and live monitoring. \u2022 <code>IndexEvent</code> / <code>EventType</code> \u2013 typed messages that drive the writer thread. \u2022 <code>_Watcher</code> \u2013 translates filesystem events into <code>IndexEvent</code>s. <code>indexing_status.py</code> Helper functions that write/read the <code>indexing_status.json</code> file in an atomic, crash\u2011safe way (e.g., <code>set_indexing_status</code>, <code>clear_indexing_status</code>, <code>get_indexing_status</code>). <code>reader.py</code> High\u2011level fa\u00e7ade (<code>MusicCollection</code>) used by the UI. It parses user queries, builds the FTS/LIKE expression, runs the query, groups rows, and formats the result payload (artists, albums, tracks, and highlight terms). <code>ui.py</code> Extends <code>MusicCollection</code> with UI\u2011specific helpers: \u2022 <code>_highlight_text</code> (term highlighting) \u2022 <code>_safe_filename</code> (sanitising filenames) \u2022 <code>_escape_for_query</code> (building click\u2011query strings) \u2022 result shaping for the front\u2011end."},{"location":"development/music-collection/overview.html#-data-flow--from-file-system-to-ui","title":"\ud83d\udd00 Data flow \u2013 from file system to UI","text":"<ol> <li>Startup \u2013 <code>MusicCollection</code> creates a <code>CollectionExtractor</code>. The extractor initializes the SQLite schema and launches the writer thread.</li> <li>Initial population \u2013 If the DB is empty, <code>MusicCollection</code> schedules a rebuild. The rebuild walks the entire <code>music_root</code>, enqueues an <code>INDEX_FILE</code> event for every supported file, and updates <code>indexing_status.json</code> so the UI can show progress.</li> <li>Live updates \u2013 The <code>watchdog</code> observer fires on every create/modify/delete. <code>_Watcher</code> converts those into <code>IndexEvent</code>s, which the writer thread processes in order, keeping the DB and the FTS mirror perfectly aligned.</li> <li>Search \u2013 When the UI calls <code>search_highlighting</code>, <code>MusicCollection</code> parses the query, builds an FTS\u2011compatible expression (or a fallback <code>LIKE</code> query), runs it against the DB, groups rows by release directory, and returns a dictionary of artists, albums, and tracks plus the list of parsed terms. Internally, searches use a multi-pass candidate scoring model with optional reuse of previous search sessions for fast refinements.</li> <li>Presentation \u2013 <code>MusicCollectionUI</code> highlights the terms, builds click\u2011queries (<code>artist:\u2026</code>, <code>release_dir:\u2026</code>), and hands the ready\u2011to\u2011render JSON back to the front\u2011end. Lazy\u2011loading of an artist\u2019s full discography or an album\u2019s track list is done by re\u2011issuing <code>search_grouped</code> with the stored click\u2011query.</li> </ol>"},{"location":"development/music-collection/overview.html#-why-the-design-choices-matter","title":"\ud83d\udca1 Why the design choices matter","text":"Design decision Benefit Single writer thread + queue Guarantees deterministic ordering of DB writes, avoids SQLite lock contention, and lets the UI stay responsive while heavy indexing runs in the background. FTS5 virtual table with triggers Provides sub\u2011millisecond full\u2011text look\u2011ups without having to maintain a separate index manually. Atomic JSON status file Prevents corrupted progress information even if the process crashes mid\u2011write; the UI never sees a half\u2011written file. Watchdog\u2011driven live sync Users see newly added songs appear instantly; deletions are reflected without a full rescan. Separation of concerns (<code>_extractor</code> vs. <code>reader</code> vs. <code>ui</code>) Keeps low\u2011level DB handling isolated from query parsing and UI formatting, making the code easier to test and extend. Typed <code>IndexEvent</code> dataclass Improves readability, reduces bugs caused by mismatched queue payloads, and makes future event types straightforward to add. Debouncing in the watcher (<code>EnhancedWatcher</code>) Prevents a flood of <code>INDEX_FILE</code> events when a user edits a file repeatedly (e.g., retagging). Guarantees only the final state is indexed, reducing DB churn and corruption risk."},{"location":"development/music-collection/overview.html#-quick-mental-model","title":"\ud83e\udde0 Quick mental model","text":"<pre><code>flowchart LR\n    %% Nodes\n    FS[Filesystem audio files]\n    WD[EnhancedWatcher Observer]\n    Q[IndexEvent Queue]\n    WT[Writer Thread processes events]\n    DB[SQLite DB *tracks + tracks_fts*]\n    UI[MusicCollection UI layer]\n\n    %% Main data flow\n    FS --&gt; WD\n    WD --&gt; Q\n    Q --&gt; WT\n    WT --&gt; DB\n\n    %% Queries from UI\n    UI --&gt; DB\n    DB --&gt; UI</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>The arrow direction indicates the primary flow of data.</p> <p>The UI never talks directly to the filesystem; it always goes through MusicCollection, which in turn reads from the already\u2011indexed SQLite store.</p>"},{"location":"development/music-collection/overview.html#-getting-started-for-developers","title":"\ud83d\ude80 Getting started (for developers)","text":"<ol> <li> <p>Instantiate the high\u2011level class:</p> <pre><code>from musiclib import MusicCollectionUI\nmc = MusicCollectionUI(\n    music_root=\"/path/to/music\",\n    db_path=\"/path/to/db.sqlite\"\n)   # Starts the watchdog observer and, if the DB is empty, schedules an initial rebuild.\n</code></pre> </li> <li> <p>Run a query (the UI does this internally):</p> <pre><code>results, terms = mc.search_highlighting(qry=\"artist:'Radiohead' love\")\n</code></pre> </li> <li> <p>Monitor progress (useful for CLI tools):</p> <pre><code>from musiclib.indexing_status import get_indexing_status\nstatus = get_indexing_status(\"/path/to/db_folder\")\nprint(status)   # \u2192 {'status': 'rebuilding', 'progress': 0.42, \u2026}\n</code></pre> </li> <li> <p>Shut down cleanly when the program exits:</p> <pre><code>mc.close()   # stops the writer thread and the watchdog observer\n</code></pre> </li> </ol>"},{"location":"development/music-collection/overview.html#-where-to-look-next","title":"\ud83e\udded Where to look next","text":"<ul> <li>DB Loading for:</li> <li>low\u2011level DB schema, triggers, the writer\u2011loop logic and</li> <li>the atomic JSON status handling used by the UI progress bar.</li> <li>DB reading for:</li> <li>the query parser,</li> <li>grouping algorithm that decides which artists/albums/tracks to return,</li> <li>presentation helpers (highlighting, safe filenames, click\u2011query generation) and</li> <li>Real\u2011time monitoring of changes in your music collection</li> </ul> <p>That\u2019s the complete picture of the <code>musiclib</code> module: a tightly coupled pipeline that turns a folder of audio files into a fast, searchable, and continuously synchronized music library.</p>"},{"location":"development/music-collection/reading.html","title":"Reading Library","text":""},{"location":"development/music-collection/reading.html#searching-the-music-collection","title":"Searching the music collection","text":"<p>The music collection supports a flexible, tag-based search language that can return artists, albums, and tracks in a single request. Search results are grouped, scored, highlighted, and designed for lazy navigation via follow-up queries.</p> <p>Searching is implemented in two layers:</p> <ul> <li>Core search engine \u2013 <code>MusicCollection.search_grouped(...)</code> (in <code>reader.py</code>)</li> <li>UI-facing API \u2013 <code>MusicCollectionUI.search_highlighting(...)</code> (in <code>ui.py</code>)</li> </ul> <p>Most applications should call the UI-facing method.</p>"},{"location":"development/music-collection/reading.html#-entry-points","title":"\ud83d\ude80 Entry points","text":""},{"location":"development/music-collection/reading.html#ui-facing-search-recommended","title":"UI-facing search (recommended)","text":"<pre><code>results = mc_ui.search_highlighting(query, limit=30)\n</code></pre> <p>Returns a single list of result objects, ready for rendering in a UI. Each result object has a <code>type</code> field (<code>artist</code>, <code>album</code>, or <code>track</code>) and includes highlighted text and navigation metadata.</p>"},{"location":"development/music-collection/reading.html#core-grouped-search-lower-level","title":"Core grouped search (lower-level)","text":"<pre><code>grouped, terms = mc.search_grouped(query, limit=20)\n</code></pre> <p>Returns:</p> <ol> <li>A dictionary with three lists: <code>artists</code>, <code>albums</code>, <code>tracks</code></li> <li>The parsed search terms, grouped by category</li> </ol> <p>This method is primarily used internally by the UI layer.</p>"},{"location":"development/music-collection/reading.html#-query-language","title":"\ud83d\udd0e Query language","text":"<p>The query parser recognizes tagged terms and general free-text terms.</p>"},{"location":"development/music-collection/reading.html#supported-tags","title":"Supported tags","text":"Tag Example Meaning <code>artist:</code> <code>artist:Prince</code> Restrict results to a specific artist <code>album:</code> <code>album:\"Purple Rain\"</code> Restrict results to a specific album <code>track:</code> / <code>song:</code> <code>track:\"When Doves Cry\"</code> Restrict results to track titles"},{"location":"development/music-collection/reading.html#free-text-terms","title":"Free-text terms","text":"<p>Any term not prefixed by a tag is treated as free-text and matched against:</p> <ul> <li>artist</li> <li>album</li> <li>track title</li> </ul> <p>Example:</p> <pre><code>love\n</code></pre>"},{"location":"development/music-collection/reading.html#quoting-and-escaping","title":"Quoting and escaping","text":"<ul> <li>Single or double quotes allow multi-word values</li> </ul> <pre><code>artist:\"The Beatles\"\nalbum:'Purple Rain'\n</code></pre> <ul> <li>Backslashes can escape special characters inside quoted values</li> </ul>"},{"location":"development/music-collection/reading.html#-parsed-term-structure","title":"\u2699\ufe0f Parsed term structure","text":"<p>The query is normalized into a dictionary:</p> <pre><code>{\n    \"artist\":  [...],\n    \"album\":   [...],\n    \"track\":   [...],\n    \"general\": [...]\n}\n</code></pre> <p>This structure is returned alongside the search results and reused for:</p> <ul> <li>scoring</li> <li>highlighting</li> <li>UI explanation (\"why did this match?\")</li> </ul>"},{"location":"development/music-collection/reading.html#-search-execution-model","title":"\u26a1 Search execution model","text":""},{"location":"development/music-collection/reading.html#pass-one-candidate-collection","title":"Pass-one candidate collection","text":"<p>The search engine performs a first pass to collect candidates:</p> <ul> <li>Artists are scored by how well they match artist terms</li> <li>Albums are scored by album name and artist context</li> <li>Tracks are scored by title and tag matches</li> </ul> <p>The engine may reuse candidates from the previous search session if the new query is a refinement (e.g. clicking an artist).</p>"},{"location":"development/music-collection/reading.html#scoring-simplified","title":"Scoring (simplified)","text":"<p>Matches are weighted using:</p> <ul> <li>Exact matches</li> <li>Prefix matches</li> <li>Substring matches</li> <li>Tag bonuses (explicit <code>artist:</code>, <code>album:</code>, <code>track:</code>)</li> </ul> <p>This produces ranked candidate sets for artists, albums, and tracks.</p>"},{"location":"development/music-collection/reading.html#performance-optimization","title":"Performance optimization","text":"<p>To minimize database overhead, the search engine batches related queries:</p> <ul> <li>Album counts for all matched artists are fetched in a single query</li> <li>Track counts for all matched albums are fetched in a single query</li> <li>Compilation status for all matched albums is checked in a single query</li> </ul> <p>This reduces the number of database round trips from O(n+m) to O(1), where n is the number of artists and m is the number of albums.</p>"},{"location":"development/music-collection/reading.html#-result-grouping-and-hierarchy","title":"\ud83c\udfd8\ufe0f Result grouping and hierarchy","text":"<p>After scoring, results are assembled into a hierarchical structure:</p> <ul> <li>Artists</li> <li>Albums</li> <li>Tracks</li> </ul> <p>The engine decides which groups to include based on the query:</p> Query type Included sections Free-text only Artists, albums, and tracks <code>artist:</code> present Artists + related albums/tracks <code>album:</code> present Albums + tracks <code>track:</code> present Tracks only"},{"location":"development/music-collection/reading.html#-ui-result-model","title":"\ud83c\udfaf UI result model","text":"<p>The UI layer converts grouped results into a single flat list of result objects via the function <code>search_highlighting</code>.</p> <p>Each object has a <code>type</code> field and a shape appropriate for rendering.</p>"},{"location":"development/music-collection/reading.html#artist-results","title":"Artist results","text":"<pre><code>{\n  \"type\": \"artist\",\n  \"artist\": \"&lt;mark&gt;Prince&lt;/mark&gt;\",\n  \"raw_artist\": \"Prince\",\n  \"reasons\": [\n    { \"type\": \"album\", \"text\": \"3 album(s)\" },\n    { \"type\": \"track\", \"text\": \"12 nummer(s)\" }\n  ],\n  \"load_on_demand\": true,\n  \"clickable\": true,\n  \"click_query\": \"artist:'Prince'\"\n}\n</code></pre> <p>Characteristics:</p> <ul> <li>Summary only (no albums or tracks included)</li> <li>Always lazy-loaded</li> <li>Clicking triggers a new search using <code>click_query</code></li> </ul>"},{"location":"development/music-collection/reading.html#album-results","title":"Album results","text":"<pre><code>{\n  \"type\": \"album\",\n  \"artist\": \"Prince\",\n  \"album\": \"&lt;mark&gt;Purple Rain&lt;/mark&gt;\",\n  \"is_compilation\": false,\n  \"cover\": \"covers/prince_purplerain.jpg\",\n  \"reasons\": [\n    { \"type\": \"track\", \"text\": \"5 nummer(s)\" }\n  ],\n  \"load_on_demand\": true,\n  \"clickable\": true,\n  \"click_query\": \"release_dir:'/Prince/Purple Rain'\"\n}\n</code></pre> <p>Characteristics:</p> <ul> <li>Summary only</li> <li>Tracks are loaded on demand</li> <li>Albums with tracks by more than three artists are shown as \"Various Artists\"</li> <li>Includes <code>cover</code> field with relative URL to cached cover image</li> </ul>"},{"location":"development/music-collection/reading.html#track-results","title":"Track results","text":"<pre><code>{\n  \"type\": \"track\",\n  \"artist\": \"Prince\",\n  \"album\": \"Purple Rain\",\n  \"track\": \"&lt;mark&gt;When Doves Cry&lt;/mark&gt;\",\n  \"duration\": \"5:54\",\n  \"path\": \"Prince/Purple Rain/01 - When Doves Cry.flac\",\n  \"cover\": \"covers/prince_purplerain.jpg\",\n  \"artist_click_query\": \"artist:'Prince'\",\n  \"album_click_query\": \"album:'Purple Rain'\"\n}\n</code></pre> <p>Characteristics:</p> <ul> <li>Fully populated (no lazy loading)</li> <li>Includes navigation queries for artist and album</li> <li>Includes <code>cover</code> field with relative URL to cached cover image</li> </ul>"},{"location":"development/music-collection/reading.html#-cover-art-management","title":"\ud83d\uddbc\ufe0f Cover art management","text":"<p>The music collection provides automatic cover art extraction, caching, and serving with support for size-optimized variants for responsive clients like Android Auto.</p>"},{"location":"development/music-collection/reading.html#basic-cover-retrieval","title":"Basic cover retrieval","text":"<pre><code># Get cover URL for a release directory\ncover_url = mc.get_cover(\"Artist/Album\")\n# Returns: \"covers/artist_album.jpg\" or \"covers/_fallback.jpg\"\n</code></pre> <p>Behavior:</p> <ul> <li>Searches for common cover image files (<code>cover.jpg</code>, <code>folder.jpg</code>, etc.)</li> <li>Extracts embedded artwork from audio files if no standalone image found</li> <li>Optimizes images to max 800\u00d7800px, 85% quality, \u2264500KB</li> <li>Caches extracted covers in <code>DATA_ROOT/cache/covers/</code></li> <li>Returns fallback image if no cover found</li> </ul>"},{"location":"development/music-collection/reading.html#size-optimized-cover-variants","title":"Size-optimized cover variants","text":"<p>For bandwidth-conscious applications (mobile, Android Auto), request specific sizes:</p> <pre><code># Get multiple size variants\ncover_sizes = mc.get_cover_sizes(\"Artist/Album\")\n# Returns:\n# {\n#   \"96x96\": \"covers/artist_album_96x96.jpg\",\n#   \"128x128\": \"covers/artist_album_128x128.jpg\",\n#   \"192x192\": \"covers/artist_album_192x192.jpg\",\n#   \"256x256\": \"covers/artist_album_256x256.jpg\",\n#   \"384x384\": \"covers/artist_album_384x384.jpg\",\n#   \"512x512\": \"covers/artist_album_512x512.jpg\"\n# }\n</code></pre> <p>Behavior:</p> <ul> <li>Generates size variants on-demand (lazy generation)</li> <li>Caches variants permanently for future requests</li> <li>Falls back to main cover if variant generation fails</li> <li>Returns fallback URLs for all sizes if no cover found</li> </ul> <p>Standard sizes:</p> Size Use case Typical file size 96\u00d796 Thumbnails, lists 5-8 KB 128\u00d7128 Small tiles 8-12 KB 192\u00d7192 Medium tiles 15-20 KB 256\u00d7256 Android Auto (optimal) 30-50 KB 384\u00d7384 High-DPI displays 60-90 KB 512\u00d7512 Full-screen player 100-150 KB"},{"location":"development/music-collection/reading.html#flask-api-endpoints","title":"Flask API endpoints","text":"<p>Two routes are available for serving cover images:</p> <p>Direct file serving (existing):</p> <pre><code>GET /covers/&lt;filename&gt;\n</code></pre> <p>Serves cached cover files directly. Used by existing UI code.</p> <p>Size-parameterized API (new):</p> <pre><code>GET /api/covers/&lt;release_dir&gt;?size=256x256\n</code></pre> <p>Serves size-specific cover variants. Generates on-demand if needed.</p> <p>Example usage:</p> <pre><code># Android Auto - request optimal size\nGET /api/covers/Artist%2FAlbum?size=256x256\n\n# Without size parameter - returns main cover\nGET /api/covers/Artist%2FAlbum\n\n# Invalid size - returns error JSON\nGET /api/covers/Artist%2FAlbum?size=999x999\n# {\"error\": \"Invalid size parameter\", \"valid_sizes\": [...]}\n</code></pre>"},{"location":"development/music-collection/reading.html#cover-extraction-details","title":"Cover extraction details","text":"<p>The extraction process follows this priority:</p> <ol> <li>Common image files in release directory:</li> <li><code>cover.jpg</code>, <code>folder.jpg</code>, <code>album.jpg</code>, <code>front.jpg</code></li> <li> <p><code>cover.png</code>, <code>folder.png</code></p> </li> <li> <p>Embedded artwork from audio files:</p> </li> <li>Extracted from first audio file with embedded art</li> <li> <p>Supports all formats handled by TinyTag</p> </li> <li> <p>Optimization:</p> </li> <li>Converts all images to RGB JPEG</li> <li>Resizes to max 800\u00d7800px (maintains aspect ratio)</li> <li>Compresses to 85% quality initially</li> <li>Reduces quality iteratively if file &gt;500KB</li> <li> <p>Handles transparency by compositing on white background</p> </li> <li> <p>Caching:</p> </li> <li>Sanitizes release directory to safe filename slug</li> <li>Stores in <code>DATA_ROOT/cache/covers/{slug}.jpg</code></li> <li>Size variants stored as <code>{slug}_{size}x{size}.jpg</code></li> </ol>"},{"location":"development/music-collection/reading.html#performance-characteristics","title":"Performance characteristics","text":"<p>Storage impact:</p> <ul> <li>Main cover: 300-500 KB per album</li> <li>All 6 size variants: 50-150 KB total per album</li> <li>Lazy generation: variants only created when requested</li> </ul> <p>Bandwidth savings:</p> Client Original (800px) Optimized Savings Android Auto 300-500 KB 30-50 KB (256\u00d7256) ~90% Mobile web 300-500 KB 15-25 KB (128\u00d7128) ~95% List thumbnails 300-500 KB 5-8 KB (96\u00d796) ~98% <p>Generation performance:</p> <ul> <li>First request with variants: +100-200ms (one-time cost)</li> <li>Subsequent requests: 0ms (served from cache)</li> <li>Main cover extraction: typically &lt;100ms</li> </ul>"},{"location":"development/music-collection/reading.html#-lazy-loading","title":"\ud83d\udca4 Lazy loading","text":"<p>Artist and album results include a <code>click_query</code> field.</p> <p>When the user clicks such a result:</p> <ol> <li>The UI issues a new search</li> <li>Using the stored <code>click_query</code></li> <li>Which returns a more specific result set</li> </ol> <p>This keeps the API stateless and avoids nested payloads.</p>"},{"location":"development/music-collection/reading.html#-highlighting","title":"\u2728 Highlighting","text":"<p>All matched terms are automatically highlighted:</p> <ul> <li>Implemented in <code>_highlight_text(...)</code></li> <li>Case-insensitive</li> <li>Wrapped in <code>&lt;mark&gt;...&lt;/mark&gt;</code></li> </ul> <p>Highlighting applies to:</p> <ul> <li>Artist names</li> <li>Album titles</li> <li>Track titles</li> </ul> <p>This behavior is UI-specific and not part of the core search engine.</p>"},{"location":"development/music-collection/reading.html#-match-explanations","title":"\ud83d\udca1 Match explanations","text":"<p>Each result may include a <code>reasons</code> list explaining why it matched:</p> <ul> <li>Matching artist name</li> <li>Number of matching albums</li> <li>Number of matching tracks</li> </ul> <p>These are intended for UI hints, badges, or tooltips.</p>"},{"location":"development/music-collection/reading.html#-realtime-monitoring","title":"\ud83d\udc40 Real\u2011time monitoring","text":"<p><code>MusicCollection.start_monitoring()</code> creates a <code>watchdog.observers.Observer</code> that uses the <code>EnhancedWatcher</code> class (defined in <code>src/musiclib/_watcher.py</code>). The enhanced watcher adds two important behaviours that differ from a na\u00efve <code>FileSystemEventHandler</code>:</p> Feature What it does Why it matters Debounce delay (<code>DEBOUNCE_DELAY = 2.0 s</code>) After the last change to a given file, the watcher waits 2 seconds before queuing an <code>INDEX_FILE</code> or <code>DELETE_FILE</code> event. Prevents a burst of rapid edits (e.g., a tag\u2011editing batch) from generating many separate index operations, which could corrupt the DB. Coalescing Multiple <code>created</code>/<code>modified</code> events for the same path are merged into a single <code>INDEX_FILE</code> event; a later <code>deleted</code> event overrides any pending <code>modified</code> events. Guarantees that the final state of the file is what gets indexed. Graceful shutdown (<code>shutdown()</code> method) Cancels all pending timers and flushes any remaining events to the write queue before the observer is stopped. Ensures no file\u2011system changes are lost when the application exits. <p>The rest of the monitoring flow (observer start/stop, queue \u2192 writer thread) remains exactly as described in the original diagram.</p>"},{"location":"development/music-collection/reading.html#-summary","title":"\ud83d\udcc4 Summary","text":"<p>In short, searching works as follows:</p> <ol> <li>Parse the query into tagged and free-text terms</li> <li>Collect and score artist, album, and track candidates</li> <li>Build hierarchical grouped results</li> <li>Flatten results into UI-friendly objects</li> <li>Highlight matches and attach navigation queries</li> <li>Support lazy exploration through follow-up searches</li> </ol> <p>Cover art management works as follows:</p> <ol> <li>Extract covers from release directories or embedded artwork</li> <li>Optimize and cache at 800\u00d7800px</li> <li>Generate size variants on-demand for bandwidth efficiency</li> <li>Serve via direct file URLs or size-parameterized API</li> <li>Fall back gracefully when covers unavailable</li> </ol> <p>This design allows the UI to deliver a fast, expressive, and navigable search experience without embedding deep hierarchies in a single response, while efficiently serving cover art to clients with varying bandwidth and display requirements.</p>"},{"location":"development/music-collection/reading.html#-api","title":"\ud83d\udd0c API","text":"<p>Only the following methods are considered stable public APIs: <code>MusicCollection.search_grouped</code>, <code>MusicCollectionUI.search_highlighting</code>, <code>MusicCollection.rebuild</code>, <code>MusicCollection.resync</code>, <code>MusicCollection.close</code>, <code>MusicCollection.get_collection_stats</code>, <code>MusicCollection.get_cover</code>, <code>MusicCollection.get_cover_sizes</code>.</p>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection","title":"<code>MusicCollection(music_root, db_path, logger=None)</code>","text":"<p>Manages a music collection database and provides search and detail retrieval functionality. Handles lazy loading, background indexing, and query parsing for artists, albums, and tracks.</p> <p>Initializes a MusicCollection backed by a SQLite database and music root directory. Sets up logging, collection extraction, and schedules any required initial indexing or resync operations.</p> <p>Parameters:</p> Name Type Description Default <code>music_root</code> <code>Path | str</code> <p>The root directory containing the music files to be indexed.</p> required <code>db_path</code> <code>Path | str</code> <p>The path to the SQLite database file used to store collection metadata.</p> required <code>logger</code> <code>Logger</code> <p>Optional logger instance for recording informational and error messages.</p> <code>None</code> <p>Methods:</p> Name Description <code>rebuild</code> <p>Triggers a full rebuild of the music collection database.</p> <code>resync</code> <p>Performs a resync of the music collection database.</p> <code>close</code> <p>Stops monitoring and closes resources associated with the music collection.</p> <code>count</code> <p>Returns the total number of tracks in the music collection database.</p> <code>search_grouped</code> <p>Searches the music collection and returns grouped results by artists, albums, and tracks.</p> <code>get_artist_details</code> <p>Retrieves detailed information about an artist, including their albums and tracks.</p> <code>get_album_details</code> <p>Retrieves detailed information about an album given its release directory.</p> <code>get_track</code> <p>Retrieves metadata for a single track identified by its path.</p> <code>get_cover</code> <p>Retrieves or generates the cover image path for a given album release directory.</p> <code>get_cover_sizes</code> <p>Returns URLs for multiple size variants of a cover image.</p> <code>get_collection_stats</code> <p>Returns high-level statistics about the music collection.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def __init__(\n    self, music_root: Path | str, db_path: Path | str, logger: Logger = None\n) -&gt; None:\n    \"\"\"Initializes a MusicCollection backed by a SQLite database and music root directory.\n    Sets up logging, collection extraction, and schedules any required initial indexing or resync operations.\n\n    Args:\n        music_root: The root directory containing the music files to be indexed.\n        db_path: The path to the SQLite database file used to store collection metadata.\n        logger: Optional logger instance for recording informational and error messages.\n    \"\"\"\n    self.music_root = Path(music_root).resolve()\n    self.db_path = Path(db_path)\n    self._logger = logger or NullLogger()\n    self._extractor = CollectionExtractor(self.music_root, self.db_path, logger=logger)\n\n    track_count = self.count()\n    self._startup_mode = \"rebuild\" if track_count == 0 else \"resync\"\n    self._logger.info(\n        \"No tracks in DB \u2014 scheduling initial rebuild\"\n        if track_count == 0\n        else \"Start resync of DB\"\n    )\n\n    self._background_task_running = False\n    self._extractor.start_monitoring()\n    self._start_background_startup_job()\n    if track_count == 0:\n        self._extractor.wait_for_indexing_start()\n\n    self._last_search_session: SearchSession | None = None\n\n    self.covers_dir = self.db_path.parent / \"cache\" / \"covers\"\n    self.covers_dir.mkdir(parents=True, exist_ok=True)\n    self._setup_fallback_cover()\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.rebuild","title":"<code>rebuild()</code>","text":"<p>Triggers a full rebuild of the music collection database. Rebuilds the database from scratch using the current music files.</p> <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def rebuild(self) -&gt; None:\n    \"\"\"Triggers a full rebuild of the music collection database.\n    Rebuilds the database from scratch using the current music files.\n\n    Returns:\n        None\n    \"\"\"\n    self._extractor.rebuild()\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.resync","title":"<code>resync()</code>","text":"<p>Performs a resync of the music collection database. Updates the database to reflect changes in the music files without a full rebuild.</p> <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def resync(self) -&gt; None:\n    \"\"\"Performs a resync of the music collection database.\n    Updates the database to reflect changes in the music files without a full rebuild.\n\n    Returns:\n        None\n    \"\"\"\n    self._extractor.resync()\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.close","title":"<code>close()</code>","text":"<p>Stops monitoring and closes resources associated with the music collection. Cleans up background tasks and releases any held resources.</p> <p>Returns:</p> Type Description <code>None</code> <p>None</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def close(self) -&gt; None:\n    \"\"\"Stops monitoring and closes resources associated with the music collection.\n    Cleans up background tasks and releases any held resources.\n\n    Returns:\n        None\n    \"\"\"\n    self._extractor.stop()\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.count","title":"<code>count()</code>","text":"<p>Returns the total number of tracks in the music collection database. Executes a query to count all tracks currently indexed.</p> <p>Returns:</p> Name Type Description <code>int</code> <code>int</code> <p>The number of tracks in the database.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def count(self) -&gt; int:\n    \"\"\"Returns the total number of tracks in the music collection database.\n    Executes a query to count all tracks currently indexed.\n\n    Returns:\n        int: The number of tracks in the database.\n    \"\"\"\n    with self._get_conn() as conn:\n        return conn.execute(\"SELECT COUNT(*) FROM tracks\").fetchone()[0]\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.search_grouped","title":"<code>search_grouped(query, limit=30)</code>","text":"<p>Searches the music collection and returns grouped results by artists, albums, and tracks. Also returns the parsed terms for highlighting.</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>The search query string.</p> required <code>limit</code> <code>int</code> <p>Maximum number of results to return per group.</p> <code>30</code> <p>Returns:</p> Type Description <code>tuple[dict, dict]</code> <p>tuple[dict, dict]: A tuple of (grouped results, parsed terms).</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def search_grouped(self, query: str, limit: int = 30) -&gt; tuple[dict, dict]:\n    \"\"\"Searches the music collection and returns grouped results by artists, albums, and tracks.\n    Also returns the parsed terms for highlighting.\n\n    Args:\n        query: The search query string.\n        limit: Maximum number of results to return per group.\n\n    Returns:\n        tuple[dict, dict]: A tuple of (grouped results, parsed terms).\n    \"\"\"\n    if not query.strip():\n        return {\"artists\": [], \"albums\": [], \"tracks\": []}, {}\n\n    terms = self._parse_query(query)\n    has_artist = bool(terms[\"artist\"])\n    has_album = bool(terms[\"album\"])\n    is_free_text = not has_artist and not has_album and not terms[\"track\"]\n\n    reuse_session = self._last_search_session\n    can_reuse = self._can_reuse_session(reuse_session, query, terms)\n\n    if can_reuse:\n        artist_candidates, album_candidates, track_candidates = (\n            self._collect_pass_two_candidates(\n                reuse_session=reuse_session,\n                terms=terms,\n                has_artist=has_artist,\n                has_album=has_album,\n                is_free_text=is_free_text,\n            )\n        )\n    else:\n        artist_candidates, album_candidates, track_candidates = (\n            self._collect_pass_one_candidates(\n                terms=terms,\n                limit=limit,\n                has_artist=has_artist,\n                has_album=has_album,\n                is_free_text=is_free_text,\n            )\n        )\n\n    grouped = self._build_hierarchical_results(\n        artist_candidates=artist_candidates,\n        album_candidates=album_candidates,\n        track_candidates=track_candidates,\n        limit=limit,\n    )\n\n    self._last_search_session = SearchSession(\n        query=query,\n        terms=terms,\n        artist_candidates=artist_candidates,\n        album_candidates=album_candidates,\n        track_candidates=track_candidates,\n        timestamp=time(),\n    )\n\n    return grouped, terms\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.get_artist_details","title":"<code>get_artist_details(artist)</code>","text":"<p>Retrieves detailed information about an artist, including their albums and tracks. Returns a dictionary with the artist name and a list of albums containing track details.</p> <p>Parameters:</p> Name Type Description Default <code>artist</code> <code>str</code> <p>The name of the artist to retrieve details for.</p> required <p>Returns:</p> Name Type Description <code>dict</code> <code>dict</code> <p>Dictionary containing the artist name and a list of albums with track information.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_artist_details(self, artist: str) -&gt; dict:\n    \"\"\"Retrieves detailed information about an artist, including their albums and tracks.\n    Returns a dictionary with the artist name and a list of albums containing track details.\n\n    Args:\n        artist: The name of the artist to retrieve details for.\n\n    Returns:\n        dict: Dictionary containing the artist name and a list of albums with track information.\n    \"\"\"\n    with self._get_conn() as conn:\n        cur = conn.execute(\n            \"\"\"\n            SELECT album, title, path, filename, duration, disc_number, track_number\n            FROM tracks\n            WHERE artist = ?\n            ORDER BY album COLLATE NOCASE, disc_number, track_number, title COLLATE NOCASE\n            \"\"\",\n            (artist,),\n        )\n        releases_map = defaultdict(list)\n        for row in cur:\n            release_dir = self._get_release_dir(row[\"path\"])\n            releases_map[release_dir].append(\n                self._build_track_dict(row, artist=artist, album=row[\"album\"])\n            )\n\n        albums = []\n        for release_dir, tracks in sorted(\n            releases_map.items(),\n            key=lambda x: x[1][0].get(\"album\", \"\") if x[1] else \"\",\n        ):\n            album_name = (\n                tracks[0].get(\"album\", \"Unknown Album\")\n                if tracks\n                else \"Unknown Album\"\n            )\n            album_cover = self.get_cover(release_dir)\n\n            # Check if this is a compilation album\n            is_compilation = self._is_compilation_album(release_dir)\n\n            albums.append(\n                {\n                    \"album\": album_name,\n                    \"cover\": album_cover,\n                    \"tracks\": tracks,\n                    \"release_dir\": release_dir,\n                    \"is_compilation\": is_compilation,\n                }\n            )\n\n        return {\"artist\": artist, \"albums\": albums}\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.get_album_details","title":"<code>get_album_details(release_dir)</code>","text":"<p>Retrieves detailed information about an album given its release directory. Returns a dictionary with album details, including artist, tracks, compilation status, and release directory.</p> <p>Parameters:</p> Name Type Description Default <code>release_dir</code> <code>str</code> <p>The release directory relative to the music root.</p> required <p>Returns:</p> Name Type Description <code>dict</code> <code>dict</code> <p>Dictionary containing album details, track list, and compilation status.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_album_details(self, release_dir: str) -&gt; dict:\n    \"\"\"Retrieves detailed information about an album given its release directory.\n    Returns a dictionary with album details, including artist, tracks, compilation status, and release directory.\n\n    Args:\n        release_dir: The release directory relative to the music root.\n\n    Returns:\n        dict: Dictionary containing album details, track list, and compilation status.\n    \"\"\"\n    # Construct the expected directory pattern with trailing slash\n    expected_dir = release_dir if release_dir.endswith(\"/\") else f\"{release_dir}/\"\n\n    with self._get_conn() as conn:\n        cur = conn.execute(\n            f\"\"\"\n            SELECT artist, title, path, filename, duration, album\n            FROM tracks\n            WHERE {self._sql_release_dir_expr()} = ?\n            ORDER BY disc_number, track_number, title COLLATE NOCASE\n            \"\"\",\n            (expected_dir,),\n        )\n        rows = cur.fetchall()\n\n        if not rows:\n            return {\n                \"artist\": \"\",\n                \"album\": \"\",\n                \"tracks\": [],\n                \"is_compilation\": False,\n                \"release_dir\": release_dir,\n            }\n\n        # Album name from first row\n        album_name = rows[0][\"album\"] or \"Unknown Album\"\n\n        # Build track list\n        track_list = [self._build_track_dict(row) for row in rows]\n\n        # Detect compilation\n        artists = {t[\"artist\"] for t in track_list if t[\"artist\"]}\n        is_compilation = len(artists) &gt; 3\n        display_artist = (\n            \"Various Artists\" if is_compilation else next(iter(artists))\n        )\n\n        return {\n            \"artist\": display_artist,\n            \"album\": album_name,\n            \"tracks\": track_list,\n            \"is_compilation\": is_compilation,\n            \"release_dir\": release_dir,\n        }\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.get_track","title":"<code>get_track(path)</code>","text":"<p>Retrieves metadata for a single track identified by its path.</p> <p>Queries the music library database for the track and returns a normalized metadata dictionary if found.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>Path</code> <p>The full or relative path of the track to look up.</p> required <p>Returns:</p> Type Description <code>dict | None</code> <p>dict | None: A dictionary of track metadata if the track exists, otherwise None.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_track(self, path: Path) -&gt; dict | None:\n    \"\"\"Retrieves metadata for a single track identified by its path.\n\n    Queries the music library database for the track and returns a normalized metadata dictionary if found.\n\n    Args:\n        path: The full or relative path of the track to look up.\n\n    Returns:\n        dict | None: A dictionary of track metadata if the track exists, otherwise None.\n    \"\"\"\n    with self._get_conn() as conn:\n        cur = conn.execute(\n            \"\"\"\n            SELECT path, filename, artist, album, title, albumartist, track_number, disc_number, duration, mtime\n            FROM tracks\n            WHERE path = ?\n            \"\"\",\n            (str(path),),\n        )\n        if rows := cur.fetchall():\n            track = rows[0]\n            # Get the release directory to fetch the cover\n            release_dir = self._get_release_dir(track[\"path\"])\n\n            return {\n                \"path\": Path(path),\n                \"filename\": track[\"filename\"],\n                \"artist\": track[\"artist\"],\n                \"album\": track[\"album\"],\n                \"track\": track[\"title\"],\n                \"albumartist\": track[\"albumartist\"],\n                \"track_number\": track[\"track_number\"],\n                \"disc_number\": track[\"disc_number\"],\n                \"duration\": self._format_duration(track[\"duration\"]),\n                \"time_added\": track[\"mtime\"],\n                \"cover\": self.get_cover(release_dir),\n            }\n        else:\n            return None\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.get_cover","title":"<code>get_cover(release_dir)</code>","text":"<p>Retrieves or generates the cover image path for a given album release directory. Returns a relative path to a cached or newly extracted cover image if available, or a fallback image path if no cover is found.</p> <p>Parameters:</p> Name Type Description Default <code>release_dir</code> <code>str</code> <p>The release directory identifier used to locate or derive the cover image.</p> required <p>Returns:</p> Type Description <code>str | None</code> <p>str | None: Relative path to the cover image within the covers directory, or fallback image path if not found.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_cover(self, release_dir: str) -&gt; str | None:\n    \"\"\"Retrieves or generates the cover image path for a given album release directory.\n    Returns a relative path to a cached or newly extracted cover image if available,\n    or a fallback image path if no cover is found.\n\n    Args:\n        release_dir: The release directory identifier used to locate or derive the cover image.\n\n    Returns:\n        str | None: Relative path to the cover image within the covers directory, or fallback image path if not found.\n    \"\"\"\n    if not release_dir:\n        return \"covers/_fallback.jpg\"\n\n    # Sanitize to a safe filename slug\n    slug = self._sanitize_release_dir(release_dir)\n    cover_path = self.covers_dir / f\"{slug}.jpg\"\n\n    if cover_path.exists():\n        return f\"covers/{slug}.jpg\"\n\n    # Extract on demand\n    if self._extract_cover(release_dir, cover_path):\n        return f\"covers/{slug}.jpg\"\n\n    return \"covers/_fallback.jpg\"\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.get_cover_sizes","title":"<code>get_cover_sizes(release_dir)</code>","text":"<p>Returns URLs for multiple size variants of a cover image. Generates size variants on-demand if not already cached.</p> <p>Parameters:</p> Name Type Description Default <code>release_dir</code> <code>str</code> <p>The release directory identifier for which to retrieve cover variants.</p> required <p>Returns:</p> Type Description <code>dict[str, str]</code> <p>dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to relative URL paths.</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_cover_sizes(self, release_dir: str) -&gt; dict[str, str]:\n    \"\"\"Returns URLs for multiple size variants of a cover image.\n    Generates size variants on-demand if not already cached.\n\n    Args:\n        release_dir: The release directory identifier for which to retrieve cover variants.\n\n    Returns:\n        dict[str, str]: Dictionary mapping size strings (e.g., \"96x96\") to relative URL paths.\n    \"\"\"\n    if not release_dir:\n        sizes = [96, 128, 192, 256, 384, 512]\n        return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    slug = self._sanitize_release_dir(release_dir)\n    sizes = [96, 128, 192, 256, 384, 512]\n\n    # Ensure main cover exists first\n    main_path = self.covers_dir / f\"{slug}.jpg\"\n    if not main_path.exists() and not self._extract_cover(release_dir, main_path):\n        return {f\"{s}x{s}\": \"covers/_fallback.jpg\" for s in sizes}\n\n    # Check if variants exist, generate if needed\n    variants_exist = all(\n        (self.covers_dir / f\"{slug}_{s}x{s}.jpg\").exists() for s in sizes\n    )\n\n    if not variants_exist:\n        self._generate_cover_variants(release_dir, slug)\n\n    # Build URL dictionary\n    result = {}\n    for size in sizes:\n        variant_path = self.covers_dir / f\"{slug}_{size}x{size}.jpg\"\n        if variant_path.exists():\n            result[f\"{size}x{size}\"] = f\"covers/{slug}_{size}x{size}.jpg\"\n        else:\n            # Fallback to main cover if variant doesn't exist\n            result[f\"{size}x{size}\"] = f\"covers/{slug}.jpg\"\n\n    return result\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.reader.MusicCollection.get_collection_stats","title":"<code>get_collection_stats()</code>","text":"<p>Returns high-level statistics about the music collection.</p> <p>This method queries the tracks table to compute aggregate counts of distinct artists, distinct artist/album combinations, total tracks, and the timestamp of the most recently added track.</p> <p>Returns:</p> Name Type Description <code>dict</code> <code>dict</code> <p>A dictionary containing <code>qty_tracks</code>, <code>qty_artists</code>,</p> <code>dict</code> <p><code>qty_albums</code>, and <code>last_added</code> (or None when no tracks exist).</p> Source code in <code>src/musiclib/reader.py</code> <pre><code>def get_collection_stats(self) -&gt; dict:\n    \"\"\"Returns high-level statistics about the music collection.\n\n    This method queries the tracks table to compute aggregate counts of\n    distinct artists, distinct artist/album combinations, total tracks, and\n    the timestamp of the most recently added track.\n\n    Returns:\n        dict: A dictionary containing ``qty_tracks``, ``qty_artists``,\n        ``qty_albums``, and ``last_added`` (or None when no tracks exist).\n    \"\"\"\n    with self._get_conn() as conn:\n        cur = conn.execute(\n            \"\"\"\n            SELECT COUNT(DISTINCT artist) as qty_artists,\n                COUNT(DISTINCT artist || album) as qty_albums,\n                COUNT(*) AS qty_tracks,\n                SUM(duration) AS total_duration,\n                MAX(mtime) AS time_lastadded\n            FROM tracks\n            \"\"\"\n        )\n        if rows := cur.fetchall():\n            return {\n                    \"num_tracks\": rows[0][\"qty_tracks\"],\n                    \"num_artists\": rows[0][\"qty_artists\"],\n                    \"num_albums\": rows[0][\"qty_albums\"],\n                    \"total_duration\": rows[0][\"total_duration\"],\n                    \"last_added\": rows[0][\"time_lastadded\"],\n                }\n        else:\n            return {\n                \"num_tracks\": 0,\n                \"num_artists\": 0,\n                \"num_albums\": 0,\n                \"total_duration\": 0,\n                \"last_added\": None,\n            }\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.ui.MusicCollectionUI","title":"<code>MusicCollectionUI(music_root, db_path, logger=None)</code>","text":"<p>               Bases: <code>MusicCollection</code></p> <p>Extends MusicCollection to provide UI-specific search and highlighting features. Adds methods for formatting, escaping, and highlighting search results for user interfaces.</p> <p>Initializes the MusicCollectionUI with the given music root, database path, and optional logger. Sets up the UI-specific extension of the music collection functionality.</p> <p>Parameters:</p> Name Type Description Default <code>music_root</code> <code>Path</code> <p>Path to the root directory containing music files.</p> required <code>db_path</code> <code>Path</code> <p>Path to the SQLite database file.</p> required <code>logger</code> <code>Logger</code> <p>Optional logger instance.</p> <code>None</code> <p>Returns:</p> Type Description <code>None</code> <p>None</p> <p>Methods:</p> Name Description <code>search_highlighting</code> <p>Performs a search and returns results with highlighted matching terms for UI display.</p> Source code in <code>src/musiclib/ui.py</code> <pre><code>def __init__(self, music_root: Path, db_path: Path, logger: Logger = None) -&gt; None:\n    \"\"\"Initializes the MusicCollectionUI with the given music root, database path, and optional logger.\n    Sets up the UI-specific extension of the music collection functionality.\n\n    Args:\n        music_root: Path to the root directory containing music files.\n        db_path: Path to the SQLite database file.\n        logger: Optional logger instance.\n\n    Returns:\n        None\n    \"\"\"\n    super().__init__(music_root, db_path, logger)\n</code></pre>"},{"location":"development/music-collection/reading.html#src.musiclib.ui.MusicCollectionUI.search_highlighting","title":"<code>search_highlighting(query, limit=30)</code>","text":"<p>Performs a search and returns results with highlighted matching terms for UI display. Groups and highlights artists, albums, and tracks based on the search query and terms.</p> <p>Parameters:</p> Name Type Description Default <code>query</code> <code>str</code> <p>The search query string.</p> required <code>limit</code> <code>int</code> <p>Maximum number of results to return.</p> <code>30</code> <p>Returns:</p> Type Description <code>list[dict]</code> <p>list[dict]: List of dictionaries containing highlighted search results for artists, albums, and tracks.</p> Source code in <code>src/musiclib/ui.py</code> <pre><code>def search_highlighting(self, query: str, limit: int = 30) -&gt; list[dict]:\n    \"\"\"Performs a search and returns results with highlighted matching terms for UI display.\n    Groups and highlights artists, albums, and tracks based on the search query and terms.\n\n    Args:\n        query: The search query string.\n        limit: Maximum number of results to return.\n\n    Returns:\n        list[dict]: List of dictionaries containing highlighted search results for artists, albums, and tracks.\n    \"\"\"\n    if not query.strip():\n        return []\n\n    grouped, terms = self.search_grouped(query, limit=limit)\n\n    # Combine all search terms for highlighting\n    all_terms = (\n        terms.get(\"artist\", [])\n        + terms.get(\"album\", [])\n        + terms.get(\"track\", [])\n        + terms.get(\"general\", [])\n    )\n    query_lower = query.lower()\n\n    # Apply strict filtering for tagged searches\n    filter_artists, filter_albums = self._should_filter_strict(terms)\n    if filter_artists:\n        grouped[\"artists\"] = []\n    if filter_albums:\n        grouped[\"albums\"] = []\n\n    results = []\n\n    # Process artists\n    for artist in grouped[\"artists\"]:\n        if artist_result := self._process_artist_result(\n            artist, terms, all_terms, query_lower\n        ):\n            results.append(artist_result)\n\n    # Process albums\n    for album in grouped[\"albums\"]:\n        if album_result := self._process_album_result(\n            album, terms, all_terms, query_lower\n        ):\n            results.append(album_result)\n\n    # Process tracks\n    for track in grouped[\"tracks\"]:\n        track_result = self._process_track_result(track, all_terms)\n        results.append(track_result)\n\n    return results\n</code></pre>"},{"location":"development/web-application/flask-app.html","title":"Flask App Structure","text":""},{"location":"development/web-application/flask-app.html#app","title":"App","text":"<p>The file <code>app.py</code> defines the main Flask application for the \"mixtape-society\" project. It is responsible for initializing the web server, configuring the application based on the environment, setting up core services (such as music collection management), and registering routes and blueprints for handling various web requests. The file serves as the entry point for the application, orchestrating authentication, static file serving, and integration with modular route handlers.</p>"},{"location":"development/web-application/flask-app.html#-highlevel-architecture","title":"\ud83c\udfdb\ufe0f High\u2011Level Architecture","text":"<p>Flask App (<code>create_app() \u2192 Flask()</code>)</p> Core Services Blueprints MusicCollectionUI auth MixtapeManager browser AudioCache play Logger editor Config (BaseConfig) og_cover <p>All routes are mounted under the appropriate URL prefixes (<code>/auth</code>, <code>/mixtapes</code>, <code>/play</code>, <code>/editor</code>, <code>/og</code>).</p>"},{"location":"development/web-application/flask-app.html#-configuration--environment-selection","title":"\u2699\ufe0f Configuration &amp; Environment Selection","text":"<p><code>app.py</code> determines the configuration class based on the <code>APP_ENV</code> environment variable:</p> <code>APP_ENV</code> value Config class used Typical purpose development DevelopmentConfig Local dev with verbose logging, SQLite DB in <code>data/dev</code>. test TestConfig CI / automated tests (in-memory DB). production ProductionConfig Deployed instance (read-only DB, stricter limits). unset DevelopmentConfig Default fallback. <p>The selected class is instantiated, its <code>ensure_dirs()</code> method creates required directories (<code>MIXTAPE_DIR</code>, <code>CACHE_DIR</code>, <code>LOGS</code>, etc.), and the instance is returned from <code>get_configuration()</code>.</p>"},{"location":"development/web-application/flask-app.html#-flask-application-creation-create_app--stepbystep","title":"\u2697\ufe0f Flask Application Creation (create_app) \u2013 Step\u2011by\u2011Step","text":"<ol> <li>Instantiate Flask</li> </ol> <pre><code>app = Flask(__name__)\napp.secret_key = config_cls.PASSWORD\napp.config.from_object(config_cls)\nCORS(app)  # adds Access\u2011Control\u2011Allow\u2011Origin: *\n</code></pre> <ol> <li>Rate limiting \u2013 flask_limiter with defaults <code>1000/day</code> and <code>300/hour</code>.</li> <li>Logging \u2013 Calls <code>logger_setup(config)</code> (creates <code>logs/app.log</code>), then mirrors Gunicorn\u2019s logger if running under Gunicorn.</li> <li>Core services<ul> <li><code>MusicCollectionUI</code> \u2013 watches the music root, builds the SQLite FTS5 DB, and exposes search/high\u2011level APIs.</li> <li><code>AudioCache</code> \u2013 instantiated with <code>app.config[\"AUDIO_CACHE_DIR\"]</code>. Stored on <code>app.audio_cache</code> for later blueprint access.</li> <li><code>MixtapeManager</code> \u2013 points at <code>config_cls.MIXTAPE_DIR</code> and receives the collection instance.</li> </ul> </li> <li>Error handler \u2013 Catches <code>DatabaseCorruptionError</code> and returns either JSON (for AJAX) or a rendered <code>database_error.html</code>.</li> <li><code>@app.before_request</code> \u2013 Checks whether an indexing job (<code>rebuilding</code> / <code>resyncing</code>) is in progress; if so, renders <code>indexing.html</code> for authenticated users.</li> <li>Route definitions \u2013 Landing page, indexing\u2011status JSON, collection\u2011stats JSON, resync trigger, robots.txt, cover serving, DB reset, health check.</li> <li>Context processors \u2013 Inject <code>app_version</code>, <code>now</code> (UTC), <code>is_authenticated</code>, and <code>is_indexing</code> into every template.</li> <li>Jinja filter \u2013 <code>to_datetime</code> parses ISO strings or custom formats for display.</li> <li>Blueprint registration \u2013 Auth, Browser, Play, Editor, OG Cover are attached with their respective URL prefixes.</li> <li>Return \u2013 The fully configured <code>app</code> object.</li> </ol>"},{"location":"development/web-application/flask-app.html#-core-services--dependency-wiring","title":"\ud83d\udd0c Core Services &amp; Dependency Wiring","text":"Service Construction Primary responsibilities MusicCollectionUI (<code>musiclib</code>) <code>MusicCollectionUI(music_root=config_cls.MUSIC_ROOT, db_path=config_cls.DB_PATH, logger=logger)</code> Scans the music folder, builds an SQLite DB with FTS5, provides <code>search_highlighting</code>, <code>get_artist_details</code>, <code>get_album_details</code>, <code>get_cover</code>, <code>count</code>, <code>get_collection_stats</code>. AudioCache (<code>audio_cache</code>) <code>AudioCache(cache_dir=app.config[\"AUDIO_CACHE_DIR\"], logger=logger)</code> Stores transcoded audio files, provides progress tracking via <code>ProgressTracker</code>. MixtapeManager (<code>mixtape_manager</code>) <code>MixtapeManager(path_mixtapes=config_cls.MIXTAPE_DIR, collection=collection)</code> Persists mixtape JSON files, handles slug generation, cover processing, and deletion. Logger <code>get_logger(name=__name__)</code> (via <code>logtools</code>) Centralised structured logging (<code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>). <p>All services are singletons attached to the Flask app (or passed explicitly to blueprints) so that they share the same DB connections and caches.</p>"},{"location":"development/web-application/flask-app.html#-error-handling-database-corruption","title":"\u26a0\ufe0f Error Handling (Database Corruption)","text":"<pre><code>@app.errorhandler(DatabaseCorruptionError)\ndef handle_database_corruption(e):\n    logger.error(f\"Database corruption detected: {e}\")\n\n    # Detect AJAX request\n    is_ajax = (\n        request.headers.get('X-Requested-With') == 'XMLHttpRequest' or\n        request.headers.get('Accept', '').startswith('application/json') or\n        request.is_json\n    )\n\n    if is_ajax:\n        return jsonify({\n            \"error\": \"database_corrupted\",\n            \"message\": \"The music library database needs to be rebuilt.\",\n            \"requires_reset\": True\n        }), 500\n    else:\n        return render_template('database_error.html'), 500\n</code></pre> <p>If the request is AJAX (or <code>Accept: application/json</code>), a JSON payload is returned; otherwise the user sees a friendly <code>database_error.html</code> page.</p>"},{"location":"development/web-application/flask-app.html#-requestlevel-hooks","title":"\ud83d\udd17 Request\u2011Level Hooks","text":""},{"location":"development/web-application/flask-app.html#indexing-guard-check_indexing_before_request","title":"Indexing Guard (<code>check_indexing_before_request</code>)","text":"<p>Runs before every request (except static assets, <code>/play</code>, <code>/indexing-status</code>, <code>/check-database-health</code>).</p> <ul> <li>If the user is authenticated and the indexing status file (<code>indexing_status.json</code>) reports <code>rebuilding</code> or <code>resyncing</code>, the request is short\u2011circuited to <code>indexing.html</code>.</li> </ul>"},{"location":"development/web-application/flask-app.html#authentication-check_auth","title":"Authentication (<code>check_auth</code>)","text":"<p>Used by the guard and by the <code>@require_auth</code> decorator.</p> <ul> <li>If the user is not authenticated, the guard does nothing (letting the view decide whether to redirect)</li> </ul>"},{"location":"development/web-application/flask-app.html#-public-routes","title":"\ud83c\udf10 Public Routes","text":"Route Method Description <code>/</code> GET Landing page (<code>landing.html</code>). If indexing is active \u2192 <code>indexing.html</code>. If authenticated \u2192 redirect to <code>/mixtapes</code>. <code>/indexing-status</code> GET (exempt from rate limiting) Returns JSON with current indexing progress (used by the front-end polling). <code>/collection-stats</code> GET (auth) Returns JSON with <code>num_artists</code>, <code>num_albums</code>, <code>num_tracks</code>, <code>total_duration</code>, <code>last_added</code>. <code>/resync</code> POST (auth) Starts a background resync of the music library (spawns a daemon thread). Returns <code>{ success: true }</code> or an error. <code>/robots.txt</code> GET Disallows all crawlers (<code>User-agent: *\\nDisallow: /</code>). <code>/covers/&lt;filename&gt;</code> GET Serves cached album cover images from <code>DATA_ROOT/cache/covers</code>. Only <code>.jpg</code>/<code>.jpeg</code>/<code>.png</code> are allowed (security). <code>/reset-database</code> POST (auth) Deletes the SQLite DB files (<code>*.db</code>, <code>*-wal</code>, <code>*-shm</code>, <code>*-journal</code>), recreates the <code>MusicCollectionUI</code> (triggers a rebuild), and returns a JSON summary. <code>/check-database-health</code> GET (auth) Runs a quick <code>PRAGMA quick_check</code> on the DB and returns <code>{ healthy: true/false, error?, requires_reset? }</code>. Used by the front-end health monitor."},{"location":"development/web-application/flask-app.html#-template-context-processors","title":"\ud83c\udfa8 Template Context Processors","text":"Processor Injected Variable Use Cases <code>inject_version</code> <code>app_version</code> (from <code>utils.get_version()</code>) Displayed in the footer (<code>vX.Y.Z</code>). <code>inject_now</code> <code>now</code> (UTC datetime) Used for timestamps in templates (<code>{{ now }}</code>). <code>inject_auth_status</code> <code>is_authenticated</code> (bool) Conditional UI (login/logout links). <code>inject_indexing_status</code> <code>is_indexing</code> (bool) Disables UI elements while indexing runs. <p>These variables are available in every template without needing to pass them explicitly.</p>"},{"location":"development/web-application/flask-app.html#-jinja-filter--to_datetime","title":"\u23f3 Jinja Filter \u2013 <code>to_datetime</code>","text":"<pre><code>@app.template_filter(\"to_datetime\")\ndef to_datetime_filter(s, fmt=\"%Y-%m-%d %H:%M:%S\"):\n    if not s:\n        return None\n    try:\n        return datetime.strptime(s, fmt)\n    except ValueError:\n        return datetime.fromisoformat(s.replace(\"Z\", \"+00:00\"))\n</code></pre> <p>Converts a string timestamp (custom format or ISO\u20118601) into a <code>datetime</code> object for formatting (<code>{{ ts|to_datetime(\"%b %d, %Y\") }}</code>).</p>"},{"location":"development/web-application/flask-app.html#-blueprint-registration","title":"\ud83d\udcdc Blueprint Registration","text":"<pre><code>app.register_blueprint(\n    create_authentication_blueprint(logger=logger, limiter=limiter),\n    url_prefix=\"/auth\",\n)\napp.register_blueprint(\n    create_browser_blueprint(\n        mixtape_manager=mixtape_manager,\n        func_processing_status=get_indexing_status,\n        logger=logger,\n    ),\n    url_prefix=\"/mixtapes\",\n)\napp.register_blueprint(\n    create_play_blueprint(\n        mixtape_manager=mixtape_manager,\n        path_audio_cache=app.config[\"AUDIO_CACHE_DIR\"],\n        logger=logger,\n    ),\n    url_prefix=\"/play\",\n)\napp.register_blueprint(\n    create_editor_blueprint(collection=collection, logger=logger),\n    url_prefix=\"/editor\",\n)\napp.register_blueprint(\n    create_og_cover_blueprint(\n        path_logo=Path(__file__).parent / \"static\" / \"images\" / \"logo.svg\", logger=logger\n    ),\n    url_prefix=\"/og\",\n)\n</code></pre> <p>Each blueprint lives in <code>routes/</code> and encapsulates a coherent feature set (authentication, browsing, playback, editing, Open\u2011Graph cover generation).</p>"},{"location":"development/web-application/flask-app.html#-application-runner","title":"\ud83c\udfc3\u200d\u2642\ufe0f Application Runner","text":"<pre><code>def serve(debug: bool = True) -&gt; None:\n    app = create_app()\n    app.run(debug=debug, use_reloader=False, host=\"0.0.0.0\", port=5000)\n\nif __name__ == \"__main__\":\n    serve(debug=True)\n</code></pre> <p>Running python <code>app.py</code> starts the development server on port\u202f5000 (accessible from any interface). In production you would typically use Gunicorn or another WSGI server.</p>"},{"location":"development/web-application/flask-app.html#-base-layout-basehtml","title":"\ud83d\uddc2\ufe0f Base Layout (<code>base.html</code>)","text":"<p><code>base.html</code> is the master template that all pages extend. It defines the global UI skeleton, navigation, theme handling, and reusable modals/toasts.</p>"},{"location":"development/web-application/flask-app.html#html-skeleton--meta-tags","title":"HTML Skeleton &amp; Meta Tags","text":"<pre><code>&lt;!doctype html&gt;\n&lt;html lang=\"en\" data-bs-theme=\"auto\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n    &lt;title&gt;{% block title %}Mixtape Society{% endblock %}&lt;/title&gt;\n\n    &lt;!-- Bootstrap CSS + Icons --&gt;\n    &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\"&gt;\n    &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\"&gt;\n\n    &lt;!-- Custom CSS (global + theme) --&gt;\n    &lt;link href=\"{{ url_for('static', filename='css/base.css') }}\" rel=\"stylesheet\"&gt;\n    {% block extra_css %}{% endblock %}\n&lt;/head&gt;\n&lt;body class=\"{% if is_authenticated %}authenticated{% endif %}\"&gt;\n</code></pre> <p>The <code>data-bs-theme=\"auto\"</code> attribute enables Bootstrap\u2019s built\u2011in dark\u2011mode auto\u2011switching (controlled by the Theme Switcher JS).</p>"},{"location":"development/web-application/flask-app.html#navigation-bar","title":"Navigation Bar","text":"<pre><code>&lt;nav class=\"navbar navbar-expand-lg navbar-dark bg-dark sticky-top\"&gt;\n    &lt;div class=\"container-fluid\"&gt;\n        &lt;a class=\"navbar-brand\" href=\"{{ url_for('landing') }}\"&gt;\n            &lt;i class=\"bi bi-music-note-beamed me-2\"&gt;&lt;/i&gt;Mixtape Society\n        &lt;/a&gt;\n\n        &lt;!-- Theme switcher (buttons with data-theme attributes) --&gt;\n        &lt;div class=\"d-flex align-items-center\"&gt;\n            &lt;button class=\"btn btn-sm btn-outline-light me-2\" data-theme=\"light\"&gt;\n                &lt;i class=\"bi bi-sun\"&gt;&lt;/i&gt;\n            &lt;/button&gt;\n            &lt;button class=\"btn btn-sm btn-outline-light me-2\" data-theme=\"dark\"&gt;\n                &lt;i class=\"bi bi-moon-stars\"&gt;&lt;/i&gt;\n            &lt;/button&gt;\n            &lt;button class=\"btn btn-sm btn-outline-light\" data-theme=\"auto\"&gt;\n                &lt;i class=\"bi bi-circle-half\"&gt;&lt;/i&gt;\n            &lt;/button&gt;\n        &lt;/div&gt;\n\n        &lt;button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\"\n                data-bs-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\"\n                aria-expanded=\"false\" aria-label=\"Toggle navigation\"&gt;\n            &lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\n        &lt;/button&gt;\n\n        &lt;div class=\"collapse navbar-collapse justify-content-end\" id=\"navbarSupportedContent\"&gt;\n            {% if is_authenticated %}\n                &lt;a class=\"nav-link text-light\" href=\"{{ url_for('logout') }}\"&gt;Logout&lt;/a&gt;\n            {% else %}\n                &lt;a class=\"nav-link text-light\" href=\"{{ url_for('login') }}\"&gt;Login&lt;/a&gt;\n            {% endif %}\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/nav&gt;\n</code></pre> <p>Provides quick theme switching (light / dark / auto) and shows Login/Logout depending on <code>is_authenticated</code>.</p>"},{"location":"development/web-application/flask-app.html#main-content-slot","title":"Main Content Slot","text":"<pre><code>&lt;main class=\"container my-4\"&gt;\n    {% block content %}{% endblock %}\n&lt;/main&gt;\n</code></pre> <p>All page\u2011specific templates (<code>landing.html</code>, <code>browse_mixtapes.html</code>, <code>editor.html</code>, etc.) inject their markup here.</p>"},{"location":"development/web-application/flask-app.html#common-modals","title":"Common Modals","text":""},{"location":"development/web-application/flask-app.html#indexing-progress-modal","title":"Indexing Progress Modal","text":"<pre><code>&lt;div class=\"modal fade\" id=\"indexingModal\" tabindex=\"-1\" aria-hidden=\"true\" data-bs-backdrop=\"static\"&gt;\n    &lt;div class=\"modal-dialog modal-dialog-centered\"&gt;\n        &lt;div class=\"modal-content bg-dark text-white\"&gt;\n            &lt;div class=\"modal-header border-0\"&gt;\n                &lt;h5 class=\"modal-title\"&gt;&lt;i class=\"bi bi-hourglass-split me-2\"&gt;&lt;/i&gt;Indexing Library&lt;/h5&gt;\n            &lt;/div&gt;\n            &lt;div class=\"modal-body\"&gt;\n                &lt;p id=\"indexingStatusText\"&gt;Preparing\u2026&lt;/p&gt;\n                &lt;div class=\"progress\"&gt;\n                    &lt;div id=\"indexingProgressBar\" class=\"progress-bar progress-bar-striped progress-bar-animated\"\n                         role=\"progressbar\" style=\"width: 0%\"&gt;&lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre> <p>Shown by the <code>check_indexing_before_request</code> hook when the library is rebuilding or resyncing.</p>"},{"location":"development/web-application/flask-app.html#database-corruption-modal","title":"Database Corruption Modal","text":"<pre><code>&lt;div class=\"modal fade\" id=\"corruptionModal\" tabindex=\"-1\" aria-hidden=\"true\" data-bs-backdrop=\"static\"&gt;\n    &lt;div class=\"modal-dialog modal-dialog-centered\"&gt;\n        &lt;div class=\"modal-content bg-danger text-white\"&gt;\n            &lt;div class=\"modal-header border-0\"&gt;\n                &lt;h5 class=\"modal-title\"&gt;&lt;i class=\"bi bi-exclamation-triangle-fill me-2\"&gt;&lt;/i&gt;Database Corruption Detected&lt;/h5&gt;\n            &lt;/div&gt;\n            &lt;div class=\"modal-body\"&gt;\n                &lt;p&gt;The music\u2011library database appears to be corrupted and cannot be used.&lt;/p&gt;\n                &lt;p class=\"fw-bold\"&gt;You must reset the database to continue.&lt;/p&gt;\n                &lt;div class=\"d-flex justify-content-end\"&gt;\n                    &lt;button id=\"showResetConfirmBtn\" class=\"btn btn-light me-2\" data-bs-dismiss=\"modal\"&gt;\n                        Cancel\n                    &lt;/button&gt;\n                    &lt;button class=\"btn btn-outline-light\" data-bs-toggle=\"modal\"\n                            data-bs-target=\"#confirmResetModal\"&gt;\n                        Reset Database\n                    &lt;/button&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre> <p>The modal is static (cannot be dismissed by clicking outside) so the user must explicitly choose to reset or cancel.</p>"},{"location":"development/web-application/flask-app.html#reset-confirmation-modal","title":"Reset Confirmation Modal","text":"<pre><code>&lt;div class=\"modal fade\" id=\"confirmResetModal\" tabindex=\"-1\" aria-hidden=\"true\" data-bs-backdrop=\"static\"&gt;\n    &lt;div class=\"modal-dialog modal-dialog-centered\"&gt;\n        &lt;div class=\"modal-content bg-dark text-white\"&gt;\n            &lt;div class=\"modal-header border-0\"&gt;\n                &lt;h5 class=\"modal-title\"&gt;&lt;i class=\"bi bi-tools me-2\"&gt;&lt;/i&gt;Confirm Database Reset&lt;/h5&gt;\n            &lt;/div&gt;\n            &lt;div class=\"modal-body\"&gt;\n                &lt;p&gt;This will permanently delete the current SQLite database and start a fresh rebuild.&lt;/p&gt;\n                &lt;p class=\"text-warning fw-bold\"&gt;All existing track metadata will be lost.&lt;/p&gt;\n                &lt;div class=\"d-flex justify-content-end\"&gt;\n                    &lt;button class=\"btn btn-secondary me-2\" data-bs-dismiss=\"modal\"&gt;Cancel&lt;/button&gt;\n                    &lt;button id=\"confirmResetBtn\" class=\"btn btn-danger\"&gt;Yes, Reset Now&lt;/button&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre> <p>Triggered from the Database Corruption modal. The JavaScript in <code>static/js/base/databaseCorruption.js</code> (or its production\u2011optimized variant) handles the POST to <code>/reset-database</code>, shows a loading overlay, and finally redirects to the landing page where the indexing progress is displayed.</p>"},{"location":"development/web-application/flask-app.html#loading-overlay-used-during-reset","title":"Loading Overlay (used during reset)","text":"<pre><code>&lt;div id=\"resetLoadingOverlay\" class=\"d-none\"&gt;\n    &lt;div class=\"loading-spinner\"&gt;&lt;/div&gt;\n    &lt;p class=\"mt-3\"&gt;Resetting database\u2026 please wait.&lt;/p&gt;\n&lt;/div&gt;\n</code></pre> <p>The overlay is hidden (<code>d-none</code>) by default. The JS toggles <code>style.display = 'flex'</code> while the reset request is in flight, preventing any further interaction.</p>"},{"location":"development/web-application/flask-app.html#toasts-user-feedback","title":"Toasts (User Feedback)","text":"<pre><code>&lt;!-- Copy\u2011to\u2011clipboard toast --&gt;\n&lt;div class=\"position-fixed bottom-0 end-0 p-3\" style=\"z-index: 1080;\"&gt;\n    &lt;div id=\"copyToast\" class=\"toast align-items-center text-bg-success border-0 shadow\" role=\"alert\"&gt;\n        &lt;div class=\"d-flex\"&gt;\n            &lt;div class=\"toast-body\"&gt;&lt;i class=\"bi bi-check2-circle me-2\"&gt;&lt;/i&gt;Public link copied!&lt;/div&gt;\n            &lt;button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\"&gt;&lt;/button&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;!-- Delete success toast --&gt;\n&lt;div class=\"position-fixed bottom-0 end-0 p-3\" style=\"z-index: 1080;\"&gt;\n    &lt;div id=\"deleteSuccessToast\" class=\"toast align-items-center text-bg-danger border-0 shadow\" role=\"alert\"&gt;\n        &lt;div class=\"d-flex\"&gt;\n            &lt;div class=\"toast-body\"&gt;&lt;i class=\"bi bi-trash-fill me-2\"&gt;&lt;/i&gt;Mixtape deleted successfully&lt;/div&gt;\n            &lt;button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\"&gt;&lt;/button&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;!-- Add track toast (used by the editor) --&gt;\n&lt;div class=\"position-fixed bottom-0 end-0 p-3\" style=\"z-index: 1080;\"&gt;\n    &lt;div id=\"addTrackToast\" class=\"toast align-items-center text-bg-success border-0 shadow\" role=\"alert\"&gt;\n        &lt;div class=\"d-flex\"&gt;\n            &lt;div class=\"toast-body\"&gt;&lt;i class=\"bi bi-plus-circle me-2\"&gt;&lt;/i&gt;Track added to mixtape!&lt;/div&gt;\n            &lt;button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\"&gt;&lt;/button&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;!-- Remove track toast (used by the editor) --&gt;\n&lt;div class=\"position-fixed bottom-0 end-0 p-3\" style=\"z-index: 1080;\"&gt;\n    &lt;div id=\"removeTrackToast\" class=\"toast align-items-center text-bg-danger border-0 shadow\" role=\"alert\"&gt;\n        &lt;div class=\"d-flex\"&gt;\n            &lt;div class=\"toast-body\"&gt;&lt;i class=\"bi bi-trash-fill me-2\"&gt;&lt;/i&gt;Track removed from mixtape&lt;/div&gt;\n            &lt;button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\"&gt;&lt;/button&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre> <p>All toasts are Bootstrap 5 components. They are instantiated in the corresponding JavaScript modules (<code>copyToast.js</code>, <code>deleteMixtape.js</code>, <code>editor/ui.js</code>). The <code>position-fixed</code> placement ensures they appear in the bottom\u2011right corner on every page.</p>"},{"location":"development/web-application/flask-app.html#footer","title":"Footer","text":"<pre><code>&lt;footer class=\"mt-5 py-4 border-top text-center bg-body-tertiary\"&gt;\n    &lt;div class=\"container\"&gt;\n        &lt;p class=\"mb-1\"&gt;\n            \u00a9 {{ now.year }} Mixtape Society \u2013 v{{ app_version }}\n            &lt;a href=\"https://github.com/yourorg/mixtape-society\" target=\"_blank\" class=\"text-decoration-none ms-2\"&gt;\n                &lt;i class=\"bi bi-github\"&gt;&lt;/i&gt;GitHub\n            &lt;/a&gt;\n        &lt;/p&gt;\n        &lt;p class=\"text-muted small mb-0\"&gt;\n            Theme by &lt;a href=\"https://bootswatch.com/\" target=\"_blank\" class=\"text-muted\"&gt;Bootswatch&lt;/a&gt;.\n            Icons from &lt;a href=\"https://icons.getbootstrap.com/\" target=\"_blank\" class=\"text-muted\"&gt;Bootstrap Icons&lt;/a&gt;.\n        &lt;/p&gt;\n    &lt;/div&gt;\n&lt;/footer&gt;\n</code></pre> <p><code>{{ now.year }}</code> comes from the inject_now context processor. <code>{{ app_version }}</code> is injected by inject_version. The footer is deliberately minimal to keep the focus on the main content.</p>"},{"location":"development/web-application/flask-app.html#extra-css--js-includes","title":"Extra CSS / JS Includes","text":"<p>At the very end of <code>base.html</code> (just before <code>&lt;/body&gt;</code>):</p> <pre><code>&lt;!-- Bootstrap Bundle (includes Popper) --&gt;\n&lt;script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"&gt;&lt;/script&gt;\n\n&lt;!-- Base JavaScript (theme switcher, collection stats, database\u2011corruption handling) --&gt;\n&lt;script type=\"module\" src=\"{{ url_for('static', filename='js/base/index.js') }}\"&gt;&lt;/script&gt;\n\n{% block extra_js %}{% endblock %}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p><code>extra_js</code> is a block that child templates can extend (e.g., the editor page loads its own modules). The base <code>index.js</code> pulls in the theme switcher, collection\u2011stats loader, and database\u2011corruption detection.</p>"},{"location":"development/web-application/flask-app.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/web-application/flask-app.html#src.app","title":"<code>app</code>","text":"<p>Functions:</p> Name Description <code>get_configuration</code> <p>Determines and returns the appropriate configuration class for the current environment.</p> <code>serve</code> <p>Starts the Flask application server.</p>"},{"location":"development/web-application/flask-app.html#src.app.get_configuration","title":"<code>get_configuration()</code>","text":"<p>Determines and returns the appropriate configuration class for the current environment.</p> <p>Selects the configuration based on the APP_ENV environment variable, ensures necessary directories exist, and returns the configuration object.</p> <p>Returns:</p> Name Type Description <code>BaseConfig</code> <code>BaseConfig</code> <p>The configuration object for the current environment.</p> Source code in <code>src/app.py</code> <pre><code>def get_configuration() -&gt; BaseConfig:\n    \"\"\"\n    Determines and returns the appropriate configuration class for the current environment.\n\n    Selects the configuration based on the APP_ENV environment variable,\n    ensures necessary directories exist, and returns the configuration object.\n\n    Returns:\n        BaseConfig: The configuration object for the current environment.\n    \"\"\"\n    CONFIG_MAP = {\n        \"development\": DevelopmentConfig,\n        \"test\": TestConfig,\n        \"production\": ProductionConfig,\n    }\n\n    ENV = os.getenv(\"APP_ENV\", \"development\")\n\n    config = CONFIG_MAP.get(ENV, DevelopmentConfig)\n    config.ensure_dirs()\n    return config\n</code></pre>"},{"location":"development/web-application/flask-app.html#src.app.serve","title":"<code>serve(debug=True)</code>","text":"<p>Starts the Flask application server.</p> <p>Runs the app on host 0.0.0.0 and port 5000, with debugging enabled or disabled based on the argument.</p> <p>Parameters:</p> Name Type Description Default <code>debug</code> <code>bool</code> <p>Whether to run the server in debug mode. Defaults to True.</p> <code>True</code> Source code in <code>src/app.py</code> <pre><code>def serve(debug: bool = True) -&gt; None:\n    \"\"\"\n    Starts the Flask application server.\n\n    Runs the app on host 0.0.0.0 and port 5000, with debugging enabled or disabled based on the argument.\n\n    Args:\n        debug: Whether to run the server in debug mode. Defaults to True.\n    \"\"\"\n    app = create_app()\n    app.run(debug=debug, use_reloader=False, host=\"0.0.0.0\", port=5000)\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html","title":"PWA Introduction","text":"<p>Purpose \u2014 This document describes the Progressive Web App (PWA) capabilities of Mixtape Society's public sharing feature. It explains how the service worker enables offline playback, how audio caching works with range requests, the installation flow, and how the manifest scopes the PWA to public routes only. All statements below are verified against the current source files (<code>service-worker.js</code>, <code>static/js/pwa/pwa-manager.js</code>, and <code>manifest.json</code>).</p>"},{"location":"development/web-application/pwa/introduction.html#-high-level-overview","title":"\ud83c\udf0d High-Level Overview","text":"Responsibility Implementation Register service worker scoped to <code>/play/</code> <code>pwa-manager.js</code> \u2192 <code>registerServiceWorker()</code> Cache static assets (CSS, JS, images) Service worker \u2192 <code>STATIC_ASSETS</code> array Cache audio files for offline playback Service worker \u2192 <code>handleAudioRequest()</code> Handle HTTP range requests (seeking) Service worker \u2192 bypass cache for 206 responses Cache mixtape pages and metadata Service worker \u2192 <code>handleMixtapePage()</code> Manage cache storage and limits <code>pwa-manager.js</code> \u2192 <code>getCacheSize()</code>, <code>clearCache()</code> Handle app installation prompts <code>pwa-manager.js</code> \u2192 <code>setupInstallPrompt()</code> Detect online/offline status <code>pwa-manager.js</code> \u2192 <code>setupNetworkDetection()</code>"},{"location":"development/web-application/pwa/introduction.html#scope-restriction","title":"Scope Restriction","text":"<p>The PWA functionality is intentionally scoped to <code>/play/</code> routes only. Authenticated routes (<code>/mixtapes</code>, <code>/editor</code>, etc.) always require live database access and are never cached.</p>"},{"location":"development/web-application/pwa/introduction.html#-pwa-architecture","title":"\ud83d\uddfa\ufe0f PWA Architecture","text":"<pre><code>flowchart TD\n    subgraph Browser\n        UI[\"Web UI&lt;br/&gt;/play/share/slug\"]\n        SW[\"Service Worker&lt;br/&gt;scope: /play/\"]\n        Cache[\"Cache Storage\"]\n    end\n\n    subgraph Server\n        Flask[\"Flask App\"]\n        Audio[\"Audio Files\"]\n        Meta[\"Mixtape JSON\"]\n    end\n\n    UI --&gt;|Request| SW\n    SW --&gt;|Cache Hit| Cache\n    SW --&gt;|Cache Miss| Flask\n    Flask --&gt;|Stream| Audio\n    Flask --&gt;|Metadata| Meta\n    SW --&gt;|Store| Cache\n\n    style Browser stroke:#4CAF50,stroke-width:2px\n    style Server stroke:#2196F3,stroke-width:2px</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/web-application/pwa/introduction.html#-core-components","title":"\ud83d\udce6 Core Components","text":""},{"location":"development/web-application/pwa/introduction.html#1-service-worker-service-workerjs","title":"1. Service Worker (<code>service-worker.js</code>)","text":"<p>Located at app root, handles all offline caching logic.</p>"},{"location":"development/web-application/pwa/introduction.html#cache-strategy-by-resource-type","title":"Cache Strategy by Resource Type","text":"Resource Type Strategy Cache Name Why Static assets (CSS/JS) Cache-first <code>mixtape-static-v1.0.0</code> Instant page loads Audio files Cache-first <code>mixtape-audio-v1.0.0</code> Offline playback Cover images Cache-first <code>mixtape-images-v1.0.0</code> Fast thumbnails Mixtape pages Network-first <code>mixtape-metadata-v1.0.0</code> Fresh content when online CDN resources Cache-first <code>mixtape-static-v1.0.0</code> Bootstrap, Vibrant.js, etc."},{"location":"development/web-application/pwa/introduction.html#range-request-handling","title":"Range Request Handling","text":"<ul> <li>Full file requests (no <code>Range</code> header) \u2192 Cached as 200 OK</li> <li>Partial requests (<code>Range</code> header present) \u2192 Bypass cache, serve 206 from server</li> <li>Seeking always requires network (Cache API limitation)</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#2-pwa-manager-pwa-managerjs","title":"2. PWA Manager (<code>pwa-manager.js</code>)","text":"<p>Client-side orchestration of PWA features.</p> <p>Key Responsibilities:</p> <pre><code>class PWAManager {\n    registerServiceWorker()      // Register SW with /play/ scope\n    setupInstallPrompt()         // Capture beforeinstallprompt\n    setupNetworkDetection()      // Online/offline indicators\n    downloadMixtapeForOffline()  // Batch download tracks\n    showCacheManagement()        // Storage UI modal\n    clearCache(type)             // Delete cached resources\n}\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#3-manifest-dynamic-per-mixtape","title":"3. Manifest (Dynamic per Mixtape)","text":"<p>Each mixtape generates its own PWA manifest dynamically at <code>/play/share/{slug}/manifest.json</code>.</p> <p>Why Dynamic Manifests?</p> <ul> <li>\u2705 Each mixtape can be installed as its own PWA</li> <li>\u2705 PWA icon shows the mixtape's cover art</li> <li>\u2705 PWA name is the mixtape's title</li> <li>\u2705 Opening the PWA goes directly to that specific mixtape</li> <li>\u2705 No 404 errors when launching from home screen</li> </ul> <p>Example Dynamic Manifest:</p> <pre><code>{\n  \"name\": \"Summer Vibes 2024\",\n  \"short_name\": \"Summer Vibe\",\n  \"description\": \"A mixtape with 12 tracks\",\n  \"start_url\": \"/play/share/summer-vibes-2024\",\n  \"scope\": \"/play/\",\n  \"display\": \"standalone\",\n  \"background_color\": \"#198754\",\n  \"theme_color\": \"#198754\",\n  \"icons\": [\n    {\n      \"src\": \"/play/covers/summer-cover.jpg\",\n      \"sizes\": \"512x512\",\n      \"type\": \"image/jpeg\",\n      \"purpose\": \"any maskable\"\n    }\n  ]\n}\n</code></pre> <p>Backend Implementation:</p> <pre><code># play.py - Dynamic manifest endpoint\n@play.route(\"/share/&lt;slug&gt;/manifest.json\")\ndef mixtape_manifest(slug: str) -&gt; Response:\n    \"\"\"Generate dynamic PWA manifest for specific mixtape\"\"\"\n    mixtape = mixtape_manager.get(slug)\n    if not mixtape:\n        abort(404)\n\n    # Use mixtape cover as PWA icon\n    icon_url = f\"/play/covers/{mixtape['cover'].split('/')[-1]}\" \\\n               if mixtape.get('cover') \\\n               else \"/static/icons/icon-512.png\"\n\n    manifest = {\n        \"name\": mixtape.get('title', 'Mixtape'),\n        \"short_name\": mixtape.get('title', 'Mixtape')[:12],\n        \"description\": f\"A mixtape with {len(mixtape.get('tracks', []))} tracks\",\n        \"start_url\": f\"/play/share/{slug}\",\n        \"scope\": \"/play/\",\n        \"display\": \"standalone\",\n        \"background_color\": \"#198754\",\n        \"theme_color\": \"#198754\",\n        \"icons\": [{\n            \"src\": icon_url,\n            \"sizes\": \"512x512\",\n            \"type\": \"image/jpeg\" if mixtape.get('cover') else \"image/png\",\n            \"purpose\": \"any maskable\"\n        }]\n    }\n\n    return Response(json.dumps(manifest, indent=2),\n                   mimetype='application/manifest+json',\n                   headers={'Cache-Control': 'public, max-age=3600'})\n</code></pre> <p>Template Integration:</p> <pre><code>&lt;!-- play_mixtape.html - Dynamic manifest per mixtape --&gt;\n&lt;link rel=\"manifest\" href=\"/play/share/{{ mixtape.slug }}/manifest.json\"&gt;\n&lt;meta name=\"apple-mobile-web-app-title\" content=\"{{ mixtape.title }}\"&gt;\n</code></pre> <p>Scope Restriction: All mixtapes share the <code>/play/</code> scope, which means:</p> <ul> <li>\u2705 One service worker handles all mixtapes efficiently</li> <li>\u2705 Public mixtape receivers get offline capabilities</li> <li>\u2705 Authenticated creator tools always hit the database</li> <li>\u2705 No stale data in admin interfaces</li> <li>\u2705 Each mixtape still gets its own home screen icon and name</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#-request-flow-offline-capable","title":"\ud83d\udd04 Request Flow (Offline-Capable)","text":"<pre><code>sequenceDiagram\n    participant Browser\n    participant ServiceWorker\n    participant Cache\n    participant Server\n\n    Browser-&gt;&gt;ServiceWorker: GET /play/share/summer-vibes\n    ServiceWorker-&gt;&gt;Cache: Check cache\n    alt Cache hit\n        Cache--&gt;&gt;ServiceWorker: Cached HTML\n        ServiceWorker--&gt;&gt;Browser: Instant response \u26a1\n        ServiceWorker-&gt;&gt;Server: Update in background\n    else Cache miss\n        ServiceWorker-&gt;&gt;Server: Fetch from network\n        Server--&gt;&gt;ServiceWorker: Fresh HTML\n        ServiceWorker-&gt;&gt;Cache: Store for offline\n        ServiceWorker--&gt;&gt;Browser: Response\n    end\n\n    Note over Browser,Server: Audio Request (seeking)\n    Browser-&gt;&gt;ServiceWorker: GET /play/audio?quality=medium&lt;br/&gt;Range: bytes=1000000-2000000\n    ServiceWorker-&gt;&gt;Server: Bypass cache (Range request)\n    Server--&gt;&gt;ServiceWorker: 206 Partial Content\n    ServiceWorker--&gt;&gt;Browser: Stream audio</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/web-application/pwa/introduction.html#-audio-caching-with-range-requests","title":"\ud83c\udfb5 Audio Caching with Range Requests","text":""},{"location":"development/web-application/pwa/introduction.html#the-challenge","title":"The Challenge","text":"<p>HTTP range requests (used for audio seeking) return 206 Partial Content responses, which the Cache API cannot store. Only full 200 OK responses can be cached.</p>"},{"location":"development/web-application/pwa/introduction.html#the-solution","title":"The Solution","text":"<ol> <li>Detect range requests:</li> </ol> <pre><code>const isRangeRequest = request.headers.has('Range');\nif (isRangeRequest) {\n    return fetch(request); // Bypass cache\n}\n</code></pre> <ol> <li>Cache only full files:</li> </ol> <pre><code>if (response.ok &amp;&amp; response.status === 200) {\n    cache.put(cacheKey, response.clone());\n}\n</code></pre> <ol> <li>Background caching requests full files:</li> </ol> <pre><code>// No Range header = get complete file\nconst fullRequest = new Request(url, { method: 'GET' });\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#user-experience-impact","title":"User Experience Impact","text":"Scenario Behavior Playing uncached track Streams from server, caches full file Playing cached track Instant playback from cache \u26a1 Seeking in uncached track Fetches partial range from server Seeking in cached track Fetches partial range from server* Download for offline Downloads complete files (200 OK) <p>*Why seek needs network: Cache API limitation - cannot serve partial responses from cached full files.</p>"},{"location":"development/web-application/pwa/introduction.html#-download-for-offline","title":"\ud83d\udce5 Download for Offline","text":"<p>User Flow:</p> <ol> <li>User opens shared mixtape: <code>/play/share/summer-vibes</code></li> <li>Clicks \"Download for Offline\" button</li> <li>PWA Manager downloads all tracks in parallel (3 at a time)</li> <li>Progress indicator shows completion</li> <li>All tracks now available offline</li> </ol> <p>Implementation:</p> <pre><code>async downloadMixtapeForOffline() {\n    const tracks = window.__mixtapeData.tracks;\n    const quality = localStorage.getItem('audioQuality') || 'medium';\n\n    // Download in batches of 3\n    for (let i = 0; i &lt; tracks.length; i += 3) {\n        const batch = tracks.slice(i, i + 3);\n        await Promise.allSettled(\n            batch.map(track =&gt; this.cacheAudioFile(track.path, quality))\n        );\n    }\n}\n\nasync cacheAudioFile(path, quality) {\n    // Send message to service worker\n    return new Promise((resolve, reject) =&gt; {\n        const messageChannel = new MessageChannel();\n        messageChannel.port1.onmessage = (event) =&gt; {\n            event.data.success ? resolve() : reject();\n        };\n\n        this.swRegistration.active.postMessage(\n            { action: 'CACHE_AUDIO', data: { url: path, quality } },\n            [messageChannel.port2]\n        );\n    });\n}\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#-backend-integration","title":"\ud83d\udd27 Backend Integration","text":""},{"location":"development/web-application/pwa/introduction.html#flask-routes","title":"Flask Routes","text":"<pre><code># In app.py - serve PWA files\n\n@app.route('/service-worker.js')\ndef service_worker():\n    \"\"\"Serve service worker with proper headers\"\"\"\n    response = send_from_directory('.', 'service-worker.js',\n                                   mimetype='application/javascript')\n    response.headers['Cache-Control'] = 'no-cache, no-store, must-revalidate'\n    response.headers['Service-Worker-Allowed'] = '/play/'  # Scope restriction\n    return response\n\n@app.route('/manifest.json')\ndef manifest():\n    \"\"\"Serve PWA manifest\"\"\"\n    return send_from_directory('.', 'manifest.json',\n                              mimetype='application/manifest+json')\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#template-integration","title":"Template Integration","text":"<p>PWA features are loaded only in <code>play_mixtape.html</code>, not in <code>base.html</code>:</p> <pre><code>&lt;!-- play_mixtape.html only --&gt;\n{% block extra_meta %}\n    &lt;link rel=\"manifest\" href=\"/manifest.json\"&gt;\n    &lt;meta name=\"theme-color\" content=\"#198754\"&gt;\n    &lt;meta name=\"apple-mobile-web-app-capable\" content=\"yes\"&gt;\n    &lt;meta name=\"mobile-web-app-capable\" content=\"yes\"&gt;\n{% endblock %}\n\n{% block extra_js %}\n    &lt;script type=\"module\" src=\"{{ url_for('static', filename='js/pwa/pwa-manager.js') }}\"&gt;&lt;/script&gt;\n{% endblock %}\n</code></pre> <p>This ensures PWA only activates for public mixtape pages, not authenticated routes.</p>"},{"location":"development/web-application/pwa/introduction.html#-cache-management","title":"\ud83d\udcca Cache Management","text":""},{"location":"development/web-application/pwa/introduction.html#storage-limits","title":"Storage Limits","text":"<pre><code>// Check storage quota\nconst estimate = await navigator.storage.estimate();\nconsole.log(`Using ${estimate.usage} of ${estimate.quota} bytes`);\n// Typical: ~60% of free disk space on Chrome\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#cache-clearing","title":"Cache Clearing","text":""},{"location":"development/web-application/pwa/introduction.html#user-interface","title":"User Interface","text":"<ul> <li>Storage management modal shows cache breakdown</li> <li>Clear buttons for specific cache types</li> <li>Automatic cleanup when quota reached</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#programmatic","title":"Programmatic","text":"<pre><code>// Clear audio cache only\nawait pwaManager.clearCache('audio');\n\n// Clear everything\nawait pwaManager.clearCache('all');\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#-update-handling","title":"\ud83d\udd04 Update Handling","text":""},{"location":"development/web-application/pwa/introduction.html#service-worker-updates","title":"Service Worker Updates","text":""},{"location":"development/web-application/pwa/introduction.html#automatic-detection","title":"Automatic Detection","text":"<pre><code>registration.addEventListener('updatefound', () =&gt; {\n    const newWorker = registration.installing;\n    newWorker.addEventListener('statechange', () =&gt; {\n        if (newWorker.state === 'installed' &amp;&amp; navigator.serviceWorker.controller) {\n            // New version available!\n            showUpdateNotification();\n        }\n    });\n});\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#user-prompt","title":"User Prompt","text":"<pre><code>&lt;div class=\"update-notification\"&gt;\n    Update available\n    &lt;button onclick=\"updateServiceWorker()\"&gt;Update Now&lt;/button&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#mixtape-content-updates","title":"Mixtape Content Updates","text":"<p>When a mixtape changes (tracks added/removed/reordered), the service worker uses network-first strategy for mixtape pages:</p> <ol> <li>Fetch from server (get latest version)</li> <li>If successful, update cache</li> <li>If offline, serve cached version</li> <li>Show \"viewing cached version\" indicator</li> </ol>"},{"location":"development/web-application/pwa/introduction.html#-installation-flow-per-mixtape-pwas","title":"\ud83d\udcf1 Installation Flow (Per-Mixtape PWAs)","text":"<p>Each shared mixtape can be installed as its own standalone app with a unique icon and name.</p>"},{"location":"development/web-application/pwa/introduction.html#desktop-chromeedge","title":"Desktop (Chrome/Edge)","text":"<ol> <li>User visits <code>/play/share/summer-vibes-2024</code></li> <li>Browser shows install icon in address bar</li> <li>Click \u2192 \"Install Summer Vibes 2024\" (uses mixtape title)</li> <li>App opens in standalone window</li> <li>Icon on taskbar shows mixtape cover art</li> </ol>"},{"location":"development/web-application/pwa/introduction.html#mobile-android","title":"Mobile (Android)","text":"<ol> <li>User visits shared mixtape link</li> <li>Chrome shows \"Add Summer Vibes 2024 to Home Screen\" banner</li> <li>Or tap menu \u2192 \"Install App\"</li> <li>Icon appears on home screen with mixtape cover as icon</li> <li>Launches directly to that mixtape (no navigation needed)</li> <li>Can install multiple mixtapes - each gets its own icon</li> </ol>"},{"location":"development/web-application/pwa/introduction.html#mobile-ios","title":"Mobile (iOS)","text":"<ol> <li>User visits shared mixtape link</li> <li>Tap Share button</li> <li>Select \"Add to Home Screen\"</li> <li>Edit name if desired (defaults to mixtape title)</li> <li>Icon appears on home screen</li> <li>Opens directly to the mixtape</li> </ol>"},{"location":"development/web-application/pwa/introduction.html#installation-benefits","title":"Installation Benefits","text":"<p>Before (Static Manifest):</p> <ul> <li>\u274c 404 errors when launching from home screen</li> <li>\u274c Generic \"Mixtape Society\" icon</li> <li>\u274c Opens to main page, user has to navigate</li> <li>\u274c Confusing if multiple mixtapes installed</li> </ul> <p>After (Dynamic Manifests):</p> <ul> <li>\u2705 Direct launch to specific mixtape</li> <li>\u2705 Unique cover art as icon</li> <li>\u2705 Clear mixtape title as app name</li> <li>\u2705 Can install many mixtapes without confusion</li> <li>\u2705 Perfect for gift mixtapes - truly personal</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#multiple-installations","title":"Multiple Installations","text":"<p>Users can install as many mixtapes as they want:</p> <pre><code>Home Screen:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Summer     \u2502 Road Trip  \u2502 Chill      \u2502\n\u2502 Vibes 2024 \u2502 Mix        \u2502 Sundays    \u2502\n\u2502 [cover 1]  \u2502 [cover 2]  \u2502 [cover 3]  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Each opens directly to its own mixtape - no confusion!</p>"},{"location":"development/web-application/pwa/introduction.html#-testing--debugging","title":"\ud83e\uddea Testing &amp; Debugging","text":""},{"location":"development/web-application/pwa/introduction.html#chrome-devtools","title":"Chrome DevTools","text":""},{"location":"development/web-application/pwa/introduction.html#application-tab","title":"Application Tab","text":"<ul> <li>Manifest: Verify icons and config</li> <li>Service Workers: Check registration status</li> <li>Cache Storage: Inspect cached resources</li> <li>Storage: Check quota usage</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#offline-testing","title":"Offline Testing","text":"<ol> <li>Open DevTools \u2192 Application \u2192 Service Workers</li> <li>Check \"Offline\" box</li> <li>Reload page</li> <li>Should still load from cache \u2705</li> </ol>"},{"location":"development/web-application/pwa/introduction.html#console-commands","title":"Console Commands","text":"<pre><code>// Check SW status\nnavigator.serviceWorker.getRegistration().then(reg =&gt; {\n    console.log('Scope:', reg.scope);\n    console.log('Active:', reg.active?.state);\n});\n\n// Check cache contents\ncaches.keys().then(keys =&gt; {\n    console.log('Caches:', keys);\n    keys.forEach(key =&gt; {\n        caches.open(key).then(cache =&gt; {\n            cache.keys().then(reqs =&gt; {\n                console.log(`${key}:`, reqs.length, 'items');\n            });\n        });\n    });\n});\n\n// Check storage\nnavigator.storage.estimate().then(est =&gt; {\n    const used = (est.usage / 1024 / 1024).toFixed(2);\n    const total = (est.quota / 1024 / 1024).toFixed(2);\n    console.log(`Storage: ${used} MB / ${total} MB`);\n});\n</code></pre>"},{"location":"development/web-application/pwa/introduction.html#-limitations--known-issues","title":"\u26a0\ufe0f Limitations &amp; Known Issues","text":""},{"location":"development/web-application/pwa/introduction.html#what-works-offline","title":"What Works Offline","text":"<p>\u2705 View mixtape page and metadata \u2705 See cover art and track list \u2705 Play downloaded tracks \u2705 Read liner notes</p>"},{"location":"development/web-application/pwa/introduction.html#what-requires-network","title":"What Requires Network","text":"<p>\u274c Seeking in tracks (range requests) \u274c Downloading new tracks \u274c Checking for mixtape updates \u274c Authenticated routes (<code>/mixtapes</code>, <code>/editor</code>)</p>"},{"location":"development/web-application/pwa/introduction.html#browser-support","title":"Browser Support","text":"Browser Service Workers Install Offline Chrome 90+ \u2705 \u2705 \u2705 Edge 90+ \u2705 \u2705 \u2705 Firefox 90+ \u2705 \u26a0\ufe0f Limited \u2705 Safari 14+ \u2705 \u26a0\ufe0f Manual \u2705"},{"location":"development/web-application/pwa/introduction.html#-performance-metrics","title":"\ud83d\udcc8 Performance Metrics","text":""},{"location":"development/web-application/pwa/introduction.html#cache-hit-rates","title":"Cache Hit Rates","text":"<ul> <li>Static assets: ~95% (after first visit)</li> <li>Cover images: ~90%</li> <li>Audio files: ~60% (depends on downloads)</li> <li>Mixtape pages: ~80%</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#load-times","title":"Load Times","text":"<ul> <li>First visit: ~2-3s (network dependent)</li> <li>Return visit (cached): ~100-300ms \u26a1</li> <li>Offline visit: ~100ms \u26a1</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#-security-considerations","title":"\ud83d\udd10 Security Considerations","text":""},{"location":"development/web-application/pwa/introduction.html#https-requirement","title":"HTTPS Requirement","text":"<p>Service workers require HTTPS in production (localhost exempted for development).</p>"},{"location":"development/web-application/pwa/introduction.html#scope-isolation","title":"Scope Isolation","text":"<p>The <code>/play/</code> scope ensures authenticated routes cannot be hijacked or cached inappropriately.</p>"},{"location":"development/web-application/pwa/introduction.html#content-security","title":"Content Security","text":"<ul> <li>No user-generated code in service worker</li> <li>Cache keys validated before storage</li> <li>CORS headers properly configured</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Audio Streaming - How audio streaming works</li> <li>Mixtape Manager - Mixtape data persistence</li> <li>Configuration - Environment setup</li> </ul>"},{"location":"development/web-application/pwa/introduction.html#-external-resources","title":"\ud83d\udd17 External Resources","text":"<ul> <li>MDN: Service Worker API</li> <li>Web.dev: PWA Patterns</li> <li>Cache API Specification</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html","title":"PWA Optimizations","text":""},{"location":"development/web-application/pwa/optimizations.html#progressive-web-app-pwa-optimization","title":"Progressive Web App (PWA) Optimization","text":"<p>Mixtape Society is designed as a Progressive Web App, providing an app-like experience without requiring installation from an app store. This is especially powerful on iOS devices, where PWA features unlock native capabilities like AirPlay streaming, background playback, and home screen installation.</p>"},{"location":"development/web-application/pwa/optimizations.html#-why-pwa-matters-for-ios-users","title":"\ud83c\udf4e Why PWA Matters for iOS Users","text":"<p>Apple devices have excellent built-in support for web audio streaming. By optimizing the PWA experience, iOS users get:</p> <ul> <li>Native AirPlay integration \u2013 Stream directly to Apple TV, HomePod, AirPort Express</li> <li>Lock screen controls \u2013 Full media controls without unlocking phone</li> <li>Background playback \u2013 Keep playing with screen off or while using other apps</li> <li>Home screen installation \u2013 Launch like a native app</li> <li>Offline support \u2013 Continue playing cached mixtapes without internet</li> <li>Immersive fullscreen \u2013 Cassette mode with landscape orientation lock</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#-native-airplay-support","title":"\ud83c\udfb5 Native AirPlay Support","text":"<p>Good news: AirPlay already works! No additional code needed.</p> <p>When iOS users play a mixtape in Safari, they automatically get native AirPlay support through the system audio player. This is actually superior to custom implementations because:</p>"},{"location":"development/web-application/pwa/optimizations.html#how-it-works","title":"How It Works","text":"<ol> <li>User opens mixtape in Safari (iOS 10+ or macOS)</li> <li>Starts playing a track \u2013 System audio controls appear</li> <li>Taps AirPlay icon \u2013 Built into the audio controls</li> <li>Selects device \u2013 Apple TV, HomePod, or AirPlay speakers</li> <li>Streams seamlessly \u2013 High-quality audio to selected device</li> </ol>"},{"location":"development/web-application/pwa/optimizations.html#advantages-over-custom-implementation","title":"Advantages Over Custom Implementation","text":"Feature Native AirPlay Custom Integration Development effort \u2705 Zero (already works) \u274c Significant (server-side streaming) Device compatibility \u2705 All AirPlay devices \u26a0\ufe0f Requires device discovery Audio quality \u2705 Lossless (if supported) \u26a0\ufe0f Depends on implementation Battery efficiency \u2705 System-optimized \u26a0\ufe0f Must manage manually UI/UX \u2705 Native iOS design \u274c Custom UI needed Maintenance \u2705 Apple handles updates \u274c Must maintain library"},{"location":"development/web-application/pwa/optimizations.html#where-to-find-airplay-controls","title":"Where to Find AirPlay Controls","text":"<p>Safari on iPhone/iPad:</p> <ul> <li>Controls appear in the Now Playing widget</li> <li>Available in Control Center</li> <li>Lock screen media controls</li> <li>Notification shade quick access</li> </ul> <p>Safari on Mac:</p> <ul> <li>Menu bar audio icon</li> <li>System audio controls</li> <li>Touch Bar (if available)</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#-pwa-installation-guide","title":"\ud83d\udcf1 PWA Installation Guide","text":"<p>Encourage users to install the mixtape player to their home screen for the best experience.</p>"},{"location":"development/web-application/pwa/optimizations.html#installation-instructions-ios","title":"Installation Instructions (iOS)","text":"<p>For Mixtape Recipients:</p> <ol> <li>Open the mixtape link in Safari (must be Safari, not Chrome)</li> <li>Tap the Share button (square with arrow pointing up)</li> <li>Scroll down and tap \"Add to Home Screen\"</li> <li>Customize the name if desired (defaults to \"Mixtape Society\")</li> <li>Tap \"Add\" in the top-right corner</li> </ol> <p>The mixtape icon now appears on the home screen like a native app!</p>"},{"location":"development/web-application/pwa/optimizations.html#why-users-should-install","title":"Why Users Should Install","text":"<p>Enhanced Experience:</p> <ul> <li>\ud83d\ude80 Launches instantly (no Safari UI)</li> <li>\ud83d\udcfa Fullscreen immersive player</li> <li>\ud83c\udfa8 Custom app icon with mixtape branding</li> <li>\ud83d\udd04 Faster load times (cached resources)</li> <li>\u2708\ufe0f Works offline with cached tracks</li> <li>\ud83c\udfb5 Better audio controls and AirPlay access</li> </ul> <p>Perfect for:</p> <ul> <li>Regular listeners of specific mixtapes</li> <li>Party playlists used frequently</li> <li>Gift mixtapes meant to be kept</li> <li>Family music collections</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#-media-session-api-integration","title":"\ud83c\udfae Media Session API Integration","text":"<p>The app uses the Media Session API to provide native OS controls. This works on both iOS and Android.</p>"},{"location":"development/web-application/pwa/optimizations.html#features-provided","title":"Features Provided","text":"<p>Lock Screen Controls:</p> <pre><code>// Already implemented in playerUtils.js\nexport function setupLocalMediaSession(metadata, playerControls) {\n    navigator.mediaSession.metadata = new MediaMetadata({\n        title: metadata.title,\n        artist: metadata.artist,\n        album: metadata.album,\n        artwork: metadata.artwork  // Shows cover art on lock screen\n    });\n\n    // Action handlers for hardware buttons\n    navigator.mediaSession.setActionHandler('play', () =&gt; playerControls.play());\n    navigator.mediaSession.setActionHandler('pause', () =&gt; playerControls.pause());\n    navigator.mediaSession.setActionHandler('previoustrack', () =&gt; playerControls.previous());\n    navigator.mediaSession.setActionHandler('nexttrack', () =&gt; playerControls.next());\n}\n</code></pre> <p>What Users Get:</p> <ul> <li>Lock screen \u2013 Play, pause, skip tracks without unlocking</li> <li>Control Center \u2013 Quick access to playback controls (swipe down from top-right)</li> <li>CarPlay \u2013 Control mixtapes from car dashboard (iOS 14.5+)</li> <li>Hardware buttons \u2013 Headphone/earphone controls work</li> <li>Now Playing \u2013 See current track and album art</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#ios-specific-optimizations","title":"iOS-Specific Optimizations","text":"<p>Artwork Optimization:</p> <pre><code>// From playerUtils.js - iOS prefers specific sizes\nif (iOS) {\n    artwork = [\n        { src: absoluteSrc, sizes: '512x512', type: mimeType }, // Primary for iOS\n        { src: absoluteSrc, sizes: '256x256', type: mimeType },\n        { src: absoluteSrc, sizes: '128x128', type: mimeType }\n    ];\n}\n</code></pre> <p>iOS displays artwork most reliably at 512\u00d7512 pixels. The app automatically provides this optimization.</p> <p>Version Detection:</p> <pre><code>// Detect iOS version and capabilities\nexport function detectiOS() {\n    const ua = navigator.userAgent;\n    const isIOS = /iPad|iPhone|iPod/.test(ua) &amp;&amp; !window.MSStream;\n\n    if (!isIOS) return null;\n\n    const match = ua.match(/OS (\\d+)_(\\d+)/);\n    const major = match ? parseInt(match[1], 10) : 0;\n\n    return {\n        isIOS: true,\n        version: major,\n        supportsMediaSession: major &gt;= 15,  // iOS 15+ required\n        isPWA: window.navigator.standalone === true\n    };\n}\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#-fullscreen-cassette-experience","title":"\ud83d\udcfa Fullscreen Cassette Experience","text":"<p>The cassette player provides an immersive retro experience, especially on mobile devices.</p>"},{"location":"development/web-application/pwa/optimizations.html#mobile-behavior","title":"Mobile Behavior","text":"<p>Automatic Optimizations:</p> <ol> <li>Fullscreen mode \u2013 Removes browser chrome for immersion</li> <li>Landscape lock \u2013 Forces horizontal orientation for cassette view</li> <li>Keep awake \u2013 Screen stays on during playback</li> <li>Restore on exit \u2013 Returns to normal orientation when stopping</li> </ol> <p>Implementation:</p> <pre><code>// From cassettePlayer.js\nasync function lockOrientationLandscape() {\n    if (screen.orientation &amp;&amp; screen.orientation.lock) {\n        try {\n            await screen.orientation.lock('landscape');\n            console.log('\ud83d\udd12 Orientation locked to landscape');\n        } catch (err) {\n            console.warn('\u26a0\ufe0f Could not lock orientation:', err);\n        }\n    }\n}\n\n// Enters fullscreen and locks orientation when user taps play\nasync function enterFullscreenAndLock() {\n    const container = document.getElementById('cassette-player-container');\n\n    if (container.requestFullscreen) {\n        await container.requestFullscreen();\n    } else if (container.webkitRequestFullscreen) {  // iOS Safari\n        await container.webkitRequestFullscreen();\n    }\n\n    await lockOrientationLandscape();\n}\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#user-experience-flow","title":"User Experience Flow","text":"<p>Starting Cassette Mode:</p> <ol> <li>User taps cassette mode toggle button</li> <li>Cassette player appears with spinning reels</li> <li>On first interaction (play/pause), device enters fullscreen</li> <li>Screen locks to landscape orientation</li> <li>Immersive walkman experience begins</li> </ol> <p>During Playback:</p> <ul> <li>Phone lock/unlock maintains playback</li> <li>AirPlay controls available from lock screen</li> <li>Physical buttons control playback</li> <li>Screen stays awake (no sleep timeout)</li> </ul> <p>Stopping:</p> <ul> <li>Stop button unlocks orientation</li> <li>User can exit fullscreen anytime</li> <li>Orientation returns to user preference</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#-service-worker--offline-support","title":"\ud83d\udd04 Service Worker &amp; Offline Support","text":"<p>The PWA uses a service worker to enable offline playback and fast loading.</p>"},{"location":"development/web-application/pwa/optimizations.html#current-implementation","title":"Current Implementation","text":"<p>Service Worker Registration:</p> <pre><code>// In base template\nif ('serviceWorker' in navigator) {\n    window.addEventListener('load', () =&gt; {\n        navigator.serviceWorker.register('/sw.js')\n            .then(registration =&gt; {\n                console.log('Service Worker registered:', registration);\n            })\n            .catch(error =&gt; {\n                console.log('Service Worker registration failed:', error);\n            });\n    });\n}\n</code></pre> <p>What Gets Cached:</p> <ul> <li>Core HTML, CSS, and JavaScript files</li> <li>App icons and branding</li> <li>Mixtape metadata and track listings</li> <li>Previously played audio files</li> <li>Cover art images</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#offline-indicator","title":"Offline Indicator","text":"<pre><code>&lt;!-- Shows when offline in PWA mode --&gt;\n&lt;div id=\"offline-indicator\"\n     class=\"alert alert-warning\"\n     style=\"display: none;\"&gt;\n    &lt;i class=\"bi bi-wifi-off\"&gt;&lt;/i&gt;\n    &lt;strong&gt;Offline Mode&lt;/strong&gt; - Playing cached tracks only\n&lt;/div&gt;\n</code></pre> <p>How It Works:</p> <ol> <li>User loses internet connection</li> <li>Yellow banner appears at top</li> <li>Previously played tracks remain available</li> <li>New tracks show as unavailable</li> <li>Banner disappears when connection restored</li> </ol>"},{"location":"development/web-application/pwa/optimizations.html#-pwa-manifest-configuration","title":"\ud83d\udcca PWA Manifest Configuration","text":"<p>The app's <code>manifest.json</code> defines PWA behavior:</p> <pre><code>{\n  \"name\": \"Mixtape Society\",\n  \"short_name\": \"Mixtapes\",\n  \"description\": \"Create and share beautiful music mixtapes\",\n  \"start_url\": \"/\",\n  \"display\": \"standalone\",\n  \"background_color\": \"#212529\",\n  \"theme_color\": \"#198754\",\n  \"orientation\": \"any\",\n  \"icons\": [\n    {\n      \"src\": \"/static/icons/icon-72.png\",\n      \"sizes\": \"72x72\",\n      \"type\": \"image/png\"\n    },\n    {\n      \"src\": \"/static/icons/icon-96.png\",\n      \"sizes\": \"96x96\",\n      \"type\": \"image/png\"\n    },\n    {\n      \"src\": \"/static/icons/icon-128.png\",\n      \"sizes\": \"128x128\",\n      \"type\": \"image/png\"\n    },\n    {\n      \"src\": \"/static/icons/icon-144.png\",\n      \"sizes\": \"144x144\",\n      \"type\": \"image/png\"\n    },\n    {\n      \"src\": \"/static/icons/icon-152.png\",\n      \"sizes\": \"152x152\",\n      \"type\": \"image/png\"\n    },\n    {\n      \"src\": \"/static/icons/icon-192.png\",\n      \"sizes\": \"192x192\",\n      \"type\": \"image/png\",\n      \"purpose\": \"any maskable\"\n    },\n    {\n      \"src\": \"/static/icons/icon-384.png\",\n      \"sizes\": \"384x384\",\n      \"type\": \"image/png\"\n    },\n    {\n      \"src\": \"/static/icons/icon-512.png\",\n      \"sizes\": \"512x512\",\n      \"type\": \"image/png\",\n      \"purpose\": \"any maskable\"\n    }\n  ]\n}\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#key-properties-explained","title":"Key Properties Explained","text":"Property Value Purpose <code>display: \"standalone\"</code> Full screen, no browser UI App-like experience <code>theme_color: \"#198754\"</code> Green accent Colors iOS status bar <code>orientation: \"any\"</code> User choice default Allows portrait and landscape <code>purpose: \"maskable\"</code> Adaptive icon Looks good on all Android launchers"},{"location":"development/web-application/pwa/optimizations.html#ios-specific-meta-tags","title":"iOS-Specific Meta Tags","text":"<pre><code>&lt;!-- From play_mixtape.html --&gt;\n&lt;meta name=\"apple-mobile-web-app-capable\" content=\"yes\"&gt;\n&lt;meta name=\"apple-mobile-web-app-status-bar-style\" content=\"default\"&gt;\n&lt;meta name=\"apple-mobile-web-app-title\" content=\"Mixtape Society\"&gt;\n&lt;link rel=\"apple-touch-icon\" href=\"/static/icons/icon-192.png\"&gt;\n</code></pre> <p>These tags ensure iOS treats the PWA like a native app when added to home screen.</p>"},{"location":"development/web-application/pwa/optimizations.html#-uiux-optimizations-for-mobile","title":"\ud83c\udfa8 UI/UX Optimizations for Mobile","text":""},{"location":"development/web-application/pwa/optimizations.html#touch-friendly-controls","title":"Touch-Friendly Controls","text":"<p>Large tap targets:</p> <ul> <li>All buttons minimum 44\u00d744 pixels (Apple HIG recommendation)</li> <li>Generous spacing between interactive elements</li> <li>Visual feedback on tap (active states)</li> </ul> <p>Responsive Design:</p> <ul> <li>Player adapts to screen size</li> <li>Cover art scales appropriately</li> <li>Track list optimized for scrolling</li> <li>Bottom player bar always accessible</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#gesture-support","title":"Gesture Support","text":"<p>Swipe Gestures:</p> <ul> <li>Swipe left/right on track list to skip</li> <li>Pull-to-refresh for mixtape updates (PWA mode)</li> <li>Swipe down to dismiss modals</li> </ul> <p>Haptic Feedback (iOS 10+):</p> <pre><code>// Subtle vibration on button press\nif (navigator.vibrate) {\n    navigator.vibrate(10);  // 10ms gentle tap\n}\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#-privacy--security","title":"\ud83d\udd10 Privacy &amp; Security","text":""},{"location":"development/web-application/pwa/optimizations.html#https-requirement","title":"HTTPS Requirement","text":"<p>PWA features (service workers, media session, fullscreen) require HTTPS. Mixtape Society enforces this:</p> <pre><code># Flask app configuration\nif not app.debug:\n    @app.before_request\n    def redirect_to_https():\n        if request.headers.get('X-Forwarded-Proto') == 'http':\n            url = request.url.replace('http://', 'https://', 1)\n            return redirect(url, code=301)\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#data-privacy","title":"Data Privacy","text":"<p>What's Stored Locally:</p> <ul> <li>User preferences (quality settings, theme)</li> <li>Player mode (cassette vs. modern)</li> <li>Cached audio files</li> <li>Service worker cache</li> </ul> <p>What's NOT Stored:</p> <ul> <li>User identity or login info</li> <li>Listening history or analytics</li> <li>Location data</li> <li>Personal information</li> </ul> <p>Cache Management:</p> <pre><code>// Users can clear cache in browser settings\n// Or use the built-in cache clear option (if implemented)\nlocalStorage.clear();\ncaches.keys().then(names =&gt; {\n    names.forEach(name =&gt; caches.delete(name));\n});\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#-performance-optimizations","title":"\ud83d\udcc8 Performance Optimizations","text":""},{"location":"development/web-application/pwa/optimizations.html#lazy-loading","title":"Lazy Loading","text":"<p>Images:</p> <pre><code>&lt;img src=\"cover.jpg\" loading=\"lazy\" alt=\"Cover art\"&gt;\n</code></pre> <p>Audio:</p> <ul> <li>Only loads when user hits play</li> <li>Preloads next track in queue (5 seconds ahead)</li> <li>Quality-based streaming (lower bitrate on slow connections)</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#resource-hints","title":"Resource Hints","text":"<pre><code>&lt;!-- Preconnect to CDN --&gt;\n&lt;link rel=\"preconnect\" href=\"https://cdn.jsdelivr.net\"&gt;\n\n&lt;!-- Prefetch critical assets --&gt;\n&lt;link rel=\"prefetch\" href=\"/static/css/cassette.css\"&gt;\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#adaptive-quality","title":"Adaptive Quality","text":"<pre><code>// Automatically adjusts based on network conditions\nconst quality = navigator.connection?.effectiveType === '4g'\n    ? 'high'\n    : 'medium';\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#-future-pwa-enhancements","title":"\ud83d\ude80 Future PWA Enhancements","text":""},{"location":"development/web-application/pwa/optimizations.html#planned-features","title":"Planned Features","text":"<p>Background Sync:</p> <ul> <li>Queue mixtapes for offline download</li> <li>Sync listening progress across devices</li> <li>Pre-cache entire mixtapes automatically</li> </ul> <p>Web Share API:</p> <pre><code>// Share mixtapes directly from PWA\nif (navigator.share) {\n    navigator.share({\n        title: mixtape.title,\n        text: 'Check out this mixtape!',\n        url: mixtape.url\n    });\n}\n</code></pre> <p>Notification API:</p> <pre><code>// Notify when new tracks added to followed mixtapes\nif (Notification.permission === 'granted') {\n    new Notification('New track added to Summer Vibes!');\n}\n</code></pre> <p>Install Prompt:</p> <pre><code>// Smart prompt to install PWA at optimal moment\nlet deferredPrompt;\nwindow.addEventListener('beforeinstallprompt', (e) =&gt; {\n    e.preventDefault();\n    deferredPrompt = e;\n    // Show custom install button\n});\n</code></pre>"},{"location":"development/web-application/pwa/optimizations.html#-testing-checklist","title":"\ud83d\udcf1 Testing Checklist","text":""},{"location":"development/web-application/pwa/optimizations.html#ios-testing","title":"iOS Testing","text":"<ul> <li> Install to home screen from Safari</li> <li> Launch from home screen (standalone mode)</li> <li> Verify splash screen appears</li> <li> Check status bar color matches theme</li> <li> Test lock screen controls</li> <li> Verify AirPlay button appears</li> <li> Stream to AirPlay device successfully</li> <li> Test background playback (screen off)</li> <li> Verify cassette fullscreen mode</li> <li> Check orientation lock in cassette mode</li> <li> Test offline playback (airplane mode)</li> <li> Confirm service worker caching</li> <li> Verify proper icon display</li> <li> Test CarPlay integration (iOS 14.5+)</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#android-testing","title":"Android Testing","text":"<ul> <li> Install prompt appears correctly</li> <li> Install to home screen</li> <li> Verify maskable icon adaptation</li> <li> Test lock screen controls</li> <li> Check notification controls</li> <li> Verify Chromecast button appears</li> <li> Cast to Chromecast device</li> <li> Test background playback</li> <li> Check offline indicator</li> <li> Verify service worker updates</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#-troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"development/web-application/pwa/optimizations.html#airplay-not-appearing-ios","title":"AirPlay Not Appearing (iOS)","text":"<p>Possible causes:</p> <ul> <li>Using Chrome instead of Safari (must use Safari)</li> <li>Device and AirPlay receiver on different WiFi networks</li> <li>AirPlay device turned off or unavailable</li> <li>Audio hasn't started playing yet</li> </ul> <p>Solution:</p> <ol> <li>Confirm using Safari browser</li> <li>Check WiFi connection</li> <li>Start playing a track first</li> <li>Look for AirPlay icon in audio controls</li> </ol>"},{"location":"development/web-application/pwa/optimizations.html#pwa-wont-install","title":"PWA Won't Install","text":"<p>iOS:</p> <ul> <li>Must use Safari (not Chrome or Firefox)</li> <li>Requires iOS 11.3 or later</li> <li>Some enterprise MDM policies block PWA installation</li> </ul> <p>Android:</p> <ul> <li>Requires Chrome 72+ or Edge 79+</li> <li>Service worker must be registered</li> <li>Site must be served over HTTPS</li> <li>Manifest must be valid</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#lock-screen-controls-not-working","title":"Lock Screen Controls Not Working","text":"<p>Check these:</p> <pre><code>// Verify Media Session API support\nconsole.log('Media Session:', 'mediaSession' in navigator);\n\n// Check if metadata is set\nconsole.log('Metadata:', navigator.mediaSession.metadata);\n\n// Verify action handlers\nconsole.log('Actions:', navigator.mediaSession);\n</code></pre> <p>Common issues:</p> <ul> <li>Audio element must have started playback</li> <li>Metadata must include title, artist, artwork</li> <li>Action handlers must be set before playback</li> <li>iOS 15+ required for full support</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#offline-mode-not-working","title":"Offline Mode Not Working","text":"<p>Verify service worker:</p> <pre><code>// Check registration\nnavigator.serviceWorker.getRegistration()\n    .then(reg =&gt; console.log('SW registered:', reg))\n    .catch(err =&gt; console.error('SW error:', err));\n\n// Check cache\ncaches.keys()\n    .then(names =&gt; console.log('Cached:', names));\n</code></pre> <p>Common issues:</p> <ul> <li>Service worker not registered</li> <li>HTTPS required (doesn't work on http://)</li> <li>Cache storage full or disabled</li> <li>Private browsing mode (cache disabled)</li> </ul>"},{"location":"development/web-application/pwa/optimizations.html#-resources","title":"\ud83d\udcda Resources","text":"<p>Apple Developer Documentation:</p> <ul> <li>Configuring Web Applications</li> <li>Media Session API</li> <li>AirPlay Overview</li> </ul> <p>Web Standards:</p> <ul> <li>PWA Builder</li> <li>Media Session API Spec</li> <li>Service Worker Spec</li> </ul> <p>Testing Tools:</p> <ul> <li>Lighthouse PWA Audit</li> <li>Web.dev PWA Checklist</li> <li>Safari Web Inspector</li> </ul> <p>By focusing on PWA optimization rather than custom AirPlay integration, Mixtape Society provides a superior user experience with less complexity and better long-term maintainability. The native capabilities of iOS combined with web standards deliver everything users need.</p>"},{"location":"development/web-application/routes/authentication.html","title":"Authentication","text":""},{"location":"development/web-application/routes/authentication.html#authentication","title":"Authentication","text":"<p>The <code>routes/authentication.py</code> file defines the authentication subsystem for the Flask app as a reusable blueprint. it's purpose is to centralize login/logout behavior, enforce rate limiting on login attempts, and provide a blueprint that can be registered on the main Flask app to enable password-based access control using a single shared secret.</p> <p>Functionally, it:</p> <ul> <li>Creates an authentication blueprint<ul> <li><code>create_authentication_blueprint(limiter, logger=None)</code> constructs and returns a Blueprint named \"authenticator\".</li> <li>It accepts:<ul> <li>A <code>Limiter</code> instance (from <code>flask_limiter</code>) used to rate-limit login attempts.</li> <li>An optional <code>Logger</code> for recording authentication-related events (with a <code>NullLogger</code> fallback, though the current code doesn\u2019t explicitly log yet).</li> </ul> </li> </ul> </li> <li>Implements login logic (<code>POST /login</code>)<ul> <li>Exposed as <code>/login</code> on the authentication blueprint.</li> <li>Protected by <code>@limiter.limit(\"5 per minute\")</code>, meaning each client can only attempt login five times per minute.</li> <li>Reads the <code>password</code> field from <code>request.form</code>.</li> <li>Compares the submitted password to <code>current_app.secret_key</code>:<ul> <li>If they match: sets <code>session[\"authenticated\"] = True</code>.</li> <li>If they do not match: uses <code>flash(\"Invalid password\", \"danger\")</code> to send an error message to the UI.</li> </ul> </li> <li>Always redirects to <code>/</code> afterward (both success and failure).</li> </ul> </li> <li>Implements logout logic (<code>GET /logout</code>)<ul> <li>Exposed as <code>/logout</code> on the <code>authentication</code> blueprint.</li> <li>Removes the authenticated flag from the session (<code>session.pop(\"authenticated\", None)</code>).</li> <li>Redirects the user back to <code>/</code> (the landing or main page).</li> </ul> </li> </ul> <p>The file <code>src/auth.py</code> defines simple authentication utilities for a Flask application. Its primary purpose is to:</p> <ul> <li>Provide a helper to check whether the current user is authenticated based on the Flask session.</li> <li>Provide a decorator to protect view functions, ensuring only authenticated users can access them and redirecting unauthenticated users to a landing page.</li> </ul> <p>In the larger system, this module centralizes basic auth checks so route handlers can easily enforce authentication without duplicating logic.</p>"},{"location":"development/web-application/routes/authentication.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/web-application/routes/authentication.html#src.routes.authentication","title":"<code>authentication</code>","text":"<p>Functions:</p> Name Description <code>create_authentication_blueprint</code> <p>Creates and configures the Flask blueprint for user authentication.</p>"},{"location":"development/web-application/routes/authentication.html#src.routes.authentication.create_authentication_blueprint","title":"<code>create_authentication_blueprint(limiter, logger=None)</code>","text":"<p>Creates and configures the Flask blueprint for user authentication.</p> <p>Sets up routes for user login and logout, applies rate limiting to login attempts, and provides logging support.</p> <p>Parameters:</p> Name Type Description Default <code>limiter</code> <code>Limiter</code> <p>The Flask-Limiter instance for rate limiting login attempts.</p> required <code>logger</code> <code>Logger | None</code> <p>Optional logger for logging authentication events. Uses NullLogger if not provided.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>Blueprint</code> <code>Blueprint</code> <p>The configured Flask blueprint for authentication.</p> Source code in <code>src/routes/authentication.py</code> <pre><code>def create_authentication_blueprint(limiter: Limiter, logger: Logger | None = None) -&gt; Blueprint:\n    \"\"\"\n    Creates and configures the Flask blueprint for user authentication.\n\n    Sets up routes for user login and logout, applies rate limiting to login attempts, and provides logging support.\n\n    Args:\n        limiter (Limiter): The Flask-Limiter instance for rate limiting login attempts.\n        logger (Logger | None): Optional logger for logging authentication events. Uses NullLogger if not provided.\n\n    Returns:\n        Blueprint: The configured Flask blueprint for authentication.\n    \"\"\"\n\n    authenticator = Blueprint(\"authenticator\", __name__)\n\n    logger: Logger = logger or NullLogger()\n\n    # === Authentication Routes ===\n    @authenticator.route(\"/login\", methods=[\"POST\"])\n    @limiter.limit(\"5 per minute\")\n    def login() -&gt; Response:\n        \"\"\"\n        Authenticates a user based on the submitted password.\n\n        Checks the provided password against the configured password and sets the session as authenticated if correct.\n        Redirects to the mixtapes page on success or flashes an error and redirects to the landing page on failure.\n\n        Returns:\n            Response: The Flask response object for the appropriate redirect.\n        \"\"\"\n        password = request.form.get(\"password\")\n        if password == current_app.secret_key:\n            session[\"authenticated\"] = True\n        else:\n            flash(\"Invalid password\", \"danger\")\n        return redirect(\"/\")\n\n    @authenticator.route(\"/logout\")\n    def logout() -&gt; Response:\n        \"\"\"\n        Logs out the current user by removing authentication from the session.\n\n        Clears the user's session and redirects to the landing page.\n\n        Returns:\n            Response: The Flask response object for the redirect to the landing page.\n        \"\"\"\n        session.pop(\"authenticated\", None)\n        return redirect(\"/\")\n\n    return authenticator\n</code></pre>"},{"location":"development/web-application/routes/authentication.html#src.auth","title":"<code>auth</code>","text":"<p>Functions:</p> Name Description <code>check_auth</code> <p>Checks if the current user is authenticated.</p> <code>require_auth</code> <p>Decorator that enforces authentication for a view function.</p>"},{"location":"development/web-application/routes/authentication.html#src.auth.check_auth","title":"<code>check_auth()</code>","text":"<p>Checks if the current user is authenticated.</p> <p>Returns True if the user is authenticated in the session, otherwise False.</p> <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>Authentication status of the current user. Returns True only if the</p> <code>bool</code> <p>session \"authenticated\" flag is explicitly set to True.</p> Source code in <code>src/auth.py</code> <pre><code>def check_auth() -&gt; bool:\n    \"\"\"\n    Checks if the current user is authenticated.\n\n    Returns True if the user is authenticated in the session, otherwise False.\n\n    Returns:\n        bool: Authentication status of the current user. Returns True only if the\n        session \"authenticated\" flag is explicitly set to True.\n    \"\"\"\n    return session.get(\"authenticated\") is True\n</code></pre>"},{"location":"development/web-application/routes/authentication.html#src.auth.require_auth","title":"<code>require_auth(view)</code>","text":"<p>Decorator that enforces authentication for a view function.</p> <p>Redirects unauthenticated users to the landing page before allowing access to the decorated view.</p> <p>Parameters:</p> Name Type Description Default <code>view</code> <code>Callable</code> <p>The view function to be protected.</p> required <p>Returns:</p> Name Type Description <code>function</code> <code>Callable</code> <p>The wrapped view function with authentication enforcement.</p> Source code in <code>src/auth.py</code> <pre><code>def require_auth(view: Callable) -&gt; Callable:\n    \"\"\"\n    Decorator that enforces authentication for a view function.\n\n    Redirects unauthenticated users to the landing page before allowing access to the decorated view.\n\n    Args:\n        view: The view function to be protected.\n\n    Returns:\n        function: The wrapped view function with authentication enforcement.\n    \"\"\"\n    from functools import wraps\n    @wraps(view)\n    def wrapper(*args, **kwargs):\n        if not check_auth():\n            return redirect(url_for(\"landing\"))\n        return view(*args, **kwargs)\n    return wrapper\n</code></pre>"},{"location":"development/web-application/routes/browse.html","title":"Browse Mixtapes","text":""},{"location":"development/web-application/routes/browse.html#browse-mixtapes","title":"Browse Mixtapes","text":"<p>The <code>browse_mixtapes</code> Flask blueprint (<code>routes/browse_mixtapes.py</code>) powers the Mixtapes listing page with advanced search and sorting capabilities, file serving, and redirection to the public player. It explains the routes, authentication flow, interaction with MixtapeManager, and the front-end assets (browse_mixtapes.html, CSS, and JavaScript).</p>"},{"location":"development/web-application/routes/browse.html#-high-level-overview","title":"\ud83c\udf10 High-Level Overview","text":"Component Responsibility <code>browse_mixtapes</code> Blueprint (<code>routes/browse_mixtapes.py</code>) Registers all UI-facing routes under the <code>/mixtapes</code> prefix, enforces authentication, handles search/sort parameters, and delegates data access to <code>MixtapeManager</code>. <code>MixtapeManager</code> (<code>mixtape_manager.py</code>) Reads/writes mixtape JSON files, manages cover images, and provides <code>list_all()</code> for the browse view. Templates (<code>templates/browse_mixtapes.html</code>) Renders the list of mixtapes with a compact search/sort bar and mixtape cards, each with cover, meta info, and action buttons (edit, play, share, delete). Static assets (<code>static/css/browse_mixtapes.css</code>, <code>static/js/browser/*.js</code>) Provide responsive styling, hybrid search functionality (instant title + deep track search), sorting logic, and delete-confirmation modal. Authentication (<code>auth.py</code>) <code>@require_auth</code> decorator and <code>check_auth()</code> helper ensure only logged-in users can reach any route in this blueprint."},{"location":"development/web-application/routes/browse.html#-flask-blueprint--routes","title":"\ud83d\uddfa\ufe0f Flask Blueprint &amp; Routes","text":"HTTP Method URL Pattern View Function Query Parameters Description <code>GET</code> <code>/mixtapes/</code> <code>browse()</code> <code>sort_by</code>, <code>sort_order</code>, <code>search</code>, <code>deep</code> Retrieves all mixtapes (<code>MixtapeManager.list_all()</code>), applies search/sort filters, and renders <code>browse_mixtapes.html</code>. <code>GET</code> <code>/mixtapes/play/&lt;slug&gt;</code> <code>play(slug)</code> - Redirect to the public player (<code>play.public_play</code>) for the given mixtape slug. <code>GET</code> <code>/mixtapes/files/&lt;path:filename&gt;</code> <code>files(filename)</code> - Serves static files (JSON, cover images, etc.) from the configured <code>MIXTAPE_DIR</code>. <code>POST</code> <code>/mixtapes/delete/&lt;slug&gt;</code> <code>delete_mixtape(slug)</code> - Deletes the mixtape JSON and its cover image; returns JSON <code>{ success: true }</code> or an error. <code>before_request</code> \u2014 <code>blueprint_require_auth()</code> - Runs before every request in this blueprint; redirects unauthenticated users to the landing page (<code>url_for(\"landing\")</code>). <p>All routes are wrapped with <code>@require_auth</code> (except the <code>before_request</code> hook, which performs the same check).</p>"},{"location":"development/web-application/routes/browse.html#query-parameters","title":"Query Parameters","text":"<p>Sort Parameters:</p> <ul> <li><code>sort_by</code>: Field to sort by (<code>updated_at</code>, <code>created_at</code>, <code>title</code>, <code>track_count</code>)</li> <li><code>sort_order</code>: Sort direction (<code>asc</code>, <code>desc</code>)</li> <li>Default: <code>sort_by=updated_at&amp;sort_order=desc</code> (most recently modified first)</li> </ul> <p>Search Parameters:</p> <ul> <li><code>search</code>: Search query string</li> <li><code>deep</code>: Boolean (<code>true</code>/<code>false</code>) indicating deep search mode</li> <li><code>false</code> or absent: Client-side title filtering only</li> <li><code>true</code>: Server-side search through tracks, artists, albums, and liner notes</li> </ul> <p>Examples:</p> <pre><code>/mixtapes/?sort_by=title&amp;sort_order=asc\n/mixtapes/?search=rock&amp;deep=true&amp;sort_by=track_count&amp;sort_order=desc\n</code></pre>"},{"location":"development/web-application/routes/browse.html#-authentication--access-control","title":"\ud83d\udd12 Authentication &amp; Access Control","text":"<ul> <li>Decorator \u2014 <code>@require_auth</code> (imported from <code>auth.py</code>) checks the session for a valid user. If the check fails, the decorator returns a redirect to the login page.</li> <li>Blueprint-wide guard \u2014 <code>@browser.before_request</code> executes <code>check_auth()</code> for every request hitting this blueprint. This is a defensive second line; even if a route is accidentally left undecorated, the guard will still enforce authentication.</li> </ul> <p>Result: Only logged-in users can view the mixtape list, play a mixtape, download files, or delete a mixtape.</p>"},{"location":"development/web-application/routes/browse.html#-search--sort-features","title":"\ud83d\udd0d Search &amp; Sort Features","text":""},{"location":"development/web-application/routes/browse.html#hybrid-search-system","title":"Hybrid Search System","text":"<p>The browse page implements a two-tier search system:</p> <ol> <li> <p>Instant Title Search (Client-Side)</p> <ul> <li>Filters mixtapes by title as you type</li> <li>No server round-trip required</li> <li>Instant visual feedback</li> <li>Implemented in <code>static/js/browser/search.js</code></li> </ul> </li> <li> <p>Deep Search (Server-Side)</p> <ul> <li>Click \"Tracks\" button to search within:</li> <li>Track names (song titles)</li> <li>Artist names</li> <li>Album names</li> <li>Mixtape titles</li> <li>Liner notes</li> <li>Implemented in <code>_deep_search_mixtapes()</code> helper function</li> <li>Returns filtered list to template</li> </ul> </li> </ol>"},{"location":"development/web-application/routes/browse.html#sorting-system","title":"Sorting System","text":"<p>Users can sort by 8 different combinations via a single dropdown:</p> <p>Date Options:</p> <ul> <li>\ud83d\udcc5 Recent First (updated_at desc)</li> <li>\ud83d\udcc5 Oldest First (updated_at asc)</li> <li>\ud83d\udcc5 Newest Created (created_at desc)</li> <li>\ud83d\udcc5 Oldest Created (created_at asc)</li> </ul> <p>Name &amp; Size Options:</p> <ul> <li>\ud83d\udd24 A \u2192 Z (title asc)</li> <li>\ud83d\udd24 Z \u2192 A (title desc)</li> <li>\ud83c\udfb5 Most Tracks (track_count desc)</li> <li>\ud83c\udfb5 Fewest Tracks (track_count asc)</li> </ul> <p>Sorting is applied after search filtering, so search results respect the selected sort order.</p>"},{"location":"development/web-application/routes/browse.html#-data-flow--server-side-logic","title":"\ud83d\udcc4 Data Flow &amp; Server-Side Logic","text":""},{"location":"development/web-application/routes/browse.html#listing-mixtapes-get-mixtapes","title":"Listing Mixtapes (<code>GET</code> <code>/mixtapes/</code>)","text":"<ol> <li>Request \u2192 Flask routes the request to <code>browse()</code> (protected).</li> <li>Parse parameters \u2014 Extract <code>sort_by</code>, <code>sort_order</code>, <code>search</code>, and <code>deep</code> from query string.</li> <li>Mixtape retrieval \u2014 <code>mixtape_manager.list_all()</code> reads every <code>*.json</code> file in <code>app.config[\"MIXTAPE_DIR\"]</code> and returns a list of dicts.</li> <li> <p>Apply search \u2014 If <code>search</code> and <code>deep=true</code>, filter mixtapes using <code>_deep_search_mixtapes()</code>:</p> <pre><code>def _deep_search_mixtapes(mixtapes: list[dict], query: str) -&gt; list[dict]:\n    \"\"\"Searches across mixtape metadata and all tracks\"\"\"\n    query_lower = query.lower()\n    results = []\n\n    for mixtape in mixtapes:\n        # Check title, liner notes\n        if query_lower in mixtape.get('title', '').lower():\n            results.append(mixtape)\n            continue\n\n        # Check all tracks (name, artist, album)\n        for track in mixtape.get('tracks', []):\n            if (query_lower in track.get('track', '').lower() or\n                query_lower in track.get('artist', '').lower() or\n                query_lower in track.get('album', '').lower()):\n                results.append(mixtape)\n                break\n\n    return results\n</code></pre> </li> <li> <p>Apply sorting \u2014 Sort the filtered list based on <code>sort_by</code> and <code>sort_order</code>:</p> <pre><code>if sort_by == 'title':\n    mixtapes.sort(key=lambda x: x.get('title', '').lower(),\n                 reverse=(sort_order == 'desc'))\nelif sort_by == 'track_count':\n    mixtapes.sort(key=lambda x: len(x.get('tracks', [])),\n                 reverse=(sort_order == 'desc'))\n# ... etc\n</code></pre> </li> <li> <p>Template rendering \u2014 Pass <code>mixtapes</code>, <code>sort_by</code>, <code>sort_order</code>, <code>search_query</code>, and <code>search_deep</code> to template.</p> </li> <li>HTML output \u2014 Renders search/sort controls and filtered mixtape cards.</li> </ol>"},{"location":"development/web-application/routes/browse.html#playing-a-mixtape-get-mixtapesplay","title":"Playing a Mixtape (<code>GET</code> <code>/mixtapes/play/&lt;slug&gt;</code>)","text":"<ul> <li> <p>The view simply redirects to the public player route defined elsewhere (e.g. play.public_play).</p> <pre><code>return redirect(url_for(\"public_play\", slug=slug))\n</code></pre> </li> <li> <p>The client ends up on <code>/play/&lt;slug&gt;#play</code>, where the full mixtape UI is rendered.</p> </li> </ul>"},{"location":"development/web-application/routes/browse.html#serving-files-get-mixtapesfiles","title":"Serving Files (<code>GET</code> <code>/mixtapes/files/&lt;filename&gt;</code>)","text":"<ul> <li>Uses Flask's <code>send_from_directory</code> to serve any file under <code>app.config[\"MIXTAPE_DIR\"]</code>.</li> <li>This includes the JSON file (<code>&lt;slug&gt;.json</code>) and cover images (<code>covers/&lt;slug&gt;.jpg</code>).</li> </ul>"},{"location":"development/web-application/routes/browse.html#deleting-a-mixtape-post-mixtapesdelete","title":"Deleting a Mixtape (<code>POST</code> <code>/mixtapes/delete/&lt;slug&gt;</code>)","text":"<ol> <li>Existence check \u2014 Verifies that <code>&lt;slug&gt;.json</code> exists; if not, returns <code>404</code> with JSON error.</li> <li>Calls <code>mixtape_manager.delete(slug)</code>, which removes the JSON file and any associated cover image (<code>covers/&lt;slug&gt;.jpg</code>).</li> <li>Returns JSON <code>{ \"success\": true }</code> on success, or <code>{ \"success\": false, \"error\": \"...\" }</code> with the appropriate HTTP status on failure.</li> </ol>"},{"location":"development/web-application/routes/browse.html#error-handling","title":"Error Handling","text":"<ul> <li>All routes catch generic <code>Exception</code> and log the traceback via the injected <code>logger</code>.</li> <li>Errors are reported to the client as JSON with a descriptive <code>error</code> field and an appropriate HTTP status code (<code>400</code>, <code>404</code>, <code>500</code>).</li> </ul>"},{"location":"development/web-application/routes/browse.html#-ui-layout-jinja-template--browse_mixtapeshtml","title":"\ud83d\udda5\ufe0f UI Layout (Jinja Template \u2014 <code>browse_mixtapes.html</code>)","text":"Section Details Header Compact header with \"My Mixtapes\" title and a \"New\" button linking to <code>/editor</code>. Responsive sizing (smaller on mobile). Search &amp; Sort Bar Compact card containing: \u2022 Search input with clear button \u2022 \"Tracks\" button (with tooltip) for deep search \u2022 Combined sort dropdown (field + order in one) \u2022 Minimal vertical space (~50px desktop, ~70px mobile) \u2022 Bootstrap theme-aware styling Search Result Banner When search is active, shows info banner with query, result count, and \"Clear Search\" button. Distinguishes between title search and deep search results. Mixtape Cards Loop over filtered/sorted mixtapes. Each card (<code>.mixtape-item</code>) contains: \u2022 Cover (<code>.mixtape-cover</code>) \u2022 Title (<code>.mixtape-title</code>) \u2022 Meta info (<code>.mixtape-meta</code>) \u2022 Action buttons (<code>.action-btn</code>): edit, play, QR share, delete Empty State Context-aware: \u2022 No mixtapes: \"No mixtapes yet...\" \u2022 No search results: \"No mixtapes found\" with clear search button Delete Confirmation Modal Modal (<code>#deleteConfirmModal</code>) that asks the user to confirm deletion; populated with the mixtape title via JS. Delete Success Toast Toast (<code>#deleteSuccessToast</code>) shown after a successful deletion. JS Entry Point <code>&lt;script type=\"module\" src=\"{{ url_for('static', filename='js/browser/index.js') }}\"&gt;&lt;/script&gt;</code> \u2014 wires up search, sort, delete, QR share, and tooltip functionality. <p>All UI elements use Bootstrap 5 utilities and custom CSS variables (<code>--bs-body-bg</code>, <code>--bs-border-color</code>, <code>--bs-body-color</code>) to stay theme-aware (light/dark modes).</p>"},{"location":"development/web-application/routes/browse.html#compact-searchsort-bar-features","title":"Compact Search/Sort Bar Features","text":"<p>Space Efficiency:</p> <ul> <li>60%+ vertical space reduction compared to separate cards</li> <li>Single card with all controls</li> <li>Mobile-optimized with reduced padding</li> </ul> <p>Responsive Layout:</p> <ul> <li>Desktop (\u2265992px): Search input expands to fill space, Tracks + Sort align right</li> <li>Tablet (768-991px): Two-row layout with natural wrapping</li> <li>Mobile (&lt;768px): Stacked controls, full-width inputs</li> <li>Tiny (&lt;576px): Extra compact sizing</li> </ul> <p>Theming:</p> <ul> <li>Search icon respects Bootstrap color variables</li> <li>No hardcoded colors (works in light/dark mode)</li> <li>Proper contrast in all themes</li> </ul> <p>Tooltips:</p> <ul> <li>Tracks button has tooltip: \"Search within song names, artists, and albums\"</li> <li>Works on both enabled and disabled states</li> <li>Helps users understand deep search feature</li> </ul>"},{"location":"development/web-application/routes/browse.html#-static-assets-css--js","title":"\ud83e\uddf1 Static Assets (CSS &amp; JS)","text":""},{"location":"development/web-application/routes/browse.html#browse_mixtapescss","title":"<code>browse_mixtapes.css</code>","text":"<p>Search &amp; Sort Styling:</p> <ul> <li>Compact card with minimal padding (<code>p-2</code> on mobile, <code>p-md-3</code> on desktop)</li> <li>Theme-aware colors using CSS variables</li> <li>Input group styling with seamless borders</li> <li>Combined sort dropdown with emoji icons</li> <li>Responsive adjustments for all screen sizes</li> </ul> <p>Mixtape Cards:</p> <ul> <li>Responsive card layout \u2014 Flexbox with wrapping, subtle shadows, and a hover lift effect</li> <li>Action buttons \u2014 Circular, color-coded (edit=primary, play=success, share=info, delete=danger). Hover scales the button</li> <li>Mobile adjustments \u2014 Smaller cover size, reduced button dimensions, and a stacked layout for very narrow viewports (<code>max-width: 480px</code>)</li> </ul> <p>Animations:</p> <ul> <li>Slide-down animation for search result banner</li> <li>Smooth hover transitions on cards and buttons</li> <li>Subtle lift effect on card hover</li> </ul>"},{"location":"development/web-application/routes/browse.html#javascript-modules","title":"JavaScript Modules","text":"File Exported function(s) Purpose <code>search.js</code> <code>initSearch()</code> Handles hybrid search: instant title filtering (client-side), deep search button click, clear search, and Enter key support. Disables client-side filtering when viewing deep search results. <code>sorting.js</code> <code>initSorting()</code> Handles combined sort dropdown changes, updates URL with sort parameters, preserves search state during sort changes. <code>deleteMixtape.js</code> <code>initDeleteMixtape()</code> Handles the delete workflow: opens the confirmation modal, sends a POST <code>/mixtapes/delete/&lt;slug&gt;</code> request, shows success toast, and reloads the page. <code>index.js</code> \u2014 Imports and initializes all modules on <code>DOMContentLoaded</code>: search, sorting, delete, QR share, and Bootstrap tooltips. <p>Common Module (Shared):</p> <ul> <li><code>../common/qrShare.js</code> - Provides QR code generation, modal display, copy-to-clipboard, and download functionality. Used across browser, editor, and player pages.</li> </ul> <p>All scripts are ES6 modules (<code>type=\"module\"</code>), ensuring they are loaded after the DOM is ready and that they don't pollute the global namespace.</p>"},{"location":"development/web-application/routes/browse.html#search-implementation-details","title":"Search Implementation Details","text":"<p>Client-Side Title Search:</p> <pre><code>function filterByTitle(query) {\n    // Skip if on deep search results page\n    if (isDeepSearchActive) return;\n\n    mixtapeItems.forEach(item =&gt; {\n        const title = item.querySelector('.mixtape-title').textContent;\n        if (title.toLowerCase().includes(query.toLowerCase())) {\n            item.style.display = originalDisplays.get(item);\n        } else {\n            item.style.display = 'none';\n        }\n    });\n}\n</code></pre> <p>Deep Search Navigation:</p> <pre><code>deepSearchBtn.addEventListener('click', () =&gt; {\n    const url = new URL(window.location.href);\n    url.searchParams.set('search', query);\n    url.searchParams.set('deep', 'true');\n    // Preserve sort parameters\n    window.location.href = url.toString();\n});\n</code></pre> <p>Key Features:</p> <ul> <li>Instant filtering respects search state (doesn't interfere with server-side results)</li> <li>Clear button removes both client-side filters and navigates away from deep search</li> <li>Enter key triggers deep search</li> <li>URL parameters maintain complete state (search + sort)</li> </ul>"},{"location":"development/web-application/routes/browse.html#-class--sequence-diagrams","title":"\ud83d\udcca Class &amp; Sequence Diagrams","text":""},{"location":"development/web-application/routes/browse.html#class-diagram","title":"Class Diagram","text":"<pre><code>classDiagram\n    class browse_mixtapes_Blueprint {\n        +browse()\n        +play(slug)\n        +files(filename)\n        +delete_mixtape(slug)\n        +blueprint_require_auth()\n        -_deep_search_mixtapes()\n    }\n    class MixtapeManager {\n        +list_all()\n        +delete(slug)\n    }\n    class AuthSystem {\n        +require_auth()\n        +check_auth()\n    }\n    class SearchSystem {\n        +initSearch()\n        +filterByTitle()\n        +deepSearch()\n    }\n    class SortSystem {\n        +initSorting()\n        +updateURL()\n    }\n\n    browse_mixtapes_Blueprint --&gt; MixtapeManager : uses\n    browse_mixtapes_Blueprint --&gt; AuthSystem : enforces authentication\n    browse_mixtapes_Blueprint --&gt; SearchSystem : client-side filtering\n    browse_mixtapes_Blueprint --&gt; SortSystem : URL parameter management</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/web-application/routes/browse.html#sequence-diagram---searching-and-sorting-mixtapes","title":"Sequence Diagram - Searching and Sorting Mixtapes","text":"<pre><code>sequenceDiagram\n    participant User\n    participant BrowserJS\n    participant FlaskApp\n    participant Blueprint as browse_mixtapes\n    participant MixtapeManager\n\n    User-&gt;&gt;BrowserJS: Types in search box\n    BrowserJS-&gt;&gt;BrowserJS: Filter by title (instant)\n\n    User-&gt;&gt;BrowserJS: Clicks \"Tracks\" button\n    BrowserJS-&gt;&gt;FlaskApp: GET /mixtapes/?search=rock&amp;deep=true&amp;sort_by=title&amp;sort_order=asc\n    FlaskApp-&gt;&gt;Blueprint: browse(search='rock', deep='true', ...)\n    Blueprint-&gt;&gt;MixtapeManager: list_all()\n    MixtapeManager--&gt;&gt;Blueprint: all mixtapes\n    Blueprint-&gt;&gt;Blueprint: _deep_search_mixtapes(mixtapes, 'rock')\n    Blueprint-&gt;&gt;Blueprint: sort by title ascending\n    Blueprint--&gt;&gt;FlaskApp: render template with filtered results\n    FlaskApp--&gt;&gt;User: HTML page with search results</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/web-application/routes/browse.html#sequence-diagram---deleting-a-mixtape","title":"Sequence Diagram - Deleting a Mixtape","text":"<pre><code>sequenceDiagram\n    participant User\n    participant BrowserJS\n    participant FlaskApp\n    participant browse_mixtapes as Blueprint\n    participant MixtapeManager\n\n    User-&gt;&gt;BrowserJS: Click Delete \u2192 opens modal\n    BrowserJS-&gt;&gt;FlaskApp: POST /mixtapes/delete/&lt;slug&gt;\n    FlaskApp-&gt;&gt;Blueprint: delete_mixtape(slug)\n    Blueprint-&gt;&gt;MixtapeManager: delete(slug)\n    MixtapeManager--&gt;&gt;Blueprint: success\n    Blueprint--&gt;&gt;FlaskApp: JSON {success:true}\n    FlaskApp--&gt;&gt;BrowserJS: JSON response\n    BrowserJS-&gt;&gt;BrowserJS: Show success toast, reload page</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/web-application/routes/browse.html#-user-experience-features","title":"\ud83c\udfaf User Experience Features","text":""},{"location":"development/web-application/routes/browse.html#search-flow","title":"Search Flow","text":"<ol> <li>Quick Title Search:</li> <li>User types in search box</li> <li>Results filter instantly (no page reload)</li> <li>Clear button appears</li> <li> <p>Tracks button becomes enabled</p> </li> <li> <p>Deep Search:</p> </li> <li>User clicks \"Tracks\" button (or presses Enter)</li> <li>Page reloads with <code>?search=query&amp;deep=true</code></li> <li>Server searches all metadata</li> <li>Results include mixtapes with matching songs/artists/albums</li> <li> <p>Banner shows \"Deep search results for: {query}\"</p> </li> <li> <p>Clear Search:</p> </li> <li>Click clear button (X)</li> <li>Returns to full mixtape list</li> <li>Preserves sort settings</li> </ol>"},{"location":"development/web-application/routes/browse.html#sort-flow","title":"Sort Flow","text":"<ol> <li>Select Sort Option:</li> <li>User selects from dropdown (e.g., \"\ud83c\udfb5 Most Tracks\")</li> <li>Page reloads with new sort parameters</li> <li> <p>Search state is preserved if active</p> </li> <li> <p>Combined with Search:</p> </li> <li>Search results can be re-sorted</li> <li>Sort order maintained during searches</li> <li>URL reflects complete state</li> </ol>"},{"location":"development/web-application/routes/browse.html#mobile-optimizations","title":"Mobile Optimizations","text":"<ul> <li>Compact Controls: 60% less vertical space than desktop</li> <li>Touch-Friendly: All buttons meet WCAG size standards</li> <li>Smart Layout: Inputs stack appropriately</li> <li>Visual Clarity: Emoji icons aid recognition</li> <li>Performance: Client-side filtering remains instant</li> </ul>"},{"location":"development/web-application/routes/browse.html#-api","title":"\ud83d\udccc API","text":""},{"location":"development/web-application/routes/browse.html#src.routes.browse_mixtapes","title":"<code>browse_mixtapes</code>","text":"<p>Functions:</p> Name Description <code>create_browser_blueprint</code> <p>Creates and configures the Flask blueprint for browsing, playing, and managing mixtapes.</p>"},{"location":"development/web-application/routes/browse.html#src.routes.browse_mixtapes.create_browser_blueprint","title":"<code>create_browser_blueprint(mixtape_manager, func_processing_status, logger=None)</code>","text":"<p>Creates and configures the Flask blueprint for browsing, playing, and managing mixtapes.</p> <p>Sets up routes for listing mixtapes, serving cover images and files, deleting mixtapes, and handling authentication for all routes in the blueprint.</p> <p>Parameters:</p> Name Type Description Default <code>mixtape_manager</code> <code>MixtapeManager</code> <p>The manager instance for retrieving and managing mixtapes.</p> required <code>func_processing_status</code> <code>any</code> <p>A function to check the current indexing or processing status.</p> required <code>logger</code> <code>Logger</code> <p>The logger instance for error reporting.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>Blueprint</code> <code>Blueprint</code> <p>The configured Flask blueprint for browsing and managing mixtapes.</p> Source code in <code>src/routes/browse_mixtapes.py</code> <pre><code>def create_browser_blueprint(\n    mixtape_manager: MixtapeManager,\n    func_processing_status: any,\n    logger: Logger | None = None,\n) -&gt; Blueprint:\n    \"\"\"\n    Creates and configures the Flask blueprint for browsing, playing, and managing mixtapes.\n\n    Sets up routes for listing mixtapes, serving cover images and files, deleting mixtapes, and handling authentication for all routes in the blueprint.\n\n    Args:\n        mixtape_manager (MixtapeManager): The manager instance for retrieving and managing mixtapes.\n        func_processing_status (any): A function to check the current indexing or processing status.\n        logger (Logger): The logger instance for error reporting.\n\n    Returns:\n        Blueprint: The configured Flask blueprint for browsing and managing mixtapes.\n    \"\"\"\n    browser = Blueprint(\"browse_mixtapes\", __name__, template_folder=\"../templates\")\n\n    logger: Logger = logger or NullLogger()\n\n    def _deep_search_mixtapes(mixtapes: list[dict], query: str) -&gt; list[dict]:\n        \"\"\"\n        Performs a deep search across mixtape tracks, artists, albums, and liner notes.\n\n        Args:\n            mixtapes: List of mixtape dictionaries to search\n            query: Search query string (case-insensitive)\n\n        Returns:\n            Filtered list of mixtapes matching the search query\n        \"\"\"\n        if not query:\n            return mixtapes\n\n        query_lower = query.lower()\n        results = []\n\n        for mixtape in mixtapes:\n            # Search in mixtape title\n            if query_lower in mixtape.get('title', '').lower():\n                results.append(mixtape)\n                continue\n\n            # Search in liner notes\n            if query_lower in mixtape.get('liner_notes', '').lower():\n                results.append(mixtape)\n                continue\n\n            # Search within tracks\n            tracks = mixtape.get('tracks', [])\n            found = False\n            for track in tracks:\n                # Search track name\n                if query_lower in track.get('track', '').lower():\n                    found = True\n                    break\n                # Search artist\n                if query_lower in track.get('artist', '').lower():\n                    found = True\n                    break\n                # Search album\n                if query_lower in track.get('album', '').lower():\n                    found = True\n                    break\n\n            if found:\n                results.append(mixtape)\n\n        return results\n\n    @browser.route(\"/\")\n    @require_auth\n    def browse() -&gt; Response:\n        \"\"\"\n        Renders the browse mixtapes page or indexing progress if active.\n\n        Checks for ongoing indexing and shows progress if active. Otherwise, lists all mixtapes.\n        Supports sorting by title, date (created/updated), and track count with ascending/descending order.\n        Supports search by title (client-side) and deep search by tracks/artists/albums (server-side).\n\n        Returns:\n            Response: The rendered template for mixtapes or indexing progress.\n        \"\"\"\n        from flask import request\n\n        # Get sorting parameters from query string\n        sort_by = request.args.get('sort_by', 'updated_at')  # default: most recent\n        sort_order = request.args.get('sort_order', 'desc')  # default: descending\n        search_query = request.args.get('search', '').strip()\n        search_deep = request.args.get('deep', '').lower() == 'true'\n\n        mixtapes = mixtape_manager.list_all()\n\n        # Apply deep search if requested (searches within tracks, artists, albums)\n        if search_query and search_deep:\n            mixtapes = _deep_search_mixtapes(mixtapes, search_query)\n\n        # Apply sorting\n        if sort_by == 'title':\n            mixtapes.sort(key=lambda x: x.get('title', '').lower(), \n                         reverse=(sort_order == 'desc'))\n        elif sort_by == 'created_at':\n            mixtapes.sort(key=lambda x: x.get('created_at') or '', \n                         reverse=(sort_order == 'desc'))\n        elif sort_by == 'updated_at':\n            mixtapes.sort(key=lambda x: x.get('updated_at') or x.get('created_at') or '', \n                         reverse=(sort_order == 'desc'))\n        elif sort_by == 'track_count':\n            mixtapes.sort(key=lambda x: len(x.get('tracks', [])), \n                         reverse=(sort_order == 'desc'))\n\n        return render_template(\"browse_mixtapes.html\", \n                             mixtapes=mixtapes,\n                             sort_by=sort_by,\n                             sort_order=sort_order,\n                             search_query=search_query,\n                             search_deep=search_deep)\n\n    @browser.route(\"/play/&lt;slug&gt;\")\n    @require_auth\n    def play(slug: str) -&gt; Response:\n        \"\"\"\n        Redirects to the public play page for a given mixtape slug.\n\n        Takes the mixtape slug and redirects the user to the corresponding public play route.\n\n        Args:\n            slug: The unique identifier for the mixtape.\n\n        Returns:\n            Response: A redirect response to the public play page for the mixtape.\n        \"\"\"\n        return redirect(url_for(\"public_play\", slug=slug))\n\n    @browser.route(\"/files/&lt;path:filename&gt;\")\n    @require_auth\n    def files(filename: str) -&gt; Response:\n        \"\"\"\n        Serves a mixtape file from the mixtape directory.\n\n        Returns the requested file as a Flask response for download or display.\n\n        Args:\n            filename: The path to the mixtape file within the mixtape directory.\n\n        Returns:\n            Response: A Flask response serving the requested file.\n        \"\"\"\n        return send_from_directory(current_app.config[\"MIXTAPE_DIR\"], filename)\n\n    @browser.route(\"/delete/&lt;slug&gt;\", methods=[\"POST\"])\n    @require_auth\n    def delete_mixtape(slug: str) -&gt; Response:\n        \"\"\"\n        Deletes a mixtape and its associated cover image.\n\n        Removes the mixtape JSON file and cover image from disk if they exist. Returns a 200 response on success or 404 if the mixtape is not found.\n\n        Args:\n            slug: The unique identifier for the mixtape to delete.\n\n        Returns:\n            Response: An empty response with status 200 if successful, or 404 if the mixtape does not exist.\n        \"\"\"\n        try:\n            # First check if it exists\n            json_path = mixtape_manager.path_mixtapes / f\"{slug}.json\"\n            if not json_path.exists():\n                return jsonify({\"success\": False, \"error\": \"Mixtape not found\"}), 404\n\n            mixtape_manager.delete(slug)\n            return jsonify({\"success\": True}), 200\n\n        except Exception as e:\n            logger.exception(\"Error deleting mixtape\")  # if you have logger\n            return jsonify({\"success\": False, \"error\": str(e)}), 500\n\n    @browser.before_request\n    def blueprint_require_auth() -&gt; Response | None:\n        \"\"\"\n        Ensures authentication for all routes in the browse_mixtapes blueprint.\n\n        Checks if the user is authenticated before allowing access to any route in this blueprint. Redirects unauthenticated users to the landing page.\n\n        Returns:\n            Response or None: A redirect response to the landing page if not authenticated, otherwise None.\n        \"\"\"\n        # Protect everything in this blueprint\n        if not check_auth():\n            return redirect(url_for(\"landing\"))\n\n    return browser\n</code></pre>"},{"location":"development/web-application/routes/browse.html#-configuration","title":"\ud83d\udd27 Configuration","text":"<p>The browse functionality relies on the following configuration values:</p> <ul> <li><code>MIXTAPE_DIR</code>: Directory where mixtape JSON files and covers are stored</li> <li><code>DATA_ROOT</code>: Root directory for application data</li> <li>Session configuration for authentication</li> </ul>"},{"location":"development/web-application/routes/browse.html#-customization","title":"\ud83c\udfa8 Customization","text":""},{"location":"development/web-application/routes/browse.html#adding-new-sort-options","title":"Adding New Sort Options","text":"<ol> <li>Add option to HTML template select dropdown</li> <li>Update <code>browse()</code> function to handle new sort field</li> <li>Ensure proper sorting logic (ascending/descending)</li> </ol>"},{"location":"development/web-application/routes/browse.html#modifying-search-behavior","title":"Modifying Search Behavior","text":"<p>Client-side (Title Search):</p> <ul> <li>Edit <code>static/js/browser/search.js</code></li> <li>Modify <code>filterByTitle()</code> function</li> </ul> <p>Server-side (Deep Search):</p> <ul> <li>Edit <code>_deep_search_mixtapes()</code> in <code>routes/browse_mixtapes.py</code></li> <li>Add or modify search fields</li> </ul>"},{"location":"development/web-application/routes/browse.html#theming","title":"Theming","text":"<p>All colors use CSS custom properties:</p> <pre><code>.input-group-text {\n    background-color: var(--bs-body-bg);\n    color: var(--bs-body-color);\n}\n</code></pre> <p>Override these in your theme CSS to customize appearance.</p>"},{"location":"development/web-application/routes/browse.html#-responsive-breakpoints","title":"\ud83d\udcf1 Responsive Breakpoints","text":"Breakpoint Width Layout Changes Desktop \u2265992px Search expands, controls align right, single row Tablet 768-991px Two-row layout, natural wrapping Mobile 576-767px Stacked pairs, larger touch targets Tiny &lt;576px Full stack, extra compact sizing"},{"location":"development/web-application/routes/qr-codes.html","title":"QR Code Routes","text":""},{"location":"development/web-application/routes/qr-codes.html#qr-codes","title":"QR Codes","text":""},{"location":"development/web-application/routes/qr-codes.html#-highlevel-overview","title":"\ud83c\udf0d High\u2011Level Overview","text":"<p>The QR blueprint (qr_blueprint.py) provides two public endpoints that generate QR\u2011code images for a mixtape\u2019s share URL:</p> Feature Description Simple QR (<code>/qr/&lt;slug&gt;.png</code>) Returns a plain PNG QR code (optional logo overlay, configurable size). Enhanced QR (<code>/qr/&lt;slug&gt;/download</code>) Returns a QR code that can embed the mixtape\u2019s cover art and title banner, and is served as a downloadable attachment. Cache-Control Both endpoints set <code>Cache-Control: public, max-age=3600</code> so browsers cache the image for one hour. Graceful fallback If the logo or cover image is missing, the generator falls back to a plain QR code. Stateless The blueprint only reads data from the injected MixtapeManager and Flask\u2019s static folder; no session data is stored."},{"location":"development/web-application/routes/qr-codes.html#-flask-blueprint--routes","title":"\ud83d\uddfa\ufe0f Flask Blueprint &amp; Routes","text":""},{"location":"development/web-application/routes/qr-codes.html#qrpng","title":"<code>/qr/&lt;slug&gt;.png</code>","text":"Method Description <code>GET</code> Returns a simple QR code PNG that encodes the public share URL for the mixtape identified by <code>&lt;slug&gt;</code>. <p>Request flow (simplified)</p> <pre><code>sequenceDiagram\n    participant UI as Browser\n    participant Flask as QR Blueprint\n    participant MM as MixtapeManager\n    participant FS as FileSystem (static folder)\n\n    UI-&gt;&gt;Flask: GET /qr/awesome-mixtape.png?size=400&amp;logo=true\n    Flask-&gt;&gt;MM: mixtape_manager.get('awesome-mixtape')\n    alt mixtape exists\n        MM--&gt;&gt;Flask: mixtape dict\n        Flask-&gt;&gt;FS: Resolve logo.svg / logo.png (if requested)\n        Flask-&gt;&gt;QRGen: generate_mixtape_qr(...)\n        QRGen--&gt;&gt;Flask: PNG bytes\n        Flask--&gt;&gt;UI: 200 PNG (Cache\u2011Control: public, max\u2011age=3600)\n    else\n        Flask--&gt;&gt;UI: 404 \u201cMixtape not found\u201d\n    end</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/web-application/routes/qr-codes.html#qrdownload","title":"<code>/qr/&lt;slug&gt;/download</code>","text":"Method Description <code>GET</code> Returns an enhanced QR code PNG that can include the mixtape\u2019s cover art and a title banner. The image is served as a downloadable attachment (<code>Content-Disposition: attachment</code>). <p>Request flow (simplified)</p> <pre><code>sequenceDiagram\n    participant UI as Browser\n    participant Flask as QR Blueprint\n    participant MM as MixtapeManager\n    participant FS as FileSystem (static folder)\n\n    UI-&gt;&gt;Flask: GET /qr/awesome-mixtape/download?size=800&amp;include_cover=true&amp;include_title=true\n    Flask-&gt;&gt;MM: mixtape_manager.get('awesome-mixtape')\n    alt mixtape exists\n        MM--&gt;&gt;Flask: mixtape dict\n        Flask-&gt;&gt;FS: Resolve logo.svg / logo.png\n        Flask-&gt;&gt;FS: Resolve mixtape cover (if requested)\n        Flask-&gt;&gt;QRGen: generate_mixtape_qr_with_cover(...)\n        QRGen--&gt;&gt;Flask: PNG bytes\n        Flask--&gt;&gt;UI: 200 PNG (attachment filename=\"&lt;title&gt;-qr-code.png\")\n    else\n        Flask--&gt;&gt;UI: 404 \u201cMixtape not found\u201d\n    end</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom"},{"location":"development/web-application/routes/qr-codes.html#-query-parameters","title":"\ud83d\udd75\ud83c\udffb\u200d\u2642\ufe0f Query Parameters","text":"Parameter Endpoint Type Default Allowed range / values Description <code>size</code> both integer 400 (simple) / 800 (download) 1\u2013800 (simple), 1\u20131200 (download) Pixel dimension of the generated QR code (square). <code>logo</code> simple boolean-like string <code>\"true\"</code> <code>\"true\"</code> / <code>\"false\"</code> (case-insensitive) Whether to overlay the site logo (SVG or PNG) in the centre of the QR. <code>include_cover</code> download boolean-like string <code>\"true\"</code> <code>\"true\"</code> / <code>\"false\"</code> Include the mixtape\u2019s cover art in the QR (centered). <code>include_title</code> download boolean-like string <code>\"true\"</code> <code>\"true\"</code> / <code>\"false\"</code> Render the mixtape title as a banner underneath the QR. <p>Note</p> <p>All parameters are optional. Missing or malformed values fall back to the defaults.</p>"},{"location":"development/web-application/routes/qr-codes.html#-response-details","title":"\ud83d\udde8\ufe0f Response Details","text":"Status Content-Type Body Headers 200 OK <code>image/png</code> Raw PNG bytes (the QR code). <code>Cache-Control: public, max-age=3600</code><code>Content-Disposition:</code>\u2022 Simple QR \u2013 <code>inline; filename=\"&lt;slug&gt;-qr.png\"</code>\u2022 Download QR \u2013 <code>attachment; filename=\"&lt;title&gt;-qr-code.png\"</code> 404 Not Found <code>application/json</code> <code>{ \"error\": \"Mixtape not found\" }</code> \u2014 500 Internal Server Error <code>application/json</code> <code>{ \"error\": \"Failed to generate QR code\" }</code> (or a more specific message if the <code>qrcode</code> library is missing). \u2014"},{"location":"development/web-application/routes/qr-codes.html#-error-handling","title":"\u26a0\ufe0f Error Handling","text":"<p>The blueprint catches two main error families:</p> <ol> <li> <p>Missing third\u2011party library \u2013 If <code>qrcode</code> (or <code>Pillow</code>) is not installed, an <code>ImportError</code> is raised. The handler logs the error and returns 500 with a helpful message:</p> <pre><code>QR code generation not available. Install qrcode library.\n</code></pre> </li> <li> <p>Unexpected runtime errors \u2013 Any other exception is logged (<code>logger.exception</code>) and a generic 500 response is sent:</p> <pre><code>Failed to generate QR code\n</code></pre> </li> </ol> <p>All 404 cases are handled by checking <code>mixtape_manager.get(slug)</code> and calling <code>abort(404, description=\"Mixtape not found\")</code>.</p>"},{"location":"development/web-application/routes/qr-codes.html#-internal-workflow","title":"\ud83d\udd00 Internal Workflow","text":"<pre><code>sequenceDiagram\n    participant UI as Browser\n    participant Flask as QR Blueprint\n    participant MM as MixtapeManager\n    participant QRGen as QR Generator (qr_generator.py)\n    participant FS as FileSystem (static folder)\n\n    UI-&gt;&gt;Flask: GET /qr/&lt;slug&gt;.png?size=400&amp;logo=true\n    Flask-&gt;&gt;MM: mixtape_manager.get(slug)\n    alt mixtape exists\n        MM--&gt;&gt;Flask: mixtape dict\n        Flask-&gt;&gt;FS: Resolve logo.svg (fallback to logo.png)\n        Flask-&gt;&gt;QRGen: generate_mixtape_qr(url, title, logo_path, size)\n        QRGen--&gt;&gt;Flask: PNG bytes\n        Flask--&gt;&gt;UI: 200 PNG (Cache\u2011Control)\n    else\n        Flask--&gt;&gt;UI: 404\n    end</code></pre>  Hold \"Alt\" / \"Option\" to enable pan &amp; zoom  <p>The download endpoint follows the same flow, with two extra steps: resolving the mixtape cover image and calling <code>generate_mixtape_qr_with_cover</code>.</p>"},{"location":"development/web-application/routes/qr-codes.html#-configuration--dependencies","title":"\ud83d\udd27 Configuration &amp; Dependencies","text":"Setting Where it lives Default Remarks <code>qrcode</code> (Python library) <code>project.toml</code> / <code>uv.lock</code> <code>&gt;=7.4</code> Required for both endpoints. <code>Pillow</code> (image handling) <code>project.toml</code> <code>&gt;=10.0</code> Needed for compositing the logo/cover. Static logo files <code>static/images/logo.svg</code> or <code>static/logo.png</code> \u2014 The blueprint prefers SVG; falls back to PNG. Cover directory <code>app.config[\"COVER_DIR\"]</code> (set in config.py) <code>collection-data/mixtapes/covers</code> Used only by the download endpoint. Cache-Control Hard-coded in the view (<code>public, max-age=3600</code>). \u2014 Adjust in the source if you need a different TTL. <p>Tip</p> <p>If you ever need to change the logo location, edit qr_blueprint.py where logo_path is resolved:</p> <pre><code>logo_path = Path(current_app.static_folder) / \"images\" / \"logo.svg\"\nif not logo_path.exists():\n    logo_path = Path(current_app.static_folder) / \"images\" / \"logo.png\"\n</code></pre>"},{"location":"development/web-application/routes/qr-codes.html#-example-requests","title":"\ud83d\udccc Example Requests","text":""},{"location":"development/web-application/routes/qr-codes.html#simple-qr-browser","title":"Simple QR (browser)","text":"<pre><code>curl -L -o mixtape-qr.png \\\n  \"http://localhost:5000/qr/awesome-mixtape.png?size=400&amp;logo=true\"\n</code></pre> <p>Result: <code>mixtape-qr.png</code> \u2013 a 400\u202f\u00d7\u202f400 PNG with the site logo in the centre.</p>"},{"location":"development/web-application/routes/qr-codes.html#enhanced-qr-download","title":"Enhanced QR (download)","text":"<pre><code>curl -L -O \\\n  \"http://localhost:5000/qr/awesome-mixtape/download?size=800&amp;include_cover=true&amp;include_title=true\"\n</code></pre> <p>Result: The server sends a <code>Content\u2011Disposition: attachment</code> header; the file will be saved as something like <code>Awesome\u2011Mixtape-qr-code.png</code>.</p>"},{"location":"development/web-application/routes/qr-codes.html#using-the-qr-from-the-editor-ui","title":"Using the QR from the Editor UI","text":"<p>The editor page (<code>editor.html</code>) contains a Share button (<code>#share-playlist</code>). When the user clicks it, the JavaScript module <code>static/js/editor/qrShare.js</code>:</p> <ol> <li>Retrieves the current mixtape slug (from the hidden <code>#editing-slug</code> input or <code>window.PRELOADED_MIXTAPE</code>).</li> <li>Opens the QR Share Modal (<code>#qrShareModal</code>).</li> <li>Sets the <code>&lt;img id=\"qr-code-img\"&gt;</code> source to <code>/qr/&lt;slug&gt;.png?...</code>.</li> <li>Shows a loading spinner until the image loads, then displays the QR.</li> <li>You can see the full client\u2011side implementation in <code>editorQrShare.txt</code>.</li> </ol>"},{"location":"development/web-application/routes/qr-codes.html#using-the-qr-from-the-public-player-ui","title":"Using the QR from the Public Player UI","text":"<p>The public player page (<code>play_mixtape.html</code>) includes a Share button (<code>#big-share-btn</code>). Its logic lives in <code>static/js/player/qrShare.js</code>:</p> <ul> <li>The same modal (<code>#qrShareModal</code>) is reused, but the download endpoint is called (<code>/qr/&lt;slug&gt;/download</code>) when the user clicks the Download button.</li> </ul> <p>Both modules share the same modal markup (see the bottom of <code>editor.html</code> and <code>play_mixtape.html</code>).</p>"},{"location":"development/web-application/routes/qr-codes.html#-frontend-integration","title":"\ud83d\udda5\ufe0f Front\u2011End Integration","text":""},{"location":"development/web-application/routes/qr-codes.html#architecture","title":"Architecture","text":"Component Location Role QR Modal <code>base.html</code> Global modal (<code>#qrShareModal</code>) available on all pages Common Module <code>static/js/common/qrShare.js</code> Shared logic for QR display, copying, and downloading Browser Integration <code>static/js/browser/index.js</code> Initializes QR for multiple mixtapes with <code>autoShow: true</code> Editor Integration <code>static/js/editor/index.js</code> Initializes QR for single mixtape with <code>autoShow: false</code> (shows after save) Player Integration <code>static/js/player/index.js</code> Initializes QR for public player with <code>autoShow: true</code>"},{"location":"development/web-application/routes/qr-codes.html#how-it-works","title":"How It Works","text":"<ol> <li>Modal defined once - <code>base.html</code> contains the QR modal markup, making it available globally</li> <li>Common module handles logic - <code>qrShare.js</code> manages modal display, QR loading, copy, and download</li> <li>Page-specific config - Each page calls <code>initQRShare()</code> with appropriate settings:</li> </ol> <pre><code>// Browser page - multiple share buttons\ninitQRShare({\n    shareButtonSelector: '.qr-share-btn',\n    getSlug: (button) =&gt; button ? button.dataset.slug : null,\n    autoShow: true\n});\n\n// Editor page - single share button, hidden until saved\ninitQRShare({\n    shareButtonSelector: '#share-playlist',\n    getSlug: () =&gt; document.getElementById('editing-slug')?.value,\n    autoShow: false  // Shows after save\n});\n\n// Player page - single share button\ninitQRShare({\n    shareButtonSelector: '#big-share-btn',\n    getSlug: () =&gt; extractSlugFromURL(),\n    autoShow: true\n});\n</code></pre>"},{"location":"development/web-application/routes/qr-codes.html#using-the-qr-from-the-editor-ui_1","title":"Using the QR from the Editor UI","text":"<p>The editor page (<code>editor.html</code>) contains a Share button (<code>#share-playlist</code>). When the user clicks it, the common QR module (<code>static/js/common/qrShare.js</code>):</p> <ol> <li>Retrieves the current mixtape slug (from the hidden <code>#editing-slug</code> input or <code>window.PRELOADED_MIXTAPE</code>)</li> <li>Opens the QR Share Modal (<code>#qrShareModal</code>) from <code>base.html</code></li> <li>Sets the <code>&lt;img id=\"qr-code-img\"&gt;</code> source to <code>/qr/&lt;slug&gt;.png?...</code></li> <li>Shows a loading spinner until the image loads, then displays the QR</li> <li>Provides copy link and download buttons within the modal</li> </ol>"},{"location":"development/web-application/routes/qr-codes.html#using-the-qr-from-the-public-player-ui_1","title":"Using the QR from the Public Player UI","text":"<p>The public player page (<code>play_mixtape.html</code>) includes a Share button (<code>#big-share-btn</code>). The same common module handles the logic:</p> <ul> <li>The modal (<code>#qrShareModal</code>) is loaded from <code>base.html</code></li> <li>The download endpoint (<code>/qr/&lt;slug&gt;/download</code>) is called when the user clicks Download</li> <li>All functionality is identical to the editor page, ensuring consistency</li> </ul> <p>Both pages share the same modal markup (from <code>base.html</code>) and logic (from <code>common/qrShare.js</code>).</p>"},{"location":"development/web-application/routes/qr-codes.html#-api","title":"\ud83d\udd0c API","text":""},{"location":"development/web-application/routes/qr-codes.html#src.routes.qr_blueprint","title":"<code>qr_blueprint</code>","text":"<p>Functions:</p> Name Description <code>create_qr_blueprint</code> <p>Creates Flask blueprint for QR code generation.</p>"},{"location":"development/web-application/routes/qr-codes.html#src.routes.qr_blueprint.create_qr_blueprint","title":"<code>create_qr_blueprint(mixtape_manager, logger=None)</code>","text":"<p>Creates Flask blueprint for QR code generation.</p> <p>Parameters:</p> Name Type Description Default <code>mixtape_manager</code> <code>MixtapeManager</code> <p>MixtapeManager instance for retrieving mixtape data</p> required <code>logger</code> <code>Logger | None</code> <p>Logger instance for error reporting</p> <code>None</code> <p>Returns:</p> Name Type Description <code>Blueprint</code> <code>Blueprint</code> <p>Configured Flask blueprint for QR endpoints</p> Source code in <code>src/routes/qr_blueprint.py</code> <pre><code>def create_qr_blueprint(\n    mixtape_manager: MixtapeManager, logger: Logger | None = None\n) -&gt; Blueprint:\n    \"\"\"\n    Creates Flask blueprint for QR code generation.\n\n    Args:\n        mixtape_manager: MixtapeManager instance for retrieving mixtape data\n        logger: Logger instance for error reporting\n\n    Returns:\n        Blueprint: Configured Flask blueprint for QR endpoints\n    \"\"\"\n    qr = Blueprint(\"qr\", __name__)\n    logger: Logger = logger or NullLogger()\n\n    @qr.route(\"/qr/&lt;slug&gt;.png\")\n    def generate_qr(slug: str) -&gt; Response:\n        \"\"\"\n        Generate a simple QR code PNG for a mixtape share URL.\n\n        Query parameters:\n            size: QR code size in pixels (default 400, max 800)\n            logo: Include logo in center (default true)\n            type: URL type - 'share' for public player or 'gift-playful'/'gift-elegant' for gift experience (default 'share')\n            to: Gift recipient name (for gift URLs)\n            from: Gift sender name (for gift URLs)\n            note: Gift personal message (for gift URLs)\n\n        Args:\n            slug: The mixtape slug identifier (URL-encoded)\n\n        Returns:\n            Response: PNG image of the QR code\n        \"\"\"\n        # URL decode the slug (handles spaces and special characters)\n        slug = unquote(slug)\n\n        # Verify mixtape exists\n        mixtape = mixtape_manager.get(slug)\n        if not mixtape:\n            abort(404, description=\"Mixtape not found\")\n\n        # Get parameters\n        size = min(int(request.args.get(\"size\", 400)), 800)\n        include_logo = request.args.get(\"logo\", \"true\").lower() != \"false\"\n        url_type = request.args.get(\"type\", \"share\")\n\n        # Get gift personalization parameters\n        gift_to = request.args.get(\"to\", \"\")\n        gift_from = request.args.get(\"from\", \"\")\n        gift_note = request.args.get(\"note\", \"\")\n\n        # Generate QR code\n        try:\n            # Get logo path if requested\n            logo_path = None\n            if include_logo:\n                logo_path = Path(current_app.static_folder) / \"images\" / \"logo.svg\"\n                if not logo_path.exists():\n                    logo_path = Path(current_app.static_folder) / \"images\" / \"logo.png\"\n                    if not logo_path.exists():\n                        logo_path = None\n\n            # Build share URL with gift parameters if applicable\n            share_url = _get_url(slug=slug, url_type=url_type)\n\n            # Add gift parameters to URL if present\n            if url_type in [\"gift-playful\", \"gift-elegant\"]:\n                params = []\n                if gift_to:\n                    params.append(f\"to={quote(gift_to)}\")\n                if gift_from:\n                    params.append(f\"from={quote(gift_from)}\")\n                if gift_note:\n                    params.append(f\"note={quote(gift_note)}\")\n\n                if params:\n                    share_url = f\"{share_url}?{'&amp;'.join(params)}\"\n\n            qr_bytes = generate_mixtape_qr(\n                url=share_url,\n                title=mixtape.get(\"title\", \"Mixtape\"),\n                logo_path=logo_path,\n                size=size,\n            )\n\n            # Create filename based on type\n            filename_type = \"gift\" if url_type.startswith(\"gift\") else \"qr\"\n            filename = f\"{slug}-{filename_type}.png\"\n\n            response = Response(qr_bytes, mimetype=\"image/png\")\n            response.headers[\"Cache-Control\"] = \"public, max-age=3600\"\n            response.headers[\"Content-Disposition\"] = f'inline; filename=\"{filename}\"'\n\n            return response\n\n        except ImportError as e:\n            logger.error(f\"QR code generation failed - library not installed: {e}\")\n            abort(\n                500,\n                description=\"QR code generation not available. Install qrcode library.\",\n            )\n        except Exception as e:\n            logger.exception(f\"QR code generation failed: {e}\")\n            abort(500, description=\"Failed to generate QR code\")\n\n    def _get_url(slug: str, url_type: str=\"\"):\n        if url_type not in [\"share\", \"gift-playful\", \"gift-elegant\"]:\n            url_type = \"share\"\n\n        # Build the appropriate URL based on type\n        if url_type == \"gift-playful\":\n            share_url = url_for(\"play.gift_playful\", slug=slug, _external=True)\n        elif url_type == \"gift-elegant\":\n            share_url = url_for(\"play.gift_elegant\", slug=slug, _external=True)\n        else:\n            share_url = url_for(\"play.public_play\", slug=slug, _external=True)\n\n        return share_url\n\n    @qr.route(\"/qr/&lt;slug&gt;/download\")\n    def download_qr(slug: str) -&gt; Response:\n        \"\"\"\n        Download enhanced QR code with cover art and title.\n\n        Query parameters:\n            size: QR code size in pixels (default 800, max 1200)\n            include_cover: Include mixtape cover art (default true)\n            include_title: Include mixtape title banner (default true)\n            type: URL type - 'share' for public player or 'gift' for gift experience (default 'share')\n\n        Args:\n            slug: The mixtape slug identifier (URL-encoded)\n\n        Returns:\n            Response: PNG image as downloadable attachment\n        \"\"\"\n        # URL decode the slug (handles spaces and special characters)\n        slug = unquote(slug)\n\n        # Verify mixtape exists\n        mixtape = mixtape_manager.get(slug)\n        if not mixtape:\n            abort(404, description=\"Mixtape not found\")\n\n        # Get parameters\n        qr_size = min(int(request.args.get(\"size\", 800)), 1200)\n        include_cover = request.args.get(\"include_cover\", \"true\").lower() != \"false\"\n        include_title = request.args.get(\"include_title\", \"true\").lower() != \"false\"\n        url_type = request.args.get(\"type\", \"share\")  # 'share' or 'gift'\n\n        try:\n            # Get logo path\n            logo_path = Path(current_app.static_folder) / \"images\" / \"logo.svg\"\n            if not logo_path.exists():\n                logo_path = Path(current_app.static_folder) / \"images\" / \"logo.png\"\n                if not logo_path.exists():\n                    logo_path = None\n\n            # Get cover path if requested\n            cover_path = None\n            if include_cover and mixtape.get(\"cover\"):\n                cover_filename = mixtape[\"cover\"].split(\"/\")[-1]\n                cover_path = Path(current_app.config[\"COVER_DIR\"]) / cover_filename\n                if not cover_path.exists():\n                    cover_path = None\n\n            # Generate enhanced QR code\n            share_url = _get_url(slug=slug, url_type=url_type)\n            qr_bytes = generate_mixtape_qr_with_cover(\n                url=share_url,\n                title=mixtape.get(\"title\", \"Mixtape\"),\n                cover_path=cover_path,\n                logo_path=logo_path,\n                qr_size=qr_size,\n                include_title=include_title,\n            )\n\n            # Sanitize title for filename\n            title = mixtape.get(\"title\", \"mixtape\")\n            safe_title = \"\".join(c if c.isalnum() or c in \" -_\" else \"_\" for c in title)\n\n            # Create filename based on type\n            type_suffix = \"gift\" if url_type == \"gift\" else \"mixtape\"\n            filename = f\"{safe_title}-{type_suffix}-qr-code.png\"\n\n            response = Response(qr_bytes, mimetype=\"image/png\")\n            response.headers[\"Content-Disposition\"] = (\n                f'attachment; filename=\"{filename}\"'\n            )\n\n            return response\n\n        except ImportError as e:\n            logger.error(f\"QR code generation failed - library not installed: {e}\")\n            abort(\n                500,\n                description=\"QR code generation not available. Install qrcode library.\",\n            )\n        except Exception as e:\n            logger.exception(f\"QR code download failed: {e}\")\n            abort(500, description=\"Failed to generate QR code\")\n\n    return qr\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html","title":"Toast Notification System","text":""},{"location":"development/web-application/ui-components/toast-system.html#toast-system-quick-reference","title":"Toast System Quick Reference","text":""},{"location":"development/web-application/ui-components/toast-system.html#-import","title":"\ud83d\udce6 Import","text":"<pre><code>import {\n    showSuccessToast,\n    showInfoToast,\n    showWarningToast,\n    showErrorToast,\n    showPWAToast,\n    showPlaybackErrorToast,\n    showToast,\n    TOAST_TYPES\n} from './common/toastSystem.js';\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-quick-usage","title":"\ud83d\ude80 Quick Usage","text":"<pre><code>// \u2705 Success (green, 3s)\nshowSuccessToast('Saved successfully!');\n\n// \u2139\ufe0f Info (blue, 4s)\nshowInfoToast('Loading data...');\n\n// \u26a0\ufe0f Warning (yellow, 5s)\nshowWarningToast('Slow connection detected');\n\n// \u274c Error (red, stays visible)\nshowErrorToast('Failed to save');\n\n// \ud83d\udcf1 PWA (blue, 3s, priority 10, z-index 9999)\nshowPWAToast('App installed successfully!');\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-with-options","title":"\u2699\ufe0f With Options","text":"<pre><code>// Custom duration\nshowInfoToast('Quick message', { duration: 2000 });\n\n// Force auto-hide on error\nshowErrorToast('Minor error', { autohide: true });\n\n// Prevent auto-hide\nshowWarningToast('Important!', { autohide: false });\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-with-actions","title":"\ud83e\udde9 With Actions","text":"<pre><code>showErrorToast('Connection lost', {\n    actions: [\n        {\n            label: 'Retry',\n            handler: () =&gt; retry(),\n            primary: true  // Primary styling\n        },\n        {\n            label: 'Cancel',\n            handler: () =&gt; cancel()\n        }\n    ]\n});\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-playback-errors","title":"\ud83c\udfb5 Playback Errors","text":"<pre><code>// Terminal error with skip button\nshowPlaybackErrorToast('Cannot play track', {\n    isTerminal: true,\n    onSkip: () =&gt; playNext()\n});\n\n// Non-terminal error (auto-hide)\nshowPlaybackErrorToast('Buffering issue', {\n    isTerminal: false\n});\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-pwa-system-toasts","title":"\ud83d\udcf1 PWA System Toasts","text":"<pre><code>// High-priority PWA events (show immediately, z-index 9999)\nshowPWAToast('App installed successfully!');\nshowPWAToast('Update available');\nshowPWAToast('Back online');\nshowPWAToast('You are offline');\n\n// Use for: Install, updates, connectivity changes\n// Priority 10: Interrupts lower-priority toasts\n// Z-index 9999: Appears above modals\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-programmatic-control","title":"\ud83d\udd79\ufe0f Programmatic Control","text":"<pre><code>// Get control object\nconst toast = showInfoToast('Processing...');\n\n// Later, dismiss it\ntoast.dismiss();\n\n// Example pattern\nconst loading = showInfoToast('Loading...');\ndoWork()\n    .then(() =&gt; {\n        loading.dismiss();\n        showSuccessToast('Done!');\n    })\n    .catch(() =&gt; {\n        loading.dismiss();\n        showErrorToast('Failed');\n    });\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-legacy-compatibility","title":"\ud83e\uddd3 Legacy Compatibility","text":"<pre><code>import { showLegacyToast } from './common/toastSystem.js';\n\n// Bootstrap type names\nshowLegacyToast('Success', 'success');\nshowLegacyToast('Error', 'danger');\nshowLegacyToast('Warning', 'warning');\nshowLegacyToast('Info', 'info');\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-toast-types","title":"\ud83c\udff7\ufe0f Toast Types","text":"Type Color Duration Auto-hide Priority Icon SUCCESS Green 3s Yes 1 \u2705 Check INFO Blue 4s Yes 1 \u2139\ufe0f Info WARNING Yellow 5s Yes 1 \u26a0\ufe0f Warning ERROR Red 8s No 2 \u274c Triangle PWA Blue 3s Yes 10 \ud83d\udcf1 App"},{"location":"development/web-application/ui-components/toast-system.html#-queue-behavior","title":"\ud83d\udcec Queue Behavior","text":"<ul> <li>Toasts show one at a time</li> <li>New toasts queue automatically</li> <li>User can dismiss current toast early</li> <li>Next toast shows immediately after</li> </ul>"},{"location":"development/web-application/ui-components/toast-system.html#-common-patterns","title":"\ud83e\udde0 Common Patterns","text":""},{"location":"development/web-application/ui-components/toast-system.html#save-operation","title":"Save Operation","text":"<pre><code>const save = async () =&gt; {\n    const toast = showInfoToast('Saving...');\n    try {\n        await saveData();\n        toast.dismiss();\n        showSuccessToast('Saved!');\n    } catch (err) {\n        toast.dismiss();\n        showErrorToast(`Failed: ${err.message}`);\n    }\n};\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#multiple-operations","title":"Multiple Operations","text":"<pre><code>items.forEach(item =&gt; {\n    processItem(item);\n    showSuccessToast(`Processed ${item.name}`);\n});\n// All toasts show in sequence!\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#error-with-recovery","title":"Error with Recovery","text":"<pre><code>showErrorToast('Operation failed', {\n    autohide: false,\n    actions: [\n        { label: 'Retry', handler: () =&gt; retry(), primary: true },\n        { label: 'Cancel', handler: () =&gt; cancel() }\n    ]\n});\n</code></pre>"},{"location":"development/web-application/ui-components/toast-system.html#-tips","title":"\ud83d\udca1 Tips","text":"<p>\u2705 DO:</p> <ul> <li>Use appropriate type for message severity</li> <li>Keep messages brief (one sentence max)</li> <li>Provide actions for errors when possible</li> <li>Use queue naturally for sequential operations</li> </ul> <p>\u274c DON'T:</p> <ul> <li>Spam toasts rapidly (users can't read them)</li> <li>Make critical errors auto-hide</li> <li>Use long messages (keep under 50 chars)</li> <li>Nest toasts in loops without throttling</li> </ul>"},{"location":"development/web-application/ui-components/toast-system.html#-module-location","title":"\ud83d\udcc1 Module Location","text":"<p><code>/static/js/common/toastSystem.js</code></p>"},{"location":"development/web-application/ui-components/toast-system.html#-dependencies","title":"\ud83d\udd17 Dependencies","text":"<ul> <li>ES6 modules</li> <li>Bootstrap 5 (for styling)</li> </ul>"},{"location":"development/web-application/utilities/common.html","title":"Common Module","text":""},{"location":"development/web-application/utilities/common.html#common","title":"Common","text":"<p>The <code>common</code> module contains stable, infrastructure-free abstractions that may be used by all layers.</p>"},{"location":"development/web-application/utilities/common.html#api","title":"API","text":""},{"location":"development/web-application/utilities/common.html#src.common.logging","title":"<code>logging</code>","text":"<p>Classes:</p> Name Description <code>Logger</code> <p>Protocol for logger objects supporting info, warning, and error messages.</p> <code>NullLogger</code> <p>A logger implementation that ignores all log messages.</p>"},{"location":"development/web-application/utilities/common.html#src.common.logging.Logger","title":"<code>Logger</code>","text":"<p>               Bases: <code>Protocol</code></p> <p>Protocol for logger objects supporting info, warning, and error messages.</p> <p>Any logger implementing this protocol must provide info, warning, and error methods that accept a string message.</p>"},{"location":"development/web-application/utilities/common.html#src.common.logging.NullLogger","title":"<code>NullLogger</code>","text":"<p>A logger implementation that ignores all log messages.</p> <p>This logger provides info, warning, and error methods that do nothing, useful for disabling logging in certain contexts.</p>"},{"location":"development/web-application/utilities/utilities.html","title":"Utilities","text":""},{"location":"development/web-application/utilities/utilities.html#utilities","title":"Utilities","text":""},{"location":"development/web-application/utilities/utilities.html#-git-version-utility","title":"\ud83d\udd16 Git version utility","text":"<p>The <code>version_info.py</code> file provides <code>get_version()</code> to access Git version information of the codebase. imported wherever version information is needed within the application. Its design ensures robust and consistent version reporting across different environments and deployment scenarios.</p> <p>It attempts to retrieve the latest Git tag, formats the version string to include commit distance and hash when not on a tag, and gracefully falls back to a default value (\"dev\") if Git is unavailable or an error occurs. This ensures that the application always has a meaningful version identifier, useful for debugging, deployment, and user information.</p>"},{"location":"development/web-application/utilities/utilities.html#api-get_version","title":"API <code>get_version</code>","text":""},{"location":"development/web-application/utilities/utilities.html#src.utils.version_info","title":"<code>version_info</code>","text":"<p>Functions:</p> Name Description <code>get_version</code> <p>Get the application version string for the current environment.</p>"},{"location":"development/web-application/utilities/utilities.html#src.utils.version_info.get_version","title":"<code>get_version()</code>","text":"<p>Get the application version string for the current environment.</p> <p>This function prefers a pre-baked version from the environment and falls back to querying Git metadata when available.</p> <p>Parameters:</p> Name Type Description Default <code>APP_VERSION</code> <p>Optional environment variable containing a pre-baked version string.</p> required <p>Returns:</p> Type Description <code>str</code> <p>The resolved version string, or \"dev\" when no version information can</p> <code>str</code> <p>be determined.</p> Source code in <code>src/utils/version_info.py</code> <pre><code>def get_version() -&gt; str:\n    \"\"\"Get the application version string for the current environment.\n\n    This function prefers a pre-baked version from the environment and falls\n    back to querying Git metadata when available.\n\n    Args:\n        APP_VERSION: Optional environment variable containing a pre-baked\n            version string.\n\n    Returns:\n        The resolved version string, or \"dev\" when no version information can\n        be determined.\n    \"\"\"\n    if baked_version := os.getenv(\"APP_VERSION\"):\n        return baked_version\n\n    # Local development fallback\n    try:\n        if result := subprocess.check_output(\n            [\"git\", \"describe\", \"--tags\", \"--abbrev=8\", \"--always\"],\n            stderr=subprocess.DEVNULL,\n            text=True,\n            timeout=5,\n        ).strip():\n            version = _parse_and_format_version(result)\n            os.environ[\"APP_VERSION\"] = version\n            return version\n    except Exception as e:\n        logger.warning(f\"Git version detection failed: {e}\")\n\n    return \"dev\"\n</code></pre>"},{"location":"development/web-application/utilities/utilities.html#-cover-image-compositor","title":"\ud83d\uddbc\ufe0f Cover image compositor","text":"<p>This file <code>cover_compositor.py</code> defines a <code>CoverCompositor</code> utility that generates a composite \u201ccollage\u201d image from a set of album cover images. It:</p> <ul> <li>Takes a directory of cover images and a list of cover filenames (with possible duplicates).</li> <li>Builds a square grid (N\u00d7N) of cover tiles sized 400\u00d7400 pixels each.</li> <li>Uses cover frequency (duplicates) to influence which covers are repeated when filling the grid.</li> <li>Performs basic image processing (center square crop, slight contrast boost).</li> <li>Outputs the final composite as a base64-encoded JPEG data URL (<code>data:image/jpeg;base64,...</code>), suitable for embedding directly in HTML or APIs without separate image hosting.</li> </ul>"},{"location":"development/web-application/utilities/utilities.html#api-covercompositor","title":"API <code>CoverCompositor</code>","text":""},{"location":"development/web-application/utilities/utilities.html#src.utils.cover_compositor.CoverCompositor","title":"<code>CoverCompositor(covers_dir, logger=None)</code>","text":"<p>Creates composite cover artwork from individual cover images.</p> <p>Provides utilities to arrange multiple covers into a grid and export the result as an embeddable image.</p> <p>Initializes the compositor with a covers directory and optional logger.</p> <p>Stores paths and logging configuration so composite images can be built and diagnostics recorded.</p> <p>Parameters:</p> Name Type Description Default <code>covers_dir</code> <code>Path</code> <p>Filesystem path where individual cover images are stored.</p> required <code>logger</code> <code>Logger</code> <p>Optional logger instance used for warnings and diagnostic messages.</p> <code>None</code> <p>Methods:</p> Name Description <code>generate_grid_composite</code> <p>Generates a composite cover image from multiple individual cover files.</p> Source code in <code>src/utils/cover_compositor.py</code> <pre><code>def __init__(self, covers_dir: Path, logger: Logger=None):\n    \"\"\"Initializes the compositor with a covers directory and optional logger.\n\n    Stores paths and logging configuration so composite images can be built and diagnostics recorded.\n\n    Args:\n        covers_dir: Filesystem path where individual cover images are stored.\n        logger: Optional logger instance used for warnings and diagnostic messages.\n    \"\"\"\n    self.covers_dir = covers_dir\n    self._logger = logger\n</code></pre>"},{"location":"development/web-application/utilities/utilities.html#src.utils.cover_compositor.CoverCompositor.generate_grid_composite","title":"<code>generate_grid_composite(cover_paths)</code>","text":"<p>Generates a composite cover image from multiple individual cover files.</p> <p>Builds a square grid of cover tiles and returns the result as a base64-encoded JPEG data URL.</p> <p>Parameters:</p> Name Type Description Default <code>cover_paths</code> <code>list[str]</code> <p>List of cover filenames (may contain duplicates for weighting).</p> required <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>A data URL string containing the base64-encoded JPEG composite image.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If no cover paths are provided or no images can be loaded.</p> Source code in <code>src/utils/cover_compositor.py</code> <pre><code>def generate_grid_composite(self, cover_paths: list[str]) -&gt; str:\n    \"\"\"Generates a composite cover image from multiple individual cover files.\n\n    Builds a square grid of cover tiles and returns the result as a base64-encoded JPEG data URL.\n\n    Args:\n        cover_paths: List of cover filenames (may contain duplicates for weighting).\n\n    Returns:\n        str: A data URL string containing the base64-encoded JPEG composite image.\n\n    Raises:\n        ValueError: If no cover paths are provided or no images can be loaded.\n    \"\"\"\n    if not cover_paths:\n        raise ValueError(\"No covers provided\")\n\n    fill_covers, grid_size = self._build_fill_covers(cover_paths)\n    tiles = self._load_tiles(fill_covers)\n\n    if not tiles:\n        raise ValueError(\"No images could be loaded\")\n\n    composite = self._compose_grid(tiles, grid_size)\n    return self._encode_image_to_data_url(composite)\n</code></pre>"},{"location":"project/index.html","title":"Overview","text":""},{"location":"project/index.html#project","title":"Project","text":"<p>Mixtape Society is still early days\u2014a solo project that's finding its footing. This section covers where it's headed and how you can get involved if you're interested.</p>"},{"location":"project/index.html#-whats-happening","title":"\ud83d\udce3 What's Happening","text":"<ul> <li>\ud83c\udfaf Roadmap - What I'm working on next</li> <li>\ud83d\udca1 Ideas - Things being explored (lots here!)</li> <li>\ud83d\udcdd Changelog - What's been shipped so far</li> </ul>"},{"location":"project/index.html#-get-involved","title":"\ud83d\udc99 Get Involved","text":"<ul> <li>\ud83d\udcac GitHub Discussions - Share thoughts or ask questions</li> <li>\ud83d\udc1b Open an issue - Report bugs or suggest features</li> <li>\ud83e\udd1d Contributing guide - How to help out</li> </ul> <p>No pressure, but if something here resonates, feel free to jump in.</p>"},{"location":"project/index.html#-core-principles","title":"\ud83e\udded Core principles","text":"<ul> <li>No central-server accounts</li> <li>No Spotify / Apple Music integration</li> <li>No social features (likes, comments, following)</li> <li>No ads, analytics, or telemetry by default</li> </ul>"},{"location":"project/index.html#principle-enforcement","title":"Principle enforcement","text":"<ul> <li>No accounts \u2013 Public routes (<code>/share/&lt;slug&gt;</code>, <code>/play/...</code>, <code>/qr/...</code>) have no <code>@login_required</code> decorators. The optional <code>authentication</code> blueprint is not registered in production.</li> <li>No streaming\u2011service integration \u2013 All audio files are served from <code>MUSIC_ROOT</code>; <code>play.py</code> never contacts Spotify, Apple\u202fMusic, or any third\u2011party API.</li> <li>No social features \u2013 Search results, mixtape pages, and the editor contain no \u201clike\u201d, \u201ccomment\u201d, or \u201cfollow\u201d UI elements.</li> <li>No ads / telemetry \u2013 No analytics scripts, no tracking pixels, and all responses omit <code>Set\u2011Cookie</code> headers (except the optional session cookie for the admin UI).</li> </ul>"},{"location":"project/index.html#-project-terminology","title":"\ud83d\udcd6 Project Terminology","text":"Term Meaning (in this project) Mixtape A JSON bundle (<code>mixtape.json</code>) plus optional cover image and audio files. Slug URL-safe identifier derived from the mixtape title (used in <code>/share/&lt;slug&gt;</code>). QR card Physical artifact that embeds a QR code pointing to the public mixtape URL. NFC tag Optional near-field-communication sticker that stores the same URL. Access policy Optional JSON field that controls time-based or \u201conce-only\u201d playback. QR blueprint Flask blueprint (<code>qr_blueprint.py</code>) that serves <code>/qr/&lt;slug&gt;.png</code> and <code>/qr/&lt;slug&gt;/download</code>. Editor blueprint Flask blueprint (<code>editor.py</code>) that handles creation, editing, and saving. Play blueprint Flask blueprint (<code>play.py</code>) that streams audio and renders the public page."},{"location":"project/about.html","title":"About Mixtape Society","text":""},{"location":"project/about.html#about-mixtape-society","title":"About Mixtape Society","text":"<p>Mixtape Society is a self-hosted web application that lets you create, manage, and share personalized music mixtapes from your own music library. Inspired by the nostalgia of cassette tapes, it brings a modern twist: drag-and-drop editing, custom covers, and public share links for easy listening without accounts or apps.</p>"},{"location":"project/about.html#-project-goals","title":"\ud83e\udd45 Project Goals","text":"<ul> <li>Privacy-First: Everything runs on your hardware\u2014no cloud uploads, no tracking.</li> <li>Simplicity: Easy to set up and use, even for non-techies.</li> <li>Nostalgia Meets Modern: Recreate the joy of mixtapes with features like themes and browser-based streaming.</li> <li>Open Source: Free and open for contributions, under the MIT License.</li> </ul>"},{"location":"project/about.html#-who-built-this","title":"\ud83e\uddd4\ud83c\udffc\u200d\u2642\ufe0f Who Built This?","text":"<p>Hi, I'm Mark Zwart (e.g., mark-me on GitHub), a Dutch developer and music enthusiast based in The Netherlands. I created Mixtape Society because I wanted a simple way to share curated playlists from my personal collection without relying on big streaming services.</p> <p>If you'd like to connect:</p> <ul> <li>GitHub: github.com/mark-me</li> </ul>"},{"location":"project/about.html#-acknowledgements","title":"\ud83d\ude4c Acknowledgements","text":"<p>Mixtape Society leverages several fantastic open-source libraries and tools. A big thank you to the developers and communities behind these projects.</p>"},{"location":"project/about.html#python--backend","title":"Python &amp; Backend","text":"<ul> <li>Flask \u2013 Web framework that powers everything</li> <li>Jinja2 \u2013 Templating engine used for dynamic HTML rendering in all pages.</li> <li>Flask-CORS \u2013 Simple cross-origin resource sharing</li> <li>Flask-Limiter \u2013 Rate limiting for the login route</li> <li>Flask-Login \u2013 Session management</li> <li>FFmpeg - Transcoding audio quality</li> <li>Gunicorn \u2013 Production WSGI server</li> <li>Pillow \u2013 Image processing for uploaded covers and OpenGraph image generation</li> <li>python-dotenv \u2013 Easy .env file support</li> <li>python-json-logger \u2013 Structured logging</li> <li>TinyTag \u2013 Fast and lightweight audio metadata reading</li> <li>Watchdog \u2013 File system events for auto-reindexing the music library</li> <li>SQLite \u2013 Embedded, zero-configuration database that stores the music library index and makes instant search possible.</li> </ul>"},{"location":"project/about.html#documentation","title":"Documentation","text":"<ul> <li>MkDocs &amp; Material for MkDocs \u2013 Static documentation you\u2019re reading right now</li> <li>mkdocstrings \u2013 Auto-generated API docs from code</li> <li>mkdocs-git-revision-date-localized-plugin \u2013 Page last-updated dates</li> <li>mkdocs-git-committers-plugin \u2013 Contributor credits</li> <li>mkdocs-panzoom-plugin \u2013 Zoomable screenshots</li> <li>mermaid2 \u2013 Diagrams</li> </ul>"},{"location":"project/about.html#frontend--design","title":"Frontend &amp; Design","text":"<ul> <li>Cassette Tape SVG Vector by flat-icon-design- Favicon is based on this</li> <li>Bootstrap 5 \u2013 The entire responsive UI, cards, buttons, modals, and grid system</li> <li>Bootstrap Icons \u2013 All the lovely icons you see everywhere</li> <li>Sortable.js \u2013 Drag-and-drop reordering in the editor</li> <li>Vibrant.js \u2013 Extract prominent colors from an image.</li> </ul>"},{"location":"project/about.html#-license","title":"\u2696\ufe0f License","text":"<p>Mixtape Society is released under the . Feel free to fork, modify, and share\u2014but remember, users are responsible for their own music content (no copyrighted media is included or distributed).</p>"},{"location":"project/about.html#-get-involved","title":"\ud83d\udc65\ud83d\udd27 Get Involved","text":"<ul> <li>Report issues or suggest features on GitHub Issues.</li> <li>Star the repo if you like it!</li> </ul> <p>Thanks for checking out Mixtape Society\u2014happy mixtaping! \ud83c\udfa7</p>"},{"location":"project/changelog.html","title":"Changelog","text":""},{"location":"project/changelog.html#changelog","title":"Changelog","text":"<p>All notable changes to Mixtape Society are documented here. We follow Semantic Versioning and the spirit of Keep a Changelog.</p> <p>Each release rewinds and fast-forwards your mixtape experience\u2014just like a real cassette! \ud83c\udfa7</p>"},{"location":"project/changelog.html#-v075","title":"\ud83d\udce6 v0.7.5","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-26</p>"},{"location":"project/changelog.html#-changed","title":"\ud83d\udd27 Changed","text":"<ul> <li>Refactored playerControl.js, split across more files</li> <li>Restructuring documentation</li> </ul>"},{"location":"project/changelog.html#-fixed","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Playback stops on mobile</li> <li>Reusing indexing for tracking playback across multiple mixtapes</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v074","title":"\ud83d\udce6 v0.7.4","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-25</p>"},{"location":"project/changelog.html#-changed_1","title":"\ud83d\udd27 Changed","text":"<ul> <li>Removed cover upload limit</li> <li>Added artist to track label for compilation albums</li> <li>Speeded up quering by improving indexes, batching count queries and batching compilcation detection</li> </ul>"},{"location":"project/changelog.html#-fixed_1","title":"\ud83d\udc1b Fixed","text":"<ul> <li>With new mixtape, every save results in a new one</li> <li>Bottom player play button doesn't resume track after page reload</li> <li>Playback stops on mobile</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v073","title":"\ud83d\udce6 v0.7.3","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-24</p>"},{"location":"project/changelog.html#-added","title":"\u2728 Added","text":"<ul> <li>Sleep timer</li> </ul>"},{"location":"project/changelog.html#-fixed_2","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Some Android devices stopped playback when track ended</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v072","title":"\ud83d\udce6 v0.7.2","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-23</p>"},{"location":"project/changelog.html#-added_1","title":"\u2728 Added","text":"<ul> <li>Add confirmation modal when emptying mixtape</li> </ul>"},{"location":"project/changelog.html#-changed_2","title":"\ud83d\udd27 Changed","text":"<ul> <li>Centralized toast system for better consistency</li> </ul>"},{"location":"project/changelog.html#-fixed_3","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Chromecasting</li> <li>Android Auto</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v071","title":"\ud83d\udce6 v0.7.1","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-22</p>"},{"location":"project/changelog.html#-added_2","title":"\u2728 Added","text":"<ul> <li>Shuffle option for receiver</li> <li>Repeat mode (off/all/one)</li> </ul>"},{"location":"project/changelog.html#-removed","title":"\ud83d\uddd1\ufe0f Removed","text":"<ul> <li>Onboarding tooltips (too little under control to be useful)</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v070","title":"\ud83d\udce6 v0.7.0","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-21</p>"},{"location":"project/changelog.html#-added_3","title":"\u2728 Added","text":"<ul> <li>Gift receiver experience!</li> <li>Help pages for users</li> <li>Resuming playback on reload</li> </ul>"},{"location":"project/changelog.html#-fixed_4","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Made playback more resistant against temporary network failures</li> <li>Play button on bottom didn't properly show on mobile devices with a light theme</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v060","title":"\ud83d\udce6 v0.6.0","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-19</p>"},{"location":"project/changelog.html#-added_4","title":"\u2728 Added","text":"<ul> <li>Prefetching next song data for improved song switching.</li> </ul>"},{"location":"project/changelog.html#-fixed_5","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Android car not showing in car.</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v059","title":"\ud83d\udce6 v0.5.9","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-17</p>"},{"location":"project/changelog.html#-fixed_6","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Limiter only applied to login page</li> <li>PWA manifest was not dynamic, so would not work for received shared mixtapes</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v058","title":"\ud83d\udce6 v0.5.8","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-16</p>"},{"location":"project/changelog.html#-added_5","title":"\u2728 Added","text":"<ul> <li>Added Android Auto support</li> <li>Size-optimized cover generation</li> <li>Mechanical click sound effect for cassette mode</li> <li>Lots of extra and restructured documentation</li> </ul>"},{"location":"project/changelog.html#-fixed_7","title":"\ud83d\udc1b Fixed","text":"<ul> <li>The artist's album accordions in the search results went missing since v0.5.7</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v057","title":"\ud83d\udce6 v0.5.7","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-13</p>"},{"location":"project/changelog.html#-added_6","title":"\u2728 Added","text":"<ul> <li>Added PWA (Progressive Web App) support for offline playback and installation</li> <li>Added ChromeCast support for playback</li> </ul>"},{"location":"project/changelog.html#-fixed_8","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Allow searching for strange characters in artist/album/track names</li> <li>Type 3 characters to start searching -&gt; 2 characters</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v056","title":"\ud83d\udce6 v0.5.6","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-11</p>"},{"location":"project/changelog.html#-added_7","title":"\u2728 Added","text":"<ul> <li>Multi-Architecture Docker Build Setup</li> </ul>"},{"location":"project/changelog.html#-fixed_9","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Slug sanitation for mixtape titles with spaces and non-URL-safe characters</li> <li>Centered QR code in modal</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v055","title":"\ud83d\udce6 v0.5.5","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-09</p>"},{"location":"project/changelog.html#-added_8","title":"\u2728 Added","text":"<ul> <li>Sharing through QR codes on browse, editor and playback pages</li> <li>Filtering and sorting on the mixtape browsing page</li> </ul>"},{"location":"project/changelog.html#-changed_3","title":"\ud83d\udd27 Changed","text":"<ul> <li>Changed search bar for the mixtape editor</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v054","title":"\ud83d\udce6 v0.5.4","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-07</p>"},{"location":"project/changelog.html#-fixed_10","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Color cassette tape strip</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v053","title":"\ud83d\udce6 v0.5.3","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-07</p>"},{"location":"project/changelog.html#-added_9","title":"\u2728 Added","text":"<ul> <li>Immersive walkman mode on mobile</li> </ul>"},{"location":"project/changelog.html#-fixed_11","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Restored mobile notification pause/play functionality</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v052","title":"\ud83d\udce6 v0.5.2","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-06</p>"},{"location":"project/changelog.html#-added_10","title":"\u2728 Added","text":"<ul> <li>Mixtape cover resizing to reduce bandwidth needs</li> <li>Added cassette tape look option to playback</li> </ul>"},{"location":"project/changelog.html#-changed_4","title":"\ud83d\udd27 Changed","text":"<ul> <li>Normalize cover images to RGB and handle transparency correctly before saving as JPEG, while slightly adjusting JPEG output settings.</li> </ul>"},{"location":"project/changelog.html#-fixed_12","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Prevent unnecessary resizing of small cover images</li> </ul> <p>Changes since last version</p>"},{"location":"project/changelog.html#-v051","title":"\ud83d\udce6 v0.5.1","text":"<p>Release</p> <p>All notable changes to Mixtape Society are documented here. We follow Semantic Versioning and the spirit of Keep a Changelog.</p> <p>Each release rewinds and fast-forwards your mixtape experience\u2014just like a real cassette! \ud83c\udfa7</p> <p>\ud83d\uddd3\ufe0f 2026-01-04</p>"},{"location":"project/changelog.html#-added_11","title":"\u2728 Added","text":"<ul> <li>Adaptive theming based on the mixtape cover for playback</li> </ul> <p>v0.5.1</p>"},{"location":"project/changelog.html#-v050","title":"\ud83d\udce6 v0.5.0","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-04</p>"},{"location":"project/changelog.html#-added_12","title":"\u2728 Added","text":"<ul> <li>Modal for statistics on the entire collection</li> <li>Improved details in editor for compilation albums</li> <li>Enlarged album cover in album details</li> <li>Hierarchical hints in search results</li> <li>User are alerted on broken DB and can rebuild from UI -&gt; Shared mixtapes still usable while DB is being rebuilt</li> </ul>"},{"location":"project/changelog.html#-changed_5","title":"\ud83d\udd27 Changed","text":"<ul> <li>Moved the resync button to the statistics modal</li> <li>Handling of compilation albums is now uniform</li> </ul>"},{"location":"project/changelog.html#-fixed_13","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Database resync corrupts database</li> <li>Watcher corrupts database when changing lots of files in the music collection</li> <li>Type 2 characters to start searching -&gt; 3 characters</li> <li>Top of search bar focus ring cut-off on top</li> <li>Title of mixtape falls off the screen</li> <li>Navbar on mobile across two rows</li> </ul> <p>v0.5.0</p>"},{"location":"project/changelog.html#-v041","title":"\ud83d\udce6 v0.4.1","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-02</p>"},{"location":"project/changelog.html#-added_13","title":"\u2728 Added","text":"<ul> <li>Fallback cover art</li> <li>Cover art for track search results</li> <li>Cover art in mobile notification</li> </ul>"},{"location":"project/changelog.html#-changed_6","title":"\ud83d\udd27 Changed","text":"<ul> <li>CSS changed to sematic color system</li> <li>Cleaning up editor and player javascript</li> </ul> <p>v0.4.1</p>"},{"location":"project/changelog.html#-v040","title":"\ud83d\udce6 v0.4.0","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-01</p>"},{"location":"project/changelog.html#-added_14","title":"\u2728 Added","text":"<ul> <li>Floating buttons in editor for mobile to:<ul> <li>Jump to mixtape tracks</li> <li>Save changes</li> </ul> </li> <li>Added button for manual resyncing the music collection library</li> </ul>"},{"location":"project/changelog.html#-fixed_14","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Saving existing mixtapes results in error</li> <li>Covers not available for non-admin users</li> <li>Playback notification on Mobile progress not in sync with actual playback position.</li> </ul> <p>v0.4.0</p>"},{"location":"project/changelog.html#-v030","title":"\ud83d\udce6 v0.3.0","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2026-01-01</p>"},{"location":"project/changelog.html#-added_15","title":"\u2728 Added","text":"<ul> <li>Covers included for tracks</li> <li>Composite cover generation</li> <li>Track removal toast</li> </ul>"},{"location":"project/changelog.html#-changed_7","title":"\ud83d\udd27 Changed","text":"<ul> <li>Play buttons changed to cover-play buttons</li> </ul>"},{"location":"project/changelog.html#-fixed_15","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Reordering tracks resulted in track added toast.</li> <li>White theme browsing mixtapes, mixtape title invisible</li> <li>No version information extracted from the repository</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v025","title":"\ud83d\udce6 v0.2.5","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2025-12-30</p>"},{"location":"project/changelog.html#-added_16","title":"\u2728 Added","text":"<ul> <li>Creating cached versions of FLAC's converted to lower (but listenable) quality when creating a mixtape</li> <li>Option to let the user choose higher quality playback</li> </ul>"},{"location":"project/changelog.html#-changed_8","title":"\ud83d\udd27 Changed","text":"<ul> <li>Updated documentation</li> </ul>"},{"location":"project/changelog.html#-fixed_16","title":"\ud83d\udc1b Fixed","text":"<ul> <li>When searching with multiple words, the results narrows down</li> <li>Player control text is illegible in the white theme</li> <li>Editor search result play preview button not in sync with player controls</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v022","title":"\ud83d\udce6 v0.2.2","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2025-12-28</p>"},{"location":"project/changelog.html#-added_17","title":"\u2728 Added","text":"<ul> <li>Possibility to expand the tracks/liner notes for easier reordering and writing notes.</li> <li>Duration of playlist items added</li> </ul>"},{"location":"project/changelog.html#-changed_9","title":"\ud83d\udd27 Changed","text":"<ul> <li>Mixtape player page:<ul> <li>Playback track layout so it looks better on mobile devices</li> <li>Decreased space for controls on mobile devices</li> <li>More track information in the audio player</li> </ul> </li> <li>Mixtape editor page<ul> <li>Search results layout in editor looks better on mobile devices</li> <li>Removed redundant labels from artist and album search results</li> <li>Made player in editor consistent with player_mixtape</li> </ul> </li> </ul>"},{"location":"project/changelog.html#-fixed_17","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Track title not rendering on playlist</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v021","title":"\ud83d\udce6 v0.2.1","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2025-12-27</p>"},{"location":"project/changelog.html#-fixed_18","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Mixtapes editing made more uniform and robust against network failures, resulted in fatal crash</li> <li>Fixed album sorting for artists to case insensitive</li> <li>Made cover validation more robust</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v020","title":"\ud83d\udce6 v0.2.0","text":"<p>Release</p> <p>\ud83d\uddd3\ufe0f 2025-12-27</p>"},{"location":"project/changelog.html#-changed_10","title":"\ud83d\udd27 Changed","text":"<ul> <li>OpenGraph image and added information to better comply with standards https://opengraph.dev/</li> <li>Changing the title of the mixtape is independent of the filename of the stored mixtape. This ensures keeping the old shared URL alive when changing the title.</li> <li>Navbar to sticky-top</li> </ul>"},{"location":"project/changelog.html#-fixed_19","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Collapse of the navbar happens only on small screens</li> <li>Better player display on smaller screens</li> <li>Redundant JavaScript removed from editor.html</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v018-alpha","title":"\ud83d\udce6 v0.1.8-alpha","text":"<p>Unreleased</p> <p>\ud83d\uddd3\ufe0f 2025-12-26</p>"},{"location":"project/changelog.html#-added_18","title":"\u2728 Added","text":"<ul> <li>Using tags while searching<ul> <li>Artist</li> <li>Album</li> <li>Song</li> </ul> </li> <li>Track sorting for albumns by disc and track number</li> <li>Clickable search results so you can change the search to an artist or album</li> <li>Logo in social card cover image</li> <li>Cache pass-1 results between keystrokes, keep the results of Pass 1 (scored rows) around temporarily, so increasing the precision of your search  doesn't need to hit the database again.</li> <li>Added robot.txt to disallow page indexing by search engines</li> </ul>"},{"location":"project/changelog.html#-changed_11","title":"\ud83d\udd27 Changed","text":"<ul> <li>Extracted JavaScript from Jinja templates to <code>static/js</code></li> <li>Liner notes before tracks list</li> <li>Remove track icon</li> <li>Removed theme label from navbar</li> <li>Documentation images update</li> <li>Large cover files are scaled down to save bandwidth</li> <li>Sped up searching</li> <li>Better mixtape editing</li> <li>When indexing the music library, Ajax reloading is used to reduce page reloads</li> </ul>"},{"location":"project/changelog.html#-fixed_20","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Player does not adhere to light/dark theming</li> <li>Possible mixtape collision</li> <li>Loading at first start-up in musiclib</li> <li>Progress report on loading in musiclib</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v017-alpha","title":"\ud83d\udce6 v0.1.7-alpha","text":"<p>Pre-release</p> <p>\ud83d\uddd3\ufe0f 2025-12-18</p>"},{"location":"project/changelog.html#-added_19","title":"\u2728 Added","text":"<ul> <li>Editing previews - each track in the search-result can be played without adding them to the playlist</li> <li>Project link in navbar</li> </ul>"},{"location":"project/changelog.html#-changed_12","title":"\ud83d\udd27 Changed","text":"<ul> <li>Logo and favicon</li> <li>Documentation line-up with app style</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v016-alpha","title":"\ud83d\udce6 v0.1.6-alpha","text":"<p>Pre-release</p> <p>\ud83d\uddd3\ufe0f 2025-12-17</p>"},{"location":"project/changelog.html#-changed_13","title":"\ud83d\udd27 Changed","text":"<ul> <li>Extracted CSS to dedicated files in static, and added comments with clear flow</li> </ul>"},{"location":"project/changelog.html#-fixed_21","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Covers not showing for users that are not logged in</li> <li>Editor headers change according to creating or editing mixtape</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v015-alpha","title":"\ud83d\udce6 v0.1.5-alpha","text":"<p>Pre-release</p> <p>\ud83d\uddd3\ufe0f 2025-12-17</p>"},{"location":"project/changelog.html#-added_20","title":"\u2728 Added","text":"<ul> <li>Grouping search results:</li> <li>Nesting for Artists: Artists show as top-level headers with summaries (e.g., \"2 album(s)\", \"5 nummer(s)\").</li> <li>Albums are nested in an accordion below, each with their own header and collapsible tracks.</li> <li>Folding Tracks: Tracks are hidden by default under a collapsible section (accordion for nested albums, simple collapse for standalone albums). Click the header/button to expand.</li> </ul>"},{"location":"project/changelog.html#-changed_14","title":"\ud83d\udd27 Changed","text":"<ul> <li>Moved from JavaScript dialogs to Bootstrap dialogs</li> </ul>"},{"location":"project/changelog.html#-fixed_22","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Fixed Dockerfile by starting app from factory function</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v014-alpha","title":"\ud83d\udce6 v0.1.4-alpha","text":"<p>Pre-release</p> <p>\ud83d\uddd3\ufe0f 2025-12-16</p>"},{"location":"project/changelog.html#-added_21","title":"\u2728 Added","text":"<ul> <li>Page that informs user at first startup on the progress of music library scraping</li> </ul>"},{"location":"project/changelog.html#-changed_15","title":"\ud83d\udd27 Changed","text":"<ul> <li>Music library extraction backend (Musiclib)</li> <li>Huge overhaul of back-end, making modules less interdependent</li> </ul>"},{"location":"project/changelog.html#-fixed_23","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Missing standard cover art</li> <li>Theme adherence on some pages</li> <li>Favicon theme adherence</li> <li>Deleting a mixtape actually works</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v013-alpha","title":"\ud83d\udce6 v0.1.3-alpha","text":"<p>Pre-release</p> <p>\ud83d\uddd3\ufe0f 2025-12-15</p>"},{"location":"project/changelog.html#-added_22","title":"\u2728 Added","text":"<ul> <li>Creating liner notes for a mixtape</li> <li>Pop-up when adding tracks to a mixtape</li> <li>Share mixtape from play page</li> <li>Social card metadata for mixtapes</li> </ul>"},{"location":"project/changelog.html#-fixed_24","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Moving away from editing a mixtape then returning would lose changes</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v012-alpha","title":"\ud83d\udce6 v0.1.2-alpha","text":"<p>Pre-release</p> <p>\ud83d\uddd3\ufe0f 2025-12-12</p>"},{"location":"project/changelog.html#-fixed_25","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Made Mixtape browser responsive</li> </ul> <p>Changes since previous version</p>"},{"location":"project/changelog.html#-v011-alpha","title":"\ud83d\udce6 v0.1.1-alpha","text":"<p>Pre-release</p> <p>\ud83d\uddd3\ufe0f 2025-12-12</p>"},{"location":"project/changelog.html#-added_23","title":"\u2728 Added","text":"<ul> <li>Included version information from git tags</li> <li>Docker logging</li> <li>Rate limiting for login</li> </ul>"},{"location":"project/changelog.html#-changed_16","title":"\ud83d\udd27 Changed","text":"<ul> <li>Improved music path handling</li> <li>Simplified logging</li> <li>Documentation welcome page</li> </ul>"},{"location":"project/changelog.html#-fixed_26","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Password handling with strange characters</li> <li>Database locks when too many Watcher related updates</li> </ul> <p>Changes since previous version</p>"},{"location":"project/contributing.html","title":"Contributing","text":""},{"location":"project/contributing.html#contributing","title":"Contributing","text":"<p>Interested in helping out? Here's how things work.</p>"},{"location":"project/contributing.html#-ways-to-contribute","title":"\ud83e\udd1d Ways to Contribute","text":"<p>Share ideas - Open a discussion or comment on existing ones. All suggestions welcome, even half-baked ones.</p> <p>Report bugs - Open an issue with: - What you expected to happen - What actually happened - Steps to reproduce (if possible) - Your setup (Docker/local, browser, OS)</p> <p>Improve documentation - Typos, unclear explanations, missing info\u2014all fair game. Docs live in the <code>/docs</code> folder.</p> <p>Code contributions - Check good first issue tags or the roadmap for things I'm planning to work on.</p>"},{"location":"project/contributing.html#-before-you-start","title":"\ud83e\udded Before You Start","text":"<p>If you're thinking of tackling something substantial (new feature, big refactor), open an issue or discussion first. Saves everyone time if the direction doesn't fit the project.</p>"},{"location":"project/contributing.html#-development-setup","title":"\ud83d\udee0\ufe0f Development Setup","text":""},{"location":"project/contributing.html#using-docker-recommended","title":"Using Docker (Recommended)","text":"<p>See Docker Development guide for full instructions.</p>"},{"location":"project/contributing.html#local-development","title":"Local Development","text":"<pre><code>git clone https://github.com/mark-me/mixtape-society.git\ncd mixtape-society\nuv sync  --group dev\n\n# Edit MUSIC_ROOT and APP_PASSWORD in .env\nuv run python app.py\n</code></pre> <p>First run will index your music library.</p> <p>See Local Development guide for more details.</p>"},{"location":"project/contributing.html#-code-style","title":"\ud83c\udfa8 Code Style","text":"<p>Nothing strict, but: - Keep it readable - Add docstrings for non-obvious functions - Follow existing patterns in the codebase - Run basic tests if you're changing core functionality</p> <p>If something's unclear, just ask.</p>"},{"location":"project/contributing.html#-pull-request-process","title":"\ud83d\udd00 Pull Request Process","text":"<ol> <li>Fork the repo</li> <li>Create a branch (<code>git checkout -b feature/thing</code>)</li> <li>Make your changes</li> <li>Commit with a clear message</li> <li>Push and open a PR</li> </ol> <p>I'll review when I can. Might ask for changes, might take a while\u2014this is a side project.</p>"},{"location":"project/contributing.html#-project-organization","title":"\ud83d\uddc2\ufe0f Project Organization","text":"<p>The GitHub Project board tracks work in progress:</p> <ul> <li>Ideas - Things being explored (Ideas doc has more)</li> <li>Planned - Committed to building (Roadmap)</li> <li>In Progress - Currently working on</li> <li>Done - Shipped (see Changelog)</li> </ul> <p>It's pretty informal, just helps keep things organized.</p>"},{"location":"project/contributing.html#-what-gets-prioritized","title":"\ud83c\udfaf What Gets Prioritized","text":"<p>Roughly in this order:</p> <ol> <li>Bug fixes (especially breaking ones)</li> <li>Features that align with project goals (see About)</li> <li>Community interest (reactions, comments on issues)</li> <li>Maintainer availability (aka: when I have time)</li> </ol>"},{"location":"project/contributing.html#-testing","title":"\ud83e\uddea Testing","text":"<p>Basic manual testing is fine for most changes. If you're modifying core components (musiclib, audio caching, database), please test thoroughly:</p> <ul> <li>Try it with your own music library</li> <li>Test edge cases (empty folders, weird filenames, large libraries)</li> <li>Check it doesn't break existing features</li> </ul> <p>No formal test suite yet, but that might change.</p>"},{"location":"project/contributing.html#-documentation","title":"\ud83d\udcda Documentation","text":"<p>If your PR adds a feature or changes behavior: - Update relevant docs in <code>/docs</code> - Add a brief note in <code>CHANGELOG.md</code> (I'll handle version numbering)</p>"},{"location":"project/contributing.html#-questions","title":"\u2753 Questions?","text":"<p>Not sure about something? Open a discussion or comment on a relevant issue. I'll respond when I can.</p>"},{"location":"project/contributing.html#-license","title":"\u2696\ufe0f License","text":"<p>By contributing, you agree your contributions will be licensed under the MIT License.</p> <p>Thanks for considering contributing to Mixtape Society. Even small fixes are appreciated. \ud83c\udfa7</p>"},{"location":"project/roadmap.html","title":"Roadmap","text":""},{"location":"project/roadmap.html#roadmap","title":"Roadmap","text":""},{"location":"project/roadmap.html#-what-not-to-add-to-keep-the-soul-of-the-project","title":"\ud83d\udeab What NOT to add (to keep the soul of the project)","text":"<ul> <li>No accounts on a central server</li> <li>No Spotify/Apple Music integration</li> <li>No social features (likes, comments, following)</li> <li>No ads, analytics, telemetry by default</li> </ul>"},{"location":"project/roadmap.html#-liner-notes","title":"\ud83d\udcdd Liner notes","text":"<ul> <li>Background info for artist, album or track</li> </ul>"},{"location":"project/roadmap.html#-mobile-experience","title":"\ud83d\udcf1 Mobile Experience","text":"<ul> <li>Pull-to-refresh on browse page</li> <li>Add manifest.json + service worker \u2192 installable on phone/home screen</li> <li>Cache current mixtape for offline playback (big for mobile users on the go)</li> <li>Queue-based background download of mixtape tracks (zip or sequential)</li> <li>A super-light Flutter or Tauri app that just points to your self-hosted instance (basically a webview + native controls + background playback).</li> </ul>"},{"location":"project/roadmap.html#-transcoding--streaming-optimisation","title":"\ud83d\udce1 Transcoding / Streaming Optimisation","text":"<ul> <li>Cache eviction policy</li> <li>Manual clear via admin endpoint.</li> <li>Implement an LRU or size\u2011based eviction strategy inside AudioCache.</li> <li>Range\u2011request optimisations</li> <li>Reads the requested slice into memory (f.read(length)).</li> <li>Stream directly from the file using werkzeug.wsgi.wrap_file for very large files.</li> </ul>"},{"location":"project/roadmap.html#-smart-features-without-becoming-bloated","title":"\ud83e\udde0 Smart Features (without becoming bloated)","text":"<ul> <li>\u201cRecently added\u201d automatic mixtape</li> <li>Simple last.fm/scrobble support (optional)</li> </ul>"},{"location":"project/roadmap.html#-sharing--discovery","title":"\ud83d\udcac Sharing &amp; Discovery","text":"<ul> <li>Beautiful public mixtape page with embed support (iframe)</li> <li>QR code for quick mobile sharing</li> <li>Optional short-url service (built-in or caddy/shlink integration)</li> <li>Web Share API target (native share button on mobile)</li> </ul>"},{"location":"project/roadmap.html#-cover-art--visual-polish","title":"\ud83d\uddbc\ufe0f Cover Art &amp; Visual Polish","text":"<ul> <li>Cover format<ul> <li>Now Always JPEG, quality 100, max width 1200 px.</li> <li>Add a configuration option (max_width, jpeg_quality, or even support PNG/WebP).</li> </ul> </li> <li>Image validation<ul> <li>Now: Only checks that the string starts with <code>data:image</code>.</li> <li>Verify MIME type (image/jpeg, image/png) before decoding, reject oversized payloads early.</li> </ul> </li> <li>Async I/O<ul> <li>Now: All file operations are blocking.</li> <li>Switch to aiofiles + async methods if you need non-blocking behavior in a high-throughput API server.                                                                                      |</li> </ul> </li> </ul>"},{"location":"project/roadmap.html#-multi-library--multi-user-support","title":"\ud83d\udc65 Multi-Library &amp; Multi-User Support","text":"<ul> <li>Support multiple MUSIC_ROOT paths (e.g., \u201cMain\u201d + \u201cVinyl Rips\u201d + \u201cLive Bootlegs\u201d)</li> <li>User roles: admin + read-only \u201cfamily\u201d accounts</li> </ul>"},{"location":"project/roadmap.html#-backup--portability","title":"\ud83d\udce6 Backup &amp; Portability","text":"<ul> <li>One-click export of all mixtapes + cover art as .zip</li> <li>M3U export of mixtapes for use in other players</li> <li>Import from M3U playlists to create mixtapes</li> </ul>"},{"location":"project/roadmap.html#-developerdeployment-experience","title":"\ud83d\udee0\ufe0f Developer/Deployment Experience","text":"<ul> <li>Add healthcheck endpoint for Docker/Kubernetes</li> <li>Support for Podman as well as Docker</li> <li>Optional Redis cache for very large libraries (&gt;50k tracks)</li> </ul>"},{"location":"project/roadmap.html#-tiny-but-delightful-details","title":"\ud83c\udf43 Tiny but Delightful Details","text":"<ul> <li>Keyboard shortcuts (J/K for next/prev, space to play/pause, etc.)</li> <li>Click on album art in player \u2192 enlarge lightbox</li> <li>\u201cSleep timer\u201d in player</li> <li>Random mixtape button on home page</li> </ul>"},{"location":"project/roadmap.html#-browser-page","title":"\ud83d\udd0d Browser page","text":"Area Current implementation Suggested enhancements Pagination All mixtapes are loaded at once (<code>list_all</code>). Add <code>limit</code>/<code>offset</code> parameters to <code>MixtapeManager.list_all</code> and UI pagination controls for large libraries. Search No search endpoint for mixtapes. Introduce <code>/mixtapes/search?q=</code> that filters by title/artist, returning JSON for a live-search UI. Bulk actions Only single-item delete. Add \u201cSelect \u2192 Delete\u201d or \u201cExport\u201d bulk actions, with a new API endpoint (<code>POST /mixtapes/bulk_delete</code>). Cover thumbnail generation Covers are served directly from the file system. Serve scaled thumbnails via a dedicated route (<code>/mixtapes/thumb/&lt;slug&gt;</code>) to reduce bandwidth on the browse page. Permissions All authenticated users can edit/delete any mixtape. Tie mixtapes to a user ID (<code>owner_id</code>) and restrict edit/delete to the owner (or admins). Progressive enhancement JavaScript is required for copy/delete. Provide graceful degradation (e.g., plain links for copy, a server-side delete confirmation page) for users with JS disabled."},{"location":"project/roadmap.html#-base-page-and-app","title":"\ud83e\uddf1 Base page and app","text":"Area Current State Suggested Improvements Theme persistence Stored in <code>localStorage['theme']</code>. Add a server-side preference (user profile) so the choice survives across devices. Modular CSS One monolithic <code>base.css</code>. Split into component-level files (navbar, modals, toasts) and use a build step (e.g., PostCSS) for easier maintenance. Accessibility Basic ARIA attributes on modals/buttons. Add <code>aria-live=\"polite\"</code> to toasts, ensure focus trapping inside modals, and provide high-contrast color variants. Internationalisation Hard-coded English strings. Integrate Flask-Babel and expose a <code>gettext</code> filter in Jinja to support multiple locales. Progressive Enhancement Many features rely on JavaScript (copy, delete, theme). Provide graceful fallbacks: a plain link for copying (mailto fallback), a server-side confirmation page for delete, and a CSS-only dark-mode toggle. Testing No unit tests for <code>base.html</code> or the global JS. Add Selenium / Playwright integration tests that verify the theme switcher, indexing modal, and database-corruption flow. Security CSRF protection is handled globally by Flask-WTF (not shown). Ensure all POST endpoints (<code>/reset-database</code>, <code>/delete/&lt;slug&gt;</code>, <code>/resync</code>) validate a CSRF token. Performance All static assets are CDN-served individually. Bundle CSS/JS with a tool like Webpack or Rollup, enable HTTP/2 server push, and add integrity attributes for Subresource Integrity (SRI)."},{"location":"project/roadmap.html#-qr-code-sharing","title":"\ud83d\udcf1 QR code sharing","text":"Idea Description Impact Dynamic QR size selector Add a UI dropdown (e.g., Small / Medium / Large) that updates the <code>size</code> query param on the fly. Improves UX for users who need larger codes for printing. QR colour theming Pass a color query param (hex) to <code>generate_mixtape_qr</code> and recolour the QR modules. Allows branding or better contrast on printed materials. Cache-Control header customization Make the <code>max-age</code> configurable via an environment variable (<code>QR_CACHE_MAX_AGE</code>). Gives operators control over CDN caching strategies. Rate limiting Apply Flask-Limiter to <code>/qr/*</code> endpoints (e.g., 1000/day). Prevents abuse (mass QR generation). SVG output Add an optional <code>format=svg</code> query param that returns a vector QR. Useful for high-resolution prints. QR analytics Record a lightweight hit counter (Redis or SQLite) each time a QR is generated. Lets you see how often mixtapes are shared. Fallback to Gravatar If the logo files are missing, generate a simple coloured circle with the site initials. Guarantees a logo is always present."},{"location":"project/ideas/design_implementation_map.html","title":"Design & Implementation Map","text":""},{"location":"project/ideas/design_implementation_map.html#design--implementation-map","title":"Design &amp; Implementation Map","text":""},{"location":"project/ideas/design_implementation_map.html#-core-principles","title":"\ud83e\udded Core principles","text":"<ul> <li>No central-server accounts</li> <li>No Spotify / Apple Music integration</li> <li>No social features (likes, comments, following)</li> <li>No ads, analytics, or telemetry by default</li> </ul>"},{"location":"project/ideas/design_implementation_map.html#-qr-card--make-it-meaningful-not-just-a-link","title":"\ud83d\uddbc\ufe0f QR card \u2013 make it meaningful (not just a link)","text":"Item Status Where it lives Notes / Proposal QR \u2192 mixtape landing page (title, personal note, tracklist, optional cover, \u201cplay order matters\u201d) \u2714\ufe0e Implemented <code>routes/play.py \u2192 public_play(slug)</code> renders <code>play_mixtape.html</code> The template already displays title, cover, dedication, and a Play button. Nothing to add. QR generation (one-time per mixtape) \u2714\ufe0e Implemented <code>routes/editor.py \u2192 qr.generate_qr(slug)</code> and <code>qr.download_qr(slug)</code> Already usable from the editor UI. QR + NFC hybrid \u2716\ufe0e Missing \u2013 Proposal: Add <code>GET /nfc/&lt;slug&gt;.json</code> returning <code>{ \"url\": \"&lt;public-share-url&gt;\" }</code>. NFC tags store this JSON (or URL). Stateless; preserves no-account rule. Contextual liner-note page (not a bare playlist) \u2714\ufe0e Implemented <code>templates/play_mixtape.html</code>, <code>static/js/player/linerNotes.js</code> Markdown liner notes already render. \u201cPlay order matters\u201d banner \u270e Partially implemented <code>play_mixtape.html</code> Proposal: Add <code>ordered: true</code> to <code>mixtape.json</code>. Template conditionally shows banner; editor exposes toggle."},{"location":"project/ideas/design_implementation_map.html#-cassette--minidisc--cd-style-card-nostalgia-wins-hard","title":"\ud83c\udfb6 Cassette / MiniDisc / CD-style card (nostalgia wins hard)","text":"Item Status Where it lives Notes / Proposal Cassette-shaped card design (QR on label) \u2716\ufe0e Missing \u2013 Proposal: Printable SVG (<code>assets/templates/cassette.svg</code>) with QR placeholder. Editor offers \u201cDownload printable card\u201d. QR PNG merged server-side (Pillow). Mini-CD sleeve with liner notes \u2716\ufe0e Missing \u2013 Proposal: SVG CD-case layout + liner-note markdown \u2192 PDF (WeasyPrint / pdfkit). Embed QR via existing QR route. Polaroid-sized card, handwritten vibe \u2716\ufe0e Missing \u2013 Proposal: Handwritten font CSS option. Store <code>style</code> in <code>mixtape.json</code>; PDF generator applies CSS class. <p>All of these are offline artifacts; server interaction is limited to existing QR generation.</p>"},{"location":"project/ideas/design_implementation_map.html#-nfc-instead-of-or-alongside-qr","title":"\ud83d\udcf1 NFC instead of (or alongside) QR","text":"Item Status Where it lives Notes / Proposal NFC-enabled card / coin / pick / postcard \u2716\ufe0e Missing \u2013 Proposal: Add <code>GET /nfc/&lt;slug&gt;.txt</code> returning the plain public URL. NFC tags can be written with any consumer writer. Hybrid QR + NFC fallback \u2716\ufe0e Missing \u2013 Proposal: Printable assets embed QR + printed short URL (<code>/s/&lt;slug&gt;</code>). Graceful fallback for non-NFC devices."},{"location":"project/ideas/design_implementation_map.html#-the-artifact-concept-beyond-cards","title":"\ud83c\udf81 The \u201cartifact\u201d concept (beyond cards)","text":"Artifact Status Notes / Proposal Matchbox with QR inside \u2716\ufe0e Missing SVG template with QR placeholder. Bookmark \u2716\ufe0e Missing Bookmark-shaped SVG using existing QR PNG. Sticker set (each sticker = a track) \u2716\ufe0e Missing Proposal: PDF \u201csticker sheet\u201d where each track has a tiny QR pointing to <code>/share/&lt;slug&gt;#track=&lt;index&gt;</code>. Client-side fragment parsing starts playback at that track. Small zine (QR at end) \u2716\ufe0e Missing Combine liner-note markdown + QR into a single PDF (WeasyPrint). Postcard (mailed) \u2716\ufe0e Missing Same as postcard template in \u00a72 with larger personal note area. <p>All artifacts remain physical; backend usage is limited to existing QR endpoints.</p>"},{"location":"project/ideas/design_implementation_map.html#-time-based-or-ritual-based-access","title":"\u23f3 Time-based or ritual-based access","text":"Item Status Where it lives Notes / Proposal Unlock 1 track per day \u2716\ufe0e Missing \u2013 Proposal: Add <code>access_policy</code> to <code>mixtape.json</code> (<code>{ type: \"daily_unlock\", start: ... }</code>). Enforced client-side via <code>playerControls.js</code> + <code>localStorage</code>. Unlock only at night \u2716\ufe0e Missing \u2013 Proposal: <code>policy: \"night_only\"</code>. Client checks local time / UTC offset. \u201cPlay in order, no shuffle\u201d \u2714\ufe0e Implemented <code>routes/play.py</code>, <code>playerControls.js</code> Shuffle disabled; order enforced. Expiring mixtape (30 days) \u2716\ufe0e Missing \u2013 Proposal: Add <code>expires_at</code>. Public page renders \u201cMixtape expired\u201d if past timestamp. \u201cListen once\u201d mode \u2716\ufe0e Missing \u2013 Proposal: <code>once: true</code>. Client disables playback after first full listen using <code>localStorage</code>. <p>All policies are client-side only \u2014 no server state, no accounts.</p>"},{"location":"project/ideas/design_implementation_map.html#-playback-without-accounts-or-ads-important-constraint","title":"\ud83d\udeab Playback without accounts or ads (important constraint)","text":"Item Status Where it lives Notes / Proposal Self-hosted audio files \u2714\ufe0e Implemented <code>routes/play.stream_audio</code> Streams from <code>MUSIC_ROOT</code>. Independent / CC music \u270e Partially implemented Editor UI Proposal: License confirmation checkbox \u2192 <code>license: \"CC0\"</code> badge on public page. Bandcamp embeds \u2716\ufe0e Missing \u2013 Proposal: Optional <code>external_url</code> per track. Player renders <code>&lt;iframe&gt;</code> embed. Progressive Web App (offline caching) \u2716\ufe0e Missing \u2013 Proposal: Service Worker (<code>static/sw.js</code>) caches JSON, cover, audio files. Zero-ads, zero-tracking \u2714\ufe0e Implemented Templates No analytics or third-party scripts."},{"location":"project/ideas/design_implementation_map.html#-strong-framing-sentence-this-matters","title":"\ud83e\udde0 Strong framing sentence (this matters)","text":"Item Status Where it lives \u201cThis is not a playlist. It\u2019s a mixtape you give to someone.\u201d \u2714\ufe0e Implemented <code>play_mixtape.html</code>, <code>editor.html</code>"},{"location":"project/ideas/design_implementation_map.html#-top-3-suggestions","title":"\u2705 Top 3 suggestions","text":"Suggestion Already present? Beautiful physical card (cassette / CD inspired) \u2716\ufe0e Missing \u2013 see \u00a72 Mixtape landing page (not generic player) \u2714\ufe0e Implemented Intentional constraints (order matters, finite) \u2714\ufe0e Implemented"},{"location":"project/ideas/design_implementation_map.html#-mvp-definition-one-sentence","title":"\ud83d\udca1 MVP definition (one sentence)","text":"<p>\u201cA creator makes a mixtape, prints a QR card, gives it to a friend. The friend scans it and listens \u2014 no account, no ads.\u201d</p> <p>All parts are functional except physical artifact generation, which is purely additive.</p>"},{"location":"project/ideas/design_implementation_map.html#-mvp-flow-creator--receiver","title":"\ud83d\udd01 MVP Flow (creator \u2192 receiver)","text":""},{"location":"project/ideas/design_implementation_map.html#creator","title":"Creator","text":"Phase Implemented? Files / Routes Missing pieces Create mixtape \u2714\ufe0e <code>routes/editor.new_mixtape()</code> \u2013 Add tracks \u2714\ufe0e <code>static/js/editor/search.js</code>, <code>src/musiclib/</code> \u2013 Publish (QR generation) \u2714\ufe0e <code>routes/qr_blueprint.py</code> \u2013 Print / share physically \u2716\ufe0e \u2013 Printable SVG/PDF templates"},{"location":"project/ideas/design_implementation_map.html#receiver","title":"Receiver","text":"Phase Implemented? Files / Routes Scan QR \u2714\ufe0e <code>routes/play.public_play</code> Landing page \u2714\ufe0e <code>templates/play_mixtape.html</code> Listen (order-only) \u2714\ufe0e <code>playerControls.js</code>, <code>stream_audio</code>"},{"location":"project/ideas/design_implementation_map.html#-mvp-includes--excludes-re-affirmed","title":"\ud83d\udcdd MVP includes / excludes (re-affirmed)","text":"Category Status Public mixtape page \u2714\ufe0e Audio playback \u2714\ufe0e QR-code generation \u2714\ufe0e Mobile-first UI \u2714\ufe0e No accounts \u2714\ufe0e No ads / analytics \u2714\ufe0e No social features \u2714\ufe0e No streaming-service APIs \u2714\ufe0e"},{"location":"project/ideas/design_implementation_map.html#-digital-enablement-implementation-map","title":"\ud83d\uddfa\ufe0f Digital enablement (implementation map)","text":"Piece Implemented? Where it lives Next step Data model (JSON) \u2714\ufe0e <code>mixtapes/&lt;slug&gt;/mixtape.json</code> \u2013 Backend (Flask) \u2714\ufe0e <code>app.py</code> \u2013 Frontend UI \u2714\ufe0e <code>templates/</code>, <code>static/js/</code> \u2013 QR generation \u2714\ufe0e <code>routes/qr_blueprint.py</code> \u2013 NFC endpoint \u2716\ufe0e \u2013 Add <code>GET /nfc/&lt;slug&gt;.txt</code> Printable artifacts \u2716\ufe0e \u2013 Add <code>/print/&lt;slug&gt;/&lt;template&gt;</code> route Time-based access \u2716\ufe0e \u2013 Extend JSON + client checks Offline PWA \u2716\ufe0e \u2013 Add <code>static/sw.js</code> <p>All additions are stateless and preserve the four core principles.</p>"},{"location":"project/ideas/design_implementation_map.html#-mvp-timeline","title":"\ud83d\udcc5 MVP timeline","text":"Week Done New tasks 1 Core app, streaming, QR, editor Design SVG templates 2 Editor save flow, QR modal <code>/print</code> route, NFC endpoint 3 \u2013 Access-policy enforcement 4 \u2013 Service Worker, UI polish, physical test <p>Success metric: A tester scans a printed card, listens fully, sees enforced constraints \u2014 no login, no ads.</p>"},{"location":"project/ideas/design_implementation_map.html#-how-youll-know-it-worked","title":"\ud83e\uddea How you\u2019ll know it worked","text":"<ul> <li>Qualitative: \u201cI listened to the whole thing.\u201d</li> <li>Technical: No login redirects; no third-party network requests.</li> <li>Artifact: Printed cassette card opens the mixtape instantly on mobile.</li> </ul>"},{"location":"project/ideas/design_implementation_map.html#-tldr--whats-already-there-vs-what-to-add","title":"\ud83d\udcdd TL;DR \u2014 What\u2019s already there vs what to add","text":"Feature Implemented Missing (quick win) QR \u2192 landing page \u2714\ufe0e \u2013 QR generation \u2714\ufe0e \u2013 Physical artifacts \u2013 SVG/PDF templates + <code>/print</code> NFC token \u2013 <code>/nfc/&lt;slug&gt;.txt</code> Time-based access \u2013 <code>access_policy</code> + JS Offline playback \u2013 Service Worker \u201cOrder matters\u201d flag \u270e Store in JSON Once-only / daily unlock \u2013 LocalStorage guard Bandcamp embeds \u2013 <code>external_url</code> support <p>All missing pieces are additive and do not violate any core principles.</p>"},{"location":"project/ideas/ideas.html","title":"General Ideas","text":""},{"location":"project/ideas/ideas.html#ideas--exploration","title":"Ideas &amp; Exploration","text":"<p>Things I'm considering or that have been suggested. Some will happen, some won't, some need more thought before deciding.</p>"},{"location":"project/ideas/ideas.html#-what-not-to-add","title":"\ud83d\udeab What NOT to Add","text":"<p>To keep the soul of the project:</p> <ul> <li>No accounts on a central server</li> <li>No Spotify/Apple Music integration</li> <li>No social features (likes, comments, following)</li> <li>No ads, analytics, telemetry by default</li> </ul>"},{"location":"project/ideas/ideas.html#-music--playback","title":"\ud83c\udfb5 Music &amp; Playback","text":"<p>Liner notes - Background info for artist, album, or track</p>"},{"location":"project/ideas/ideas.html#smart-features-without-bloat","title":"Smart features (without bloat)","text":"<ul> <li>\"Recently added\" automatic mixtape</li> <li>Simple last.fm/scrobble support (optional)</li> </ul>"},{"location":"project/ideas/ideas.html#transcoding-optimizations","title":"Transcoding optimizations","text":"<ul> <li>Cache eviction policy (manual clear, LRU strategy)</li> <li>Range-request optimizations for large files</li> </ul>"},{"location":"project/ideas/ideas.html#-mobile-experience","title":"\ud83d\udcf1 Mobile Experience","text":"<ul> <li>Queue-based background download of tracks</li> <li>Super-light Flutter/Tauri app (webview + native controls)</li> </ul>"},{"location":"project/ideas/ideas.html#-sharing--discovery","title":"\ud83d\udcac Sharing &amp; Discovery","text":"<ul> <li>Beautiful public mixtape embed (iframe)</li> <li>Optional short-url service integration</li> </ul>"},{"location":"project/ideas/ideas.html#-cover-art--visuals","title":"\ud83d\uddbc\ufe0f Cover Art &amp; Visuals","text":"<p>Image validation improvements:</p> <ul> <li>Async I/O with aiofiles</li> </ul>"},{"location":"project/ideas/ideas.html#-multi-library--users","title":"\ud83d\udc65 Multi-Library &amp; Users","text":"<ul> <li>Support multiple MUSIC_ROOT paths</li> </ul>"},{"location":"project/ideas/ideas.html#-backup--portability","title":"\ud83d\udce6 Backup &amp; Portability","text":"<ul> <li>One-click export (all mixtapes + covers as .zip)</li> <li>M3U export for other players</li> <li>Import from M3U playlists</li> </ul>"},{"location":"project/ideas/ideas.html#-developer-experience","title":"\ud83d\udee0\ufe0f Developer Experience","text":"<ul> <li>Healthcheck endpoint for Docker/Kubernetes</li> <li>Podman support</li> <li>Optional Redis cache for huge libraries (&gt;50k tracks)</li> </ul>"},{"location":"project/ideas/ideas.html#-tiny-delights","title":"\ud83c\udfa8 Tiny Delights","text":"<ul> <li>Click album art \u2192 enlarge lightbox</li> <li>Sleep timer in player</li> <li>Random mixtape button</li> </ul>"},{"location":"project/ideas/ideas.html#-technical-improvements","title":"\ud83d\udd27 Technical Improvements","text":""},{"location":"project/ideas/ideas.html#browse-page","title":"Browse Page","text":"<ul> <li>Pagination for large libraries (currently loads all)</li> <li>Bulk actions (select \u2192 delete/export)</li> </ul>"},{"location":"project/ideas/ideas.html#base--ui","title":"Base &amp; UI","text":"<ul> <li>Accessibility improvements (ARIA, focus trapping)</li> <li>Internationalization (Flask-Babel)</li> </ul> <p>Got thoughts on any of these? Open a discussion or comment on issues.</p>"},{"location":"user/getting-started.html","title":"Overview","text":""},{"location":"user/getting-started.html#getting-started-with-mixtape-society","title":"Getting Started with Mixtape Society","text":"<p>Welcome to Mixtape Society! Whether you're setting up your own server to create and share mixtapes, or you've received a mixtape link from a friend, we've got you covered.</p>"},{"location":"user/getting-started.html#-choose-your-path","title":"\ud83c\udfaf Choose Your Path","text":""},{"location":"user/getting-started.html#-i-want-to-create-mixtapes","title":"\ud83c\udfa8 I Want to Create Mixtapes","text":"<p>You want to run your own Mixtape Society server to craft and share mixtapes from your music library.</p> <p>\u2192 Creator's Guide</p> <p>What you'll learn:</p> <ul> <li>Installing and setting up your server</li> <li>Creating your first mixtape</li> <li>Managing your music collection</li> <li>Sharing mixtapes with friends</li> <li>Privacy and access control</li> </ul> <p>Perfect for:</p> <ul> <li>Music enthusiasts with personal music libraries</li> <li>People who love curating playlists for friends</li> <li>Anyone wanting to run their own music sharing server</li> </ul>"},{"location":"user/getting-started.html#-i-received-a-mixtape","title":"\ud83c\udfa7 I Received a Mixtape","text":"<p>Someone shared a mixtape link with you and you want to know how to listen to it.</p> <p>\u2192 Recipient's Guide</p> <p>What you'll learn:</p> <ul> <li>Opening and playing mixtapes</li> <li>Using player controls and features</li> <li>Streaming to TVs and speakers</li> <li>Adjusting quality settings</li> <li>Mobile and desktop tips</li> </ul> <p>Perfect for:</p> <ul> <li>Friends and family receiving mixtape links</li> <li>Anyone who got a QR code or gift link</li> <li>People wanting to cast to Chromecast or AirPlay</li> </ul>"},{"location":"user/getting-started.html#-quick-start-for-creators","title":"\ud83d\ude80 Quick Start (For Creators)","text":"<p>If you just want to get a server running immediately:</p> <pre><code>docker run -d \\\n  --name mixtape-society \\\n  --restart unless-stopped \\\n  -p 5000:5000 \\\n  -v /path/to/your/music:/music:ro \\\n  -v /data/mixtape-society:/app/collection-data \\\n  -e APP_PASSWORD=YourStrongPassword123! \\\n  ghcr.io/mark-me/mixtape-society:latest\n</code></pre> <p>\u2192 Open http://localhost:5000, log in, and start creating!</p> <p>Full installation guide \u2192</p>"},{"location":"user/getting-started.html#-not-sure-which-path","title":"\ud83d\udca1 Not Sure Which Path?","text":"<p>You're a Creator if:</p> <ul> <li>You have a music library you want to share</li> <li>You want to run your own server</li> <li>You need login/admin access</li> <li>You're setting up Mixtape Society</li> </ul> <p>You're a Recipient if:</p> <ul> <li>Someone sent you a mixtape link</li> <li>You just want to listen to music</li> <li>You don't need to create mixtapes</li> <li>You're using someone else's server</li> </ul>"},{"location":"user/getting-started.html#-need-help","title":"\ud83c\udd98 Need Help?","text":"<ul> <li>Creators: Check the Creator FAQ</li> <li>Recipients: Check the Recipient FAQ</li> <li>Everyone: Visit our GitHub Issues</li> </ul> <p>Enjoy the mixtape magic! \ud83d\ude80</p>"},{"location":"user/creators/index.html","title":"Creator's Guide","text":""},{"location":"user/creators/index.html#creators-guide","title":"Creator's Guide","text":"<p>Welcome to Mixtape Society! This guide will help you set up your server, create amazing mixtapes, and share them with the world.</p>"},{"location":"user/creators/index.html#-complete-creator-journey","title":"\ud83d\udcda Complete Creator Journey","text":""},{"location":"user/creators/index.html#1-installation--setup","title":"1. Installation &amp; Setup","text":"<p>Installation Guide</p> <p>Choose your deployment method:</p> <ul> <li>Docker Compose (Recommended) - Production-ready with persistence</li> <li>Docker - Quick one-command setup</li> <li>Local Development - For contributors and testing</li> </ul> <p>What you'll need:</p> <ul> <li>A music library (MP3, FLAC, etc.)</li> <li>Docker (or Python 3.11+ for local dev)</li> <li>10 minutes for setup</li> </ul>"},{"location":"user/creators/index.html#2-managing-your-collection","title":"2. Managing Your Collection","text":"<p>Collection Management</p> <p>Learn to:</p> <ul> <li>View your library statistics</li> <li>Resync after adding new music</li> <li>Understand what gets indexed</li> <li>Troubleshoot collection issues</li> </ul> <p>Key concepts:</p> <ul> <li>Initial indexing vs. resyncing</li> <li>What metadata is extracted</li> <li>How album art is handled</li> </ul>"},{"location":"user/creators/index.html#3-creating-mixtapes","title":"3. Creating Mixtapes","text":"<p>Editor Guide</p> <p>Master the mixtape editor:</p> <ul> <li>Search and add tracks</li> <li>Reorder for perfect flow</li> <li>Customize cover art</li> <li>Write meaningful liner notes</li> <li>Save and get your share link</li> </ul> <p>Pro tips:</p> <ul> <li>Keyboard shortcuts for efficiency</li> <li>Track reference syntax in liner notes</li> <li>Cover art best practices</li> </ul>"},{"location":"user/creators/index.html#4-sharing-your-mixtapes","title":"4. Sharing Your Mixtapes","text":"<p>Sharing Guide</p> <p>Share your creations:</p> <ul> <li>Quick Share - Simple links for casual sharing</li> <li>Gift Experience - Themed landing pages for special occasions</li> <li>QR Codes - For physical gifts and events</li> </ul> <p>Learn about:</p> <ul> <li>Privacy and access control</li> <li>Permanent vs. temporary sharing</li> <li>Creative sharing ideas</li> <li>When to use each method</li> </ul>"},{"location":"user/creators/index.html#-common-tasks","title":"\ud83c\udfaf Common Tasks","text":""},{"location":"user/creators/index.html#creating-your-first-mixtape","title":"Creating Your First Mixtape","text":"<ol> <li>Log in to your server</li> <li>Click \"New Mixtape\"</li> <li>Search and add 5-10 favorite tracks</li> <li>Add a title and optional liner notes</li> <li>Click Save</li> <li>Copy the link and share!</li> </ol> <p>Detailed walkthrough \u2192</p>"},{"location":"user/creators/index.html#adding-new-music","title":"Adding New Music","text":"<ol> <li>Add files to your music directory</li> <li>Log in to Mixtape Society</li> <li>Click \"Collection\" in navigation</li> <li>Click \"Resync Library\"</li> <li>Wait for indexing to complete</li> </ol> <p>Full collection management \u2192</p>"},{"location":"user/creators/index.html#sharing-as-a-gift","title":"Sharing as a Gift","text":"<ol> <li>Create your mixtape</li> <li>Click Save</li> <li>Choose \"Gift Experience\"</li> <li>Select Playful or Elegant theme</li> <li>Copy the gift link</li> <li>Share with your recipient</li> </ol> <p>Gift sharing details \u2192</p>"},{"location":"user/creators/index.html#-installation-quick-reference","title":"\ud83d\udd27 Installation Quick Reference","text":""},{"location":"user/creators/index.html#docker-one-liner","title":"Docker One-Liner","text":"<pre><code>docker run -d \\\n  --name mixtape-society \\\n  --restart unless-stopped \\\n  -p 5000:5000 \\\n  -v /path/to/your/music:/music:ro \\\n  -v /data/mixtape-society:/app/collection-data \\\n  -e APP_PASSWORD=YourStrongPassword123! \\\n  ghcr.io/mark-me/mixtape-society:latest\n</code></pre>"},{"location":"user/creators/index.html#docker-compose","title":"Docker Compose","text":"<pre><code>services:\n  mixtape:\n    image: ghcr.io/mark-me/mixtape-society:latest\n    container_name: mixtape-society\n    restart: unless-stopped\n    ports:\n      - \"5000:5000\"\n    volumes:\n      - /your/music:/music:ro\n      - mixtape_data:/app/collection-data\n    environment:\n      - APP_PASSWORD=${APP_PASSWORD}\n      - APP_ENV=production\n\nvolumes:\n  mixtape_data:\n</code></pre> <p>Full installation guide \u2192</p>"},{"location":"user/creators/index.html#-best-practices","title":"\ud83d\udca1 Best Practices","text":""},{"location":"user/creators/index.html#organizing-your-music-library","title":"Organizing Your Music Library","text":"<ul> <li>Use consistent folder structure (Artist/Album/Tracks)</li> <li>Ensure proper ID3 tags (title, artist, album)</li> <li>Include album art in files when possible</li> <li>Use standard audio formats (MP3, FLAC, M4A)</li> </ul>"},{"location":"user/creators/index.html#creating-great-mixtapes","title":"Creating Great Mixtapes","text":"<ul> <li>Flow matters - Order tracks for emotional journey</li> <li>Mix it up - Vary tempo and mood</li> <li>Liner notes - Explain why you chose each song</li> <li>Cover art - Use strong visual that represents the mood</li> <li>Length - 10-15 tracks is the sweet spot</li> </ul>"},{"location":"user/creators/index.html#sharing-effectively","title":"Sharing Effectively","text":"<ul> <li>Context is key - Add a personal message when sharing</li> <li>Choose the right format:</li> <li>Quick link for casual shares</li> <li>Gift theme for special occasions</li> <li>QR code for physical presents</li> <li>Privacy - Only share with people you trust</li> <li>Update when needed - Edit mixtapes after sharing if needed</li> </ul>"},{"location":"user/creators/index.html#-troubleshooting","title":"\ud83c\udd98 Troubleshooting","text":""},{"location":"user/creators/index.html#server-wont-start","title":"Server Won't Start","text":"<p>Check:</p> <ul> <li>Docker is running</li> <li>Port 5000 isn't already in use</li> <li>Music directory path is correct</li> <li>You have sufficient disk space</li> </ul> <p>Detailed troubleshooting \u2192</p>"},{"location":"user/creators/index.html#music-not-appearing","title":"Music Not Appearing","text":"<p>Solutions:</p> <ul> <li>Ensure files are in the mounted music directory</li> <li>Run a collection resync</li> <li>Check file formats are supported</li> <li>Verify file permissions</li> </ul> <p>Collection troubleshooting \u2192</p>"},{"location":"user/creators/index.html#sharing-link-not-working","title":"Sharing Link Not Working","text":"<p>Verify:</p> <ul> <li>Mixtape was saved successfully</li> <li>Server is accessible from outside your network</li> <li>Firewall allows inbound connections</li> <li>HTTPS setup is correct (if using)</li> </ul> <p>Sharing troubleshooting \u2192</p>"},{"location":"user/creators/index.html#-frequently-asked-questions","title":"\u2753 Frequently Asked Questions","text":""},{"location":"user/creators/index.html#how-do-i-update-my-server","title":"How do I update my server?","text":"<pre><code>docker compose pull\ndocker compose up -d --force-recreate\n</code></pre> <p>Your mixtapes and database are preserved in volumes.</p>"},{"location":"user/creators/index.html#can-i-edit-a-mixtape-after-sharing","title":"Can I edit a mixtape after sharing?","text":"<p>Yes! Edit anytime. The share link stays the same, and recipients see the updated version immediately.</p>"},{"location":"user/creators/index.html#how-much-disk-space-do-i-need","title":"How much disk space do I need?","text":"<ul> <li>Database: ~1MB per 1000 tracks</li> <li>Cache: Up to 2GB for transcoded audio (configurable)</li> <li>Covers: ~5MB per 100 mixtapes</li> </ul>"},{"location":"user/creators/index.html#can-i-run-this-on-a-raspberry-pi","title":"Can I run this on a Raspberry Pi?","text":"<p>Yes! Use the ARM-compatible Docker image. Works great on Pi 4 or newer.</p>"},{"location":"user/creators/index.html#is-there-a-user-limit","title":"Is there a user limit?","text":"<p>No built-in limits. Performance depends on your server hardware and concurrent users.</p> <p>More FAQ \u2192</p>"},{"location":"user/creators/index.html#-next-steps","title":"\ud83d\udcd6 Next Steps","text":"<p>Ready to dive deeper? Check out:</p> <ul> <li>Installation Guide - Full setup instructions</li> <li>Editor Guide - Master the mixtape creation tools</li> <li>Sharing Guide - Learn all sharing options</li> <li>Collection Management - Manage your music library</li> </ul> <p>Happy mixtape making! \ud83c\udfb5</p>"},{"location":"user/creators/collection-management.html","title":"Collection Management","text":""},{"location":"user/creators/collection-management.html#collection-management","title":"Collection Management","text":""},{"location":"user/creators/collection-management.html#-overview","title":"\ud83c\udf0d Overview","text":"<p>The Collection Management feature provides two key capabilities:</p> <ol> <li>View Statistics - Get an overview of your music library with counts of artists, albums, tracks, total duration, and information about recently added music</li> <li>Resync Library - Update your music database when you've added, removed, or modified music files</li> </ol>"},{"location":"user/creators/collection-management.html#-accessing-collection-management","title":"\ud83d\udd11 Accessing Collection Management","text":"<p>To access collection management:</p> <ol> <li>Click the Collection button in the top navigation bar</li> <li>The collection management modal will open automatically</li> </ol> <p></p> <p>Note</p> <p>You must be logged in to access collection management features.</p>"},{"location":"user/creators/collection-management.html#-collection-statistics","title":"\ud83d\udcca Collection Statistics","text":"<p>When you open the Collection Management modal, you'll see current statistics about your music library.</p>"},{"location":"user/creators/collection-management.html#artist-count","title":"Artist Count","text":"<p>The total number of unique artists in your music collection. This includes both individual artists and bands.</p>"},{"location":"user/creators/collection-management.html#album-count","title":"Album Count","text":"<p>The total number of unique albums across all artists. Compilation albums with various artists are counted as separate albums.</p>"},{"location":"user/creators/collection-management.html#track-count","title":"Track Count","text":"<p>The total number of individual music tracks in your collection.</p>"},{"location":"user/creators/collection-management.html#total-duration","title":"Total Duration","text":"<p>The combined playback time of all tracks in your library, displayed in a human-readable format:</p> <ul> <li>Days (d)</li> <li>Hours (h)</li> <li>Minutes (m)</li> </ul> <p>Example: <code>5d 3h 45m</code> means 5 days, 3 hours, and 45 minutes of total music</p>"},{"location":"user/creators/collection-management.html#last-added","title":"Last Added","text":"<p>Shows the age of the most recently added track in your collection:</p> <ul> <li>Recent additions - Displays as relative time (e.g., \"2 hours ago\", \"3 days ago\")</li> <li>Older additions - Shows the actual date (e.g., \"Dec 15, 2024\")</li> </ul> <p>What does Last Added mean?</p> <p>This indicates when the newest file in your collection was added to your music directory (based on file modification time), not when it was added to the database. After resyncing, this reflects the youngest track in your entire collection.</p> <p>Tip</p> <p>The statistics automatically refresh each time you open the modal, ensuring you always see up-to-date information.</p>"},{"location":"user/creators/collection-management.html#-resyncing-your-library","title":"\ud83d\udd04 Resyncing Your Library","text":"<p>Resyncing is essential for keeping your music database in sync with your actual music files. You should resync whenever you make changes to your music directory.</p>"},{"location":"user/creators/collection-management.html#when-to-resync","title":"When to Resync","text":"<p>Resync your library when you:</p> <ul> <li>Add new music - New files won't appear until after a resync</li> <li>Delete music - Removed files will still appear in the database until resynced</li> <li>Move or rename files - The database won't reflect these changes until resynced</li> <li>Update metadata - Changes to ID3 tags won't appear until after a resync</li> <li>Notice discrepancies - If statistics or search results seem incorrect</li> </ul>"},{"location":"user/creators/collection-management.html#how-to-resync","title":"How to Resync","text":"<ol> <li>Open the Collection Management modal (click Collection in the navbar)</li> <li>Review your current statistics</li> <li>Click the Resync Library button at the bottom</li> <li>Confirm the resync operation in the confirmation dialog</li> <li>The resync process will begin in the background</li> </ol> <p>Resync Duration</p> <p>Resyncing may take several minutes depending on the size of your music collection. During this time, the application will show an indexing progress screen.</p>"},{"location":"user/creators/collection-management.html#what-happens-during-resync","title":"What Happens During Resync","text":"<p>The resync process:</p> <ol> <li>Scans your music directory for all audio files</li> <li>Adds new files to the database</li> <li>Updates metadata for existing tracks</li> <li>Removes references to deleted or moved files</li> <li>Extracts album artwork from audio files</li> <li>Recalculates all collection statistics</li> </ol> <p>Info</p> <p>During the resync process, you'll see a progress screen showing how many files have been processed. You cannot use other features of the application until the resync completes.</p>"},{"location":"user/creators/collection-management.html#after-resync","title":"After Resync","text":"<p>Once the resync completes:</p> <ul> <li>All statistics will reflect your current music collection</li> <li>New tracks will appear in search results</li> <li>Deleted tracks will no longer appear</li> <li>Updated metadata will be reflected throughout the application</li> </ul>"},{"location":"user/creators/collection-management.html#-understanding-the-resync-process","title":"\ud83e\udde0 Understanding the Resync Process","text":""},{"location":"user/creators/collection-management.html#initial-indexing-vs-resync","title":"Initial Indexing vs. Resync","text":"<ul> <li>Initial Indexing - Happens automatically the first time you start the application, building the complete database from scratch</li> <li>Resync - Updates an existing database by comparing file system changes with the current database</li> </ul>"},{"location":"user/creators/collection-management.html#what-gets-updated","title":"What Gets Updated","text":"<p>During a resync:</p> <ul> <li>\u2705 Track titles and metadata</li> <li>\u2705 Artist and album information</li> <li>\u2705 File paths and locations</li> <li>\u2705 Duration and bitrate</li> <li>\u2705 Album artwork</li> <li>\u2705 File modification times</li> </ul>"},{"location":"user/creators/collection-management.html#what-doesnt-change","title":"What Doesn't Change","text":"<ul> <li>\u274c Mixtapes you've created (these remain intact)</li> <li>\u274c Application settings</li> <li>\u274c Your login credentials</li> </ul>"},{"location":"user/creators/collection-management.html#-common-questions","title":"\u2753 Common Questions","text":""},{"location":"user/creators/collection-management.html#why-are-my-new-files-not-showing-up","title":"Why are my new files not showing up?","text":"<p>New files won't appear in the application until you resync your library. The database only knows about files that existed at the time of the last sync.</p>"},{"location":"user/creators/collection-management.html#what-counts-as-a-unique-album","title":"What counts as a unique album?","text":"<p>An album is considered unique based on the combination of artist name and album title. The same album title by different artists counts as separate albums.</p>"},{"location":"user/creators/collection-management.html#how-is-duration-calculated","title":"How is duration calculated?","text":"<p>The total duration is the sum of all track durations in your collection. If a track's duration cannot be determined from its metadata, it's excluded from the total.</p>"},{"location":"user/creators/collection-management.html#can-i-cancel-a-resync-in-progress","title":"Can I cancel a resync in progress?","text":"<p>No, once a resync starts, it must complete. However, the process is safe and can be performed as often as needed without risk to your data.</p>"},{"location":"user/creators/collection-management.html#will-resyncing-affect-my-mixtapes","title":"Will resyncing affect my mixtapes?","text":"<p>No, resyncing only updates the music database. Your created mixtapes and their track lists remain unchanged.</p>"},{"location":"user/creators/collection-management.html#how-often-should-i-resync","title":"How often should I resync?","text":"<p>Resync whenever you make changes to your music collection. There's no harm in resyncing frequently - it simply ensures your database stays current.</p>"},{"location":"user/creators/collection-management.html#-troubleshooting","title":"\u26a0\ufe0f Troubleshooting","text":""},{"location":"user/creators/collection-management.html#statistics-wont-load","title":"Statistics won't load","text":"<p>If the statistics fail to load:</p> <ol> <li>Ensure you have an active internet connection</li> <li>Try refreshing the page</li> <li>Close and reopen the modal</li> <li>Check that your music library has been indexed at least once</li> </ol>"},{"location":"user/creators/collection-management.html#resync-fails-or-gets-stuck","title":"Resync fails or gets stuck","text":"<p>If a resync operation fails or appears stuck:</p> <ol> <li>Check the progress screen to see if it's still processing</li> <li>Wait for the current operation to complete (it may take longer for large libraries)</li> <li>Check your server logs for error messages</li> <li>Ensure your music directory is accessible and permissions are correct</li> <li>Verify you have sufficient disk space for the database</li> </ol>"},{"location":"user/creators/collection-management.html#resync-says-already-in-progress","title":"Resync says \"already in progress\"","text":"<p>If you try to start a resync while one is already running:</p> <ol> <li>Wait for the current resync to complete</li> <li>Check the indexing progress screen</li> <li>If the process appears truly stuck, restart the application</li> </ol>"},{"location":"user/creators/collection-management.html#statistics-seem-incorrect-after-resync","title":"Statistics seem incorrect after resync","text":"<p>If your statistics don't look right after a resync:</p> <ol> <li>Close and reopen the Collection Management modal to refresh the data</li> <li>Check that all your music files are in the configured music directory</li> <li>Verify that your audio files have valid metadata tags</li> <li>Try another resync to ensure all files were processed</li> </ol>"},{"location":"user/creators/editor.html","title":"Creating Mixtapes","text":""},{"location":"user/creators/editor.html#the-mixtape-editor","title":"The Mixtape Editor","text":"<p>The Mixtape Editor lets you craft personal mixtapes by searching your music library, adding tracks, reordering them, and customizing the cover and title. It evokes the joy of making a real cassette for a friend\u2014simple, intuitive, and fun.</p> <p></p>"},{"location":"user/creators/editor.html#-features","title":"\u2728 Features","text":"<ul> <li>Live search with result highlighting</li> <li>Drag-and-drop track reordering (Sortable.js)</li> <li>Automatic cover extraction from the available cover art.</li> <li>Manual cover upload (drag or paste)</li> <li>Title auto-sanitizes to create clean URLs</li> <li>One-click \u201cSave\u201d \u2192 instantly get a public link</li> </ul>"},{"location":"user/creators/editor.html#-how-to-create-a-mixtape","title":"\ud83c\udfb6 How to Create a Mixtape","text":"<ol> <li> <p>Start a New Mixtape</p> <p>Log in and click \"New Mixtape\" on the browse page. This opens the blank editor.</p> </li> <li> <p>Search and Add Tracks</p> <p>Type in the search bar to find songs, artists, or albums. Results highlight matches live for quick scanning.</p> <p>Click a track to add it to your mixtape.</p> <p>Pro Tip</p> <p><code>Escape</code> \u2013 Clears the search field</p> </li> <li> <p>Reorder Tracks</p> <p>Drag and drop tracks in the playlist to perfect the flow (powered by Sortable.js).</p> <p>Pro Tip</p> <p>Start with a strong opener track\u2014the app uses its album art as the default cover for that perfect first impression.</p> </li> <li> <p>Customize the Cover Art</p> <p>The app auto-extracts cover art from the first track's album.</p> <p>Upload manually.</p> </li> <li> <p>Add liner notes</p> <p>What would you want your friend to know about the mixtape?</p> <p>You can refer to tracks by using <code>#1</code> or ranges of tracks <code>#1-4</code>, which will turn into track titles and artist names when viewing the mixtape.</p> </li> <li> <p>Add a Title and Save</p> <p>Enter a title (it auto-generates a clean, URL-friendly slug).</p> <p>Click Save \u2013 your mixtape saves instantly, and you get a public share link.</p> <p>Pro Tip</p> <p><code>Ctrl + Enter</code> also saves your mixtape</p> </li> </ol> <p>Once saved, head to the Sharing page to learn how to send your mixtape to friends. Enjoy the magic! \ud83d\ude80</p>"},{"location":"user/creators/faq.html","title":"Creator FAQ","text":""},{"location":"user/creators/faq.html#creator-faq","title":"Creator FAQ","text":"<p>Frequently asked questions for Mixtape Society creators and server administrators.</p>"},{"location":"user/creators/faq.html#-installation--setup","title":"\ud83d\ude80 Installation &amp; Setup","text":""},{"location":"user/creators/faq.html#how-do-i-install-mixtape-society","title":"How do I install Mixtape Society?","text":"<p>The easiest way is using Docker:</p> <pre><code>docker run -d \\\n  --name mixtape-society \\\n  --restart unless-stopped \\\n  -p 5000:5000 \\\n  -v /path/to/your/music:/music:ro \\\n  -v /data/mixtape-society:/app/collection-data \\\n  -e APP_PASSWORD=YourStrongPassword123! \\\n  ghcr.io/mark-me/mixtape-society:latest\n</code></pre> <p>Full installation guide \u2192</p>"},{"location":"user/creators/faq.html#how-do-i-update-my-server","title":"How do I update my server?","text":"<p>Using Docker Compose:</p> <pre><code>docker compose pull\ndocker compose up -d --force-recreate\n</code></pre> <p>Using Docker run:</p> <pre><code>docker pull ghcr.io/mark-me/mixtape-society:latest\ndocker stop mixtape-society\ndocker rm mixtape-society\n# Run your original docker run command again\n</code></pre> <p>Your mixtapes and database are preserved in volumes.</p>"},{"location":"user/creators/faq.html#can-i-run-this-on-a-raspberry-pi","title":"Can I run this on a Raspberry Pi?","text":"<p>Yes! Mixtape Society works great on Raspberry Pi 4 or newer.</p> <p>Requirements:</p> <ul> <li>Raspberry Pi 4 (2GB+ RAM recommended)</li> <li>Docker installed</li> <li>External storage recommended for music library</li> <li>Stable power supply</li> </ul> <p>Performance notes:</p> <ul> <li>Initial indexing may take longer</li> <li>Transcoding is slower than on desktop</li> <li>Works perfectly once library is indexed</li> </ul>"},{"location":"user/creators/faq.html#what-are-the-minimum-system-requirements","title":"What are the minimum system requirements?","text":"<p>Minimum:</p> <ul> <li>1GB RAM</li> <li>2GB disk space (plus music library)</li> <li>Single-core CPU</li> <li>Docker or Python 3.11+</li> </ul> <p>Recommended:</p> <ul> <li>2GB+ RAM</li> <li>10GB disk space (for cache and database)</li> <li>Multi-core CPU</li> <li>SSD storage</li> </ul>"},{"location":"user/creators/faq.html#how-much-disk-space-do-i-need","title":"How much disk space do I need?","text":"<p>Base requirements:</p> <ul> <li>Database: ~1MB per 1,000 tracks</li> <li>Audio cache: Up to 2GB (configurable)</li> <li>Cover images: ~5MB per 100 mixtapes</li> <li>Application: ~500MB</li> </ul> <p>Example: 10,000-track library = ~50MB database + 2GB cache = ~2.5GB total</p>"},{"location":"user/creators/faq.html#where-is-my-data-stored","title":"Where is my data stored?","text":"<p>In Docker, data is stored in volumes:</p> <p>Collection data volume (<code>/app/collection-data</code>):</p> <ul> <li><code>collection.db</code> - SQLite database</li> <li><code>mixtapes/</code> - JSON files for each mixtape</li> <li><code>mixtapes/covers/</code> - Custom cover images</li> <li><code>cache/audio/</code> - Transcoded audio files</li> </ul> <p>Music volume (<code>/music</code>):</p> <ul> <li>Your original music files (read-only)</li> <li>Not modified by Mixtape Society</li> </ul> <p>Volume layout details \u2192</p>"},{"location":"user/creators/faq.html#-music-library-management","title":"\ud83c\udfb5 Music Library Management","text":""},{"location":"user/creators/faq.html#what-audio-formats-are-supported","title":"What audio formats are supported?","text":"<p>Supported formats:</p> <ul> <li>\u2705 MP3</li> <li>\u2705 FLAC</li> <li>\u2705 M4A / AAC</li> <li>\u2705 OGG Vorbis</li> <li>\u2705 WAV</li> <li>\u2705 ALAC (Apple Lossless)</li> <li>\u2705 WMA (Windows Media Audio)</li> </ul> <p>Not supported:</p> <ul> <li>\u274c DRM-protected files</li> <li>\u274c Proprietary formats</li> </ul>"},{"location":"user/creators/faq.html#why-arent-my-new-files-showing-up","title":"Why aren't my new files showing up?","text":"<p>New files won't appear until you resync your library.</p> <p>To resync:</p> <ol> <li>Log in to your server</li> <li>Click Collection in navigation</li> <li>Click Resync Library</li> <li>Wait for indexing to complete</li> </ol> <p>Collection management guide \u2192</p>"},{"location":"user/creators/faq.html#how-often-should-i-resync","title":"How often should I resync?","text":"<p>Resync whenever you:</p> <ul> <li>Add new music files</li> <li>Delete or move files</li> <li>Rename files or folders</li> <li>Update ID3 tags or metadata</li> <li>Notice missing tracks or incorrect data</li> </ul> <p>Note: Resyncing is safe and can be done as often as needed. It doesn't affect existing mixtapes.</p>"},{"location":"user/creators/faq.html#can-i-organize-my-music-library-while-using-mixtape-society","title":"Can I organize my music library while using Mixtape Society?","text":"<p>Yes! Your music library is mounted read-only, so Mixtape Society never modifies your files.</p> <p>You can safely:</p> <ul> <li>Add new files</li> <li>Move files between folders</li> <li>Rename files or folders</li> <li>Update ID3 tags</li> <li>Delete files</li> </ul> <p>Just remember to resync after making changes.</p>"},{"location":"user/creators/faq.html#what-metadata-does-mixtape-society-use","title":"What metadata does Mixtape Society use?","text":"<p>Extracted from ID3 tags:</p> <ul> <li>Track title</li> <li>Artist name</li> <li>Album name</li> <li>Track number</li> <li>Genre</li> <li>Year</li> <li>Album artist</li> <li>Duration</li> <li>Bitrate</li> </ul> <p>Extracted from files:</p> <ul> <li>File path</li> <li>File size</li> <li>File modification date</li> <li>Embedded album art</li> </ul>"},{"location":"user/creators/faq.html#how-do-i-add-album-art","title":"How do I add album art?","text":""},{"location":"user/creators/faq.html#method-1-embed-in-files-recommended","title":"Method 1: Embed in files (recommended)","text":"<ul> <li>Use a music tagger (Mp3tag, MusicBrainz Picard)</li> <li>Embed cover art directly in audio files</li> <li>Resync library</li> </ul>"},{"location":"user/creators/faq.html#method-2-folderjpg","title":"Method 2: Folder.jpg","text":"<ul> <li>Place <code>folder.jpg</code> or <code>cover.jpg</code> in album folder</li> <li>Some taggers do this automatically</li> <li>Resync library</li> </ul>"},{"location":"user/creators/faq.html#method-3-custom-mixtape-covers","title":"Method 3: Custom mixtape covers","text":"<ul> <li>Upload when creating mixtape</li> <li>Overrides album art</li> <li>Specific to that mixtape</li> </ul>"},{"location":"user/creators/faq.html#can-i-have-multiple-music-libraries","title":"Can I have multiple music libraries?","text":"<p>Currently: Only one music library path is supported per server instance.</p> <p>Workaround:</p> <ul> <li>Mount multiple folders to subdirectories of <code>/music</code></li> <li>Example: <code>/music/library1/</code>, <code>/music/library2/</code></li> <li>All will be indexed together</li> </ul> <p>Alternative:</p> <ul> <li>Run multiple Mixtape Society instances</li> <li>Each on different port</li> <li>Each with different music library</li> </ul>"},{"location":"user/creators/faq.html#-creating-mixtapes","title":"\ud83c\udfa8 Creating Mixtapes","text":""},{"location":"user/creators/faq.html#how-many-tracks-can-a-mixtape-have","title":"How many tracks can a mixtape have?","text":"<p>Technical limit: 1,000 tracks (unlikely to reach)</p> <p>Practical recommendations:</p> <ul> <li>Short mixtape: 5-10 tracks (~30-45 min)</li> <li>Standard: 10-15 tracks (~45-60 min)</li> <li>Long: 15-25 tracks (~1-2 hours)</li> <li>Very long: 25+ tracks (use sparingly)</li> </ul> <p>Note: Longer mixtapes take more effort to listen through completely.</p>"},{"location":"user/creators/faq.html#can-i-edit-a-mixtape-after-sharing","title":"Can I edit a mixtape after sharing?","text":"<p>Yes! You can edit anytime:</p> <ul> <li>\u2705 Add or remove tracks</li> <li>\u2705 Reorder tracks</li> <li>\u2705 Change cover art</li> <li>\u2705 Update liner notes</li> <li>\u2705 Change title</li> </ul> <p>The share link stays the same and recipients see updates immediately.</p>"},{"location":"user/creators/faq.html#what-happens-if-i-delete-a-mixtape","title":"What happens if I delete a mixtape?","text":"<p>Immediate effects:</p> <ul> <li>All share links stop working immediately</li> <li>Recipients can no longer access it</li> <li>Mixtape is permanently deleted</li> <li>Cover image is deleted</li> <li>Cannot be recovered</li> </ul> <p>Not affected:</p> <ul> <li>Your music library remains unchanged</li> <li>Other mixtapes are unaffected</li> <li>Database statistics update</li> </ul> <p>Permanent Deletion</p> <p>There is no \"undo\" for deleting a mixtape. Make sure you're ready before confirming deletion.</p>"},{"location":"user/creators/faq.html#can-i-duplicate-a-mixtape","title":"Can I duplicate a mixtape?","text":"<p>Currently: No built-in duplication feature.</p> <p>Workaround:</p> <ol> <li>Open the mixtape in editor</li> <li>Manually recreate with same tracks</li> <li>Copy liner notes</li> <li>Upload same cover image</li> </ol> <p>Future feature: One-click duplication is planned.</p>"},{"location":"user/creators/faq.html#how-do-i-reference-tracks-in-liner-notes","title":"How do I reference tracks in liner notes?","text":"<p>Use the track reference syntax:</p> <p>Single track:</p> <ul> <li><code>#1</code> \u2192 Becomes \"Track Title by Artist\"</li> <li><code>#5</code> \u2192 Fifth track in the mixtape</li> </ul> <p>Range of tracks:</p> <ul> <li><code>#1-3</code> \u2192 First three tracks</li> <li><code>#5-8</code> \u2192 Tracks 5 through 8</li> </ul> <p>Example liner notes:</p> <pre><code>This mixtape starts with #1, which reminds me of our road trip.\nTracks #3-5 are for when you need motivation.\nAnd #12 is your favorite - had to include it!\n</code></pre> <p>Editor guide \u2192</p>"},{"location":"user/creators/faq.html#-sharing--access","title":"\ud83d\udd17 Sharing &amp; Access","text":""},{"location":"user/creators/faq.html#how-long-do-share-links-last","title":"How long do share links last?","text":"<p>Links are permanent and never expire unless you:</p> <ul> <li>Delete the mixtape</li> <li>Shut down the server</li> </ul> <p>Links contain:</p> <ul> <li>Mixtape slug (title)</li> <li>Creation date</li> <li>Unique random ID</li> </ul>"},{"location":"user/creators/faq.html#can-i-see-whos-listening-to-my-mixtapes","title":"Can I see who's listening to my mixtapes?","text":"<p>No. Mixtape Society does not track listeners:</p> <ul> <li>No analytics</li> <li>No view counts</li> <li>No listener identification</li> <li>Complete privacy for recipients</li> </ul> <p>This is by design to protect recipient privacy.</p>"},{"location":"user/creators/faq.html#can-i-password-protect-a-mixtape","title":"Can I password-protect a mixtape?","text":"<p>Currently: No password protection feature.</p> <p>Access control is through:</p> <ul> <li>Link privacy (unguessable URLs)</li> <li>Sharing only with trusted people</li> <li>Deleting mixtapes when needed</li> </ul> <p>Workaround for privacy:</p> <ul> <li>Only share links privately</li> <li>Delete and recreate if link is compromised</li> <li>Use a reverse proxy with authentication</li> </ul>"},{"location":"user/creators/faq.html#what-if-someone-shares-my-link-publicly","title":"What if someone shares my link publicly?","text":"<p>If a link is shared publicly:</p> <ol> <li>Delete the mixtape immediately</li> <li>This breaks all links (including the public one)</li> <li>Create a new mixtape</li> <li>Share new link only with trusted people</li> </ol> <p>Prevention:</p> <ul> <li>Only share with people you trust</li> <li>Use private communication channels</li> <li>Remind recipients not to share further</li> </ul>"},{"location":"user/creators/faq.html#can-i-create-temporaryexpiring-links","title":"Can I create temporary/expiring links?","text":"<p>Currently: No built-in link expiration.</p> <p>All links are permanent until the mixtape is deleted.</p> <p>Future consideration: Temporary links may be added in future versions.</p>"},{"location":"user/creators/faq.html#how-do-gift-links-work","title":"How do gift links work?","text":"<p>Gift links are the same URL as direct links, but displayed differently in your sharing modal.</p> <p>When you choose \"Gift Experience\":</p> <ol> <li>You select a theme (Playful or Elegant)</li> <li>The link includes a parameter for the theme</li> <li>Recipients see themed landing page</li> <li>Same link, different presentation</li> </ol> <p>The recipient experience includes:</p> <ul> <li>Themed landing page</li> <li>Cover art showcase</li> <li>Liner notes display</li> <li>\"Unwrap\" or \"Open\" button</li> </ul> <p>Full sharing guide \u2192</p>"},{"location":"user/creators/faq.html#-configuration--customization","title":"\u2699\ufe0f Configuration &amp; Customization","text":""},{"location":"user/creators/faq.html#how-do-i-change-my-admin-password","title":"How do I change my admin password?","text":"<p>Docker Compose:</p> <ol> <li>Edit <code>.env</code> file</li> <li>Change <code>APP_PASSWORD</code> value</li> <li>Restart container: <code>docker compose up -d</code></li> </ol> <p>Docker run:</p> <ol> <li>Stop container: <code>docker stop mixtape-society</code></li> <li>Remove container: <code>docker rm mixtape-society</code></li> <li>Run again with new <code>-e APP_PASSWORD=NewPassword</code></li> </ol> <p>Local development:</p> <ol> <li>Edit <code>.env</code> file</li> <li>Change <code>APP_PASSWORD</code> value</li> <li>Restart application</li> </ol>"},{"location":"user/creators/faq.html#can-i-customize-the-appearance","title":"Can I customize the appearance?","text":"<p>Currently: Limited customization options.</p> <p>What you can customize:</p> <ul> <li>Server name (in config)</li> <li>Password</li> <li>Logo (by modifying static files)</li> </ul> <p>Future plans:</p> <ul> <li>Theme customization</li> <li>Color schemes</li> <li>Custom branding</li> </ul>"},{"location":"user/creators/faq.html#how-do-i-enable-https","title":"How do I enable HTTPS?","text":"<p>Recommended: Use a reverse proxy (Traefik, Nginx, Caddy)</p> <p>Example with Traefik: See installation guide \u2192</p> <p>Not recommended:</p> <ul> <li>Built-in Flask HTTPS (development only)</li> <li>Self-signed certificates</li> </ul>"},{"location":"user/creators/faq.html#can-i-run-multiple-servers","title":"Can I run multiple servers?","text":"<p>Yes! You can run multiple instances:</p> <p>Use cases:</p> <ul> <li>Different music libraries</li> <li>Separate family vs. friends servers</li> <li>Test vs. production</li> <li>Different geographic locations</li> </ul> <p>Requirements:</p> <ul> <li>Different ports for each instance</li> <li>Separate data volumes</li> <li>Unique passwords</li> </ul> <p>Example:</p> <pre><code># Server 1 - Personal\ndocker run -d --name mixtape-personal -p 5000:5000 ...\n\n# Server 2 - Family\ndocker run -d --name mixtape-family -p 5001:5000 ...\n</code></pre>"},{"location":"user/creators/faq.html#-technical-issues","title":"\ud83d\udd27 Technical Issues","text":""},{"location":"user/creators/faq.html#initial-indexing-is-taking-forever","title":"Initial indexing is taking forever","text":"<p>This is normal for large libraries.</p> <p>Expected times:</p> <ul> <li>1,000 tracks: 2-5 minutes</li> <li>10,000 tracks: 15-30 minutes</li> <li>50,000 tracks: 1-2 hours</li> <li>100,000+ tracks: Several hours</li> </ul> <p>What affects speed:</p> <ul> <li>CPU speed</li> <li>Disk speed (SSD vs HDD)</li> <li>File formats (FLAC takes longer)</li> <li>Embedded artwork size</li> </ul> <p>Check progress:</p> <pre><code>docker logs -f mixtape-society\n</code></pre>"},{"location":"user/creators/faq.html#database-corruption-after-crash","title":"Database corruption after crash","text":"<p>Symptoms:</p> <ul> <li>Server won't start</li> <li>Database errors in logs</li> <li>Mixtapes won't load</li> </ul> <p>Recovery:</p> <ol> <li>Stop the server</li> <li>Backup data volume</li> <li>Delete <code>collection.db</code></li> <li>Restart server (triggers re-index)</li> <li>Mixtapes are preserved (stored in JSON)</li> </ol> <p>Prevention:</p> <ul> <li>Use <code>restart: unless-stopped</code> in Docker</li> <li>Proper shutdown procedures</li> <li>Don't kill Docker containers</li> </ul>"},{"location":"user/creators/faq.html#audio-cache-keeps-filling-up","title":"Audio cache keeps filling up","text":"<p>Cache behavior:</p> <ul> <li>Caches transcoded audio</li> <li>Grows over time with usage</li> <li>Automatically managed (LRU)</li> </ul> <p>If cache is too large:</p> <p>Option 1: Clear cache manually</p> <pre><code>docker exec mixtape-society rm -rf /app/collection-data/cache/audio/*\n</code></pre> <p>Option 2: Disable cache</p> <pre><code>environment:\n  - AUDIO_CACHE_ENABLED=false\n</code></pre> <p>Option 3: Reduce cache size (future feature)</p>"},{"location":"user/creators/faq.html#cannot-access-from-other-devices","title":"Cannot access from other devices","text":"<p>Common causes:</p> <p>Firewall blocking:</p> <ul> <li>Check host firewall settings</li> <li>Allow port 5000 inbound</li> <li>Check Docker firewall rules</li> </ul> <p>Port not published:</p> <ul> <li>Verify <code>-p 5000:5000</code> in docker run</li> <li>Check <code>ports:</code> in docker-compose.yml</li> </ul> <p>Wrong IP address:</p> <ul> <li>Use server's local IP, not localhost</li> <li>Find IP: <code>ip addr</code> or <code>ifconfig</code></li> <li>Example: <code>http://192.168.1.100:5000</code></li> </ul> <p>Docker network mode:</p> <ul> <li>Use bridge mode (default)</li> <li>Avoid host-only network</li> </ul>"},{"location":"user/creators/faq.html#mixtapes-wont-play","title":"Mixtapes won't play","text":"<p>Check:</p> <ol> <li>Original music files still exist</li> <li>File permissions are correct</li> <li>Music directory is mounted</li> <li>No file corruption</li> </ol> <p>Debug:</p> <pre><code># Check if music is accessible\ndocker exec mixtape-society ls /music\n\n# Check logs\ndocker logs mixtape-society\n</code></pre>"},{"location":"user/creators/faq.html#-performance--scaling","title":"\ud83d\udcca Performance &amp; Scaling","text":""},{"location":"user/creators/faq.html#how-many-users-can-my-server-handle","title":"How many users can my server handle?","text":"<p>Depends on:</p> <ul> <li>Server hardware</li> <li>Number of concurrent streams</li> <li>Quality settings</li> <li>Network bandwidth</li> </ul> <p>Rough estimates:</p> <ul> <li>Raspberry Pi 4: 2-5 concurrent users</li> <li>Basic VPS: 5-10 concurrent users</li> <li>Dedicated server: 20+ concurrent users</li> </ul> <p>Bottlenecks:</p> <ul> <li>CPU (for transcoding)</li> <li>Network bandwidth</li> <li>Disk I/O</li> <li>RAM (minimal impact)</li> </ul>"},{"location":"user/creators/faq.html#can-i-upgrade-without-losing-data","title":"Can I upgrade without losing data?","text":"<p>Yes! Data is preserved in Docker volumes.</p> <p>Safe to upgrade:</p> <ul> <li>\u2705 Mixtapes (stored in JSON)</li> <li>\u2705 Database (SQLite file)</li> <li>\u2705 Cover images</li> <li>\u2705 Audio cache (can be cleared)</li> <li>\u2705 Configuration</li> </ul> <p>Process:</p> <pre><code>docker compose pull\ndocker compose up -d\n</code></pre>"},{"location":"user/creators/faq.html#should-i-use-ssd-or-hdd-for-storage","title":"Should I use SSD or HDD for storage?","text":"<p>For music library:</p> <ul> <li>HDD is fine</li> <li>Read-mostly workload</li> <li>Size matters more than speed</li> </ul> <p>For database/cache:</p> <ul> <li>SSD recommended</li> <li>Faster indexing</li> <li>Better concurrent access</li> <li>Quicker cache reads</li> </ul> <p>Ideal setup:</p> <ul> <li>Music on HDD (larger capacity)</li> <li>Database/cache on SSD (better performance)</li> </ul>"},{"location":"user/creators/faq.html#-best-practices","title":"\ud83d\udca1 Best Practices","text":""},{"location":"user/creators/faq.html#how-should-i-organize-my-music-library","title":"How should I organize my music library?","text":"<p>Recommended structure:</p> <pre><code>/music/\n  \u251c\u2500\u2500 Artist Name/\n  \u2502   \u251c\u2500\u2500 Album Name/\n  \u2502   \u2502   \u251c\u2500\u2500 01 - Track Name.mp3\n  \u2502   \u2502   \u251c\u2500\u2500 02 - Track Name.mp3\n  \u2502   \u2502   \u2514\u2500\u2500 cover.jpg\n  \u2502   \u2514\u2500\u2500 Another Album/\n  \u2514\u2500\u2500 Another Artist/\n</code></pre> <p>Key principles:</p> <ul> <li>Consistent folder naming</li> <li>Complete ID3 tags</li> <li>Embed album art when possible</li> <li>Use standard formats</li> </ul>"},{"location":"user/creators/faq.html#how-often-should-i-backup","title":"How often should I backup?","text":"<p>Critical data to backup:</p> <ul> <li>Database (<code>collection.db</code>)</li> <li>Mixtape JSON files (<code>mixtapes/*.json</code>)</li> <li>Custom cover images (<code>mixtapes/covers/</code>)</li> </ul> <p>Recommended schedule:</p> <ul> <li>Weekly backups for active servers</li> <li>Before major updates</li> <li>After creating important mixtapes</li> </ul> <p>Docker backup:</p> <pre><code># Backup entire data volume\ndocker run --rm \\\n  -v mixtape_data:/data \\\n  -v $(pwd):/backup \\\n  alpine tar czf /backup/mixtape-backup.tar.gz /data\n</code></pre>"},{"location":"user/creators/faq.html#should-i-use-docker-or-local-installation","title":"Should I use Docker or local installation?","text":"<p>Use Docker if:</p> <ul> <li>\u2705 You want easy setup</li> <li>\u2705 You're deploying to production</li> <li>\u2705 You want easy updates</li> <li>\u2705 You need isolation</li> </ul> <p>Use local if:</p> <ul> <li>You're developing/contributing</li> <li>You need custom modifications</li> <li>You're testing new features</li> <li>You prefer direct access</li> </ul> <p>Recommendation: Docker for 95% of users.</p>"},{"location":"user/creators/faq.html#-additional-resources","title":"\ud83d\udcda Additional Resources","text":"<ul> <li>Installation Guide - Full setup instructions</li> <li>Editor Guide - Creating mixtapes</li> <li>Collection Management - Managing your library</li> <li>Sharing Guide - Sharing options</li> <li>GitHub Issues - Report bugs or request features</li> </ul> <p>Still have questions? Ask in GitHub Discussions!</p>"},{"location":"user/creators/installation.html","title":"Installation","text":""},{"location":"user/creators/installation.html#installation","title":"Installation","text":"<p>Deploying Mixtape Society with Docker is the recommended way to run your private mixtape server\u2014perfect for home servers, VPS, or NAS devices.</p>"},{"location":"user/creators/installation.html#-why-docker","title":"\ud83d\udc0b Why Docker?","text":"Benefit Explanation Zero-setup No manual Python or dependency installation. Everything runs in an isolated container. Portability Works on Linux, macOS, Windows, and ARM devices (Raspberry Pi) without code changes. Isolation The app runs securely with limited system access through volume mounts. Persistence Your data (database, mixtapes, covers, cache) survives container updates and restarts. Easy Updates Pull the latest image and restart\u2014new version runs in seconds."},{"location":"user/creators/installation.html#-official-image","title":"\u2705 Official Image","text":"<p>The official, automatically-built image is available at:</p> <pre><code>ghcr.io/mark-me/mixtape-society:latest\n</code></pre> <p>Images are rebuilt automatically on every release. Use specific version tags (e.g., <code>v1.4.2</code>) for reproducible deployments.</p>"},{"location":"user/creators/installation.html#-quick-start-one-liner","title":"\ud83d\ude80 Quick-Start One-Liner","text":"<p>Replace the placeholders with your actual paths:</p> <pre><code>docker run -d \\\n  --name mixtape-society \\\n  --restart unless-stopped \\\n  -p 5000:5000 \\\n  -v /path/to/your/music:/music:ro \\\n  -v mixtape_data:/app/collection-data \\\n  -e PASSWORD=YourStrongPassword123! \\\n  -e APP_ENV=production \\\n  ghcr.io/mark-me/mixtape-society:latest\n</code></pre> <p>What this does:</p> Flag Effect <code>-p 5000:5000</code> Exposes the web interface on host port 5000. <code>-v /path/to/your/music:/music:ro</code> Mounts your music library read-only. <code>-v mixtape_data:/app/collection-data</code> Persists database, mixtapes, covers, and cache. <code>-e PASSWORD=...</code> Sets your login password (required). <code>-e APP_ENV=production</code> Enables production configuration (required). <code>--restart unless-stopped</code> Automatically restarts after crashes or reboots. <p>After the container starts:</p> <ol> <li>Open http://localhost:5000</li> <li>Log in with your password</li> <li>Wait for initial music indexing to complete (check progress with <code>docker logs -f mixtape-society</code>)</li> </ol>"},{"location":"user/creators/installation.html#-full-docker-compose-setup-recommended","title":"\ud83d\uddc2\ufe0f Full Docker-Compose Setup (Recommended)","text":""},{"location":"user/creators/installation.html#directory-structure","title":"Directory Structure","text":"<p>Create a deployment directory:</p> <pre><code>mkdir ~/mixtape-society\ncd ~/mixtape-society\n</code></pre>"},{"location":"user/creators/installation.html#docker-composeyml","title":"docker-compose.yml","text":"<p>Create this file in your deployment directory:</p> <pre><code>services:\n  mixtape:\n    image: ghcr.io/mark-me/mixtape-society:latest\n    container_name: mixtape-society\n    restart: unless-stopped\n    ports:\n      - \"5000:5000\"\n    volumes:\n      - ${MUSIC_HOST_PATH}:/music:ro\n      - mixtape_data:/app/collection-data\n    environment:\n      - PUID=1000\n      - PGID=1000\n      - TZ=Europe/Amsterdam\n      - PASSWORD=${PASSWORD}\n      - APP_ENV=production\n      - LOG_LEVEL=INFO\n\nvolumes:\n  mixtape_data:\n</code></pre>"},{"location":"user/creators/installation.html#env","title":".env","text":"<p>Create this file next to <code>docker-compose.yml</code>:</p> <pre><code># Path to your music collection on the host\nMUSIC_HOST_PATH=/home/user/Music\n\n# Strong password for web interface (required!)\nPASSWORD=YourVeryStrongPasswordHere!\n</code></pre> <p>Security Note</p> <p>Never commit <code>.env</code> files to version control. Add it to <code>.gitignore</code> if you're tracking your deployment configuration.</p>"},{"location":"user/creators/installation.html#starting-the-service","title":"Starting the Service","text":"<pre><code>docker compose up -d\n</code></pre> <p>First-time setup:</p> <ul> <li>The container will start indexing your music library automatically</li> <li>Monitor progress: <code>docker compose logs -f</code></li> <li>Indexing time depends on library size (e.g., ~5 minutes for 10,000 tracks)</li> </ul>"},{"location":"user/creators/installation.html#updating-to-a-newer-version","title":"Updating to a Newer Version","text":"<pre><code>docker compose pull\ndocker compose up -d\n</code></pre> <p>Your data (database, mixtapes, covers) is preserved in the <code>mixtape_data</code> volume.</p>"},{"location":"user/creators/installation.html#-data-storage","title":"\ud83d\udcc1 Data Storage","text":""},{"location":"user/creators/installation.html#volume-layout","title":"Volume Layout","text":"<p>Inside the container, data is stored at <code>/app/collection-data</code>:</p> <pre><code>/app/collection-data/\n\u251c\u2500\u2500 collection.db              # Music library database\n\u251c\u2500\u2500 mixtapes/\n\u2502   \u251c\u2500\u2500 &lt;slug&gt;.json           # Mixtape definitions\n\u2502   \u2514\u2500\u2500 covers/\n\u2502       \u2514\u2500\u2500 &lt;slug&gt;.jpg        # Custom cover images\n\u2514\u2500\u2500 cache/\n    \u2514\u2500\u2500 audio/\n        \u2514\u2500\u2500 &lt;artist&gt;/&lt;album&gt;/&lt;track&gt;.mp3   # Transcoded audio cache\n</code></pre>"},{"location":"user/creators/installation.html#using-named-volumes-default","title":"Using Named Volumes (Default)","text":"<p>Named volumes are managed by Docker and are the recommended approach:</p> <pre><code>volumes:\n  - mixtape_data:/app/collection-data\n</code></pre> <p>Advantages:</p> <ul> <li>Automatic management by Docker</li> <li>Good performance</li> <li>Easy to backup with <code>docker volume</code> commands</li> </ul> <p>Inspect volume location:</p> <pre><code>docker volume inspect mixtape_data\n# Usually at: /var/lib/docker/volumes/mixtape_data/_data\n</code></pre>"},{"location":"user/creators/installation.html#using-bind-mounts-alternative","title":"Using Bind Mounts (Alternative)","text":"<p>If you prefer direct access to data files:</p> <pre><code>volumes:\n  - /path/on/host/mixtape-data:/app/collection-data\n</code></pre> <p>Advantages:</p> <ul> <li>Easy to browse/backup with regular tools</li> <li>Direct file system access</li> </ul> <p>Requirements:</p> <ul> <li>Directory must be writable by UID 1000 (default container user)</li> <li>Run: <code>sudo chown -R 1000:1000 /path/on/host/mixtape-data</code></li> </ul>"},{"location":"user/creators/installation.html#-configuration-reference","title":"\ud83d\udd27 Configuration Reference","text":""},{"location":"user/creators/installation.html#environment-variables","title":"Environment Variables","text":"Variable Required Default Description <code>PASSWORD</code> Yes (none) Login password for the web interface <code>APP_ENV</code> Yes <code>development</code> Must be set to <code>production</code> for deployment <code>MUSIC_ROOT</code> No <code>/music</code> Container path to music (matches volume mount) <code>LOG_LEVEL</code> No <code>INFO</code> Logging verbosity: <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code> <code>TZ</code> No <code>UTC</code> Timezone for timestamps (e.g., <code>America/New_York</code>) <code>PUID</code> No <code>1000</code> User ID for file permissions <code>PGID</code> No <code>1000</code> Group ID for file permissions"},{"location":"user/creators/installation.html#port-configuration","title":"Port Configuration","text":"<p>Default port mapping:</p> <pre><code>ports:\n  - \"5000:5000\"    # host:container\n</code></pre> <p>To use a different host port (e.g., 8080):</p> <pre><code>ports:\n  - \"8080:5000\"    # Access at http://localhost:8080\n</code></pre>"},{"location":"user/creators/installation.html#-running-behind-a-reverse-proxy","title":"\ud83c\udf10 Running Behind a Reverse Proxy","text":"<p>For external access with HTTPS and a custom domain, use a reverse proxy.</p>"},{"location":"user/creators/installation.html#traefik","title":"Traefik","text":"<p>Add these labels to your <code>docker-compose.yml</code>:</p> <pre><code>services:\n  mixtape:\n    # ... existing configuration ...\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.mixtape.rule=Host(`mixtape.yourdomain.com`)\"\n      - \"traefik.http.routers.mixtape.entrypoints=websecure\"\n      - \"traefik.http.routers.mixtape.tls.certresolver=letsencrypt\"\n      - \"traefik.http.services.mixtape.loadbalancer.server.port=5000\"\n</code></pre> <p>What this does:</p> <ul> <li>Routes <code>mixtape.yourdomain.com</code> to your service</li> <li>Automatically obtains Let's Encrypt certificates</li> <li>Terminates TLS at the proxy level</li> </ul>"},{"location":"user/creators/installation.html#nginx-proxy-manager","title":"Nginx Proxy Manager","text":"<ol> <li>In NPM web interface, add a new Proxy Host</li> <li>Set:</li> <li>Domain: <code>mixtape.yourdomain.com</code></li> <li>Forward Hostname: <code>mixtape-society</code> (container name)</li> <li>Forward Port: <code>5000</code></li> <li>Enable SSL: Yes (request Let's Encrypt certificate)</li> </ol>"},{"location":"user/creators/installation.html#caddy","title":"Caddy","text":"<p>Create a <code>Caddyfile</code>:</p> <pre><code>mixtape.yourdomain.com {\n    reverse_proxy mixtape-society:5000\n}\n</code></pre> <p>Caddy automatically handles HTTPS certificates.</p>"},{"location":"user/creators/installation.html#tailscale-with-tsdproxy","title":"Tailscale with TSDProxy","text":"<p>If using Tailscale for private access:</p> <pre><code>services:\n  mixtape:\n    # ... existing configuration ...\n    environment:\n      - TSDPROXY_ENABLE=true\n      - TSDPROXY_HOST=mixtape.yourtailnet.ts.net\n      - TSDPROXY_HTTP_PORT=5000\n      - TSDPROXY_TLS_EMAIL=you@example.com\n</code></pre> <p>What this does:</p> <ul> <li>Exposes your service on your Tailscale network</li> <li>Automatically provisions TLS certificates</li> <li>Private access without exposing to public internet</li> </ul>"},{"location":"user/creators/installation.html#-troubleshooting","title":"\u26a0\ufe0f Troubleshooting","text":""},{"location":"user/creators/installation.html#container-wont-start","title":"Container Won't Start","text":"<p>Check logs:</p> <pre><code>docker compose logs\n</code></pre> <p>Common causes:</p> <ul> <li>Missing required environment variables (<code>PASSWORD</code>, <code>APP_ENV</code>)</li> <li>Port 5000 already in use</li> <li>Volume mount paths don't exist</li> </ul>"},{"location":"user/creators/installation.html#music-library-not-indexing","title":"Music Library Not Indexing","text":"<p>Verify music mount:</p> <pre><code>docker compose exec mixtape ls -la /music\n</code></pre> <p>Check permissions:</p> <ul> <li>Container user (UID 1000) must be able to read music files</li> <li>For bind mounts: <code>chmod -R 755 /path/to/music</code></li> </ul> <p>Monitor indexing progress:</p> <pre><code>docker compose logs -f | grep -i index\n</code></pre>"},{"location":"user/creators/installation.html#cannot-access-web-interface","title":"Cannot Access Web Interface","text":"<p>Check container is running:</p> <pre><code>docker compose ps\n</code></pre> <p>Verify port mapping:</p> <pre><code>docker compose port mixtape 5000\n</code></pre> <p>Test from inside container:</p> <pre><code>docker compose exec mixtape curl -I http://localhost:5000\n</code></pre>"},{"location":"user/creators/installation.html#permission-errors-when-writing-data","title":"Permission Errors When Writing Data","text":"<p>Verify volume ownership:</p> <pre><code># For bind mounts\nls -la /path/to/mixtape-data\n\n# Should be owned by UID 1000\nsudo chown -R 1000:1000 /path/to/mixtape-data\n</code></pre> <p>Adjust container user (if needed):</p> <pre><code>environment:\n  - PUID=1001\n  - PGID=1001\n</code></pre>"},{"location":"user/creators/installation.html#database-corruption","title":"Database Corruption","text":"<p>If you encounter database errors:</p> <ol> <li>Stop the container:</li> </ol> <pre><code>docker compose down\n</code></pre> <ol> <li>Backup current data:</li> </ol> <pre><code>docker run --rm -v mixtape_data:/data -v $(pwd):/backup \\\n  alpine tar czf /backup/mixtape-backup.tar.gz /data\n</code></pre> <ol> <li>Reset database (this will re-index your library):</li> <li>Through web UI: Settings \u2192 Reset Database</li> <li> <p>Manual: Delete <code>collection.db</code> and restart</p> </li> <li> <p>Restore only mixtapes (if needed):</p> </li> </ol> <pre><code>tar xzf mixtape-backup.tar.gz data/mixtapes/ --strip-components=1\n</code></pre>"},{"location":"user/creators/installation.html#audio-not-playing","title":"Audio Not Playing","text":"<p>Check audio cache:</p> <pre><code>docker compose exec mixtape ls -la /app/collection-data/cache/audio/\n</code></pre> <p>Verify browser console for errors:</p> <ul> <li>Open browser DevTools (F12)</li> <li>Check Console and Network tabs for failed requests</li> </ul> <p>Test direct audio access:</p> <pre><code>curl -I http://localhost:5000/play/&lt;mixtape-slug&gt;/stream/&lt;track-id&gt;\n</code></pre>"},{"location":"user/creators/installation.html#-monitoring-and-maintenance","title":"\ud83d\udcca Monitoring and Maintenance","text":""},{"location":"user/creators/installation.html#view-logs","title":"View Logs","text":"<pre><code># Real-time logs\ndocker compose logs -f\n\n# Last 100 lines\ndocker compose logs --tail=100\n\n# Logs for specific time\ndocker compose logs --since=\"2024-01-20T10:00:00\"\n</code></pre>"},{"location":"user/creators/installation.html#container-resource-usage","title":"Container Resource Usage","text":"<pre><code>docker stats mixtape-society\n</code></pre>"},{"location":"user/creators/installation.html#backup-data","title":"Backup Data","text":"<p>Using named volume:</p> <pre><code>docker run --rm \\\n  -v mixtape_data:/data \\\n  -v $(pwd):/backup \\\n  alpine tar czf /backup/mixtape-backup-$(date +%Y%m%d).tar.gz /data\n</code></pre> <p>Using bind mount:</p> <pre><code>tar czf mixtape-backup-$(date +%Y%m%d).tar.gz /path/to/mixtape-data\n</code></pre>"},{"location":"user/creators/installation.html#restore-backup","title":"Restore Backup","text":"<pre><code>docker compose down\ndocker run --rm \\\n  -v mixtape_data:/data \\\n  -v $(pwd):/backup \\\n  alpine sh -c \"cd /data &amp;&amp; tar xzf /backup/mixtape-backup.tar.gz --strip-components=1\"\ndocker compose up -d\n</code></pre>"},{"location":"user/creators/installation.html#-upgrade-checklist","title":"\ud83d\udd04 Upgrade Checklist","text":"<p>Before upgrading to a new version:</p> <ol> <li>\u2705 Backup your data (see above)</li> <li>\u2705 Read release notes for breaking changes</li> <li>\u2705 Pull new image: <code>docker compose pull</code></li> <li>\u2705 Restart: <code>docker compose up -d</code></li> <li>\u2705 Verify functionality: Check web interface and play a mixtape</li> <li>\u2705 Monitor logs: <code>docker compose logs -f</code> for any errors</li> </ol>"},{"location":"user/creators/installation.html#-related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>Local Development with Docker: For developers building and testing images</li> <li>Configuration Reference: Detailed explanation of all configuration options</li> <li>Installation Overview: Alternative installation methods (non-Docker)</li> </ul>"},{"location":"user/creators/sharing.html","title":"Sharing Mixtapes","text":""},{"location":"user/creators/sharing.html#sharing-your-mixtapes","title":"Sharing Your Mixtapes","text":"<p>You've created the perfect mixtape\u2014now it's time to share it! Mixtape Society gives you flexible options to match any occasion, from casual links to beautifully themed gift experiences.</p>"},{"location":"user/creators/sharing.html#-quick-overview","title":"\ud83c\udfaf Quick Overview","text":"<p>After saving your mixtape, you have three sharing options:</p> Method Best For Recipient Experience Quick Share Casual sharing, messaging apps Direct to player Gift Experience Special occasions, surprises Themed landing page QR Code Physical gifts, events Scan to access"},{"location":"user/creators/sharing.html#-getting-your-share-link","title":"\ud83d\udcf1 Getting Your Share Link","text":""},{"location":"user/creators/sharing.html#save-your-mixtape","title":"Save Your Mixtape","text":"<ol> <li>In the editor, click Save (or press Ctrl + Enter)</li> <li>The app generates a unique, permanent public link</li> <li>The sharing modal appears automatically</li> </ol>"},{"location":"user/creators/sharing.html#the-share-link-format","title":"The Share Link Format","text":"<p>Your link will look like:</p> <pre><code>https://yourdomain.com/share/summer-vibes_20251217_abcd1234\n</code></pre> <ul> <li>Slug: Human-readable title (<code>summer-vibes</code>)</li> <li>Date: When created (<code>20251217</code>)</li> <li>ID: Random unique identifier (<code>abcd1234</code>)</li> </ul> <p>This format ensures:</p> <ul> <li>Links are memorable</li> <li>No conflicts with other mixtapes</li> <li>Privacy through unguessable IDs</li> </ul>"},{"location":"user/creators/sharing.html#-quick-share-simple-link","title":"\ud83d\udd17 Quick Share (Simple Link)","text":"<p>Perfect for everyday sharing via text, email, or messaging apps.</p>"},{"location":"user/creators/sharing.html#when-to-use","title":"When to Use","text":"<ul> <li>Sharing with friends casually</li> <li>Social media posts</li> <li>Quick \"check this out\" moments</li> <li>Group chats or Discord servers</li> <li>Email newsletters</li> </ul>"},{"location":"user/creators/sharing.html#how-it-works","title":"How It Works","text":"<ol> <li>Click Copy Link in the share modal</li> <li>Paste anywhere you can share URLs</li> <li>Recipients click and start listening immediately</li> </ol>"},{"location":"user/creators/sharing.html#what-recipients-see","title":"What Recipients See","text":"<ul> <li>Direct access to the player</li> <li>Full track listing</li> <li>Cover art display</li> <li>All playback controls</li> <li>No login or signup required</li> </ul>"},{"location":"user/creators/sharing.html#sharing-tips","title":"Sharing Tips","text":"<p>Add Context</p> <p>When sharing links, add a personal message: \"Made this thinking of our road trip! Hope you enjoy! \ud83c\udfb5\"</p>"},{"location":"user/creators/sharing.html#-gift-experience-themed-landing-page","title":"\ud83c\udf81 Gift Experience (Themed Landing Page)","text":"<p>Transform your mixtape into a memorable gift with a beautiful themed landing page.</p>"},{"location":"user/creators/sharing.html#choosing-a-theme","title":"Choosing a Theme","text":""},{"location":"user/creators/sharing.html#playful-theme","title":"Playful Theme","text":"<p>Best for:</p> <ul> <li>Birthday mixtapes</li> <li>Party playlists</li> <li>Fun, upbeat collections</li> <li>Celebrations and happy occasions</li> <li>Friends and casual gifts</li> </ul> <p>Design characteristics:</p> <ul> <li>Vibrant colors</li> <li>Energetic feel</li> <li>Casual, fun typography</li> <li>Playful animations</li> </ul>"},{"location":"user/creators/sharing.html#elegant-theme","title":"Elegant Theme","text":"<p>Best for:</p> <ul> <li>Anniversary mixtapes</li> <li>Romantic collections</li> <li>Meaningful milestone gifts</li> <li>Heartfelt messages</li> <li>Sophisticated occasions</li> </ul> <p>Design characteristics:</p> <ul> <li>Refined, minimalist design</li> <li>Elegant typography</li> <li>Subtle animations</li> <li>Timeless aesthetic</li> </ul>"},{"location":"user/creators/sharing.html#how-to-create-a-gift-link","title":"How to Create a Gift Link","text":"<ol> <li>Save your mixtape</li> <li>In the share modal, select Gift Experience</li> <li>Choose Playful or Elegant theme</li> <li>Copy the generated gift link</li> <li>Share with your recipient</li> </ol>"},{"location":"user/creators/sharing.html#what-recipients-experience","title":"What Recipients Experience","text":"<ol> <li>Landing Page - Beautiful themed page with your cover art</li> <li>Liner Notes - Your personal message displayed prominently</li> <li>\"Unwrap\" Button - Playful theme shows \"Unwrap Your Gift\"</li> <li>\"Open\" Button - Elegant theme shows \"Open Mixtape\"</li> <li>Player Reveal - Smooth transition to the full player</li> </ol>"},{"location":"user/creators/sharing.html#gift-link-tips","title":"Gift Link Tips","text":"<p>Maximize Impact</p> <ul> <li>Write heartfelt liner notes for the landing page</li> <li>Choose cover art that complements the theme</li> <li>Match the theme to the mixtape's emotional tone</li> <li>Send with anticipation: \"I made you something special...\"</li> </ul> <p>Perfect Occasions</p> <p>Playful Theme: - \"Your 30<sup>th</sup> Birthday Bangers\" - \"Summer BBQ Essentials\" - \"Workout Energy Boost\" - \"Road Trip Mix Vol. 3\"</p> <p>Elegant Theme: - \"Our First Year Together\" - \"For Your Wedding Day\" - \"In Memory of...\" - \"Welcome to the World, Baby Emma\"</p>"},{"location":"user/creators/sharing.html#-qr-codes","title":"\ud83d\udcf7 QR Codes","text":"<p>Perfect for bridging digital and physical sharing experiences.</p>"},{"location":"user/creators/sharing.html#download-options","title":"Download Options","text":"<p>When you select QR code sharing, you can download:</p> <ol> <li>Simple QR Code - Black and white, for printing</li> <li>Enhanced QR Code - Includes cover art and title</li> </ol>"},{"location":"user/creators/sharing.html#use-cases","title":"Use Cases","text":""},{"location":"user/creators/sharing.html#greeting-cards","title":"Greeting Cards","text":"<ol> <li>Download enhanced QR code</li> <li>Print on cardstock or photo paper</li> <li>Include in birthday, anniversary, or thank-you card</li> <li>Recipient scans with phone camera</li> <li>Instant access to your mixtape</li> </ol> <p>Card ideas:</p> <ul> <li>\"Scan to hear why you're amazing\"</li> <li>\"Your birthday soundtrack awaits\"</li> <li>\"Open when you need a smile \u266a\"</li> </ul>"},{"location":"user/creators/sharing.html#physical-gifts","title":"Physical Gifts","text":"<p>Gift Tags:</p> <ul> <li>Attach QR code tag to wrapped presents</li> <li>Include with flower arrangements</li> <li>Add to gift baskets</li> <li>Accompany jewelry or other presents</li> </ul> <p>Printable Booklet:</p> <ul> <li>Cover art on front</li> <li>QR code on back</li> <li>Track listing inside</li> <li>Liner notes with personal messages</li> <li>Song-by-song explanations</li> </ul>"},{"location":"user/creators/sharing.html#events--parties","title":"Events &amp; Parties","text":"<p>Party Materials:</p> <ul> <li>Table tent cards with QR codes</li> <li>Guests scan to access party playlist</li> <li>Everyone can cast to speakers</li> <li>Creates shared listening experience</li> </ul> <p>Wedding Favors:</p> <ul> <li>Custom cards for each guest table</li> <li>Reception playlist access</li> <li>Couple's love story in songs</li> <li>Memorable keepsake</li> </ul> <p>Venue Signage:</p> <ul> <li>Large QR code prints</li> <li>Background music at gatherings</li> <li>Gallery opening soundtracks</li> <li>Pop-up shop ambiance</li> </ul>"},{"location":"user/creators/sharing.html#creative-implementations","title":"Creative Implementations","text":"<p>Photo Album:</p> <ul> <li>Add QR codes to physical photo albums</li> <li>\"Soundtrack to Our Vacation\"</li> <li>Each section has matching music</li> </ul> <p>Care Packages:</p> <ul> <li>Include QR code in mail packages</li> <li>Adds emotional soundtrack</li> <li>Perfect for long-distance relationships</li> </ul> <p>Memory Books:</p> <ul> <li>Scrapbooks with embedded QR codes</li> <li>Songs that capture moments</li> <li>Multi-sensory memories</li> </ul>"},{"location":"user/creators/sharing.html#qr-code-tips","title":"QR Code Tips","text":"<p>Print Quality</p> <ul> <li>Use high DPI (300+) for clarity</li> <li>Test scan before mass printing</li> <li>Ensure good contrast</li> <li>Leave white border around QR code</li> </ul> <p>Physical Placement</p> <ul> <li>Make QR codes prominent and obvious</li> <li>Include text: \"Scan me!\" or \"Tap to play\"</li> <li>Ensure good lighting where placed</li> <li>Consider phone access angle</li> </ul>"},{"location":"user/creators/sharing.html#-privacy--access-control","title":"\ud83d\udd12 Privacy &amp; Access Control","text":""},{"location":"user/creators/sharing.html#what-you-control","title":"What You Control","text":"<p>Link Privacy:</p> <ul> <li>Links use random IDs that can't be guessed</li> <li>No public directory of mixtapes</li> <li>Only people with the link can access</li> <li>Same link works for all sharing methods</li> </ul> <p>Lifetime Management:</p> <ul> <li>Links are permanent by default</li> <li>Never expire automatically</li> <li>Delete mixtape to revoke all access</li> <li>No time limits or view counts</li> </ul> <p>Content Control:</p> <ul> <li>Edit mixtape anytime</li> <li>Changes reflect immediately for all recipients</li> <li>Same link works after edits</li> <li>Update cover, tracks, or liner notes freely</li> </ul>"},{"location":"user/creators/sharing.html#what-recipients-see_1","title":"What Recipients See","text":"<p>No Personal Data:</p> <ul> <li>No tracking of who listens</li> <li>No analytics or view counts</li> <li>No IP address logging</li> <li>Complete privacy for recipients</li> </ul> <p>No Barriers:</p> <ul> <li>No login required</li> <li>No account creation</li> <li>No email collection</li> <li>No cookies (beyond essential playback)</li> </ul>"},{"location":"user/creators/sharing.html#sharing-best-practices","title":"Sharing Best Practices","text":"<p>Share Responsibly</p> <p>While links are hard to guess, anyone who receives the link can access the mixtape. Only share with people you trust, or delete the mixtape when you want to revoke access.</p> <p>Sensitive Content</p> <p>If sharing mixtapes with personal or sensitive liner notes: - Consider who might forward the link - Use private communication channels - Remember that recipients can share further - Delete when no longer needed</p>"},{"location":"user/creators/sharing.html#-creative-sharing-ideas","title":"\ud83c\udfa8 Creative Sharing Ideas","text":""},{"location":"user/creators/sharing.html#occasions","title":"Occasions","text":"<p>Birthdays:</p> <ul> <li>Curate songs from their birth year</li> <li>Include memories from each decade</li> <li>Theme: their favorite genre journey</li> <li>Playful gift theme</li> </ul> <p>Anniversaries:</p> <ul> <li>Songs from key relationship moments</li> <li>\"Our Story in 15 Songs\"</li> <li>Include first dance, first concert, etc.</li> <li>Elegant gift theme</li> </ul> <p>Graduations:</p> <ul> <li>Motivational anthems</li> <li>Songs about new beginnings</li> <li>Advice in liner notes</li> <li>Playful theme with inspiring message</li> </ul> <p>New Baby:</p> <ul> <li>Lullabies and soft songs</li> <li>Welcome messages in liner notes</li> <li>Gift QR code with baby blanket</li> <li>Elegant theme for sentimental touch</li> </ul> <p>Breakups/Support:</p> <ul> <li>Healing playlist for friends</li> <li>Empowering anthems</li> <li>\"You've Got This\" message</li> <li>Simple link with supportive text</li> </ul>"},{"location":"user/creators/sharing.html#long-distance","title":"Long Distance","text":"<p>Monthly Musical Letters:</p> <ul> <li>Create new mixtape each month</li> <li>Share your current mood through music</li> <li>Liner notes as voice memo-style updates</li> <li>Builds ongoing soundtrack to relationship</li> </ul> <p>Time Capsule:</p> <ul> <li>Create mixtape of current favorites</li> <li>Seal with message: \"Open in 5 years\"</li> <li>Document this moment in time</li> <li>Use elegant theme for gravitas</li> </ul>"},{"location":"user/creators/sharing.html#work--professional","title":"Work &amp; Professional","text":"<p>Team Building:</p> <ul> <li>Collaborative office playlist</li> <li>QR codes at desks</li> <li>Shared listening during lunches</li> <li>Builds team culture</li> </ul> <p>Store/Business Ambiance:</p> <ul> <li>Curated brand soundtrack</li> <li>QR code at entrance</li> <li>Customers can take the vibe home</li> <li>Memorable brand experience</li> </ul>"},{"location":"user/creators/sharing.html#-after-sharing","title":"\ud83d\udd04 After Sharing","text":""},{"location":"user/creators/sharing.html#editing-shared-mixtapes","title":"Editing Shared Mixtapes","text":"<p>You can always:</p> <ul> <li>Add or remove tracks</li> <li>Reorder the sequence</li> <li>Update cover art</li> <li>Revise liner notes</li> <li>Change the title</li> </ul> <p>Recipients see:</p> <ul> <li>Updates immediately</li> <li>Same link continues working</li> <li>No re-sharing needed</li> </ul>"},{"location":"user/creators/sharing.html#managing-your-collection","title":"Managing Your Collection","text":"<p>Track what you've shared:</p> <ul> <li>Review all mixtapes in browse view</li> <li>See creation dates</li> <li>Organize by audience or occasion</li> <li>Delete when no longer needed</li> </ul>"},{"location":"user/creators/sharing.html#removing-access","title":"Removing Access","text":"<p>To stop sharing:</p> <ol> <li>Go to browse page</li> <li>Find the mixtape</li> <li>Click delete</li> <li>Confirm deletion</li> <li>All links immediately stop working</li> </ol> <p>Deletion is Permanent</p> <p>Once deleted, the mixtape and all its data are gone. Recipients can no longer access it. There's no recovery\u2014make sure you're ready!</p>"},{"location":"user/creators/sharing.html#-common-questions","title":"\u2753 Common Questions","text":""},{"location":"user/creators/sharing.html#how-long-do-links-last","title":"How long do links last?","text":"<p>Links are permanent and never expire unless you delete the mixtape.</p>"},{"location":"user/creators/sharing.html#can-i-see-whos-listening","title":"Can I see who's listening?","text":"<p>No, we don't track listeners. Privacy is built-in for both you and recipients.</p>"},{"location":"user/creators/sharing.html#can-i-change-a-mixtape-after-sharing","title":"Can I change a mixtape after sharing?","text":"<p>Yes! Edit anytime. The link stays the same, and recipients see updates immediately.</p>"},{"location":"user/creators/sharing.html#can-i-use-multiple-sharing-methods-for-one-mixtape","title":"Can I use multiple sharing methods for one mixtape?","text":"<p>Absolutely! Generate a simple link for one friend, a gift link for another, and a QR code for a card\u2014all for the same mixtape.</p>"},{"location":"user/creators/sharing.html#what-if-someone-shares-my-link-publicly","title":"What if someone shares my link publicly?","text":"<p>Anyone with the link can access it. If this happens, delete the mixtape to revoke all access, then create a new one to share privately again.</p>"},{"location":"user/creators/sharing.html#can-i-password-protect-a-mixtape","title":"Can I password-protect a mixtape?","text":"<p>Not currently. Access control is through link privacy only (unguessable URLs).</p>"},{"location":"user/creators/sharing.html#do-i-need-to-reshare-after-editing","title":"Do I need to reshare after editing?","text":"<p>No! Edits appear immediately for everyone who has the link. The URL never changes.</p>"},{"location":"user/creators/sharing.html#-related-guides","title":"\ud83d\udcda Related Guides","text":"<ul> <li>Editor Guide - Learn to create amazing mixtapes</li> <li>Collection Management - Manage your music library</li> <li>Recipient's Guide - How friends experience your mixtapes</li> </ul> <p>Share the joy of music! \ud83c\udfb5</p>"},{"location":"user/recipients/index.html","title":"Recipient's Guide","text":""},{"location":"user/recipients/index.html#recipients-guide","title":"Recipient's Guide","text":"<p>Someone shared a mixtape with you\u2014exciting! This guide will help you listen, enjoy, and get the most out of your musical gift.</p>"},{"location":"user/recipients/index.html#-quick-start","title":"\ud83c\udfa7 Quick Start","text":""},{"location":"user/recipients/index.html#got-a-link-or-qr-code","title":"Got a Link or QR Code?","text":"<ol> <li>Click the link or scan the QR code</li> <li>Your mixtape opens in your browser</li> <li>Hit play and enjoy!</li> </ol> <p>No app needed. No login required. No signup.</p>"},{"location":"user/recipients/index.html#-complete-listening-guide","title":"\ud83d\udcda Complete Listening Guide","text":""},{"location":"user/recipients/index.html#opening-your-mixtape","title":"Opening Your Mixtape","text":"<p>Getting Started</p> <p>Different ways you might receive a mixtape:</p> <ul> <li>Direct link in a text or email</li> <li>Gift landing page (themed experience)</li> <li>QR code on a card or gift</li> <li>Social media share</li> </ul> <p>Each opens easily in any web browser on any device.</p>"},{"location":"user/recipients/index.html#using-the-player","title":"Using the Player","text":"<p>Player Guide</p> <p>Master all the features:</p> <ul> <li>Basic controls (play, pause, skip)</li> <li>Advanced features (shuffle, repeat, seek)</li> <li>Quality settings for your connection</li> <li>Keyboard shortcuts</li> <li>Lock screen controls</li> </ul>"},{"location":"user/recipients/index.html#streaming-to-devices","title":"Streaming to Devices","text":"<p>Streaming Guide</p> <p>Play on bigger screens and better speakers:</p> <ul> <li>Chromecast - For Android, Chrome, Windows</li> <li>AirPlay - For iPhone, iPad, Mac</li> <li>Android Auto - In your car</li> </ul> <p>Full instructions for each platform.</p>"},{"location":"user/recipients/index.html#troubleshooting","title":"Troubleshooting","text":"<p>Help &amp; FAQ</p> <p>Common issues and solutions:</p> <ul> <li>Link won't open</li> <li>Playback stutters</li> <li>Connection problems</li> <li>Quality settings</li> </ul>"},{"location":"user/recipients/index.html#-common-questions","title":"\ud83c\udfaf Common Questions","text":""},{"location":"user/recipients/index.html#do-i-need-to-create-an-account","title":"Do I need to create an account?","text":"<p>No! Just click the link and start listening. That's it.</p>"},{"location":"user/recipients/index.html#does-it-work-on-my-phone","title":"Does it work on my phone?","text":"<p>Yes! Works on any device with a modern web browser:</p> <ul> <li>iPhone &amp; iPad (Safari works best)</li> <li>Android phones &amp; tablets</li> <li>Windows, Mac, Linux computers</li> <li>Chromebooks</li> </ul>"},{"location":"user/recipients/index.html#can-i-download-the-songs","title":"Can I download the songs?","text":"<p>No, streaming only. This protects the creator's music library and respects copyright. But you can listen as many times as you want!</p>"},{"location":"user/recipients/index.html#will-it-use-a-lot-of-data","title":"Will it use a lot of data?","text":"<p>Mixtapes use about:</p> <ul> <li>Original quality: ~10MB per song</li> <li>High quality: ~7MB per song</li> <li>Medium quality: ~5MB per song (default)</li> <li>Low quality: ~3MB per song</li> </ul> <p>You can adjust quality in the player settings.</p>"},{"location":"user/recipients/index.html#can-i-listen-offline","title":"Can I listen offline?","text":"<p>Not currently. You need an internet connection to stream mixtapes.</p>"},{"location":"user/recipients/index.html#can-i-cast-to-my-tv-or-speakers","title":"Can I cast to my TV or speakers?","text":"<p>Yes! If you have:</p> <ul> <li>Chromecast (Android/Chrome/Windows)</li> <li>AirPlay device (iPhone/iPad/Mac)</li> <li>Android Auto (in-car)</li> </ul> <p>Full casting guide \u2192</p>"},{"location":"user/recipients/index.html#-types-of-mixtape-links","title":"\ud83c\udf81 Types of Mixtape Links","text":""},{"location":"user/recipients/index.html#direct-link","title":"Direct Link","text":"<p>Simple URL that opens straight to the player.</p> <p>Example: <code>https://mixtape.example.com/share/summer-vibes_20251217_abcd1234</code></p> <p>When you'll see this:</p> <ul> <li>Text messages</li> <li>Emails</li> <li>Social media posts</li> <li>Group chats</li> </ul>"},{"location":"user/recipients/index.html#gift-experience","title":"Gift Experience","text":"<p>Special landing page before the player.</p> <p>What you'll see:</p> <ul> <li>Beautiful themed design (Playful or Elegant)</li> <li>Cover art showcase</li> <li>Personal message from creator</li> <li>\"Unwrap\" or \"Open\" button to reveal player</li> </ul> <p>When you'll see this:</p> <ul> <li>Birthday gifts</li> <li>Anniversary presents</li> <li>Special occasions</li> <li>Heartfelt messages</li> </ul>"},{"location":"user/recipients/index.html#qr-code","title":"QR Code","text":"<p>Scan with your phone camera.</p> <p>Where you'll find these:</p> <ul> <li>Greeting cards</li> <li>Physical gifts</li> <li>Event tables</li> <li>Party materials</li> </ul> <p>How to scan:</p> <ol> <li>Open phone camera</li> <li>Point at QR code</li> <li>Tap the notification</li> <li>Mixtape opens in browser</li> </ol>"},{"location":"user/recipients/index.html#-platform-specific-tips","title":"\ud83d\udcf1 Platform-Specific Tips","text":""},{"location":"user/recipients/index.html#iphone--ipad","title":"iPhone &amp; iPad","text":"<p>Best Browser: Safari (for AirPlay support)</p> <p>Tips:</p> <ul> <li>Add to home screen for quick access</li> <li>Use Control Center for playback controls</li> <li>Lock screen controls work automatically</li> <li>AirPlay to Apple TV or HomePod</li> </ul> <p>iPhone guide \u2192</p>"},{"location":"user/recipients/index.html#android","title":"Android","text":"<p>Best Browser: Chrome</p> <p>Tips:</p> <ul> <li>Lock screen controls available</li> <li>Notification controls for quick access</li> <li>Cast to Chromecast devices</li> <li>Android Auto support in cars</li> </ul> <p>Android guide \u2192</p>"},{"location":"user/recipients/index.html#desktop","title":"Desktop","text":"<p>Works in any browser</p> <p>Tips:</p> <ul> <li>Keyboard shortcuts for control</li> <li>Better for long listening sessions</li> <li>Large album art display</li> <li>Full track listing visible</li> </ul> <p>Desktop guide \u2192</p>"},{"location":"user/recipients/index.html#-making-the-most-of-it","title":"\ud83c\udfb5 Making the Most of It","text":""},{"location":"user/recipients/index.html#first-listen-experience","title":"First Listen Experience","text":"<ol> <li>Read the liner notes - The creator often explains why they chose each song</li> <li>See the flow - Notice how songs connect and transition</li> <li>Save it - Bookmark or add to home screen</li> <li>Share the love - Thank the creator!</li> </ol>"},{"location":"user/recipients/index.html#repeated-listening","title":"Repeated Listening","text":"<ul> <li>Try different quality settings</li> <li>Cast to different devices</li> <li>Listen in different contexts (workout, relaxation, driving)</li> <li>Discover new favorites</li> </ul>"},{"location":"user/recipients/index.html#showing-appreciation","title":"Showing Appreciation","text":"<ul> <li>Send a thank you message</li> <li>Tell them your favorite track</li> <li>Share which moments hit hardest</li> <li>Create one back!</li> </ul>"},{"location":"user/recipients/index.html#-audio-quality-guide","title":"\ud83d\udd0a Audio Quality Guide","text":"<p>The player defaults to Medium (192k) for balanced quality and data usage.</p> <p>When to adjust:</p> <p>Use Original/High if:</p> <ul> <li>On WiFi</li> <li>Have unlimited data</li> <li>Want best quality</li> <li>Using good headphones/speakers</li> </ul> <p>Use Medium if:</p> <ul> <li>Normal mobile data</li> <li>Balanced needs (default)</li> <li>Standard headphones</li> </ul> <p>Use Low if:</p> <ul> <li>Limited data plan</li> <li>Slow connection</li> <li>Playback keeps buffering</li> <li>On cellular in remote areas</li> </ul> <p>Detailed quality guide \u2192</p>"},{"location":"user/recipients/index.html#-if-you-received-a-gift-link","title":"\ud83c\udf81 If You Received a Gift Link","text":"<p>Gift links have a special landing page before the player:</p> <p>Playful Theme:</p> <ul> <li>Bright, energetic design</li> <li>Fun for celebrations</li> <li>\"Unwrap Your Gift\" button</li> </ul> <p>Elegant Theme:</p> <ul> <li>Refined, sophisticated design</li> <li>Perfect for heartfelt occasions</li> <li>\"Open Mixtape\" button</li> </ul> <p>Both include:</p> <ul> <li>Cover art showcase</li> <li>Liner notes/personal message</li> <li>Smooth reveal to player</li> <li>Memorable first impression</li> </ul> <p>The creator chose the theme to match the mood of the mixtape!</p>"},{"location":"user/recipients/index.html#-need-more-help","title":"\ud83d\udcd6 Need More Help?","text":""},{"location":"user/recipients/index.html#detailed-guides","title":"Detailed Guides","text":"<ul> <li>Getting Started - Opening and accessing mixtapes</li> <li>Player Guide - All features and controls</li> <li>Streaming Guide - Chromecast, AirPlay, Android Auto</li> <li>FAQ - Common questions and troubleshooting</li> </ul>"},{"location":"user/recipients/index.html#still-stuck","title":"Still Stuck?","text":"<ul> <li>Ask the person who shared the mixtape</li> <li>Check if your browser is up to date</li> <li>Try a different browser</li> <li>Ensure you have internet connection</li> </ul>"},{"location":"user/recipients/index.html#-want-to-create-your-own","title":"\ud83d\udcad Want to Create Your Own?","text":"<p>You can't create mixtapes as a recipient\u2014you'd need your own Mixtape Society server.</p> <p>Options:</p> <ul> <li>Ask your friend if they can give you access to their server</li> <li>Set up your own server (requires a music library and Docker)</li> <li>Check if there's a shared server you can join</li> </ul> <p>Creator setup guide \u2192</p> <p>Enjoy your mixtape! \ud83c\udfb5</p>"},{"location":"user/recipients/faq.html","title":"Recipient FAQ","text":""},{"location":"user/recipients/faq.html#recipient-faq","title":"Recipient FAQ","text":"<p>Frequently asked questions for people receiving and listening to mixtapes.</p>"},{"location":"user/recipients/faq.html#-getting-started","title":"\ud83c\udfa7 Getting Started","text":""},{"location":"user/recipients/faq.html#do-i-need-to-create-an-account","title":"Do I need to create an account?","text":"<p>No! Mixtape Society requires no account, signup, or personal information.</p> <p>Just:</p> <ol> <li>Click the link</li> <li>Press play</li> <li>Enjoy!</li> </ol>"},{"location":"user/recipients/faq.html#do-i-need-to-download-an-app","title":"Do I need to download an app?","text":"<p>No app needed. Mixtapes play directly in your web browser.</p> <p>Works in:</p> <ul> <li>Safari (iPhone, iPad, Mac)</li> <li>Chrome (Android, Windows, Mac)</li> <li>Firefox</li> <li>Edge</li> <li>Any modern browser</li> </ul>"},{"location":"user/recipients/faq.html#does-it-work-on-my-phone","title":"Does it work on my phone?","text":"<p>Yes! Works on all modern smartphones:</p> <ul> <li>\u2705 iPhone &amp; iPad</li> <li>\u2705 Android phones &amp; tablets</li> <li>\u2705 Windows, Mac, Linux computers</li> <li>\u2705 Chromebooks</li> </ul> <p>Getting started guide \u2192</p>"},{"location":"user/recipients/faq.html#is-it-free","title":"Is it free?","text":"<p>Yes, completely free for recipients.</p> <p>No costs for:</p> <ul> <li>Listening to mixtapes</li> <li>Accessing shared links</li> <li>Using the player</li> <li>Casting to devices</li> </ul> <p>Note: The creator may have server costs, but that doesn't affect you.</p>"},{"location":"user/recipients/faq.html#-links--access","title":"\ud83d\udd17 Links &amp; Access","text":""},{"location":"user/recipients/faq.html#why-wont-the-link-open","title":"Why won't the link open?","text":"<p>Common issues:</p> <p>Link was truncated:</p> <ul> <li>Copy and paste the full URL</li> <li>Check for line breaks in messages</li> <li>Ask sender to resend</li> </ul> <p>Browser issues:</p> <ul> <li>Try different browser</li> <li>Update your browser</li> <li>Clear browser cache</li> <li>Disable extensions temporarily</li> </ul> <p>Server issues:</p> <ul> <li>Creator's server might be down</li> <li>Check with the person who sent it</li> </ul> <p>Link was deleted:</p> <ul> <li>Creator may have removed the mixtape</li> <li>Ask them to share again</li> </ul>"},{"location":"user/recipients/faq.html#can-i-save-the-mixtape","title":"Can I save the mixtape?","text":"<p>You can:</p> <ul> <li>\u2705 Bookmark the link</li> <li>\u2705 Add to home screen (mobile)</li> <li>\u2705 Save the URL anywhere</li> <li>\u2705 Listen as many times as you want</li> </ul> <p>You cannot:</p> <ul> <li>\u274c Download the audio files</li> <li>\u274c Play offline (needs internet)</li> <li>\u274c Export to Spotify/Apple Music</li> </ul> <p>Why? Protects the creator's music library and respects copyright.</p>"},{"location":"user/recipients/faq.html#how-long-does-the-link-last","title":"How long does the link last?","text":"<p>Links are permanent unless:</p> <ul> <li>Creator deletes the mixtape</li> <li>Creator's server goes offline</li> </ul> <p>Otherwise:</p> <ul> <li>Link never expires</li> <li>Works indefinitely</li> <li>Can revisit anytime</li> </ul>"},{"location":"user/recipients/faq.html#can-i-share-the-link-with-others","title":"Can I share the link with others?","text":"<p>Technically yes, but consider:</p> <p>Check with the creator first:</p> <ul> <li>It might be a personal gift</li> <li>They may prefer to share directly</li> <li>Respect their privacy intentions</li> </ul> <p>If you do share:</p> <ul> <li>Link works for anyone</li> <li>Creator won't know who's listening</li> <li>Use private channels</li> </ul> <p>Better option:</p> <ul> <li>Thank the creator</li> <li>Ask them to share with your friend too</li> <li>Respect the personal nature of mixtapes</li> </ul>"},{"location":"user/recipients/faq.html#-playback--features","title":"\ud83c\udfb5 Playback &amp; Features","text":""},{"location":"user/recipients/faq.html#why-isnt-there-a-download-button","title":"Why isn't there a download button?","text":"<p>By design. Mixtapes are for streaming only.</p> <p>Reasons:</p> <ul> <li>Protects creator's music library</li> <li>Respects copyright</li> <li>Keeps files on secure server</li> <li>Prevents unauthorized distribution</li> </ul> <p>You can:</p> <ul> <li>Listen unlimited times</li> <li>Bookmark for easy access</li> <li>Cast to better speakers</li> <li>Control quality settings</li> </ul>"},{"location":"user/recipients/faq.html#can-i-listen-offline","title":"Can I listen offline?","text":"<p>Currently, no. You need an internet connection to stream.</p> <p>Future possibilities:</p> <ul> <li>Offline mode may be added later</li> <li>Would require creator permission</li> <li>Not available yet</li> </ul> <p>For now:</p> <ul> <li>Use WiFi when possible</li> <li>Choose lower quality to save data</li> <li>Download music legally from other sources</li> </ul>"},{"location":"user/recipients/faq.html#how-much-data-does-streaming-use","title":"How much data does streaming use?","text":"<p>Per song (approximate):</p> Quality Per Song Per Hour Original ~10MB ~150MB High (256k) ~7MB ~105MB Medium (192k) ~5MB ~75MB Low (128k) ~3MB ~45MB <p>Default: Medium quality (good balance)</p> <p>Tips:</p> <ul> <li>Use WiFi when available</li> <li>Switch to Low on cellular</li> <li>Monitor your data usage</li> <li>Consider unlimited data plan</li> </ul>"},{"location":"user/recipients/faq.html#why-does-playback-keep-stopping","title":"Why does playback keep stopping?","text":"<p>Common causes:</p> <p>Slow connection:</p> <ul> <li>Switch to lower quality</li> <li>Move closer to WiFi router</li> <li>Close other apps using internet</li> <li>Pause and let it buffer</li> </ul> <p>Browser issues:</p> <ul> <li>Refresh the page</li> <li>Clear browser cache</li> <li>Update browser</li> <li>Try different browser</li> </ul> <p>Device issues:</p> <ul> <li>Close other apps</li> <li>Free up RAM</li> <li>Restart your device</li> <li>Check available storage</li> </ul> <p>Server issues:</p> <ul> <li>Creator's server might be slow</li> <li>Many people listening at once</li> <li>Contact creator about issues</li> </ul>"},{"location":"user/recipients/faq.html#can-i-adjust-the-volume","title":"Can I adjust the volume?","text":"<p>Yes! Multiple volume controls:</p> <p>In the player:</p> <ul> <li>Use the volume slider</li> <li>Click speaker icon to mute/unmute</li> </ul> <p>On your device:</p> <ul> <li>Use device volume buttons</li> <li>System volume controls</li> </ul> <p>When casting:</p> <ul> <li>Control volume on the cast device</li> <li>Or use the app's cast volume</li> </ul> <p>Note: Player volume and device volume work together\u2014both affect final output.</p>"},{"location":"user/recipients/faq.html#-mobile--devices","title":"\ud83d\udcf1 Mobile &amp; Devices","text":""},{"location":"user/recipients/faq.html#which-browser-works-best-on-iphone","title":"Which browser works best on iPhone?","text":"<p>Safari is recommended for iPhone/iPad:</p> <p>Why Safari?</p> <ul> <li>\u2705 AirPlay support built-in</li> <li>\u2705 Best iOS integration</li> <li>\u2705 Lock screen controls</li> <li>\u2705 Control Center access</li> <li>\u2705 Apple Watch controls</li> </ul> <p>Chrome on iOS:</p> <ul> <li>Works for basic playback</li> <li>No AirPlay support</li> <li>Limited casting options</li> </ul> <p>iPhone tips \u2192</p>"},{"location":"user/recipients/faq.html#which-browser-works-best-on-android","title":"Which browser works best on Android?","text":"<p>Chrome is recommended for Android:</p> <p>Why Chrome?</p> <ul> <li>\u2705 Chromecast support</li> <li>\u2705 Android Auto integration</li> <li>\u2705 Full media controls</li> <li>\u2705 Notification playback controls</li> <li>\u2705 Best compatibility</li> </ul> <p>Other browsers:</p> <ul> <li>Firefox works fine</li> <li>Edge works fine</li> <li>Limited casting in some browsers</li> </ul> <p>Android tips \u2192</p>"},{"location":"user/recipients/faq.html#how-do-i-add-it-to-my-home-screen","title":"How do I add it to my home screen?","text":"<p>iPhone/iPad (Safari):</p> <ol> <li>Tap Share button</li> <li>Scroll and tap \"Add to Home Screen\"</li> <li>Name it and tap Add</li> </ol> <p>Android (Chrome):</p> <ol> <li>Tap \u22ee menu (three dots)</li> <li>Tap \"Add to Home screen\"</li> <li>Name it and tap Add</li> </ol> <p>Benefits:</p> <ul> <li>Quick access like an app</li> <li>No need to find link</li> <li>Full-screen experience</li> </ul> <p>Detailed instructions \u2192</p>"},{"location":"user/recipients/faq.html#can-i-use-it-in-my-car","title":"Can I use it in my car?","text":"<p>Yes! Multiple options:</p> <p>Android Auto:</p> <ul> <li>Connect phone to car</li> <li>Mixtape appears automatically</li> <li>Dashboard controls work</li> <li>Android Auto guide \u2192</li> </ul> <p>Bluetooth:</p> <ul> <li>Pair phone to car</li> <li>Play from phone</li> <li>Use phone controls</li> </ul> <p>AirPlay (some cars):</p> <ul> <li>CarPlay integration</li> <li>iPhone controls</li> <li>Dashboard display</li> </ul>"},{"location":"user/recipients/faq.html#does-it-work-with-my-smart-speaker","title":"Does it work with my smart speaker?","text":"<p>Yes! If you have:</p> <p>Chromecast-enabled speakers:</p> <ul> <li>Use cast button in player</li> <li>Select your speaker</li> <li>Chromecast guide \u2192</li> </ul> <p>AirPlay speakers:</p> <ul> <li>Use AirPlay from iPhone/iPad</li> <li>Select speaker in Control Center</li> <li>AirPlay guide \u2192</li> </ul> <p>Bluetooth speakers:</p> <ul> <li>Pair normally with phone</li> <li>Play from device</li> <li>Any speaker works</li> </ul>"},{"location":"user/recipients/faq.html#-casting--streaming","title":"\ud83d\udcfa Casting &amp; Streaming","text":""},{"location":"user/recipients/faq.html#how-do-i-cast-to-my-tv","title":"How do I cast to my TV?","text":"<p>Chromecast (Android/Chrome):</p> <ol> <li>Open mixtape in Chrome</li> <li>Look for cast icon (\ud83d\udce1)</li> <li>Tap and select your TV</li> <li>Full guide \u2192</li> </ol> <p>AirPlay (iPhone/iPad):</p> <ol> <li>Open mixtape in Safari</li> <li>Start playing</li> <li>Tap AirPlay icon</li> <li>Select Apple TV</li> <li>Full guide \u2192</li> </ol>"},{"location":"user/recipients/faq.html#can-i-use-airplay","title":"Can I use AirPlay?","text":"<p>Yes! For iPhone, iPad, and Mac users:</p> <p>Requirements:</p> <ul> <li>Must use Safari browser (not Chrome)</li> <li>Apple TV, HomePod, or AirPlay 2 speakers</li> <li>Same WiFi network</li> </ul> <p>How to use:</p> <ul> <li>Tap AirPlay icon in player</li> <li>Or use Control Center</li> <li>Select your device</li> <li>AirPlay guide \u2192</li> </ul>"},{"location":"user/recipients/faq.html#can-i-use-chromecast","title":"Can I use Chromecast?","text":"<p>Yes! For Android, Chrome, and Windows:</p> <p>Requirements:</p> <ul> <li>Chromecast device</li> <li>Chrome, Edge, or Opera browser</li> <li>Same WiFi network</li> </ul> <p>How to use:</p> <ul> <li>Look for cast icon (\ud83d\udce1)</li> <li>Tap to select device</li> <li>Start streaming</li> <li>Chromecast guide \u2192</li> </ul>"},{"location":"user/recipients/faq.html#why-isnt-airplay-working","title":"Why isn't AirPlay working?","text":"<p>Common issues:</p> <p>Wrong browser:</p> <ul> <li>Must use Safari on iOS/Mac</li> <li>Chrome doesn't support AirPlay</li> <li>Switch to Safari</li> </ul> <p>Not on same network:</p> <ul> <li>Phone and Apple TV need same WiFi</li> <li>Check WiFi settings</li> <li>Restart router if needed</li> </ul> <p>AirPlay disabled:</p> <ul> <li>Check Apple TV settings</li> <li>Enable AirPlay</li> <li>Update Apple TV software</li> </ul> <p>Device issues:</p> <ul> <li>Restart iPhone/iPad</li> <li>Restart Apple TV</li> <li>Update iOS/tvOS</li> </ul>"},{"location":"user/recipients/faq.html#can-multiple-people-control-playback","title":"Can multiple people control playback?","text":"<p>Depends on casting method:</p> <p>Chromecast:</p> <ul> <li>\u2705 Anyone on same WiFi can control</li> <li>\u2705 See what's playing</li> <li>\u2705 Change tracks or volume</li> </ul> <p>AirPlay:</p> <ul> <li>\u274c Only device that started AirPlay</li> <li>Control from that device only</li> <li>Others need to stop and start their own</li> </ul> <p>Direct playback:</p> <ul> <li>Only person with the browser open</li> <li>Not shared control</li> </ul>"},{"location":"user/recipients/faq.html#-player-features","title":"\ud83c\udfa8 Player Features","text":""},{"location":"user/recipients/faq.html#what-do-all-the-buttons-do","title":"What do all the buttons do?","text":"<p>Basic controls:</p> <ul> <li>\u25b6\ufe0f Play/Pause - Start/stop playback</li> <li>\u23ed\ufe0f Next - Skip to next track</li> <li>\u23ee\ufe0f Previous - Go to previous track</li> <li>\ud83d\udd0a Volume - Adjust loudness</li> </ul> <p>Advanced features:</p> <ul> <li>\ud83d\udd00 Shuffle - Random track order</li> <li>\ud83d\udd01 Repeat - Loop all or single track</li> <li>\ud83d\udcca Quality - Change audio quality</li> <li>\ud83d\udce1 Cast - Stream to other devices</li> </ul> <p>Full player guide \u2192</p>"},{"location":"user/recipients/faq.html#how-do-i-change-the-quality","title":"How do I change the quality?","text":"<p>To adjust quality:</p> <ol> <li>Look for \u2699\ufe0f Settings or Quality button</li> <li>Tap to open menu</li> <li>Select your preferred quality</li> <li>Current track restarts at new quality</li> </ol> <p>When to use each:</p> <ul> <li>Original/High - On WiFi, best sound</li> <li>Medium - Default, balanced</li> <li>Low - Mobile data, slow connections</li> </ul> <p>Quality guide \u2192</p>"},{"location":"user/recipients/faq.html#can-i-see-the-lyrics","title":"Can I see the lyrics?","text":"<p>Currently, no. Lyrics are not supported.</p> <p>You can:</p> <ul> <li>Search for lyrics separately</li> <li>Use genius.com or other sites</li> <li>Check liner notes for context</li> </ul> <p>Future feature: Lyrics display may be added later.</p>"},{"location":"user/recipients/faq.html#what-are-liner-notes","title":"What are liner notes?","text":"<p>Personal messages from the creator explaining:</p> <ul> <li>Why they made the mixtape</li> <li>What songs mean to them</li> <li>Context for track choices</li> <li>Dedications or messages</li> </ul> <p>Where to find them:</p> <ul> <li>Gift links show them on landing page</li> <li>Direct links may have expandable section</li> <li>Not all mixtapes have liner notes</li> </ul> <p>Track references:</p> <ul> <li> </li> <li> </li> <li> </li> </ul>"},{"location":"user/recipients/faq.html#1--first-track","title":"1 = First track","text":""},{"location":"user/recipients/faq.html#5--fifth-track","title":"5 = Fifth track","text":""},{"location":"user/recipients/faq.html#1-3--first-three-tracks","title":"1-3 = First three tracks","text":""},{"location":"user/recipients/faq.html#-privacy--safety","title":"\ud83d\udd12 Privacy &amp; Safety","text":""},{"location":"user/recipients/faq.html#is-my-listening-tracked","title":"Is my listening tracked?","text":"<p>No tracking. Mixtape Society doesn't monitor:</p> <ul> <li>Who listens</li> <li>When you listen</li> <li>How many times</li> <li>Which tracks you play</li> </ul> <p>Complete privacy for recipients.</p>"},{"location":"user/recipients/faq.html#do-i-need-to-worry-about-viruses","title":"Do I need to worry about viruses?","text":"<p>No. Mixtapes are audio streams, not downloads.</p> <p>Safe because:</p> <ul> <li>No files downloaded to your device</li> <li>Streaming only</li> <li>No executable code</li> <li>No browser extensions required</li> </ul> <p>Standard web safety:</p> <ul> <li>Use updated browser</li> <li>Don't click suspicious links</li> <li>Verify sender before opening</li> </ul>"},{"location":"user/recipients/faq.html#can-the-creator-see-my-information","title":"Can the creator see my information?","text":"<p>No. The creator cannot see:</p> <ul> <li>Your IP address</li> <li>Your location</li> <li>Your device information</li> <li>When you listened</li> <li>Who else you shared with</li> </ul> <p>Total privacy - it's anonymous listening.</p>"},{"location":"user/recipients/faq.html#-troubleshooting","title":"\u26a0\ufe0f Troubleshooting","text":""},{"location":"user/recipients/faq.html#the-player-looks-broken-or-glitchy","title":"The player looks broken or glitchy","text":"<p>Solutions:</p> <p>Update browser:</p> <pre><code>Check browser settings \u2192 About\nUpdate to latest version\n</code></pre> <p>Clear cache:</p> <ol> <li>Browser settings</li> <li>Clear browsing data</li> <li>Reload mixtape</li> </ol> <p>Try different browser:</p> <ul> <li>Download Chrome or Firefox</li> <li>Test in that browser</li> </ul> <p>Disable extensions:</p> <ul> <li>Ad blockers might interfere</li> <li>Try incognito/private mode</li> </ul>"},{"location":"user/recipients/faq.html#i-hear-crackling-or-distortion","title":"I hear crackling or distortion","text":"<p>Audio quality:</p> <ul> <li>Try different quality setting</li> <li>Higher might fix digital issues</li> <li>Lower might fix buffering</li> </ul> <p>Connection:</p> <ul> <li>Slow internet causes artifacts</li> <li>Switch to lower quality</li> <li>Use WiFi instead of cellular</li> </ul> <p>Device:</p> <ul> <li>Check headphone connection</li> <li>Try different headphones</li> <li>Restart your device</li> </ul> <p>File issue:</p> <ul> <li>Might be the source file</li> <li>Contact creator</li> <li>Try other tracks</li> </ul>"},{"location":"user/recipients/faq.html#controls-arent-responding","title":"Controls aren't responding","text":"<p>Try:</p> <ol> <li>Refresh the page</li> <li>Close and reopen tab</li> <li>Restart browser</li> <li>Restart device</li> <li>Try different browser</li> </ol> <p>Check:</p> <ul> <li>JavaScript is enabled</li> <li>No browser errors (F12 console)</li> <li>Browser is updated</li> </ul>"},{"location":"user/recipients/faq.html#battery-drains-quickly","title":"Battery drains quickly","text":"<p>Why this happens:</p> <ul> <li>Streaming uses network constantly</li> <li>Screen might stay on</li> <li>Processing audio</li> </ul> <p>To improve:</p> <ul> <li>Lower quality setting</li> <li>Close other apps</li> <li>Reduce screen brightness</li> <li>Use battery saver mode</li> <li>Plug in while listening</li> </ul>"},{"location":"user/recipients/faq.html#-tips--tricks","title":"\ud83d\udca1 Tips &amp; Tricks","text":""},{"location":"user/recipients/faq.html#how-can-i-get-the-best-audio-quality","title":"How can I get the best audio quality?","text":"<ol> <li>Use good headphones</li> <li>Wired often better than Bluetooth</li> <li>Proper fit matters</li> <li>Over-ear vs in-ear preference</li> <li>Choose right quality<ul> <li>Original/High on WiFi</li> <li>Good headphones reveal difference</li> <li>Lower quality for casual listening</li> </ul> </li> <li>Stable connection<ul> <li>WiFi over cellular</li> <li>Close to router</li> <li>Avoid congestion</li> </ul> </li> <li>Cast to quality speakers<ul> <li>Chromecast to home system</li> <li>AirPlay to HomePod</li> <li>Better than phone speakers</li> </ul> </li> </ol>"},{"location":"user/recipients/faq.html#can-i-make-my-own-mixtapes","title":"Can I make my own mixtapes?","text":"<p>As a recipient, no. You'd need:</p> <ul> <li>Your own music library</li> <li>A server to run Mixtape Society</li> <li>Technical setup knowledge</li> </ul> <p>Your options:</p> <ol> <li>Ask the creator for access to their server</li> <li>Set up your own server</li> <li>Use other services for playlists</li> </ol> <p>Learn about becoming a creator \u2192</p>"},{"location":"user/recipients/faq.html#how-do-i-thank-the-creator","title":"How do I thank the creator?","text":"<p>Great ways to respond:</p> <p>Be specific:</p> <ul> <li>\"Track 5 made me cry!\"</li> <li>\"The flow from 3 to 4 is perfect\"</li> <li>\"This is my new workout mix\"</li> </ul> <p>Share impact:</p> <ul> <li>When/where you listened</li> <li>How it made you feel</li> <li>Which songs hit hardest</li> </ul> <p>Return the favor:</p> <ul> <li>Create one back (if you can)</li> <li>Share music they'd like</li> <li>Make a playlist on another platform</li> </ul> <p>Simple appreciation:</p> <ul> <li>\"Thank you, this is perfect\"</li> <li>\"You really get my taste\"</li> <li>\"Best gift ever\"</li> </ul>"},{"location":"user/recipients/faq.html#-learn-more","title":"\ud83d\udcda Learn More","text":"<p>Guides:</p> <ul> <li>Getting Started - Opening and accessing mixtapes</li> <li>Player Guide - All features and controls</li> <li>Streaming Guide - Casting to TVs and speakers</li> </ul> <p>Still stuck?</p> <ul> <li>Check with the person who sent you the link</li> <li>Try a different device or browser</li> <li>Look for updates to your browser</li> </ul> <p>Enjoy the music! \ud83c\udfb5</p>"},{"location":"user/recipients/getting-started.html","title":"Getting Started","text":""},{"location":"user/recipients/getting-started.html#getting-started-for-recipients","title":"Getting Started for Recipients","text":"<p>Someone shared a mixtape with you! This quick guide will help you open it and start listening in seconds.</p>"},{"location":"user/recipients/getting-started.html#-the-basics","title":"\ud83c\udfa7 The Basics","text":""},{"location":"user/recipients/getting-started.html#no-account-needed","title":"No Account Needed","text":"<p>You don't need to:</p> <ul> <li>\u274c Create an account</li> <li>\u274c Download an app</li> <li>\u274c Sign up for anything</li> <li>\u274c Enter personal information</li> </ul> <p>You just need to:</p> <ul> <li>\u2705 Click the link</li> <li>\u2705 Press play</li> <li>\u2705 Enjoy!</li> </ul>"},{"location":"user/recipients/getting-started.html#-opening-your-mixtape","title":"\ud83d\udcf1 Opening Your Mixtape","text":""},{"location":"user/recipients/getting-started.html#method-1-direct-link","title":"Method 1: Direct Link","text":"<p>The most common way to receive a mixtape is through a simple link.</p> <p>You might receive it via:</p> <ul> <li>Text message (SMS/iMessage/WhatsApp)</li> <li>Email</li> <li>Social media (Instagram, Facebook, Twitter)</li> <li>Messaging apps (Discord, Slack, Telegram)</li> </ul> <p>To open:</p> <ol> <li>Tap or click the link</li> <li>Your browser opens automatically</li> <li>The mixtape player loads</li> <li>Hit \u25b6\ufe0f Play</li> </ol> <p>Example link:</p> <pre><code>https://mixtape.example.com/share/summer-vibes_20251217_abcd1234\n</code></pre> <p>Works Everywhere</p> <p>The link opens in any web browser on any device\u2014phone, tablet, or computer. No special app needed!</p>"},{"location":"user/recipients/getting-started.html#method-2-gift-landing-page","title":"Method 2: Gift Landing Page","text":"<p>Some mixtapes come with a special themed landing page designed to feel like unwrapping a gift.</p> <p>What you'll see:</p> <p>Two possible themes:</p> <p>Playful Theme:</p> <ul> <li>Bright, energetic design</li> <li>\"Unwrap Your Gift\" button</li> <li>Perfect for celebrations and fun occasions</li> </ul> <p>Elegant Theme:</p> <ul> <li>Sophisticated, refined design</li> <li>\"Open Mixtape\" button</li> <li>Perfect for heartfelt or romantic occasions</li> </ul> <p>How it works:</p> <ol> <li>Click the link</li> <li>See the beautiful landing page with cover art</li> <li>Read the personal message (liner notes)</li> <li>Click \"Unwrap Your Gift\" or \"Open Mixtape\"</li> <li>The player appears and you can start listening</li> </ol> <p>Special Moment</p> <p>The creator chose this gift experience to make receiving the mixtape feel special. Take a moment to appreciate the presentation!</p>"},{"location":"user/recipients/getting-started.html#method-3-qr-code","title":"Method 3: QR Code","text":"<p>You might receive a QR code on a card, gift, or event material.</p> <p>How to scan:</p> <p>iPhone/iPad:</p> <ol> <li>Open the Camera app</li> <li>Point at the QR code</li> <li>A notification appears at the top</li> <li>Tap the notification</li> <li>Mixtape opens in Safari</li> </ol> <p>Android:</p> <ol> <li>Open the Camera app (or Google Lens)</li> <li>Point at the QR code</li> <li>A link appears or notification pops up</li> <li>Tap to open</li> <li>Mixtape opens in Chrome</li> </ol> <p>No camera app working?</p> <ul> <li>Try Google Lens app</li> <li>Many messaging apps can scan QR codes</li> <li>Ask the sender for the direct link instead</li> </ul> <p>Test Your Scanner</p> <p>If you've never scanned a QR code before, try scanning one now to test your camera app. Most modern phones can scan QR codes without any additional app.</p>"},{"location":"user/recipients/getting-started.html#-browser-compatibility","title":"\ud83c\udf10 Browser Compatibility","text":""},{"location":"user/recipients/getting-started.html#works-best-in","title":"Works Best In","text":"<p>iPhone/iPad:</p> <ul> <li>\u2705 Safari (recommended for AirPlay)</li> <li>\u2705 Chrome</li> <li>\u2705 Firefox</li> <li>\u2705 Edge</li> </ul> <p>Android:</p> <ul> <li>\u2705 Chrome (recommended for Chromecast)</li> <li>\u2705 Firefox</li> <li>\u2705 Edge</li> <li>\u2705 Samsung Internet</li> </ul> <p>Desktop (Windows/Mac/Linux):</p> <ul> <li>\u2705 Chrome</li> <li>\u2705 Firefox</li> <li>\u2705 Safari (Mac)</li> <li>\u2705 Edge</li> <li>\u2705 Opera</li> </ul>"},{"location":"user/recipients/getting-started.html#browser-requirements","title":"Browser Requirements","text":"<p>Minimum versions:</p> <ul> <li>Chrome 90+</li> <li>Firefox 88+</li> <li>Safari 14+</li> <li>Edge 90+</li> </ul> <p>Update Your Browser</p> <p>If the mixtape won't load, your browser might be outdated. Update to the latest version for the best experience.</p>"},{"location":"user/recipients/getting-started.html#-what-youll-see","title":"\ud83d\udcca What You'll See","text":""},{"location":"user/recipients/getting-started.html#the-player-interface","title":"The Player Interface","text":"<p>When the mixtape loads, you'll see:</p> <p>Main Elements:</p> <ul> <li>\ud83c\udfa8 Album art - Cover image chosen by creator</li> <li>\u25b6\ufe0f Play button - Start/pause playback</li> <li>\ud83d\udcdc Track listing - All songs in the mixtape</li> <li>\u23f1\ufe0f Progress bar - See how far through the track</li> <li>\ud83d\udd0a Volume control - Adjust playback volume</li> <li>\u23ed\ufe0f Skip buttons - Next/previous track</li> </ul> <p>Additional Features:</p> <ul> <li>\ud83d\udd00 Shuffle mode</li> <li>\ud83d\udd01 Repeat options</li> <li>\ud83d\udcca Quality settings</li> <li>\ud83d\udce1 Cast button (if available)</li> </ul>"},{"location":"user/recipients/getting-started.html#track-information","title":"Track Information","text":"<p>For each track you'll see:</p> <ul> <li>Track number</li> <li>Song title</li> <li>Artist name</li> <li>Album name (if available)</li> <li>Duration</li> </ul> <p>Currently playing:</p> <ul> <li>Highlighted in track list</li> <li>Shows progress</li> <li>Displays on lock screen (mobile)</li> </ul>"},{"location":"user/recipients/getting-started.html#-your-first-listen","title":"\ud83c\udfb5 Your First Listen","text":""},{"location":"user/recipients/getting-started.html#recommended-steps","title":"Recommended Steps","text":"<ol> <li>Get comfortable</li> <li>Find a quiet moment</li> <li>Put on headphones or connect to speakers</li> <li> <p>Settle in for the experience</p> </li> <li> <p>Read the liner notes (if present)</p> </li> <li>The creator may have left a personal message</li> <li>Explains why they made this mixtape</li> <li> <p>Adds context to song choices</p> </li> <li> <p>Listen in order (first time)</p> </li> <li>The creator carefully arranged the flow</li> <li>Songs transition with intention</li> <li> <p>Experience it as designed</p> </li> <li> <p>Enjoy!</p> </li> <li>Relax and appreciate the music</li> <li>Notice how songs connect</li> <li>Let it play through</li> </ol> <p>Save for Later</p> <p>Love the mixtape? Bookmark the link or add it to your home screen so you can come back anytime!</p>"},{"location":"user/recipients/getting-started.html#-add-to-home-screen","title":"\ud83d\udcf1 Add to Home Screen","text":"<p>Save the mixtape for quick access like an app.</p>"},{"location":"user/recipients/getting-started.html#iphoneipad","title":"iPhone/iPad","text":"<ol> <li>Open the mixtape in Safari</li> <li>Tap the Share button (square with arrow)</li> <li>Scroll and tap \"Add to Home Screen\"</li> <li>Name it (e.g., \"Sarah's Mixtape\")</li> <li>Tap Add</li> <li>Icon appears on your home screen</li> </ol>"},{"location":"user/recipients/getting-started.html#android","title":"Android","text":"<ol> <li>Open the mixtape in Chrome</li> <li>Tap the \u22ee menu (three dots)</li> <li>Tap \"Add to Home screen\"</li> <li>Name it and tap Add</li> <li>Icon appears in your app drawer</li> </ol> <p>Benefits:</p> <ul> <li>\u2705 Quick access from home screen</li> <li>\u2705 Looks like a real app</li> <li>\u2705 No need to find the link again</li> <li>\u2705 Full-screen experience</li> </ul>"},{"location":"user/recipients/getting-started.html#-quick-tips","title":"\ud83d\udca1 Quick Tips","text":""},{"location":"user/recipients/getting-started.html#for-best-quality","title":"For Best Quality","text":"<p>On WiFi:</p> <ul> <li>Use Original or High quality</li> <li>Better sound with good headphones</li> <li>Streams without buffering</li> </ul> <p>On Mobile Data:</p> <ul> <li>Use Medium quality (default)</li> <li>Switch to Low if connection is slow</li> <li>Watch your data usage</li> </ul>"},{"location":"user/recipients/getting-started.html#for-best-experience","title":"For Best Experience","text":"<p>Headphones:</p> <ul> <li>\u2705 Use good quality headphones</li> <li>\u2705 Ensure proper fit</li> <li>\u2705 Try different EQ settings on your device</li> </ul> <p>Speakers:</p> <ul> <li>\u2705 Cast to Chromecast or AirPlay</li> <li>\u2705 Connect via Bluetooth</li> <li>\u2705 Use quality speakers when possible</li> </ul> <p>Environment:</p> <ul> <li>\u2705 Find a quiet space for first listen</li> <li>\u2705 Minimize distractions</li> <li>\u2705 Give it your full attention</li> </ul>"},{"location":"user/recipients/getting-started.html#-playing-on-other-devices","title":"\ud83d\udd0a Playing on Other Devices","text":"<p>Want to play on your TV or better speakers?</p>"},{"location":"user/recipients/getting-started.html#quick-options","title":"Quick Options","text":"<p>Chromecast (Android/Chrome)</p> <ul> <li>Look for the cast icon (\ud83d\udce1)</li> <li>Tap to select your device</li> <li>Full Chromecast guide \u2192</li> </ul> <p>AirPlay (iPhone/iPad/Mac)</p> <ul> <li>Tap the AirPlay icon</li> <li>Select your Apple TV or HomePod</li> <li>Full AirPlay guide \u2192</li> </ul> <p>Android Auto (in car)</p> <ul> <li>Connect phone to car</li> <li>Mixtape appears automatically</li> <li>Full Android Auto guide \u2192</li> </ul>"},{"location":"user/recipients/getting-started.html#-connection-requirements","title":"\ud83d\udcf6 Connection Requirements","text":""},{"location":"user/recipients/getting-started.html#internet-connection","title":"Internet Connection","text":"<p>You need:</p> <ul> <li>Active internet connection (WiFi or mobile data)</li> <li>Stable connection for smooth playback</li> </ul> <p>Data usage:</p> <ul> <li>Original quality: ~10MB per song</li> <li>High quality: ~7MB per song</li> <li>Medium quality: ~5MB per song</li> <li>Low quality: ~3MB per song</li> </ul> <p>Offline Playback</p> <p>Currently, mixtapes cannot be played offline. You must have an internet connection to stream.</p>"},{"location":"user/recipients/getting-started.html#speed-recommendations","title":"Speed Recommendations","text":"<p>Minimum:</p> <ul> <li>1 Mbps for Low quality</li> <li>2 Mbps for Medium quality</li> </ul> <p>Recommended:</p> <ul> <li>5 Mbps for High quality</li> <li>10 Mbps for Original quality</li> </ul> <p>If playback stutters:</p> <ul> <li>Switch to lower quality</li> <li>Move closer to WiFi router</li> <li>Close other apps using internet</li> <li>Pause and let it buffer</li> </ul>"},{"location":"user/recipients/getting-started.html#-quick-troubleshooting","title":"\u2753 Quick Troubleshooting","text":""},{"location":"user/recipients/getting-started.html#link-wont-open","title":"Link Won't Open","text":"<p>Try:</p> <ol> <li>Copy and paste link into browser directly</li> <li>Try a different browser</li> <li>Check your internet connection</li> <li>Ask sender to re-send the link</li> <li>Ensure link wasn't truncated in message</li> </ol>"},{"location":"user/recipients/getting-started.html#player-wont-load","title":"Player Won't Load","text":"<p>Try:</p> <ol> <li>Refresh the page</li> <li>Clear browser cache</li> <li>Update your browser</li> <li>Try different browser</li> <li>Disable browser extensions temporarily</li> </ol>"},{"location":"user/recipients/getting-started.html#no-sound","title":"No Sound","text":"<p>Check:</p> <ol> <li>Device volume is up</li> <li>Not muted in browser</li> <li>Headphones are plugged in correctly</li> <li>Bluetooth is connected (if using wireless)</li> <li>Browser has permission to play audio</li> </ol>"},{"location":"user/recipients/getting-started.html#playback-keeps-stopping","title":"Playback Keeps Stopping","text":"<p>Solutions:</p> <ol> <li>Switch to lower quality setting</li> <li>Pause and let it buffer</li> <li>Check internet connection</li> <li>Close other apps/tabs</li> <li>Move closer to WiFi router</li> </ol>"},{"location":"user/recipients/getting-started.html#-showing-appreciation","title":"\ud83c\udf81 Showing Appreciation","text":"<p>Love the mixtape? Let the creator know!</p> <p>Great ways to respond:</p> <ul> <li>\ud83d\udcac Send a thank you message</li> <li>\ud83c\udfb5 Share your favorite track</li> <li>\u2764\ufe0f Tell them which moments hit hardest</li> <li>\ud83c\udfa8 Comment on their song choices</li> <li>\ud83c\udfb5 Create one back for them!</li> </ul> <p>Example messages:</p> <ul> <li>\"Track 5 made me cry. Thank you \u2764\ufe0f\"</li> <li>\"This is perfect for my morning runs!\"</li> <li>\"How did you know I needed this today?\"</li> <li>\"The flow from track 3 to 4 is chef's kiss\"</li> </ul>"},{"location":"user/recipients/getting-started.html#-learn-more","title":"\ud83d\udcda Learn More","text":"<p>Next Steps:</p> <ul> <li>Player Guide - Master all player features</li> <li>Streaming Guide - Cast to TVs and speakers</li> <li>FAQ - Common questions answered</li> </ul> <p>Need Help?</p> <ul> <li>Check the FAQ for common issues</li> <li>Ask the person who sent you the mixtape</li> <li>Ensure your browser is updated</li> </ul>"},{"location":"user/recipients/getting-started.html#-want-to-create-your-own","title":"\ud83d\udcad Want to Create Your Own?","text":"<p>Recipients can't create mixtapes\u2014you'd need access to a Mixtape Society server.</p> <p>Your options:</p> <ol> <li>Ask the creator if you can use their server</li> <li>Set up your own (requires music library and Docker)</li> <li>Find a friend who runs a server</li> </ol> <p>Learn about becoming a creator \u2192</p> <p>Enjoy your mixtape! \ud83c\udfb5</p>"},{"location":"user/recipients/player.html","title":"Player Guide","text":""},{"location":"user/recipients/player.html#player-guide-for-recipients","title":"Player Guide for Recipients","text":"<p>Master the mixtape player to get the best listening experience. Whether you're on your phone, computer, or casting to a TV, this guide covers everything you need to know.</p>"},{"location":"user/recipients/player.html#-basic-controls","title":"\ud83c\udfae Basic Controls","text":""},{"location":"user/recipients/player.html#play--pause","title":"Play &amp; Pause","text":"<p>Desktop:</p> <ul> <li>Click the \u25b6\ufe0f Play button</li> <li>Click again (now \u23f8\ufe0f Pause) to pause</li> <li>Press Space bar for quick play/pause</li> </ul> <p>Mobile:</p> <ul> <li>Tap the play button</li> <li>Tap again to pause</li> <li>Use lock screen controls</li> </ul>"},{"location":"user/recipients/player.html#skip-tracks","title":"Skip Tracks","text":"<p>Next Track:</p> <ul> <li>Desktop: Click \u23ed\ufe0f or press \u2192 Right Arrow</li> <li>Mobile: Tap \u23ed\ufe0f or use lock screen controls</li> </ul> <p>Previous Track:</p> <ul> <li>Desktop: Click \u23ee\ufe0f or press \u2190 Left Arrow</li> <li>Mobile: Tap \u23ee\ufe0f or use lock screen controls</li> </ul>"},{"location":"user/recipients/player.html#seek-within-a-track","title":"Seek Within a Track","text":"<p>Desktop:</p> <ul> <li>Click anywhere on the progress bar</li> <li>Drag the position handle</li> <li>Use arrow keys for fine control</li> </ul> <p>Mobile:</p> <ul> <li>Tap on the progress bar</li> <li>Drag the progress handle</li> </ul>"},{"location":"user/recipients/player.html#-advanced-features","title":"\ud83c\udfb5 Advanced Features","text":""},{"location":"user/recipients/player.html#shuffle-mode","title":"Shuffle Mode","text":"<p>Play tracks in random order instead of the mixtape's sequence.</p> <p>How to enable:</p> <ol> <li>Find the \ud83d\udd00 Shuffle button next to the prev/next controls</li> <li>Click/tap to toggle on (button lights up)</li> <li>Click/tap again to return to normal order</li> </ol> <p>What happens:</p> <ul> <li>Tracks play in a random sequence</li> <li>Next/Previous buttons follow the shuffled order</li> <li>Your shuffle order stays the same even if you reload the page</li> </ul> <p>Visual indicator:</p> <ul> <li>Off: Button is outlined (\u26aa \ud83d\udd00)</li> <li>On: Button is filled (\u26ab \ud83d\udd00)</li> </ul> <p>When it's useful:</p> <ul> <li>You've listened through already and want variety</li> <li>Long mixtapes (20+ tracks)</li> <li>Background music where order doesn't matter</li> <li>Discovering tracks you might have skipped</li> </ul> <p>Getting a new shuffle: Click shuffle off, then on again to get a different random order.</p> <p>Note</p> <p>The creator carefully ordered the tracks\u2014shuffle changes the intended experience! Best for repeat listens.</p>"},{"location":"user/recipients/player.html#repeat-mode","title":"Repeat Mode","text":"<p>Loop the entire mixtape or a single track.</p> <p>How to use:</p> <ol> <li>Find the \ud83d\udd01 Repeat button next to shuffle</li> <li>Click/tap to cycle through modes</li> <li>Watch the button change to show which mode is active</li> </ol> <p>The three modes:</p>"},{"location":"user/recipients/player.html#-repeat-off-default","title":"\ud83d\udd01 Repeat Off (default)","text":"<ul> <li>Button is outlined</li> <li>Mixtape plays through once and stops</li> <li>Normal listening experience</li> </ul>"},{"location":"user/recipients/player.html#-repeat-all","title":"\ud83d\udd01 Repeat All","text":"<ul> <li>Button is filled/solid white</li> <li>Mixtape loops back to the beginning after the last track</li> <li>Great for background music or extended listening</li> </ul>"},{"location":"user/recipients/player.html#\u2081-repeat-one","title":"\ud83d\udd01\u2081 Repeat One","text":"<ul> <li>Button turns blue with a \"1\" icon</li> <li>Current track plays over and over</li> <li>Perfect for learning lyrics or focusing on one song</li> </ul> <p>What happens:</p> <ul> <li>Your repeat setting saves automatically</li> <li>Works with shuffle (loops through the shuffled order)</li> <li>Click any track to play it, repeat mode stays active</li> </ul> <p>When it's useful:</p> <ul> <li>Repeat All: Long car rides, work sessions, parties</li> <li>Repeat One: Practicing a song, meditation, focus</li> </ul> <p>Getting back to normal: Click the repeat button until it's outlined again (Repeat Off).</p> <p>Repeat + Shuffle</p> <p>Enable both for endless variety! The playlist will keep looping through the same shuffle order.</p>"},{"location":"user/recipients/player.html#sleep-timer","title":"Sleep Timer","text":"<p>Automatically stop playback after a set duration\u2014perfect for falling asleep or timed listening sessions.</p> <p>How to use:</p> <ol> <li>Find the \u23f0 Sleep Timer button next to shuffle and repeat</li> <li>Click/tap to open the timer settings</li> <li>Choose a duration or use quick presets</li> <li>Optional: Enable \"Wait until current track ends\"</li> <li>Click Start Timer</li> </ol> <p>Setting the duration:</p> <ul> <li>Quick presets: 15, 30, 45, or 60 minutes</li> <li>Custom time: Use the slider for any duration (5-120 minutes)</li> <li>Visual display: Large timer shows your selected duration</li> </ul> <p>Wait until track ends: When enabled, playback stops gracefully after the current track finishes instead of cutting off mid-song.</p> <p>Visual indicator:</p> <ul> <li>Off: Button is outlined (\u26aa \u23f0)</li> <li>Active: Button turns yellow and pulses (\ud83d\udfe1 \u23f0)</li> </ul> <p>What happens:</p> <ul> <li>Timer counts down in the background</li> <li>You'll see notifications at 30min, 15min, 10min, 5min, and 1min remaining</li> <li>Each notification includes options to extend or cancel</li> <li>When time expires, playback stops automatically</li> <li>Your preferred duration is remembered for next time</li> </ul> <p>Managing active timer:</p> <ul> <li>Modify: Click the pulsing timer button to adjust time</li> <li>Cancel: Use the cancel button in settings or notifications</li> <li>Extend: Click \"Extend\" in countdown notifications</li> </ul> <p>When it's useful:</p> <ul> <li>Falling asleep to music</li> <li>Timed meditation or focus sessions</li> <li>Conserving battery on mobile</li> <li>Limiting listening time</li> <li>Background music for specific activities</li> </ul> <p>Perfect for Sleep</p> <p>Set 30-45 minutes with \"wait until track ends\" enabled. The music fades naturally as your last track finishes, instead of jarring silence mid-song.</p>"},{"location":"user/recipients/player.html#volume-control","title":"Volume Control","text":"<p>Adjust playback volume independent of your device volume.</p> <p>Desktop:</p> <ul> <li>Click \ud83d\udd0a Volume icon</li> <li>Drag slider up/down</li> <li>Or use your keyboard volume keys</li> </ul> <p>Mobile:</p> <ul> <li>Use device volume buttons</li> <li>Player respects system volume</li> </ul>"},{"location":"user/recipients/player.html#-audio-quality-settings","title":"\ud83d\udcca Audio Quality Settings","text":"<p>Adjust streaming quality to match your connection and data plan.</p>"},{"location":"user/recipients/player.html#quality-options","title":"Quality Options","text":"Quality Bitrate File Size/Song Best For Original Variable ~10MB WiFi, best audio High 256 kbps ~7MB WiFi, great audio Medium 192 kbps ~5MB Default, balanced Low 128 kbps ~3MB Mobile data, slow connections <p>Default: Medium (192 kbps)</p>"},{"location":"user/recipients/player.html#how-to-change-quality","title":"How to Change Quality","text":"<ol> <li>Look for the \u2699\ufe0f Settings or Quality button</li> <li>Select your preferred quality</li> <li>Current track will restart at new quality</li> <li>Setting persists for this mixtape session</li> </ol>"},{"location":"user/recipients/player.html#when-to-adjust","title":"When to Adjust","text":"<p>Use Higher Quality (Original/High) when:</p> <ul> <li>\u2705 Connected to WiFi</li> <li>\u2705 Using unlimited data plan</li> <li>\u2705 Want best possible sound</li> <li>\u2705 Using good headphones or speakers</li> <li>\u2705 Connection is fast and stable</li> </ul> <p>Use Lower Quality (Low) when:</p> <ul> <li>\u2705 On limited mobile data plan</li> <li>\u2705 Connection is slow or unstable</li> <li>\u2705 Playback keeps buffering</li> <li>\u2705 In area with weak signal</li> <li>\u2705 Want to conserve data</li> </ul> <p>Connection Issues?</p> <p>If playback stutters or stops frequently, try switching to a lower quality setting. The difference is often imperceptible with standard headphones.</p>"},{"location":"user/recipients/player.html#-keyboard-shortcuts-desktop","title":"\u2328\ufe0f Keyboard Shortcuts (Desktop)","text":"<p>Master these shortcuts for effortless control:</p> Key Action Space Play/Pause \u2192 Next track \u2190 Previous track \u2191 Volume up \u2193 Volume down M Mute/Unmute S Toggle shuffle R Cycle repeat modes T Open sleep timer 0-9 Jump to position (0%=start, 5=50%, 9=90%) <p>Power User</p> <p>Once you learn the shortcuts, you can control playback without touching your mouse!</p>"},{"location":"user/recipients/player.html#-mobile--desktop-experience","title":"\ud83d\udcf1 Mobile &amp; Desktop Experience","text":""},{"location":"user/recipients/player.html#iphone--ipad","title":"iPhone &amp; iPad","text":"<p>Best Browser: Safari (required for AirPlay)</p> <p>Features:</p> <ul> <li>\u2705 Lock screen controls</li> <li>\u2705 Control Center access</li> <li>\u2705 Background playback</li> <li>\u2705 AirPlay support</li> <li>\u2705 Apple Watch controls (if paired)</li> <li>\u2705 CarPlay support (iOS 14.5+)</li> <li>\u2705 Sleep timer with notifications</li> </ul> <p>Lock Screen Controls: When playing, you'll see:</p> <ul> <li>Album art</li> <li>Track title and artist</li> <li>Play/Pause button</li> <li>Next/Previous buttons</li> <li>Progress bar</li> <li>AirPlay icon</li> </ul> <p>Control Center: Swipe down from top-right (iPhone X+) or swipe up (older iPhones) to access quick controls.</p> <p>Add to Home Screen:</p> <ol> <li>Tap Share button in Safari</li> <li>Select \"Add to Home Screen\"</li> <li>Name it (e.g., \"Sarah's Mixtape\")</li> <li>Tap Add</li> <li>Access from home screen like an app</li> </ol> <p>Best Experience</p> <p>Adding to home screen gives you a dedicated icon and faster access. The player works perfectly as a \"web app\"!</p>"},{"location":"user/recipients/player.html#android","title":"Android","text":"<p>Best Browser: Chrome</p> <p>Features:</p> <ul> <li>\u2705 Lock screen controls</li> <li>\u2705 Notification controls</li> <li>\u2705 Background playback</li> <li>\u2705 Chromecast support</li> <li>\u2705 Android Auto support</li> <li>\u2705 Media key support</li> <li>\u2705 Sleep timer with notifications</li> </ul> <p>Lock Screen: Full media controls appear automatically when playing.</p> <p>Notification Shade: Pull down to access playback controls without opening the browser.</p> <p>Add to Home Screen:</p> <ol> <li>Tap \u22ee Menu in Chrome</li> <li>Select \"Add to Home screen\"</li> <li>Name it and confirm</li> <li>Access from app drawer</li> </ol> <p>Android Auto: If connected to car:</p> <ol> <li>Mixtape appears in Android Auto</li> <li>Use dashboard or voice controls</li> <li>Safe, hands-free operation</li> </ol>"},{"location":"user/recipients/player.html#desktop-windows-mac-linux","title":"Desktop (Windows, Mac, Linux)","text":"<p>Works in any modern browser:</p> <ul> <li>Chrome</li> <li>Firefox</li> <li>Safari</li> <li>Edge</li> <li>Opera</li> </ul> <p>Features:</p> <ul> <li>\u2705 Large album art display</li> <li>\u2705 Full track listing always visible</li> <li>\u2705 Keyboard shortcuts</li> <li>\u2705 Media key support</li> <li>\u2705 Better for long sessions</li> </ul> <p>Media Keys: Hardware media keys on your keyboard work automatically:</p> <ul> <li>Play/Pause key</li> <li>Next/Previous track keys</li> <li>Volume keys</li> </ul> <p>Window Control: Minimize the browser and controls work from background:</p> <ul> <li>Lock screen (Windows/Mac)</li> <li>Notification area</li> <li>Media popup</li> </ul>"},{"location":"user/recipients/player.html#-visual-features","title":"\ud83c\udfa8 Visual Features","text":""},{"location":"user/recipients/player.html#album-art-display","title":"Album Art Display","text":"<p>Desktop:</p> <ul> <li>Large, prominent display</li> <li>Click to expand (if supported)</li> <li>Shows during playback</li> </ul> <p>Mobile:</p> <ul> <li>Optimized for screen size</li> <li>Visible on lock screen</li> <li>Shows in notifications</li> </ul>"},{"location":"user/recipients/player.html#track-listing","title":"Track Listing","text":"<p>Desktop:</p> <ul> <li>Full tracklist always visible</li> <li>Current track highlighted</li> <li>Click any track to jump to it</li> <li>Shows track numbers, titles, artists</li> </ul> <p>Mobile:</p> <ul> <li>Swipe or scroll to see full list</li> <li>Current track highlighted</li> <li>Tap any track to jump to it</li> <li>Compact view for small screens</li> </ul>"},{"location":"user/recipients/player.html#liner-notes","title":"Liner Notes","text":"<p>If the creator added liner notes (personal message):</p> <ul> <li>Gift links: Displayed on landing page</li> <li>Direct links: Usually in expandable section</li> <li>May include: Track references (#1, #1-4 converted to titles)</li> </ul>"},{"location":"user/recipients/player.html#-playback-states","title":"\ud83d\udd04 Playback States","text":""},{"location":"user/recipients/player.html#playing-","title":"Playing \u25b6\ufe0f","text":"<p>Visual indicators:</p> <ul> <li>Play button shows pause icon</li> <li>Progress bar advances</li> <li>Track time updates</li> <li>Waveform animation (if present)</li> </ul> <p>While playing:</p> <ul> <li>Screen can turn off (mobile)</li> <li>Can switch apps (background playback)</li> <li>Lock screen controls available</li> </ul>"},{"location":"user/recipients/player.html#paused-","title":"Paused \u23f8\ufe0f","text":"<p>Visual indicators:</p> <ul> <li>Pause button shows play icon</li> <li>Progress bar stopped</li> <li>Animation frozen</li> </ul> <p>While paused:</p> <ul> <li>Position saved</li> <li>Resume from same point</li> <li>Battery-friendly</li> </ul>"},{"location":"user/recipients/player.html#buffering-","title":"Buffering \u23f3","text":"<p>What's happening:</p> <ul> <li>Loading next segment</li> <li>Usually brief</li> <li>Normal on first load</li> </ul> <p>If buffering frequently:</p> <ul> <li>Switch to lower quality</li> <li>Check internet connection</li> <li>Move closer to WiFi router</li> </ul>"},{"location":"user/recipients/player.html#loadingseeking-","title":"Loading/Seeking \u231b","text":"<p>What's happening:</p> <ul> <li>Loading new track</li> <li>Jumping to different position</li> <li>Switching quality</li> </ul> <p>Usually quick - should resolve in 1-2 seconds</p>"},{"location":"user/recipients/player.html#-best-listening-practices","title":"\ud83c\udfa7 Best Listening Practices","text":""},{"location":"user/recipients/player.html#for-first-listen","title":"For First Listen","text":"<ol> <li>Find quiet time - Appreciate the creator's work</li> <li>Read liner notes - Understand their message</li> <li>Listen in order - Experience the intended flow</li> <li>No distractions - Give it your full attention</li> </ol>"},{"location":"user/recipients/player.html#for-repeated-listening","title":"For Repeated Listening","text":"<ul> <li>Try shuffle mode for variety</li> <li>Different contexts (workout, relaxation, driving)</li> <li>Cast to different speakers/rooms</li> <li>Share with others</li> </ul>"},{"location":"user/recipients/player.html#battery-life-mobile","title":"Battery Life (Mobile)","text":"<p>To maximize battery:</p> <ul> <li>\u2705 Use lower quality settings</li> <li>\u2705 Download for offline (if available in future)</li> <li>\u2705 Close other apps</li> <li>\u2705 Reduce screen brightness</li> <li>\u2705 Use battery saver mode</li> </ul>"},{"location":"user/recipients/player.html#-sound-quality-tips","title":"\ud83d\udd0a Sound Quality Tips","text":""},{"location":"user/recipients/player.html#get-the-best-audio","title":"Get the Best Audio","text":"<p>Headphones/Earbuds:</p> <ul> <li>Use good quality headphones</li> <li>Wired often better than Bluetooth</li> <li>Ensure proper fit and seal</li> </ul> <p>Speakers:</p> <ul> <li>Cast to quality speakers when possible</li> <li>Position speakers properly</li> <li>Adjust room acoustics</li> </ul> <p>Settings:</p> <ul> <li>Use highest quality your connection allows</li> <li>Disable other bandwidth-heavy apps</li> <li>Close unnecessary browser tabs</li> </ul>"},{"location":"user/recipients/player.html#-offline-listening","title":"\ud83d\udcf1 Offline Listening","text":"<p>Currently: Mixtapes require internet connection</p> <p>Future possibilities:</p> <ul> <li>Offline mode for saved mixtapes</li> <li>Background sync when on WiFi</li> <li>Full offline playback</li> </ul> <p>Check with the creator about their server's features.</p>"},{"location":"user/recipients/player.html#-common-issues","title":"\u2753 Common Issues","text":""},{"location":"user/recipients/player.html#playback-wont-start","title":"Playback Won't Start","text":"<p>Solutions:</p> <ol> <li>Refresh the page</li> <li>Check internet connection</li> <li>Try different browser</li> <li>Clear browser cache</li> <li>Disable browser extensions</li> </ol>"},{"location":"user/recipients/player.html#stuttering-or-buffering","title":"Stuttering or Buffering","text":"<p>Solutions:</p> <ol> <li>Switch to lower quality</li> <li>Pause and let it buffer</li> <li>Close other apps/tabs</li> <li>Move closer to router</li> <li>Restart your router</li> </ol>"},{"location":"user/recipients/player.html#controls-not-working","title":"Controls Not Working","text":"<p>Solutions:</p> <ol> <li>Refresh the page</li> <li>Check if browser is up to date</li> <li>Try different browser</li> <li>Disable ad blockers</li> <li>Check if JavaScript is enabled</li> </ol>"},{"location":"user/recipients/player.html#audio-cutting-out","title":"Audio Cutting Out","text":"<p>Solutions:</p> <ol> <li>Check Bluetooth connection</li> <li>Restart Bluetooth</li> <li>Use wired headphones</li> <li>Close battery-draining apps</li> <li>Disable battery saver temporarily</li> </ol>"},{"location":"user/recipients/player.html#shuffle-not-saving","title":"Shuffle Not Saving","text":"<p>Solutions:</p> <ol> <li>Check if you're in private/incognito mode (shuffle won't save)</li> <li>Make sure browser allows cookies and storage</li> <li>To get a new random order: toggle shuffle off then on again</li> </ol>"},{"location":"user/recipients/player.html#repeat-not-working","title":"Repeat Not Working","text":"<p>Solutions:</p> <ol> <li>Not looping: Make sure repeat mode is on (button should be filled or blue)</li> <li>Can't change modes: Refresh the page</li> <li>Repeat lost on reload: Check if browser allows storage (like with shuffle)</li> <li>Track won't stop repeating: Click repeat button to cycle to \"Off\" (outlined button)</li> </ol>"},{"location":"user/recipients/player.html#sleep-timer-not-working","title":"Sleep Timer Not Working","text":"<p>Solutions:</p> <ol> <li>Timer won't start: Refresh the page and try again</li> <li>Not seeing notifications: Check browser notification permissions</li> <li>Timer doesn't stop playback: Make sure browser tab stays open</li> <li>Duration not saving: Check if browser allows cookies and storage</li> <li>Timer stopped unexpectedly: Check if device went to sleep or lost connection</li> </ol>"},{"location":"user/recipients/player.html#-related-guides","title":"\ud83d\udcda Related Guides","text":"<ul> <li>Getting Started - Opening your mixtape</li> <li>Streaming Guide - Cast to TVs and speakers</li> <li>FAQ - Common questions and troubleshooting</li> </ul> <p>Enjoy every track! \ud83c\udfb5</p>"},{"location":"user/recipients/streaming.html","title":"Streaming to Devices","text":""},{"location":"user/recipients/streaming.html#streaming-to-devices","title":"Streaming to Devices","text":"<p>Play your mixtape on bigger screens and better speakers using Chromecast, AirPlay, or Android Auto. Perfect for parties, relaxing at home, or listening in the car.</p>"},{"location":"user/recipients/streaming.html#-streaming-options-overview","title":"\ud83d\udce1 Streaming Options Overview","text":"Platform Device Best For Chromecast Android, Chrome, Windows TVs, speakers, parties AirPlay iPhone, iPad, Mac Apple ecosystem Android Auto Android phones In-car listening"},{"location":"user/recipients/streaming.html#-chromecast","title":"\ud83d\udcfa Chromecast","text":"<p>Perfect for Android users and anyone with a Chromecast device.</p>"},{"location":"user/recipients/streaming.html#what-you-can-do","title":"What You Can Do","text":"<ul> <li>Parties \u2013 Play through your home sound system</li> <li>Background music \u2013 Stream to living room while entertaining</li> <li>Shared listening \u2013 Enjoy together on the big screen</li> <li>High-quality audio \u2013 Connect to premium speakers</li> </ul>"},{"location":"user/recipients/streaming.html#requirements","title":"Requirements","text":"<p>Before you start, ensure you have:</p> <ul> <li>\u2705 Chromecast device</li> <li>Chromecast (any generation)</li> <li>Chromecast Audio</li> <li>TV with Chromecast built-in</li> <li> <p>Speakers with Chromecast built-in</p> </li> <li> <p>\u2705 Same WiFi network</p> </li> <li>Phone/computer and Chromecast on same network</li> <li> <p>2.4GHz or 5GHz WiFi works</p> </li> <li> <p>\u2705 Modern web browser</p> </li> <li>Chrome (recommended)</li> <li>Edge</li> <li>Opera</li> <li>Firefox (limited support)</li> </ul>"},{"location":"user/recipients/streaming.html#how-to-cast","title":"How to Cast","text":""},{"location":"user/recipients/streaming.html#step-by-step","title":"Step-by-Step","text":"<ol> <li>Open the mixtape on your phone or computer</li> <li>Click the shared link in your browser</li> <li> <p>Wait for player to load</p> </li> <li> <p>Look for the cast icon (\ud83d\udce1)</p> </li> <li>Usually in player controls</li> <li>Top-right corner or bottom controls</li> <li> <p>May need to click \"More options\" first</p> </li> <li> <p>Tap the cast button</p> </li> <li>Browser shows available devices</li> <li> <p>Your Chromecast devices appear in list</p> </li> <li> <p>Choose your device</p> </li> <li>Select from the list</li> <li> <p>Connection establishes (2-5 seconds)</p> </li> <li> <p>Start playing</p> </li> <li>Tap play if not already playing</li> <li>Audio streams to selected device</li> <li>Video shows album art on TV (if casting to TV)</li> </ol>"},{"location":"user/recipients/streaming.html#quick-cast-chrome","title":"Quick Cast (Chrome)","text":"<p>From Chrome browser:</p> <ol> <li>Right-click anywhere on page</li> <li>Select \"Cast...\"</li> <li>Choose your device</li> <li>Page content appears on TV/speaker</li> </ol>"},{"location":"user/recipients/streaming.html#controlling-playback","title":"Controlling Playback","text":"<p>Once casting, you can control from multiple places:</p> <p>From the Mixtape Player:</p> <ul> <li>\u25b6\ufe0f Play/Pause</li> <li>\u23ed\ufe0f Next/Previous</li> <li>\ud83d\udd0a Volume control</li> <li>\ud83d\udcca Quality settings</li> </ul> <p>From Lock Screen (Mobile):</p> <ul> <li>Full media controls appear</li> <li>Change tracks without unlocking</li> <li>See album art and track info</li> <li>Quick access to volume</li> </ul> <p>From Notification Shade (Android):</p> <ul> <li>Pull down notifications</li> <li>Media controls always visible</li> <li>Quick pause/resume</li> <li>Stop casting button</li> </ul> <p>From Hardware Keys:</p> <ul> <li>Media keys on keyboard</li> <li>Headphone controls (if supported)</li> <li>Car steering wheel controls (Android Auto)</li> </ul>"},{"location":"user/recipients/streaming.html#stopping-chromecast","title":"Stopping Chromecast","text":"<p>To stop casting:</p> <ol> <li>Click the cast icon (\ud83d\udce1) again</li> <li>Select \"Stop casting\"</li> <li>Or disconnect from device list</li> <li>Playback stops on device</li> </ol> <p>Or:</p> <ul> <li>Close the browser tab</li> <li>Exit the application</li> <li>Select a different device</li> </ul>"},{"location":"user/recipients/streaming.html#troubleshooting-chromecast","title":"Troubleshooting Chromecast","text":""},{"location":"user/recipients/streaming.html#device-not-appearing","title":"Device Not Appearing","text":"<p>Solutions:</p> <ol> <li>Ensure same WiFi network</li> <li>Restart Chromecast device</li> <li>Restart router</li> <li>Update Google Home app</li> <li>Re-setup Chromecast</li> </ol>"},{"location":"user/recipients/streaming.html#connection-drops","title":"Connection Drops","text":"<p>Solutions:</p> <ol> <li>Move router closer to Chromecast</li> <li>Reduce WiFi interference</li> <li>Restart Chromecast</li> <li>Use 5GHz WiFi if available</li> <li>Update Chromecast firmware</li> </ol>"},{"location":"user/recipients/streaming.html#audio-delay-or-stuttering","title":"Audio Delay or Stuttering","text":"<p>Solutions:</p> <ol> <li>Lower quality setting in player</li> <li>Close other streaming apps</li> <li>Restart router</li> <li>Check for router firmware updates</li> <li>Reduce WiFi congestion</li> </ol>"},{"location":"user/recipients/streaming.html#no-sound","title":"No Sound","text":"<p>Solutions:</p> <ol> <li>Check TV/speaker volume</li> <li>Verify HDMI cable (for TV)</li> <li>Test with different content</li> <li>Restart Chromecast</li> <li>Check audio output settings on TV</li> </ol>"},{"location":"user/recipients/streaming.html#-airplay-apple-devices","title":"\ud83c\udf4e AirPlay (Apple Devices)","text":"<p>Native casting for iPhone, iPad, and Mac users\u2014works automatically!</p>"},{"location":"user/recipients/streaming.html#what-you-can-do_1","title":"What You Can Do","text":"<ul> <li>Home audio \u2013 Stream to HomePod or Apple TV</li> <li>Multi-room \u2013 Play on multiple AirPlay 2 speakers</li> <li>Car \u2013 Use CarPlay in supported vehicles</li> <li>Mac \u2013 Stream from desktop to any AirPlay device</li> </ul>"},{"location":"user/recipients/streaming.html#requirements_1","title":"Requirements","text":"<ul> <li>\u2705 Safari browser (required\u2014Chrome won't work)</li> <li>\u2705 Apple device</li> <li>iPhone (iOS 11.4+)</li> <li>iPad (iOS 11.4+)</li> <li> <p>Mac (macOS 10.14+)</p> </li> <li> <p>\u2705 AirPlay device</p> </li> <li>Apple TV (3<sup>rd</sup> gen or later)</li> <li>HomePod or HomePod mini</li> <li>AirPort Express</li> <li>AirPlay 2-enabled smart TVs</li> <li> <p>AirPlay 2-enabled speakers</p> </li> <li> <p>\u2705 Same WiFi network (device and AirPlay destination)</p> </li> </ul>"},{"location":"user/recipients/streaming.html#how-to-use-airplay","title":"How to Use AirPlay","text":""},{"location":"user/recipients/streaming.html#from-iphoneipad","title":"From iPhone/iPad","text":"<ol> <li>Open mixtape in Safari (must be Safari)</li> <li>Start playing a track</li> <li>Find AirPlay controls:</li> </ol> <p>Option A - From Player:    - Look for AirPlay icon in player controls    - Tap to see available devices</p> <p>Option B - From Control Center:    - Swipe down from top-right (iPhone X+)    - Or swipe up from bottom (older iPhones)    - Tap audio card in top-right    - Tap AirPlay icon (\u25b2\ud83d\udce1)</p> <p>Option C - From Lock Screen:    - Wake your phone (don't unlock)    - See now playing card    - Tap AirPlay icon</p> <ol> <li>Select your device</li> <li>Choose Apple TV, HomePod, etc.</li> <li>Multiple devices for multi-room audio</li> <li> <p>Check devices to include them</p> </li> <li> <p>Start streaming</p> </li> <li>Audio plays on selected device(s)</li> <li>Control from any AirPlay interface</li> </ol>"},{"location":"user/recipients/streaming.html#from-mac","title":"From Mac","text":"<ol> <li>Open mixtape in Safari</li> <li>Start playing</li> <li>Click AirPlay icon in menu bar</li> <li>Or in Safari's audio controls</li> <li>Select device</li> <li>Enjoy on speakers/TV</li> </ol>"},{"location":"user/recipients/streaming.html#where-to-find-airplay","title":"Where to Find AirPlay","text":"<p>Control Center (iOS):</p> <ul> <li>Quick access to AirPlay</li> <li>Change devices on the fly</li> <li>Adjust volume per device</li> <li>See what's playing where</li> </ul> <p>Lock Screen (iOS):</p> <ul> <li>Full media controls</li> <li>AirPlay icon always visible</li> <li>No need to unlock</li> <li>Quick device switching</li> </ul> <p>Now Playing (iOS):</p> <ul> <li>Tap playing card anywhere</li> <li>Expanded AirPlay controls</li> <li>Multi-room configuration</li> <li>Individual volume controls</li> </ul> <p>Menu Bar (Mac):</p> <ul> <li>Persistent audio controls</li> <li>Quick AirPlay access</li> <li>System-wide availability</li> </ul>"},{"location":"user/recipients/streaming.html#airplay-features","title":"AirPlay Features","text":"<p>Multi-Room Audio:</p> <ul> <li>Select multiple AirPlay 2 speakers</li> <li>Synchronized playback</li> <li>Individual volume control per room</li> <li>Add/remove rooms on the fly</li> </ul> <p>Handoff:</p> <ul> <li>Start on iPhone, continue on Mac</li> <li>Seamless transition between devices</li> <li>Same account required</li> </ul> <p>CarPlay:</p> <ul> <li>Automatic when connected to car</li> <li>Dashboard controls</li> <li>Siri voice control</li> <li>Safe, hands-free operation</li> </ul>"},{"location":"user/recipients/streaming.html#controlling-airplay-playback","title":"Controlling AirPlay Playback","text":"<p>From iPhone/iPad:</p> <ul> <li>\ud83c\udfb5 Control Center \u2013 Quick access</li> <li>\ud83d\udd12 Lock screen \u2013 Full controls</li> <li>\u231a Apple Watch \u2013 Wrist controls (if paired)</li> <li>\ud83d\ude97 CarPlay \u2013 Dashboard controls</li> <li>\ud83c\udf9b\ufe0f Device itself \u2013 Physical buttons</li> </ul> <p>From Mac:</p> <ul> <li>\u2328\ufe0f Media keys \u2013 Hardware buttons</li> <li>\ud83d\uddb1\ufe0f Menu bar \u2013 Quick access</li> <li>\ud83c\udfb9 Touch Bar \u2013 MacBook Pro controls</li> </ul>"},{"location":"user/recipients/streaming.html#stopping-airplay","title":"Stopping AirPlay","text":"<p>To stop streaming:</p> <ol> <li>Open AirPlay menu</li> <li>Select \"iPhone\" or \"Mac\" (your device)</li> <li>Audio returns to device speakers</li> </ol> <p>Or:</p> <ul> <li>Disable AirPlay from Control Center</li> <li>Select different output device</li> <li>Close Safari tab</li> </ul>"},{"location":"user/recipients/streaming.html#troubleshooting-airplay","title":"Troubleshooting AirPlay","text":""},{"location":"user/recipients/streaming.html#device-not-appearing_1","title":"Device Not Appearing","text":"<p>Solutions:</p> <ol> <li>Ensure same WiFi network</li> <li>Restart AirPlay device</li> <li>Restart iPhone/iPad/Mac</li> <li>Update iOS/macOS</li> <li>Check AirPlay device is powered on</li> </ol>"},{"location":"user/recipients/streaming.html#connection-issues","title":"Connection Issues","text":"<p>Solutions:</p> <ol> <li>Toggle WiFi off and on</li> <li>Forget and rejoin WiFi network</li> <li>Restart router</li> <li>Move closer to router</li> <li>Update device firmware</li> </ol>"},{"location":"user/recipients/streaming.html#audio-cutting-out","title":"Audio Cutting Out","text":"<p>Solutions:</p> <ol> <li>Reduce distance between devices</li> <li>Minimize WiFi interference</li> <li>Close bandwidth-heavy apps</li> <li>Restart router</li> <li>Switch to 5GHz WiFi</li> </ol>"},{"location":"user/recipients/streaming.html#not-working-in-chrome","title":"Not Working in Chrome","text":"<p>This is expected! AirPlay requires Safari on iOS/Mac. Switch to Safari browser.</p>"},{"location":"user/recipients/streaming.html#-android-auto","title":"\ud83d\ude97 Android Auto","text":"<p>Listen to mixtapes safely while driving with hands-free controls.</p>"},{"location":"user/recipients/streaming.html#what-you-can-do_2","title":"What You Can Do","text":"<ul> <li>In-car listening \u2013 Mixtape integrates with dashboard</li> <li>Voice control \u2013 Use Google Assistant</li> <li>Safe operation \u2013 Designed for driving</li> <li>Large display \u2013 Easy to see track info</li> </ul>"},{"location":"user/recipients/streaming.html#requirements_2","title":"Requirements","text":"<ul> <li>\u2705 Android phone (Android 6.0+)</li> <li>\u2705 Car with Android Auto</li> <li>Built-in Android Auto</li> <li> <p>Or aftermarket head unit</p> </li> <li> <p>\u2705 Connection method</p> </li> <li>USB cable (recommended)</li> <li> <p>Wireless Android Auto (some cars)</p> </li> <li> <p>\u2705 Android Auto app (pre-installed on most phones)</p> </li> </ul>"},{"location":"user/recipients/streaming.html#how-to-use","title":"How to Use","text":"<ol> <li>Connect phone to car</li> <li>USB cable to Android Auto port</li> <li> <p>Or pair via Bluetooth (wireless)</p> </li> <li> <p>Android Auto launches automatically</p> </li> <li> <p>Or tap Android Auto on car display</p> </li> <li> <p>Open your mixtape in Chrome</p> </li> <li> <p>Before or after connecting to car</p> </li> <li> <p>Start playing</p> </li> <li> <p>Mixtape appears in Android Auto music apps</p> </li> <li> <p>Control from dashboard</p> </li> <li>Tap next/previous</li> <li>Use steering wheel buttons</li> <li>Voice commands: \"Hey Google, next track\"</li> </ol>"},{"location":"user/recipients/streaming.html#safety-features","title":"Safety Features","text":"<p>While Driving:</p> <ul> <li>\u2705 Large, simple controls</li> <li>\u2705 Voice command support</li> <li>\u2705 Minimal distraction</li> <li>\u2705 Glanceable information</li> <li>\u2705 Steering wheel integration</li> </ul> <p>What's Blocked:</p> <ul> <li>\u26d4 Complex interactions</li> <li>\u26d4 Text input while moving</li> <li>\u26d4 Detailed settings changes</li> </ul>"},{"location":"user/recipients/streaming.html#voice-control","title":"Voice Control","text":"<p>Supported commands:</p> <ul> <li>\"Hey Google, play\"</li> <li>\"Hey Google, pause\"</li> <li>\"Hey Google, next track\"</li> <li>\"Hey Google, previous track\"</li> <li>\"Hey Google, stop\"</li> </ul>"},{"location":"user/recipients/streaming.html#troubleshooting-android-auto","title":"Troubleshooting Android Auto","text":""},{"location":"user/recipients/streaming.html#not-connecting","title":"Not Connecting","text":"<p>Solutions:</p> <ol> <li>Check USB cable (try different cable)</li> <li>Enable Android Auto in car settings</li> <li>Update Android Auto app</li> <li>Enable USB debugging (developer options)</li> <li>Restart phone</li> </ol>"},{"location":"user/recipients/streaming.html#mixtape-not-appearing","title":"Mixtape Not Appearing","text":"<p>Solutions:</p> <ol> <li>Ensure mixtape is playing before connecting</li> <li>Restart Android Auto</li> <li>Update Chrome browser</li> <li>Clear Chrome app cache</li> <li>Reconnect to car</li> </ol>"},{"location":"user/recipients/streaming.html#audio-through-phone-instead-of-car","title":"Audio Through Phone Instead of Car","text":"<p>Solutions:</p> <ol> <li>Check car audio source (should be Android Auto)</li> <li>Ensure USB cable carries audio</li> <li>Adjust car volume</li> <li>Restart Android Auto connection</li> </ol>"},{"location":"user/recipients/streaming.html#-multi-device-scenarios","title":"\ud83c\udf9b\ufe0f Multi-Device Scenarios","text":""},{"location":"user/recipients/streaming.html#party-setup-chromecast","title":"Party Setup (Chromecast)","text":"<p>Connect multiple speakers:</p> <ol> <li>Use Google Home app</li> <li>Create speaker group</li> <li>Cast to group</li> <li>All speakers play in sync</li> </ol>"},{"location":"user/recipients/streaming.html#whole-home-audio-airplay-2","title":"Whole Home Audio (AirPlay 2)","text":"<p>Multi-room with Apple:</p> <ol> <li>Select multiple AirPlay 2 devices</li> <li>Adjust volume per room</li> <li>Add/remove rooms on the fly</li> <li>All play synchronized</li> </ol>"},{"location":"user/recipients/streaming.html#handoff-between-devices","title":"Handoff Between Devices","text":"<p>iPhone to Mac (AirPlay):</p> <ol> <li>Start on iPhone</li> <li>Select Mac as AirPlay destination</li> <li>Or start on Mac, move to HomePod</li> <li>Seamless transition</li> </ol>"},{"location":"user/recipients/streaming.html#-quality-considerations","title":"\ud83c\udfb5 Quality Considerations","text":""},{"location":"user/recipients/streaming.html#for-tvspeaker-streaming","title":"For TV/Speaker Streaming","text":"<p>Recommended quality:</p> <ul> <li>Use High (256k) or Original</li> <li>Better speakers deserve better quality</li> <li>You're likely on WiFi</li> <li>Take advantage of bandwidth</li> </ul>"},{"location":"user/recipients/streaming.html#for-mobilecar-streaming","title":"For Mobile/Car Streaming","text":"<p>Consider:</p> <ul> <li>Medium (192k) for mobile data</li> <li>Original/High on WiFi</li> <li>Battery impact of higher quality</li> <li>Data usage on cellular</li> </ul>"},{"location":"user/recipients/streaming.html#-comparison","title":"\ud83d\udcca Comparison","text":"Feature Chromecast AirPlay Android Auto Platforms Android, Chrome, Windows iPhone, iPad, Mac Android Setup Simple Built-in Car-dependent Multi-room Yes (via Google Home) Yes (AirPlay 2) No Voice Control Google Assistant Siri Google Assistant Lock Screen Yes Yes N/A Best For Parties, shared spaces Apple ecosystem Safe driving"},{"location":"user/recipients/streaming.html#-common-questions","title":"\u2753 Common Questions","text":""},{"location":"user/recipients/streaming.html#can-i-cast-to-multiple-devices","title":"Can I cast to multiple devices?","text":"<p>Chromecast: Yes, via Google Home speaker groups AirPlay: Yes, AirPlay 2 supports multi-room Android Auto: No, single car only</p>"},{"location":"user/recipients/streaming.html#does-casting-use-my-battery","title":"Does casting use my battery?","text":"<p>Less than direct playback! Your device just controls the stream\u2014the receiver does the heavy lifting.</p>"},{"location":"user/recipients/streaming.html#can-others-control-while-im-casting","title":"Can others control while I'm casting?","text":"<p>Chromecast: Anyone on the same network can see and control AirPlay: Only the device that started AirPlay Android Auto: Only the connected phone</p>"},{"location":"user/recipients/streaming.html#what-if-i-get-a-call-while-casting","title":"What if I get a call while casting?","text":"<ul> <li>Music pauses automatically</li> <li>Take your call</li> <li>Music resumes when call ends</li> <li>Casting stays connected</li> </ul>"},{"location":"user/recipients/streaming.html#will-casting-work-on-mobile-data","title":"Will casting work on mobile data?","text":"<p>Not recommended. Casting works best on WiFi. Mobile data can be slow and expensive for audio streaming.</p>"},{"location":"user/recipients/streaming.html#-related-guides","title":"\ud83d\udcda Related Guides","text":"<ul> <li>Player Guide - Master all player features</li> <li>Getting Started - Open and access mixtapes</li> <li>FAQ - Common questions and answers</li> </ul> <p>Enjoy your mixtape on the big screen! \ud83c\udfb5</p>"}]}